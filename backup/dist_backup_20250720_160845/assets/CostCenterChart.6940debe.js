import{_ as U,d as q,r as a,c as R,o as G,a as H,b as m,e as t,y as J,z as K,F as D,g as F,t as l,l as Q,j as $,f as X,v}from"./index.dd551b11.js";import{i as k,L as Z}from"./index.0a005eaa.js";const ee={class:"p-6 bg-gray-50 min-h-screen"},te={class:"max-w-7xl mx-auto"},se={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},oe={class:"flex items-center justify-between"},ue={class:"flex items-center space-x-3"},ae=["value"],le={key:0,class:"bg-white rounded-lg shadow-sm p-6 mb-8"},ne={class:"text-lg font-semibold text-gray-900 mb-4"},re={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ie={class:"text-center"},ce={class:"text-2xl font-bold text-blue-600"},de={class:"text-center"},me={class:"text-2xl font-bold text-green-600"},ve={class:"text-center"},fe={class:"mt-4"},ge={class:"w-full bg-gray-200 rounded-full h-3"},he={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},xe={class:"text-lg font-semibold text-gray-900 mb-4"},pe={class:"space-y-3"},ye={class:"flex justify-between"},be={class:"font-medium text-blue-600"},_e={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},Ee={class:"flex justify-between items-center mb-6"},Ce={class:"text-lg font-semibold text-gray-900"},we={class:"bg-white rounded-lg shadow-sm p-6"},Be={class:"text-lg font-semibold text-gray-900 mb-6"},De={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Fe={class:"space-y-4"},Ae={class:"space-y-2"},Se={class:"flex items-center"},ze={class:"text-sm font-medium text-gray-900"},Ie={class:"text-right"},je={class:"text-sm font-medium text-gray-900"},Le={class:"text-xs text-gray-500"},Re=q({__name:"CostCenterChart",setup($e){const r=a(new Date().getFullYear().toString()),A=a([]),S=a(!0),C=a(null),w=a(null),h=a(null),x=a(null),i={equipment:{name:"\u8BBE\u5907",color:"#3B82F6"},component:{name:"\u5143\u4EF6",color:"#10B981"},engineering:{name:"\u5DE5\u7A0B",color:"#F59E0B"},nonMainBusiness:{name:"\u975E\u4E3B\u8425\u4E1A\u52A1",color:"#EF4444"}},b=a([]),_=a({}),f=a({}),g=a([]),c=a(0),z=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"];R(()=>{const s={};return Object.keys(i).forEach(e=>{const o=f.value[e]||{cumulativeIncome:0,currentPeriodTotal:0};s[e]={...o,ratio:o.cumulativeIncome>0?Number((o.currentPeriodTotal/o.cumulativeIncome*100).toFixed(2)):0}}),s});const E=R(()=>{const s=Object.keys(i).reduce((o,u)=>{var n;return o+(((n=f.value[u])==null?void 0:n.cumulativeIncome)||0)},0),e=c.value>0?Number((s/c.value*100).toFixed(2)):0;return{totalCumulativeIncome:s,yearlyPlan:c.value,completionRate:e}}),d=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),I=s=>z[s%z.length],N=s=>s>=90?"text-green-600":s>=70?"text-blue-600":s>=50?"text-yellow-600":"text-red-600",O=()=>{const s=new Date().getFullYear(),e=[];for(let o=0;o<5;o++)e.push((s-o).toString());A.value=e},j=async()=>{try{S.value=!0,await P(),await W(),T()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s)}finally{S.value=!1}},P=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/cost-center/${r.value}`);if(s.ok){const e=await s.json();e.success&&e.data?(b.value=e.data.months||[],_.value=e.data.monthlyData||{},f.value=e.data.summary||{},c.value=e.data.yearlyPlan||0):B()}else B()}catch(s){console.error("\u83B7\u53D6\u6210\u672C\u4E2D\u5FC3\u6570\u636E\u5931\u8D25:",s),B()}},B=()=>{b.value=[],_.value={},f.value={},c.value=0,g.value=[]},W=async()=>{try{const s=[];let e=0;Object.keys(i).forEach(o=>{const u=f.value[o],n=i[o];u&&u.cumulativeIncome>0&&(s.push({name:n.name,value:u.cumulativeIncome}),e+=u.cumulativeIncome)}),g.value=s.map(o=>({...o,percentage:e>0?Number((o.value/e*100).toFixed(2)):0}))}catch(s){console.error("\u751F\u6210\u997C\u56FE\u6570\u636E\u5931\u8D25:",s),g.value=[]}},Y=()=>{C.value&&(h.value=k(C.value)),w.value&&(x.value=k(w.value))},T=()=>{M(),V()},M=()=>{if(!h.value)return;const s=[],e=b.value.length>0&&Object.keys(_.value).length>0;e&&Object.keys(i).forEach((u,n)=>{const p=_.value[u],y=i[u];p&&s.push({name:`${y.name}`,type:"line",data:p.cumulativeIncome,smooth:!0,lineStyle:{color:y.color,width:3},itemStyle:{color:y.color},areaStyle:{color:new Z(0,0,0,1,[{offset:0,color:y.color+"40"},{offset:1,color:y.color+"10"}])}})});const o={title:{text:`${r.value}\u5E74\u6210\u672C\u4E2D\u5FC3\u6708\u5EA6\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(u){if(!e)return"\u6682\u65E0\u6570\u636E";let n=`${u[0].name}<br/>`;return u.forEach(p=>{n+=`${p.seriesName}: ${d(p.value)} \u4E07\u5143<br/>`}),n}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:e?b.value:[],axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u4E07\u5143",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(u){return d(u)},fontSize:12}},series:e?s:[],graphic:e?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};h.value.setOption(o,!0)},V=()=>{if(!x.value)return;const s=g.value.length>0,e={title:{text:"\u677F\u5757\u5360\u6BD4",textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"item",formatter:function(o){return s?`${o.name}<br/>\u6570\u503C: ${d(o.value)} \u4E07\u5143<br/>\u5360\u6BD4: ${o.percent}%`:"\u6682\u65E0\u6570\u636E"}},legend:{orient:"vertical",left:"left",top:"middle",textStyle:{fontSize:12},show:s},series:[{name:"\u677F\u5757\u5360\u6BD4",type:"pie",radius:["30%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},labelLine:{show:!1},data:s?g.value.map((o,u)=>({value:o.value,name:o.name,itemStyle:{color:I(u)}})):[]}],graphic:s?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};x.value.setOption(e,!0)},L=()=>{var s,e;(s=h.value)==null||s.resize(),(e=x.value)==null||e.resize()};return G(async()=>{O(),Y(),await j(),window.addEventListener("resize",L)}),H(()=>{var s,e;(s=h.value)==null||s.dispose(),(e=x.value)==null||e.dispose(),window.removeEventListener("resize",L)}),(s,e)=>(v(),m("div",ee,[t("div",te,[e[9]||(e[9]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u6210\u672C\u4E2D\u5FC3\u7ED3\u6784\u5206\u6790"),t("p",{class:"text-gray-600 mt-2"},"\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3 - \u8BA1\u5165\u635F\u76CA\u7ED3\u6784\u5206\u6790")],-1)),t("div",se,[t("div",oe,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),t("div",ue,[e[1]||(e[1]=t("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),J(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.value=o),onChange:j,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(v(!0),m(D,null,F(A.value,o=>(v(),m("option",{key:o,value:o},l(o)+"\u5E74",9,ae))),128))],544),[[K,r.value]])])])]),c.value>0?(v(),m("div",le,[t("h3",ne,l(r.value)+"\u5E74\u5EA6\u8BA1\u5212\u5B8C\u6210\u60C5\u51B5",1),t("div",re,[t("div",ie,[t("div",ce,l(d(c.value))+" \u4E07\u5143",1),e[3]||(e[3]=t("div",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212",-1))]),t("div",de,[t("div",me,l(d(E.value.totalCumulativeIncome))+" \u4E07\u5143",1),e[4]||(e[4]=t("div",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA",-1))]),t("div",ve,[t("div",{class:Q(["text-2xl font-bold",N(E.value.completionRate)])},l(E.value.completionRate)+"%",3),e[5]||(e[5]=t("div",{class:"text-sm text-gray-600"},"\u6267\u884C\u7387",-1))])]),t("div",fe,[t("div",ge,[t("div",{class:"bg-blue-600 h-3 rounded-full transition-all duration-500",style:$(`width: ${Math.min(E.value.completionRate,100)}%`)},null,4)])])])):X("",!0),t("div",he,[(v(),m(D,null,F(i,(o,u)=>{var n;return t("div",{key:u,class:"bg-white rounded-lg shadow-sm p-6"},[t("h3",xe,l(o.name),1),t("div",pe,[t("div",ye,[e[6]||(e[6]=t("span",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA:",-1)),t("span",be,l(d(((n=f.value[u])==null?void 0:n.cumulativeIncome)||0))+" \u4E07\u5143",1)])])])}),64))]),t("div",_e,[t("div",Ee,[t("h3",Ce,l(r.value)+"\u5E74\u6708\u5EA6\u8D8B\u52BF\u5BF9\u6BD4",1),e[7]||(e[7]=t("div",{class:"flex items-center space-x-4"},[t("div",{class:"flex items-center"},[t("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),t("span",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA\u6708\u5EA6\u53D8\u5316")])],-1))]),t("div",{class:"h-[500px]",ref_key:"chartRef",ref:C},null,512)]),t("div",we,[t("h3",Be,l(r.value)+"\u5E74\u5404\u677F\u5757\u8BA1\u5165\u635F\u76CA\u5360\u6BD4\u5206\u6790",1),t("div",De,[t("div",{class:"h-[350px]",ref_key:"pieChartRef",ref:w},null,512),t("div",Fe,[e[8]||(e[8]=t("h4",{class:"text-md font-medium text-gray-800"},"\u5360\u6BD4\u8BE6\u60C5",-1)),t("div",Ae,[(v(!0),m(D,null,F(g.value,(o,u)=>(v(),m("div",{key:u,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[t("div",Se,[t("div",{class:"w-3 h-3 rounded-full mr-3",style:$(`background-color: ${I(u)}`)},null,4),t("span",ze,l(o.name),1)]),t("div",Ie,[t("div",je,l(d(o.value))+" \u4E07\u5143",1),t("div",Le,l(o.percentage)+"%",1)])]))),128))])])])])])]))}});var Oe=U(Re,[["__scopeId","data-v-08571b37"]]);export{Oe as default};
