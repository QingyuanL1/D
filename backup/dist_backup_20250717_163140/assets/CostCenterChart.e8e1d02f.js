import{_ as q,d as G,r as l,c as L,o as H,a as J,b as g,e,y as K,z as Q,F as B,g as F,t as a,l as X,j as S,f as Z,v as h}from"./index.e35cd37c.js";import{i as k,L as ee}from"./index.0a005eaa.js";const te={class:"p-6 bg-gray-50 min-h-screen"},se={class:"max-w-7xl mx-auto"},oe={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},ue={class:"flex items-center justify-between"},ae={class:"flex items-center space-x-3"},le=["value"],ne={key:0,class:"bg-white rounded-lg shadow-sm p-6 mb-8"},re={class:"text-lg font-semibold text-gray-900 mb-4"},ie={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ce={class:"text-center"},de={class:"text-2xl font-bold text-blue-600"},me={class:"text-center"},ve={class:"text-2xl font-bold text-green-600"},fe={class:"text-center"},ge={class:"mt-4"},he={class:"w-full bg-gray-200 rounded-full h-3"},xe={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},pe={class:"text-lg font-semibold text-gray-900 mb-4"},ye={class:"space-y-3"},be={class:"flex justify-between"},_e={class:"font-medium text-blue-600"},Ee={class:"flex justify-between"},Ce={class:"font-medium text-green-600"},De={class:"w-full bg-gray-200 rounded-full h-2"},we={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},Be={class:"flex justify-between items-center mb-6"},Fe={class:"text-lg font-semibold text-gray-900"},Se={class:"bg-white rounded-lg shadow-sm p-6"},Ae={class:"text-lg font-semibold text-gray-900 mb-6"},ze={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ie={class:"space-y-4"},je={class:"space-y-2"},Re={class:"flex items-center"},$e={class:"text-sm font-medium text-gray-900"},Le={class:"text-right"},ke={class:"text-sm font-medium text-gray-900"},Ne={class:"text-xs text-gray-500"},Oe=G({__name:"CostCenterChart",setup(Pe){const d=l(new Date().getFullYear().toString()),A=l([]),z=l(!0),C=l(null),D=l(null),p=l(null),y=l(null),m={equipment:{name:"\u8BBE\u5907",color:"#3B82F6"},component:{name:"\u5143\u4EF6",color:"#10B981"},engineering:{name:"\u5DE5\u7A0B",color:"#F59E0B"},nonMainBusiness:{name:"\u975E\u4E3B\u8425\u4E1A\u52A1",color:"#EF4444"}},b=l([]),_=l({}),v=l({}),x=l([]),f=l(0),I=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],N=L(()=>{const s={};return Object.keys(m).forEach(t=>{const o=v.value[t]||{cumulativeIncome:0,currentPeriodTotal:0};s[t]={...o,ratio:o.cumulativeIncome>0?Number((o.currentPeriodTotal/o.cumulativeIncome*100).toFixed(2)):0}}),s}),E=L(()=>{const s=Object.keys(m).reduce((o,u)=>{var n;return o+(((n=v.value[u])==null?void 0:n.cumulativeIncome)||0)},0),t=f.value>0?Number((s/f.value*100).toFixed(2)):0;return{totalCumulativeIncome:s,yearlyPlan:f.value,completionRate:t}}),r=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),j=s=>I[s%I.length],O=s=>s>=90?"text-green-600":s>=70?"text-blue-600":s>=50?"text-yellow-600":"text-red-600",P=()=>{const s=new Date().getFullYear(),t=[];for(let o=0;o<5;o++)t.push((s-o).toString());A.value=t},R=async()=>{try{z.value=!0,await W(),await T(),M()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s)}finally{z.value=!1}},W=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/cost-center/${d.value}`);if(s.ok){const t=await s.json();t.success&&t.data?(b.value=t.data.months||[],_.value=t.data.monthlyData||{},v.value=t.data.summary||{},f.value=t.data.yearlyPlan||0):w()}else w()}catch(s){console.error("\u83B7\u53D6\u6210\u672C\u4E2D\u5FC3\u6570\u636E\u5931\u8D25:",s),w()}},w=()=>{b.value=[],_.value={},v.value={},f.value=0,x.value=[]},T=async()=>{try{const s=[];let t=0;Object.keys(m).forEach(o=>{const u=v.value[o],n=m[o];u&&u.cumulativeIncome>0&&(s.push({name:n.name,value:u.cumulativeIncome}),t+=u.cumulativeIncome)}),x.value=s.map(o=>({...o,percentage:t>0?Number((o.value/t*100).toFixed(2)):0}))}catch(s){console.error("\u751F\u6210\u997C\u56FE\u6570\u636E\u5931\u8D25:",s),x.value=[]}},Y=()=>{C.value&&(p.value=k(C.value)),D.value&&(y.value=k(D.value))},M=()=>{V(),U()},V=()=>{if(!p.value)return;const s=[],t=b.value.length>0&&Object.keys(_.value).length>0;t&&Object.keys(m).forEach((u,n)=>{const i=_.value[u],c=m[u];i&&s.push({name:`${c.name}`,type:"line",data:i.cumulativeIncome,smooth:!0,lineStyle:{color:c.color,width:3},itemStyle:{color:c.color},areaStyle:{color:new ee(0,0,0,1,[{offset:0,color:c.color+"40"},{offset:1,color:c.color+"10"}])}})});const o={title:{text:`${d.value}\u5E74\u6210\u672C\u4E2D\u5FC3\u6708\u5EA6\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(u){if(!t)return"\u6682\u65E0\u6570\u636E";let n=`${u[0].name}<br/>`;return u.forEach(i=>{n+=`${i.seriesName}: ${r(i.value)} \u4E07\u5143<br/>`}),n}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:t?b.value:[],axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u4E07\u5143",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(u){return r(u)},fontSize:12}},series:t?s:[],graphic:t?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};p.value.setOption(o,!0)},U=()=>{if(!y.value)return;const s=x.value.length>0,t={title:{text:"\u677F\u5757\u5360\u6BD4",textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"item",formatter:function(o){return s?`${o.name}<br/>\u6570\u503C: ${r(o.value)} \u4E07\u5143<br/>\u5360\u6BD4: ${o.percent}%`:"\u6682\u65E0\u6570\u636E"}},legend:{orient:"vertical",left:"left",top:"middle",textStyle:{fontSize:12},show:s},series:[{name:"\u677F\u5757\u5360\u6BD4",type:"pie",radius:["30%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},labelLine:{show:!1},data:s?x.value.map((o,u)=>({value:o.value,name:o.name,itemStyle:{color:j(u)}})):[]}],graphic:s?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};y.value.setOption(t,!0)},$=()=>{var s,t;(s=p.value)==null||s.resize(),(t=y.value)==null||t.resize()};return H(async()=>{P(),Y(),await R(),window.addEventListener("resize",$)}),J(()=>{var s,t;(s=p.value)==null||s.dispose(),(t=y.value)==null||t.dispose(),window.removeEventListener("resize",$)}),(s,t)=>(h(),g("div",te,[e("div",se,[t[10]||(t[10]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"\u6210\u672C\u4E2D\u5FC3\u7ED3\u6784\u5206\u6790"),e("p",{class:"text-gray-600 mt-2"},"\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3 - \u7D2F\u8BA1\u6267\u884C\u7ED3\u6784\u5206\u6790")],-1)),e("div",oe,[e("div",ue,[t[2]||(t[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),e("div",ae,[t[1]||(t[1]=e("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),K(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),onChange:R,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(h(!0),g(B,null,F(A.value,o=>(h(),g("option",{key:o,value:o},a(o)+"\u5E74",9,le))),128))],544),[[Q,d.value]])])])]),f.value>0?(h(),g("div",ne,[e("h3",re,a(d.value)+"\u5E74\u5EA6\u8BA1\u5212\u5B8C\u6210\u60C5\u51B5",1),e("div",ie,[e("div",ce,[e("div",de,a(r(f.value))+" \u4E07\u5143",1),t[3]||(t[3]=e("div",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212",-1))]),e("div",me,[e("div",ve,a(r(E.value.totalCumulativeIncome))+" \u4E07\u5143",1),t[4]||(t[4]=e("div",{class:"text-sm text-gray-600"},"\u7D2F\u8BA1\u6267\u884C",-1))]),e("div",fe,[e("div",{class:X(["text-2xl font-bold",O(E.value.completionRate)])},a(E.value.completionRate)+"%",3),t[5]||(t[5]=e("div",{class:"text-sm text-gray-600"},"\u6267\u884C\u7387",-1))])]),e("div",ge,[e("div",he,[e("div",{class:"bg-blue-600 h-3 rounded-full transition-all duration-500",style:S(`width: ${Math.min(E.value.completionRate,100)}%`)},null,4)])])])):Z("",!0),e("div",xe,[(h(),g(B,null,F(m,(o,u)=>{var n,i,c;return e("div",{key:u,class:"bg-white rounded-lg shadow-sm p-6"},[e("h3",pe,a(o.name),1),e("div",ye,[e("div",be,[t[6]||(t[6]=e("span",{class:"text-sm text-gray-600"},"\u7D2F\u8BA1\u6267\u884C:",-1)),e("span",_e,a(r(((n=v.value[u])==null?void 0:n.cumulativeIncome)||0))+" \u4E07\u5143",1)]),e("div",Ee,[t[7]||(t[7]=e("span",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA:",-1)),e("span",Ce,a(r(((i=v.value[u])==null?void 0:i.currentPeriodTotal)||0))+" \u4E07\u5143",1)]),e("div",De,[e("div",{class:"bg-green-600 h-2 rounded-full transition-all duration-500",style:S(`width: ${Math.min(((c=N.value[u])==null?void 0:c.ratio)||0,100)}%`)},null,4)])])])}),64))]),e("div",we,[e("div",Be,[e("h3",Fe,a(d.value)+"\u5E74\u6708\u5EA6\u8D8B\u52BF\u5BF9\u6BD4",1),t[8]||(t[8]=e("div",{class:"flex items-center space-x-4"},[e("div",{class:"flex items-center"},[e("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),e("span",{class:"text-sm text-gray-600"},"\u7D2F\u8BA1\u6267\u884C\u6708\u5EA6\u53D8\u5316")])],-1))]),e("div",{class:"h-[500px]",ref_key:"chartRef",ref:C},null,512)]),e("div",Se,[e("h3",Ae,a(d.value)+"\u5E74\u5404\u677F\u5757\u7D2F\u8BA1\u6267\u884C\u5360\u6BD4\u5206\u6790",1),e("div",ze,[e("div",{class:"h-[350px]",ref_key:"pieChartRef",ref:D},null,512),e("div",Ie,[t[9]||(t[9]=e("h4",{class:"text-md font-medium text-gray-800"},"\u5360\u6BD4\u8BE6\u60C5",-1)),e("div",je,[(h(!0),g(B,null,F(x.value,(o,u)=>(h(),g("div",{key:u,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",Re,[e("div",{class:"w-3 h-3 rounded-full mr-3",style:S(`background-color: ${j(u)}`)},null,4),e("span",$e,a(o.name),1)]),e("div",Le,[e("div",ke,a(r(o.value))+" \u4E07\u5143",1),e("div",Ne,a(o.percentage)+"%",1)])]))),128))])])])])])]))}});var Ye=q(Oe,[["__scopeId","data-v-1c52fc92"]]);export{Ye as default};
