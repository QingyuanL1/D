import{_ as w,d as C,r as p,B as F,c as I,o as S,b,e as t,y as E,A as D,F as R,g as k,t as c,k as U,h as O,G as V,v as y,f as $}from"./index.62a10462.js";import{_ as J,M as _,r as j}from"./FormAttachmentAndRemarks.84ddfd3d.js";const L={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},M={class:"flex justify-between items-center mb-6"},T={class:"flex items-center space-x-4"},q={class:"overflow-x-auto my-6"},H={class:"w-full border-collapse border border-gray-300"},X=["rowspan"],Y={class:"border border-gray-300 px-4 py-2"},G={class:"border border-gray-300 px-4 py-2 text-right"},z={class:"border border-gray-300 px-4 py-2"},K=["onUpdate:modelValue"],Q={class:"border border-gray-300 px-4 py-2"},W=["onUpdate:modelValue"],Z={class:"border border-gray-300 px-4 py-2 text-right"},ee={class:"text-sm font-medium"},re={class:"bg-gray-50 font-bold"},te={class:"border border-gray-300 px-4 py-2 text-right"},ue={class:"border border-gray-300 px-4 py-2 text-right"},ae={class:"border border-gray-300 px-4 py-2 text-right"},ne={class:"border border-gray-300 px-4 py-2 text-right"},oe={class:"text-sm font-bold"},ce=C({__name:"AnalysisAppendix",setup(se){var P;const v=V(),n=p(((P=v.query.period)==null?void 0:P.toString())||new Date().toISOString().slice(0,7)),m={items:[{customerAttribute:"\u4E00\u5305\u9879\u76EE",yearBeginningBalance:1.08,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u4E8C\u5305\u9879\u76EE",yearBeginningBalance:396.72,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",yearBeginningBalance:1121.48,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",yearBeginningBalance:2009.38,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u8BBE\u5907\u5916\u670D",yearBeginningBalance:0,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u65B0\u80FD\u6E90\u9879\u76EE",yearBeginningBalance:297.69,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u82CF\u5DDE\u9879\u76EE",yearBeginningBalance:295.75,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u62A2\u4FEE\u9879\u76EE",yearBeginningBalance:22.96,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0},{customerAttribute:"\u8FD0\u68C0\u9879\u76EE",yearBeginningBalance:101.12,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0}]},a=p(JSON.parse(JSON.stringify(m))),i=p(""),l=p(""),s=r=>r===0?"0.00":r.toFixed(2),h=r=>r.yearBeginningBalance+r.currentPeriodNewInvoicing-r.currentPeriodAccumulatedCollection;F(()=>a.value.items,r=>{r.forEach(e=>{e.currentPeriodReceivableBalance=h(e)})},{deep:!0});const g=I(()=>{const r={yearBeginningBalance:0,currentPeriodNewInvoicing:0,currentPeriodAccumulatedCollection:0,currentPeriodReceivableBalance:0};return a.value.items.forEach(e=>{r.yearBeginningBalance+=e.yearBeginningBalance||0,r.currentPeriodNewInvoicing+=e.currentPeriodNewInvoicing||0,r.currentPeriodAccumulatedCollection+=e.currentPeriodAccumulatedCollection||0,r.currentPeriodReceivableBalance+=e.currentPeriodReceivableBalance||0}),r}),B=async r=>{try{const e=await fetch(`http://47.111.95.19:3000/nanhua-analysis-appendix/${r}`);if(!e.ok){if(e.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log(`${r}\u671F\u95F4\u65E0\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u72B6\u6001`),d();return}const u=await e.json();u.data&&u.data.items&&(a.value.items=u.data.items.map(o=>({customerAttribute:o.customerAttribute,yearBeginningBalance:Number(o.yearBeginningBalance)||0,currentPeriodNewInvoicing:Number(o.currentPeriodNewInvoicing)||0,currentPeriodAccumulatedCollection:Number(o.currentPeriodAccumulatedCollection)||0,currentPeriodReceivableBalance:Number(o.currentPeriodReceivableBalance)||0})))}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e),d()}},d=()=>{a.value=JSON.parse(JSON.stringify(m))},A=async r=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${_.NANHUA_ANALYSIS_APPENDIX}/${r}`);if(e.ok){const u=await e.json();u.success&&u.data&&(i.value=u.data.remarks||"",l.value=u.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};F(()=>v.query.period,async r=>{r&&(n.value=r.toString(),d(),await B(r.toString()),A(r.toString()))}),F(n,async(r,e)=>{r&&r!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${r}`),d(),await B(r),A(r))});const f=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-analysis-appendix",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:n.value,data:a.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await j(_.NANHUA_ANALYSIS_APPENDIX,n.value,a.value,i.value,l.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(r){console.error("\u4FDD\u5B58\u5931\u8D25:",r),alert("\u4FDD\u5B58\u5931\u8D25")}},N=()=>{a.value=JSON.parse(JSON.stringify(m)),i.value="",l.value=""};return S(async()=>{var e;d();const r=((e=v.query.period)==null?void 0:e.toString())||n.value;await B(r),A(r)}),(r,e)=>(y(),b("div",L,[t("div",M,[e[5]||(e[5]=t("h1",{class:"text-2xl font-bold"},"\u5E94\u6536\u8D26\u6B3E",-1)),t("div",T,[e[3]||(e[3]=t("span",{class:"text-sm text-gray-600"},"\u5E94\u6536\u8D26\u6B3E\u6E05\u6B20\uFF1A\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),e[4]||(e[4]=t("span",{class:"text-xs text-gray-500"},"\u5F53\u671F\u5E94\u6536\u4F59\u989D = \u5E74\u521D\u5E94\u6536\u4F59\u989D + \u5F53\u671F\u65B0\u589E\u5F00\u7968 - \u5F53\u671F\u79EF\u7D2F\u6536\u6B3E",-1)),E(t("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>n.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[D,n.value]])])]),t("div",q,[t("table",H,[e[7]||(e[7]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u521D\u5E94\u6536\u4F59\u989D"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u65B0\u589E\u5F00\u7968"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u79EF\u7D2F\u6536\u6B3E"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u5E94\u6536\u4F59\u989D")])],-1)),t("tbody",null,[(y(!0),b(R,null,k(a.value.items,(u,o)=>(y(),b("tr",{key:`item-${o}`},[o===0?(y(),b("td",{key:0,rowspan:a.value.items.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,X)):$("",!0),t("td",Y,c(u.customerAttribute),1),t("td",G,c(s(u.yearBeginningBalance)),1),t("td",z,[E(t("input",{"onUpdate:modelValue":x=>u.currentPeriodNewInvoicing=x,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,K),[[D,u.currentPeriodNewInvoicing]])]),t("td",Q,[E(t("input",{"onUpdate:modelValue":x=>u.currentPeriodAccumulatedCollection=x,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,W),[[D,u.currentPeriodAccumulatedCollection]])]),t("td",Z,[t("span",ee,c(s(u.currentPeriodReceivableBalance)),1)])]))),128)),t("tr",re,[e[6]||(e[6]=t("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),t("td",te,c(s(g.value.yearBeginningBalance)),1),t("td",ue,c(s(g.value.currentPeriodNewInvoicing)),1),t("td",ae,c(s(g.value.currentPeriodAccumulatedCollection)),1),t("td",ne,[t("span",oe,c(s(g.value.currentPeriodReceivableBalance)),1)])])])])]),U(J,{"module-id":O(_).NANHUA_ANALYSIS_APPENDIX,period:n.value,remarks:i.value,"onUpdate:remarks":e[1]||(e[1]=u=>i.value=u),suggestions:l.value,"onUpdate:suggestions":e[2]||(e[2]=u=>l.value=u)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:f,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:N,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var de=w(ce,[["__scopeId","data-v-6cb8fd64"]]);export{de as default};
