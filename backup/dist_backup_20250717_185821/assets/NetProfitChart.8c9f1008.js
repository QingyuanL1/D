import{_ as A,d as z,r as a,o as T,a as L,b as g,e as t,y as N,z as Y,F as P,g as k,t as i,l as $,j,v as x}from"./index.7df532c5.js";import{i as R,L as M}from"./index.0a005eaa.js";const I={class:"p-6 bg-gray-50 min-h-screen"},O={class:"max-w-7xl mx-auto"},U={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},V={class:"flex items-center justify-between"},W={class:"flex items-center space-x-3"},G=["value"],q={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},H={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},J={class:"text-center"},K={class:"text-2xl font-bold text-blue-600"},Q={class:"text-center"},X={class:"text-2xl font-bold text-green-600"},Z={class:"text-center"},tt={class:"mt-4"},et={class:"w-full bg-gray-200 rounded-full h-3"},st={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},ot={class:"flex justify-between items-center mb-6"},at={class:"text-lg font-semibold text-gray-900"},ut=z({__name:"NetProfitChart",setup(lt){const l=a(new Date().getFullYear().toString()),h=a([]),y=a(!0),v=a(null),n=a(null),c=a([]),r=a({}),u=a({yearlyPlan:0,currentTotal:0,completion_rate:0,previousYearSame:0,growth_rate:0,growth_amount:0}),d=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),D=s=>s>=90?"text-green-600":s>=70?"text-blue-600":s>=50?"text-yellow-600":"text-red-600",E=()=>{const s=new Date().getFullYear(),e=[];for(let o=0;o<5;o++)e.push((s-o).toString());h.value=e},p=async()=>{try{y.value=!0,await B(),S()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s)}finally{y.value=!1}},f=()=>{c.value=[],r.value={},u.value={yearlyPlan:0,currentTotal:0,completion_rate:0,previousYearSame:0,growth_rate:0,growth_amount:0}},B=async()=>{try{console.log("Fetching net profit data for year:",l.value);const s=await fetch(`http://47.111.95.19:3000/analytics/net-profit/${l.value}`);if(s.ok){const e=await s.json();console.log("Net profit data response:",e),e.success&&e.data?(c.value=e.data.months||[],r.value=e.data.monthlyData||{},u.value=e.data.summary||{yearlyPlan:0,currentTotal:0,completion_rate:0,previousYearSame:0,growth_rate:0,growth_amount:0}):f()}else f()}catch(s){console.error("\u83B7\u53D6\u51C0\u5229\u6DA6\u6570\u636E\u5931\u8D25:",s),f()}},F=()=>{v.value&&(n.value=R(v.value))},S=()=>{if(!!n.value)try{const s=c.value.length>0&&r.value&&Object.keys(r.value).length>0,e=s?c.value:[],o=s&&r.value.currentTotal?r.value.currentTotal:[];console.log("Chart data:",{monthsData:e,currentTotal:o,hasData:s});const C={title:{text:`${l.value}\u5E74\u51C0\u5229\u6DA6\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(m){if(!s)return"\u6682\u65E0\u6570\u636E";let b=`${m[0].name}<br/>`;return m.forEach(w=>{b+=`${w.seriesName}: ${d(w.value)} \u4E07\u5143<br/>`}),b}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:e,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u4E07\u5143",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(m){return d(m)},fontSize:12}},series:s?[{name:"\u51C0\u5229\u6DA6",type:"line",data:o,smooth:!0,lineStyle:{color:"#3B82F6",width:3},itemStyle:{color:"#3B82F6"},areaStyle:{color:new M(0,0,0,1,[{offset:0,color:"#3B82F640"},{offset:1,color:"#3B82F610"}])}}]:[],graphic:s?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};n.value.setOption(C,!0)}catch(s){console.error("\u66F4\u65B0\u8D8B\u52BF\u56FE\u8868\u5931\u8D25:",s)}},_=()=>{var s;(s=n.value)==null||s.resize()};return T(async()=>{E(),F(),await p(),window.addEventListener("resize",_)}),L(()=>{var s;(s=n.value)==null||s.dispose(),window.removeEventListener("resize",_)}),(s,e)=>(x(),g("div",I,[t("div",O,[e[8]||(e[8]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u51C0\u5229\u6DA6\u6570\u636E\u5206\u6790"),t("p",{class:"text-gray-600 mt-2"},"\u5E74\u5EA6\u8BA1\u5212\u4E0E\u5F53\u671F\u7D2F\u8BA1\u5BF9\u6BD4\u5206\u6790")],-1)),t("div",U,[t("div",V,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),t("div",W,[e[1]||(e[1]=t("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),N(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value=o),onChange:p,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(x(!0),g(P,null,k(h.value,o=>(x(),g("option",{key:o,value:o},i(o)+"\u5E74",9,G))),128))],544),[[Y,l.value]])])])]),t("div",q,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"\u51C0\u5229\u6DA6\u6307\u6807",-1)),t("div",H,[t("div",J,[t("div",K,i(d(u.value.yearlyPlan||0))+" \u4E07\u5143",1),e[3]||(e[3]=t("div",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212",-1))]),t("div",Q,[t("div",X,i(d(u.value.currentTotal||0))+" \u4E07\u5143",1),e[4]||(e[4]=t("div",{class:"text-sm text-gray-600"},"\u5F53\u671F\u7D2F\u8BA1",-1))]),t("div",Z,[t("div",{class:$(["text-2xl font-bold",D(u.value.completion_rate||0)])},i(u.value.completion_rate||0)+"%",3),e[5]||(e[5]=t("div",{class:"text-sm text-gray-600"},"\u6267\u884C\u7387",-1))])]),t("div",tt,[t("div",et,[t("div",{class:"bg-blue-600 h-3 rounded-full transition-all duration-500",style:j(`width: ${Math.min(u.value.completion_rate||0,100)}%`)},null,4)])])]),t("div",st,[t("div",ot,[t("h3",at,i(l.value)+"\u5E74\u6708\u5EA6\u8D8B\u52BF\u5BF9\u6BD4",1),e[7]||(e[7]=t("div",{class:"flex items-center space-x-4"},[t("div",{class:"flex items-center"},[t("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),t("span",{class:"text-sm text-gray-600"},"\u6708\u5EA6\u53D8\u5316\u8D8B\u52BF")])],-1))]),t("div",{class:"h-[500px]",ref_key:"chartRef",ref:v},null,512)])])]))}});var it=A(ut,[["__scopeId","data-v-d59f2ce0"]]);export{it as default};
