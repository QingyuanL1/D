import{_ as O,d as N,r as S,h as w,B as v,o as U,c as f,a as u,y as i,A as p,F as B,l as T,t as b,b as k,m as V,G as I,f as g,k as P}from"./index.d631cc9b.js";import{_ as $,M as h,r as R}from"./FormAttachmentAndRemarks.53a80494.js";const j={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},J={class:"flex justify-between items-center mb-6"},M={class:"flex items-center space-x-4"},q={class:"overflow-x-auto my-6"},H={class:"w-full border-collapse border border-gray-300"},X=["rowspan"],L={class:"border border-gray-300 px-4 py-2"},G={class:"border border-gray-300 px-4 py-2"},z=["onUpdate:modelValue"],K={class:"border border-gray-300 px-4 py-2"},Q=["onUpdate:modelValue"],W={class:"border border-gray-300 px-4 py-2"},Y=["onUpdate:modelValue"],Z={class:"border border-gray-300 px-4 py-2"},tt=["onUpdate:modelValue"],ut={class:"bg-gray-50 font-bold"},et={class:"border border-gray-300 px-4 py-2 text-right"},ot={class:"border border-gray-300 px-4 py-2 text-right"},st={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"border border-gray-300 px-4 py-2 text-right"},at=N({__name:"ConstructionExecutionStatus",setup(nt){var D;const x=I(),s=S(((D=x.query.period)==null?void 0:D.toString())||new Date().toISOString().slice(0,7)),C={items:[{customerAttribute:"\u4E00\u5305\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0},{customerAttribute:"\u4E8C\u5305\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0},{customerAttribute:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0},{customerAttribute:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0},{customerAttribute:"\u65B0\u80FD\u6E90\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0},{customerAttribute:"\u82CF\u5DDE\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0},{customerAttribute:"\u62A2\u4FEE\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0},{customerAttribute:"\u8FD0\u68C0\u9879\u76EE",annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0}]},a=S(JSON.parse(JSON.stringify(C))),l=S(""),d=S(""),m=e=>e===0?"0.00":e.toFixed(2),y=w(()=>{const e={annualPlannedOutput:0,selfConstruction:0,semiSelfSubcontract:0,outsourcedSubcontract:0};return a.value.items.forEach(t=>{e.annualPlannedOutput+=t.annualPlannedOutput||0,e.selfConstruction+=t.selfConstruction||0,e.semiSelfSubcontract+=t.semiSelfSubcontract||0,e.outsourcedSubcontract+=t.outsourcedSubcontract||0}),e}),_=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/nanhua-construction-execution-status/${e}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log(`${e}\u671F\u95F4\u65E0\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u72B6\u6001`),c();return}const o=await t.json();o.data&&o.data.items&&(a.value.items=o.data.items.map(r=>({customerAttribute:r.customerAttribute,annualPlannedOutput:Number(r.annualPlannedOutput)||0,selfConstruction:Number(r.selfConstruction)||0,semiSelfSubcontract:Number(r.semiSelfSubcontract)||0,outsourcedSubcontract:Number(r.outsourcedSubcontract)||0})))}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t),c()}},c=()=>{a.value=JSON.parse(JSON.stringify(C))},E=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${h.NANHUA_CONSTRUCTION_EXECUTION_STATUS}/${e}`);if(t.ok){const o=await t.json();o.success&&o.data&&(l.value=o.data.remarks||"",d.value=o.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",t)}};v(()=>x.query.period,async e=>{e&&(s.value=e.toString(),c(),await _(e.toString()),E(e.toString()))}),v(s,async(e,t)=>{e&&e!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${e}`),c(),await _(e),E(e))});const A=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-construction-execution-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:s.value,data:{items:a.value.items}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await R(h.NANHUA_CONSTRUCTION_EXECUTION_STATUS,s.value,{items:a.value.items},l.value,d.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25")}},F=()=>{c(),l.value="",d.value=""};return U(async()=>{var t;c();const e=((t=x.query.period)==null?void 0:t.toString())||s.value;await _(e),E(e)}),(e,t)=>(g(),f("div",j,[u("div",J,[t[4]||(t[4]=u("h1",{class:"text-2xl font-bold"},"\u65BD\u5DE5\u6267\u884C\u60C5\u51B5",-1)),u("div",M,[t[3]||(t[3]=u("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),i(u("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),type:"month",class:"px-3 py-2 border rounded"},null,512),[[p,s.value]])])]),u("div",q,[u("table",H,[t[6]||(t[6]=u("thead",{class:"sticky top-0 bg-white"},[u("tr",{class:"bg-gray-50"},[u("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212\u4EA7\u503C"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u81EA\u5236/\u81EA\u884C\u65BD\u5DE5"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u534A\u81EA\u5236/\u5206\u5305"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5916\u53D1/\u8F6C\u5305")])],-1)),u("tbody",null,[(g(!0),f(B,null,T(a.value.items,(o,r)=>(g(),f("tr",{key:`item-${r}`},[r===0?(g(),f("td",{key:0,rowspan:a.value.items.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,X)):P("",!0),u("td",L,b(o.customerAttribute),1),u("td",G,[i(u("input",{"onUpdate:modelValue":n=>o.annualPlannedOutput=n,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,z),[[p,o.annualPlannedOutput]])]),u("td",K,[i(u("input",{"onUpdate:modelValue":n=>o.selfConstruction=n,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Q),[[p,o.selfConstruction]])]),u("td",W,[i(u("input",{"onUpdate:modelValue":n=>o.semiSelfSubcontract=n,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Y),[[p,o.semiSelfSubcontract]])]),u("td",Z,[i(u("input",{"onUpdate:modelValue":n=>o.outsourcedSubcontract=n,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,tt),[[p,o.outsourcedSubcontract]])])]))),128)),u("tr",ut,[t[5]||(t[5]=u("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1\u4EA7\u503C",-1)),u("td",et,b(m(y.value.annualPlannedOutput)),1),u("td",ot,b(m(y.value.selfConstruction)),1),u("td",st,b(m(y.value.semiSelfSubcontract)),1),u("td",rt,b(m(y.value.outsourcedSubcontract)),1)])])])]),k($,{"module-id":V(h).NANHUA_CONSTRUCTION_EXECUTION_STATUS,period:s.value,remarks:l.value,"onUpdate:remarks":t[1]||(t[1]=o=>l.value=o),suggestions:d.value,"onUpdate:suggestions":t[2]||(t[2]=o=>d.value=o)},null,8,["module-id","period","remarks","suggestions"]),u("div",{class:"mt-4 flex justify-end space-x-4"},[u("button",{onClick:A,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),u("button",{onClick:F,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var dt=O(at,[["__scopeId","data-v-6b26cd27"]]);export{dt as default};
