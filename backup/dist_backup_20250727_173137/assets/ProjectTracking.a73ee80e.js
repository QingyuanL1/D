import{_ as k,d as C,r as b,h as S,B as v,o as w,c as m,a as t,y as D,A as E,F as B,l as P,t as u,b as T,m as O,G as R,f as x,k as U}from"./index.a1c43a78.js";import{_ as J,M as _,r as $}from"./FormAttachmentAndRemarks.e6065ef7.js";const I={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},V={class:"flex justify-between items-center mb-6"},q={class:"flex items-center space-x-4"},G={class:"overflow-x-auto my-6"},M={class:"w-full border-collapse border border-gray-300"},H=["rowspan"],K={class:"border border-gray-300 px-4 py-2"},L={class:"border border-gray-300 px-4 py-2 text-right"},z={class:"border border-gray-300 px-4 py-2"},Q=["onUpdate:modelValue"],W={class:"border border-gray-300 px-4 py-2 text-right"},X={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"text-sm font-medium"},Z={class:"bg-gray-50 font-bold"},ee={class:"border border-gray-300 px-4 py-2 text-right"},re={class:"border border-gray-300 px-4 py-2 text-right"},te={class:"border border-gray-300 px-4 py-2 text-right"},ae={class:"border border-gray-300 px-4 py-2 text-right"},se={class:"text-sm font-bold"},ue=C({__name:"ProjectTracking",setup(oe){var f;const l=R(),s=b(((f=l.query.period)==null?void 0:f.toString())||new Date().toISOString().slice(0,7)),h={projects:[{projectName:"\u4E00\u5305\u9879\u76EE",yearlyPlan:7e3,current:0,accumulated:0},{projectName:"\u4E8C\u5305\u9879\u76EE",yearlyPlan:2e3,current:0,accumulated:0},{projectName:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",yearlyPlan:6e3,current:0,accumulated:0},{projectName:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",yearlyPlan:2e3,current:0,accumulated:0},{projectName:"\u65B0\u80FD\u6E90\u9879\u76EE",yearlyPlan:4e3,current:0,accumulated:0},{projectName:"\u82CF\u5DDE\u9879\u76EE",yearlyPlan:1e3,current:0,accumulated:0},{projectName:"\u81EA\u5EFA\u9879\u76EE",yearlyPlan:0,current:0,accumulated:0}]},o=b(JSON.parse(JSON.stringify(h))),c=b(""),d=b(""),p=e=>e===0?"0.00":e.toFixed(2),F=(e,r)=>!e||e===0?"0.00":(r/e*100).toFixed(2),y=S(()=>{const e={yearlyPlan:0,current:0,accumulated:0,progress:0};return o.value.projects.forEach(r=>{e.yearlyPlan+=r.yearlyPlan||0,e.current+=r.current||0,e.accumulated+=r.accumulated||0}),e.progress=e.yearlyPlan>0?e.accumulated/e.yearlyPlan*100:0,e.progress=parseFloat(e.progress.toFixed(2)),e}),i=async e=>{try{const r=await fetch(`http://47.111.95.19:3000/nanhua-project-tracking/${e}`);if(!r.ok){if(r.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const a=await r.json();a.data&&a.data.projects&&(o.value.projects=a.data.projects.map(n=>({projectName:n.projectName,yearlyPlan:Number(n.yearlyPlan)||0,current:Number(n.current)||0,accumulated:Number(n.accumulated)||0})))}catch(r){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",r)}},g=async e=>{try{const r=await fetch(`http://47.111.95.19:3000/forms/submission/${_.NANHUA_PROJECT_TRACKING}/${e}`);if(r.ok){const a=await r.json();a.success&&a.data&&(c.value=a.data.remarks||"",d.value=a.data.suggestions||"")}}catch(r){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",r)}};v(()=>l.query.period,e=>{e&&(s.value=e.toString(),i(e.toString()),g(e.toString()))}),v(s,(e,r)=>{e&&e!==r&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${r} -> ${e}`),i(e),g(e))});const N=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-project-tracking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:s.value,data:o.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await $(_.NANHUA_PROJECT_TRACKING,s.value,o.value,c.value,d.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25")}},j=()=>{o.value=JSON.parse(JSON.stringify(h)),c.value="",d.value=""};return w(()=>{l.query.period?(i(l.query.period.toString()),g(l.query.period.toString())):(i(s.value),g(s.value))}),(e,r)=>(x(),m("div",I,[t("div",V,[r[4]||(r[4]=t("h1",{class:"text-2xl font-bold"},"\u9879\u76EE\u8DDF\u8E2A\u60C5\u51B5",-1)),t("div",q,[r[3]||(r[3]=t("span",{class:"text-sm text-gray-600"},"\u5355\u4F4D\uFF1A\u4E07\u5143",-1)),D(t("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>s.value=a),type:"month",class:"px-3 py-2 border rounded"},null,512),[[E,s.value]])])]),t("div",G,[t("table",M,[r[6]||(r[6]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u6267\u884C\u8FDB\u5EA6")])],-1)),t("tbody",null,[(x(!0),m(B,null,P(o.value.projects,(a,n)=>(x(),m("tr",{key:`project-${n}`},[n===0?(x(),m("td",{key:0,rowspan:o.value.projects.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,H)):U("",!0),t("td",K,u(a.projectName),1),t("td",L,u(p(a.yearlyPlan)),1),t("td",z,[D(t("input",{"onUpdate:modelValue":A=>a.current=A,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Q),[[E,a.current]])]),t("td",W,u(p(a.accumulated)),1),t("td",X,[t("span",Y,u(F(a.yearlyPlan,a.accumulated))+"%",1)])]))),128)),t("tr",Z,[r[5]||(r[5]=t("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),t("td",ee,u(p(y.value.yearlyPlan)),1),t("td",re,u(p(y.value.current)),1),t("td",te,u(p(y.value.accumulated)),1),t("td",ae,[t("span",se,u(y.value.progress)+"%",1)])])])])]),T(J,{"module-id":O(_).NANHUA_PROJECT_TRACKING,period:s.value,remarks:c.value,"onUpdate:remarks":r[1]||(r[1]=a=>c.value=a),suggestions:d.value,"onUpdate:suggestions":r[2]||(r[2]=a=>d.value=a)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:N,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:j,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ce=k(ue,[["__scopeId","data-v-66ba91c4"]]);export{ce as default};
