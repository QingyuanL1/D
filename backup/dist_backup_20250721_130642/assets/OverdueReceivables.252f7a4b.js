import{_ as z,d as Q,r as m,c as W,B as q,o as X,b as i,e as t,y as v,A as _,F as $,g as I,t as n,k as Y,h as Z,G as ee,v as d,f as U}from"./index.2d945b9a.js";import{_ as te,r as oe,M as P,l as ue}from"./FormAttachmentAndRemarks.4fb64ea3.js";const re={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},ae={class:"flex justify-between items-center mb-6"},se={class:"flex items-center space-x-4"},ne={class:"overflow-x-auto my-6"},le={class:"w-full border-collapse border border-gray-300"},ce=["rowspan"],pe={class:"border border-gray-300 px-4 py-2"},ie={class:"border border-gray-300 px-4 py-2"},de={class:"border border-gray-300 px-4 py-2"},ye=["onUpdate:modelValue","onInput"],ge={class:"border border-gray-300 px-4 py-2"},he=["onUpdate:modelValue","onInput"],Fe={class:"border border-gray-300 px-4 py-2"},be={class:"border border-gray-300 px-4 py-2"},Ee=["rowspan"],me={class:"border border-gray-300 px-4 py-2"},ve={class:"border border-gray-300 px-4 py-2"},_e={class:"border border-gray-300 px-4 py-2"},De=["onUpdate:modelValue","onInput"],Be={class:"border border-gray-300 px-4 py-2"},Re=["onUpdate:modelValue","onInput"],Ae={class:"border border-gray-300 px-4 py-2"},xe={class:"border border-gray-300 px-4 py-2"},we=["rowspan"],fe={class:"border border-gray-300 px-4 py-2"},Te={class:"border border-gray-300 px-4 py-2"},Ce={class:"border border-gray-300 px-4 py-2"},Ve=["onUpdate:modelValue","onInput"],ke={class:"border border-gray-300 px-4 py-2"},Se=["onUpdate:modelValue","onInput"],$e={class:"border border-gray-300 px-4 py-2"},Ie={class:"border border-gray-300 px-4 py-2"},Ue={class:"bg-gray-50 font-bold"},Pe={class:"border border-gray-300 px-4 py-2"},je={class:"border border-gray-300 px-4 py-2"},Oe={class:"border border-gray-300 px-4 py-2"},qe={class:"border border-gray-300 px-4 py-2"},Le={class:"border border-gray-300 px-4 py-2"},Ne=Q({__name:"OverdueReceivables",setup(Me){var j;const w=ee(),l=m(((j=w.query.period)==null?void 0:j.toString())||new Date().toISOString().slice(0,7)),B=m(""),R=m(""),f=()=>[{customerType:"\u4E0A\u6D77",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u56FD\u7F51",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u6C5F\u82CF",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u8F93\u914D\u7535\u5185\u914D",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u897F\u95E8\u5B50",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u540C\u4E1A",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u7528\u6237",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u5176\u5B83",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"}],T=()=>[{customerType:"\u7528\u6237",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"}],C=()=>[{customerType:"\u4E00\u5305",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u4E8C\u5305",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u57DF\u5185\u5408\u4F5C",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u57DF\u5916\u5408\u4F5C",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"},{customerType:"\u5176\u5B83",initialBalance:"0",newAddition:"0",monthlyReceipt:"0",totalReceipt:0,progress:"0.00%"}],y=m(f()),g=m(T()),h=m(C()),F=m({\u8BBE\u5907:{},\u5143\u4EF6:{},\u5DE5\u7A0B:{}}),c=r=>r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),L=r=>{const[u,e]=r.split("-").map(Number);return{year:u,month:e}},N=r=>{const{year:u,month:e}=L(r),a=[];for(let o=1;o<e;o++)a.push(`${u}-${o.toString().padStart(2,"0")}`);return a},E=r=>{const u=parseFloat(r.initialBalance.replace(/,/g,""))||0,e=parseFloat(r.newAddition.replace(/,/g,""))||0,a=parseFloat(r.monthlyReceipt.replace(/,/g,""))||0,o=r.historicalReceipts||0;r.totalReceipt=o+a;const p=u+e;if(p>0){const s=(r.totalReceipt/p*100).toFixed(2);r.progress=`${s}%`}else r.progress="0.00%"},A=W(()=>{let r=0,u=0,e=0,a=0;y.value.forEach(s=>{r+=s.yearlyPlan||0,u+=parseFloat(s.newAddition.replace(/,/g,""))||0,e+=parseFloat(s.monthlyReceipt.replace(/,/g,""))||0,a+=s.totalReceipt||0}),g.value.forEach(s=>{r+=s.yearlyPlan||0,u+=parseFloat(s.newAddition.replace(/,/g,""))||0,e+=parseFloat(s.monthlyReceipt.replace(/,/g,""))||0,a+=s.totalReceipt||0}),h.value.forEach(s=>{r+=s.yearlyPlan||0,u+=parseFloat(s.newAddition.replace(/,/g,""))||0,e+=parseFloat(s.monthlyReceipt.replace(/,/g,""))||0,a+=s.totalReceipt||0});let o="0.00%";const p=r+u;return p>0&&(o=`${(a/p*100).toFixed(2)}%`),{initialBalance:r,newAddition:u,monthlyReceipt:e,totalReceipt:a,progress:o}}),M={\u8BBE\u5907:{\u4E0A\u6D77:1349.6,\u56FD\u7F51:462.01,\u6C5F\u82CF:1123.94,\u8F93\u914D\u7535\u5185\u914D:176.86,\u897F\u95E8\u5B50:0,\u540C\u4E1A:46.23,\u7528\u6237:1705.24,\u5176\u5B83:391.31},\u5143\u4EF6:{\u7528\u6237:380.94},\u5DE5\u7A0B:{\u4E00\u5305:106.86,\u4E8C\u5305:189.12,\u57DF\u5185\u5408\u4F5C:358.51,\u57DF\u5916\u5408\u4F5C:564.23,\u5176\u5B83:324.3}},K=async r=>{try{const u=N(r);if(u.length===0){console.log("\u6CA1\u6709\u5386\u53F2\u671F\u95F4\u6570\u636E\u9700\u8981\u52A0\u8F7D");return}console.log("\u6B63\u5728\u52A0\u8F7D\u5386\u53F2\u6570\u636E\uFF0C\u671F\u95F4:",u),F.value={\u8BBE\u5907:{},\u5143\u4EF6:{},\u5DE5\u7A0B:{}};for(const e of u)try{const a=await fetch(`http://47.111.95.19:3000/overdue-receivables/${e}`);if(a.ok){const o=await a.json();o.success&&o.data&&Array.isArray(o.data)&&o.data.forEach(p=>{const s=p.segment,b=p.customerType,k=parseFloat(p.monthlyReceipt||"0");F.value[s]||(F.value[s]={}),F.value[s][b]||(F.value[s][b]=0),F.value[s][b]+=k})}}catch(a){console.error(`\u52A0\u8F7D\u671F\u95F4 ${e} \u7684\u6570\u636E\u5931\u8D25:`,a)}console.log("\u5386\u53F2\u6570\u636E\u52A0\u8F7D\u5B8C\u6210:",F.value)}catch(u){console.error("\u52A0\u8F7D\u5386\u53F2\u6570\u636E\u5931\u8D25:",u)}},D=(r,u,e)=>r.map(a=>{var k,O;const o=u==null?void 0:u.find(x=>x.segment===e&&x.customerType===a.customerType),s=((k=M[e])==null?void 0:k[a.customerType])||0,b=((O=F.value[e])==null?void 0:O[a.customerType])||0;if(o){const x=o.monthlyReceipt||"0",J=b+(parseFloat(x.replace(/,/g,""))||0);return{customerType:a.customerType,initialBalance:s.toString(),newAddition:o.newAddition||"0",monthlyReceipt:x,totalReceipt:J,progress:"0.00%",yearlyPlan:s,historicalReceipts:b}}else return{customerType:a.customerType,initialBalance:s.toString(),newAddition:"0",monthlyReceipt:"0",totalReceipt:b,progress:"0.00%",yearlyPlan:s,historicalReceipts:b}}).map(a=>(E(a),a)),V=async r=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u903E\u671F\u5E94\u6536\u6B3E\u6570\u636E\uFF0C\u671F\u95F4: ${r}`),await K(r);const u=await fetch(`http://47.111.95.19:3000/overdue-receivables/${r}`);let e=[];if(u.ok){const a=await u.json();console.log("API\u8FD4\u56DE\u6570\u636E:",a),a.success&&a.data&&Array.isArray(a.data)&&(e=a.data,console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76..."))}else u.status===404?console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4F7F\u7528\u9884\u7B97\u6570\u636E\u586B\u5145"):console.log("\u52A0\u8F7D\u6570\u636E\u5931\u8D25\uFF0C\u4F7F\u7528\u9884\u7B97\u6570\u636E\u586B\u5145");y.value=D(f(),e,"\u8BBE\u5907"),g.value=D(T(),e,"\u5143\u4EF6"),h.value=D(C(),e,"\u5DE5\u7A0B"),console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{equipmentData:y.value,componentData:g.value,projectData:h.value})}catch(u){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",u),y.value=D(f(),[],"\u8BBE\u5907"),g.value=D(T(),[],"\u5143\u4EF6"),h.value=D(C(),[],"\u5DE5\u7A0B")}};q(()=>w.query.period,r=>{r&&(l.value=r.toString(),V(r.toString()),S())}),q(l,r=>{V(r),S()});const G=async()=>{try{const r=[...y.value.map(o=>({segment:"\u8BBE\u5907",customerType:o.customerType,newAddition:o.newAddition,monthlyReceipt:o.monthlyReceipt})),...g.value.map(o=>({segment:"\u5143\u4EF6",customerType:o.customerType,newAddition:o.newAddition,monthlyReceipt:o.monthlyReceipt})),...h.value.map(o=>({segment:"\u5DE5\u7A0B",customerType:o.customerType,newAddition:o.newAddition,monthlyReceipt:o.monthlyReceipt}))],u={period:l.value,data:r};console.log("\u4FDD\u5B58\u6570\u636E:",u);const e=await fetch("http://47.111.95.19:3000/overdue-receivables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!e.ok){const o=await e.text();throw new Error(`\u4FDD\u5B58\u5931\u8D25: ${e.status} - ${o}`)}const a={equipment:y.value,component:g.value,project:h.value};await oe(P.OVERDUE_RECEIVABLES,l.value,a,B.value,R.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(r){console.error("\u4FDD\u5B58\u5931\u8D25:",r),alert("\u4FDD\u5B58\u5931\u8D25: "+(r instanceof Error?r.message:"\u672A\u77E5\u9519\u8BEF"))}},H=()=>{y.value=f(),g.value=T(),h.value=C(),B.value="",R.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")},S=async()=>{const{remarks:r,suggestions:u}=await ue(P.OVERDUE_RECEIVABLES,l.value);B.value=r,R.value=u};return X(()=>{console.log("\u903E\u671F\u5E94\u6536\u6B3E\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",l.value),w.query.period?V(w.query.period.toString()):V(l.value),S()}),(r,u)=>(d(),i("div",re,[t("div",ae,[u[3]||(u[3]=t("h1",{class:"text-2xl font-bold"},"\u903E\u671F\u5E94\u6536\u8D26\u6B3E\u60C5\u51B5\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),t("div",se,[v(t("input",{"onUpdate:modelValue":u[0]||(u[0]=e=>l.value=e),type:"month",class:"px-3 py-2 border rounded"},null,512),[[_,l.value]])])]),t("div",ne,[t("table",le,[u[5]||(u[5]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u521D\u4F59\u989D"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u672C\u5E74\u65B0\u589E"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u6708\u6536\u6B3E"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u5DF2\u6536\u6B3E"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u6536\u6B3E\u8FDB\u5EA6")])],-1)),t("tbody",null,[(d(!0),i($,null,I(y.value,(e,a)=>(d(),i("tr",{key:`equipment-${a}`},[a===0?(d(),i("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:y.value.length}," \u8BBE\u5907 ",8,ce)):U("",!0),t("td",pe,n(e.customerType),1),t("td",ie,n(c(e.yearlyPlan||0)),1),t("td",de,[v(t("input",{"onUpdate:modelValue":o=>e.newAddition=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,ye),[[_,e.newAddition]])]),t("td",ge,[v(t("input",{"onUpdate:modelValue":o=>e.monthlyReceipt=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,he),[[_,e.monthlyReceipt]])]),t("td",Fe,n(c(e.totalReceipt)),1),t("td",be,n(e.progress),1)]))),128)),(d(!0),i($,null,I(g.value,(e,a)=>(d(),i("tr",{key:`component-${a}`},[a===0?(d(),i("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:g.value.length}," \u5143\u4EF6 ",8,Ee)):U("",!0),t("td",me,n(e.customerType),1),t("td",ve,n(c(e.yearlyPlan||0)),1),t("td",_e,[v(t("input",{"onUpdate:modelValue":o=>e.newAddition=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,De),[[_,e.newAddition]])]),t("td",Be,[v(t("input",{"onUpdate:modelValue":o=>e.monthlyReceipt=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,Re),[[_,e.monthlyReceipt]])]),t("td",Ae,n(c(e.totalReceipt)),1),t("td",xe,n(e.progress),1)]))),128)),(d(!0),i($,null,I(h.value,(e,a)=>(d(),i("tr",{key:`project-${a}`},[a===0?(d(),i("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:h.value.length}," \u5DE5\u7A0B ",8,we)):U("",!0),t("td",fe,n(e.customerType),1),t("td",Te,n(c(e.yearlyPlan||0)),1),t("td",Ce,[v(t("input",{"onUpdate:modelValue":o=>e.newAddition=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,Ve),[[_,e.newAddition]])]),t("td",ke,[v(t("input",{"onUpdate:modelValue":o=>e.monthlyReceipt=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,Se),[[_,e.monthlyReceipt]])]),t("td",$e,n(c(e.totalReceipt)),1),t("td",Ie,n(e.progress),1)]))),128)),t("tr",Ue,[u[4]||(u[4]=t("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),t("td",Pe,n(c(A.value.initialBalance)),1),t("td",je,n(c(A.value.newAddition)),1),t("td",Oe,n(c(A.value.monthlyReceipt)),1),t("td",qe,n(c(A.value.totalReceipt)),1),t("td",Le,n(A.value.progress),1)])])])]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:G,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:H,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")]),Y(te,{"module-id":Z(P).OVERDUE_RECEIVABLES,period:l.value,remarks:B.value,"onUpdate:remarks":u[1]||(u[1]=e=>B.value=e),suggestions:R.value,"onUpdate:suggestions":u[2]||(u[2]=e=>R.value=e)},null,8,["module-id","period","remarks","suggestions"])]))}});var He=z(Ne,[["__scopeId","data-v-4a5e626b"]]);export{He as default};
