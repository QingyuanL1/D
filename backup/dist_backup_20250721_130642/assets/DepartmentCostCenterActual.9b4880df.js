import{_ as P,d as O,r as A,c as $,B as C,o as U,b as E,e,y as R,A as S,F as M,g as j,t as s,k as q,h as I,G as J,v as D}from"./index.2d945b9a.js";import{_ as L,M as f,r as V}from"./FormAttachmentAndRemarks.4fb64ea3.js";const G={class:"max-w-[1600px] mx-auto bg-white rounded-lg shadow-lg p-6"},z={class:"flex justify-between items-center mb-6"},H={class:"flex items-center space-x-4"},K={class:"overflow-x-auto my-6"},Q={class:"w-full border-collapse border border-gray-300"},W={class:"border border-gray-300 px-4 py-2 font-medium"},X={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],tt={class:"border border-gray-300 px-4 py-2 text-right"},et={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"text-sm font-medium"},ut={class:"border border-gray-300 px-4 py-2 text-right"},at={class:"text-sm font-medium"},ot={class:"bg-gray-50 font-bold"},st={class:"border border-gray-300 px-4 py-2 text-right"},nt={class:"border border-gray-300 px-4 py-2 text-right"},dt={class:"border border-gray-300 px-4 py-2 text-right"},ct={class:"border border-gray-300 px-4 py-2 text-right"},lt={class:"text-sm font-bold"},mt={class:"border border-gray-300 px-4 py-2 text-right"},it={class:"text-sm font-bold"},pt=O({__name:"DepartmentCostCenterActual",setup(yt){var v;const l=J(),a=A(((v=l.query.period)==null?void 0:v.toString())||new Date().toISOString().slice(0,7)),B={departments:[{departmentName:"\u603B\u7ECF\u7406\u5BA4",yearlyBudget:361.36,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u7EFC\u5408\u90E8",yearlyBudget:461.45,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8D22\u52A1\u90E8",yearlyBudget:93.07,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u5B89\u8D28\u90E8",yearlyBudget:116,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u5DE5\u7A0B\u90E8",yearlyBudget:821.07,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8FD0\u68C0\u90E8",yearlyBudget:569.9,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8425\u9500\u90E8-\u9500\u552E",yearlyBudget:125.13,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8425\u9500\u90E8-\u5546\u52A1",yearlyBudget:53.37,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8425\u9500\u90E8-\u8BBE\u5907",yearlyBudget:1048.86,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8425\u9500\u90E8-\u91C7\u8D2D",yearlyBudget:.47,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8425\u9500\u90E8-\u540E\u52E4",yearlyBudget:200,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0}]},c=A(JSON.parse(JSON.stringify(B))),m=A(""),i=A(""),n=r=>r===0?"0.00":r.toFixed(2),y=async r=>{try{const[t,u]=r.split("-"),o=parseInt(u);for(let d of c.value.departments){let _=0;for(let h=1;h<=o;h++){const F=`${t}-${h.toString().padStart(2,"0")}`;try{const b=await fetch(`http://47.111.95.19:3000/department-cost-center-actual/${F}`);if(b.ok){const N=(await b.json()).data.departments.find(k=>k.departmentName===d.departmentName);N&&(_+=N.currentAmount||0)}}catch(b){console.warn(`\u65E0\u6CD5\u52A0\u8F7D${F}\u7684\u6570\u636E:`,b)}}d.accumulatedAmount=_,d.executionProgress=d.yearlyBudget>0?_/d.yearlyBudget*100:0,d.actualRatio=0}}catch(t){console.error("\u8BA1\u7B97\u7D2F\u8BA1\u6570\u636E\u5931\u8D25:",t)}},p=$(()=>{const r={yearlyBudget:0,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0};return c.value.departments.forEach(t=>{r.yearlyBudget+=t.yearlyBudget||0,r.currentAmount+=t.currentAmount||0,r.accumulatedAmount+=t.accumulatedAmount||0}),r.executionProgress=r.yearlyBudget>0?r.accumulatedAmount/r.yearlyBudget*100:0,r.actualRatio=0,r}),g=async r=>{try{const t=await fetch(`http://47.111.95.19:3000/department-cost-center-actual/${r}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const u=await t.json();u.data&&u.data.departments&&(c.value.departments=u.data.departments.map(o=>({departmentName:o.departmentName,yearlyBudget:Number(o.yearlyBudget)||0,currentAmount:Number(o.currentAmount)||0,accumulatedAmount:Number(o.accumulatedAmount)||0,executionProgress:Number(o.executionProgress)||0,actualRatio:Number(o.actualRatio)||0})))}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t)}},x=async r=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${f.DEPARTMENT_COST_CENTER_ACTUAL}/${r}`);if(t.ok){const u=await t.json();u.success&&u.data&&(m.value=u.data.remarks||"",i.value=u.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",t)}};C(()=>l.query.period,async r=>{r&&(a.value=r.toString(),await g(r.toString()),await y(r.toString()),x(r.toString()))}),C(a,async(r,t)=>{r&&r!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${r}`),await g(r),await y(r),x(r))});const w=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/department-cost-center-actual",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:c.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await V(f.DEPARTMENT_COST_CENTER_ACTUAL,a.value,c.value,m.value,i.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(r){console.error("\u4FDD\u5B58\u5931\u8D25:",r),alert("\u4FDD\u5B58\u5931\u8D25")}},T=()=>{c.value=JSON.parse(JSON.stringify(B)),m.value="",i.value=""};return U(async()=>{l.query.period?(await g(l.query.period.toString()),await y(l.query.period.toString()),x(l.query.period.toString())):(await g(a.value),await y(a.value),x(a.value))}),(r,t)=>(D(),E("div",G,[e("div",z,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold"},"\u90E8\u95E8\u6210\u672C\u4E2D\u5FC3\u5B9E\u9645\u53D1\u751F\u60C5\u51B5",-1)),e("div",H,[t[3]||(t[3]=e("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),R(e("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>a.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[S,a.value]])])]),e("div",K,[e("table",Q,[t[8]||(t[8]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2"},"\u90E8\u95E8\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u9884\u7B97"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u6267\u884C\u8FDB\u5EA6"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u9884\u7B97\u5360\u4EA7\u503C\u6BD4"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5B9E\u9645\u5360\u4EA7\u503C\u6BD4")])],-1)),e("tbody",null,[(D(!0),E(M,null,j(c.value.departments,(u,o)=>(D(),E("tr",{key:`department-${o}`},[e("td",W,s(u.departmentName),1),e("td",X,s(n(u.yearlyBudget)),1),e("td",Y,[R(e("input",{"onUpdate:modelValue":d=>u.currentAmount=d,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Z),[[S,u.currentAmount]])]),e("td",tt,s(n(u.accumulatedAmount)),1),e("td",et,[e("span",rt,s(n(u.executionProgress))+"%",1)]),t[5]||(t[5]=e("td",{class:"border border-gray-300 px-4 py-2 text-right"}," / ",-1)),e("td",ut,[e("span",at,s(n(u.actualRatio))+"%",1)])]))),128)),e("tr",ot,[t[6]||(t[6]=e("td",{class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),e("td",st,s(n(p.value.yearlyBudget)),1),e("td",nt,s(n(p.value.currentAmount)),1),e("td",dt,s(n(p.value.accumulatedAmount)),1),e("td",ct,[e("span",lt,s(n(p.value.executionProgress))+"%",1)]),t[7]||(t[7]=e("td",{class:"border border-gray-300 px-4 py-2 text-right"}," / ",-1)),e("td",mt,[e("span",it,s(n(p.value.actualRatio))+"%",1)])])])])]),q(L,{"module-id":I(f).DEPARTMENT_COST_CENTER_ACTUAL,period:a.value,remarks:m.value,"onUpdate:remarks":t[1]||(t[1]=u=>m.value=u),suggestions:i.value,"onUpdate:suggestions":t[2]||(t[2]=u=>i.value=u)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:w,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:T,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var At=P(pt,[["__scopeId","data-v-3c94f530"]]);export{At as default};
