import{d as I,r as d,c as E,B as S,o as P,b,e as o,y as p,A as m,F as k,g as C,t as l,k as j,h as V,G as M,v as F}from"./index.259964f3.js";import{_ as U,l as T,M as y,r as O}from"./FormAttachmentAndRemarks.0ecd273a.js";const R={class:"container mx-auto p-6"},L={class:"bg-white rounded-lg shadow-md p-6 mb-6"},$={class:"flex items-center justify-between mb-4"},J={class:"flex items-center"},q={class:"overflow-x-auto"},Y={class:"min-w-full border-collapse"},G={class:"border px-4 py-2 text-center"},z={class:"border px-4 py-2"},H=["onUpdate:modelValue"],K={class:"border px-4 py-2"},Q=["onUpdate:modelValue","onInput"],W={class:"border px-4 py-2"},X=["onUpdate:modelValue","onInput"],Z={class:"border px-4 py-2 text-center"},tt={class:"bg-gray-100 font-bold"},et={class:"border px-4 py-2 text-center"},ot={class:"border px-4 py-2 text-center"},st={class:"border px-4 py-2 text-center"},at=I({__name:"MajorInvestmentAnalysis",setup(ut){var N;const x=M(),n=d(((N=x.query.period)==null?void 0:N.toString())||new Date().toISOString().substr(0,7)),c=d(""),i=d(""),D=()=>Array.from({length:12},(e,t)=>({id:t+1,projectName:"",initialPlan:0,currentExecution:0,executionProgress:"0.0%"})),w=(e,t)=>{if(!t||!t.projects)return e;const s=[...e];return t.projects.forEach((u,r)=>{r<s.length&&(s[r]={...s[r],...u})}),s},a=d(D()),_=e=>{const t=a.value[e],s=Number(t.initialPlan||0),u=Number(t.currentExecution||0);s>0?t.executionProgress=(u/s*100).toFixed(1)+"%":t.executionProgress="0.0%"},g=E(()=>a.value.reduce((e,t)=>e+Number(t.initialPlan||0),0).toFixed(2)),v=E(()=>a.value.reduce((e,t)=>e+Number(t.currentExecution||0),0).toFixed(2)),f=E(()=>{const e=parseFloat(g.value),t=parseFloat(v.value);return e>0?(t/e*100).toFixed(1)+"%":"0.0%"}),h=async e=>{console.log(`\u6B63\u5728\u52A0\u8F7D\u5E74\u5EA6\u91CD\u5927\u6295\u8D44\u60C5\u51B5\u6570\u636E\uFF0C\u671F\u95F4: ${e}`);try{const t=await fetch(`http://47.111.95.19:3000/major-investment-analysis/${e}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log("\u672A\u627E\u5230\u6570\u636E\uFF0C\u4F7F\u7528\u7A7A\u767D\u6A21\u677F");return}const s=await t.json();if(console.log("\u52A0\u8F7D\u5230\u7684\u6570\u636E:",s),s.data){const u=w(D(),s.data);a.value=u,console.log("\u6570\u636E\u5408\u5E76\u5B8C\u6210:",a.value)}}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t)}},A=async e=>{try{const t=await T(y.MAJOR_INVESTMENT_ANALYSIS,e);c.value=t.remarks,i.value=t.suggestions}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u4FE1\u606F\u5931\u8D25:",t)}},B=async()=>{try{const t={projects:a.value.filter(u=>u.projectName.trim()!==""),summary:{totalInitialPlan:parseFloat(g.value),totalCurrentExecution:parseFloat(v.value),totalExecutionProgress:f.value}};if(!(await fetch("http://47.111.95.19:3000/major-investment-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:n.value,data:t})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await O(y.MAJOR_INVESTMENT_ANALYSIS,n.value,t,c.value,i.value),alert("\u6570\u636E\u4FDD\u5B58\u6210\u529F\uFF01")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25: "+(e instanceof Error?e.message:"\u672A\u77E5\u9519\u8BEF"))}};return S(n,e=>{e&&(h(e),A(e))}),S(()=>x.query.period,e=>{e&&(n.value=e.toString())}),P(()=>{var t;const e=((t=x.query.period)==null?void 0:t.toString())||n.value;h(e),A(e)}),(e,t)=>(F(),b("div",R,[t[6]||(t[6]=o("h1",{class:"text-2xl font-bold mb-6"},"\u5E74\u5EA6\u91CD\u5927\u6295\u8D44\u60C5\u51B5",-1)),o("div",L,[o("div",$,[o("div",J,[t[3]||(t[3]=o("span",{class:"mr-2"},"\u9009\u62E9\u6708\u4EFD\uFF1A",-1)),p(o("input",{type:"month","onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),class:"border rounded px-2 py-1"},null,512),[[m,n.value]])]),o("button",{onClick:B,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors"}," \u4FDD\u5B58\u6570\u636E ")]),o("div",q,[o("table",Y,[t[5]||(t[5]=o("thead",null,[o("tr",{class:"bg-gray-100"},[o("th",{class:"border px-4 py-2 text-center"},"\u5E8F\u53F7"),o("th",{class:"border px-4 py-2 text-center"},"\u9879\u76EE\u540D\u79F0"),o("th",{class:"border px-4 py-2 text-center"},"\u5E74\u521D\u8BA1\u5212"),o("th",{class:"border px-4 py-2 text-center"},"\u5F53\u671F\u6267\u884C"),o("th",{class:"border px-4 py-2 text-center"},"\u6267\u884C\u8FDB\u5EA6")])],-1)),o("tbody",null,[(F(!0),b(k,null,C(a.value,(s,u)=>(F(),b("tr",{key:u},[o("td",G,l(u+1),1),o("td",z,[p(o("input",{type:"text","onUpdate:modelValue":r=>s.projectName=r,class:"w-full border-0 focus:ring-0"},null,8,H),[[m,s.projectName]])]),o("td",K,[p(o("input",{type:"number","onUpdate:modelValue":r=>s.initialPlan=r,class:"w-full border-0 focus:ring-0",onInput:r=>_(u)},null,40,Q),[[m,s.initialPlan]])]),o("td",W,[p(o("input",{type:"number","onUpdate:modelValue":r=>s.currentExecution=r,class:"w-full border-0 focus:ring-0",onInput:r=>_(u)},null,40,X),[[m,s.currentExecution]])]),o("td",Z,l(s.executionProgress||"0.0%"),1)]))),128)),o("tr",tt,[t[4]||(t[4]=o("td",{class:"border px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),o("td",et,l(g.value),1),o("td",ot,l(v.value),1),o("td",st,l(f.value),1)])])])]),j(U,{"module-id":V(y).MAJOR_INVESTMENT_ANALYSIS,period:n.value,remarks:c.value,"onUpdate:remarks":t[1]||(t[1]=s=>c.value=s),suggestions:i.value,"onUpdate:suggestions":t[2]||(t[2]=s=>i.value=s)},null,8,["module-id","period","remarks","suggestions"])])]))}});export{at as default};
