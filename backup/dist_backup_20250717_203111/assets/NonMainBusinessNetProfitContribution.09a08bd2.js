import{_ as B,d as w,r as g,c as C,B as f,o as k,b as _,e as u,y as F,A as v,F as j,g as O,t as n,k as U,h as I,G as M,v as h}from"./index.259964f3.js";import{_ as T,M as D,r as $}from"./FormAttachmentAndRemarks.0ecd273a.js";const R={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},q={class:"flex justify-between items-center mb-6"},J={class:"flex items-center space-x-4"},V={class:"overflow-x-auto my-6"},H={class:"w-full border-collapse border border-gray-300"},L={class:"border border-gray-300 px-4 py-2 text-center"},z={class:"border border-gray-300 px-4 py-2"},G={class:"border border-gray-300 px-4 py-2 text-right"},K={class:"border border-gray-300 px-4 py-2"},Q=["onUpdate:modelValue"],W={class:"border border-gray-300 px-4 py-2 text-right"},X={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"text-sm font-medium"},Z={class:"bg-gray-50 font-bold"},ee={class:"border border-gray-300 px-4 py-2 text-right"},te={class:"border border-gray-300 px-4 py-2 text-right"},ue={class:"border border-gray-300 px-4 py-2 text-right"},ae={class:"border border-gray-300 px-4 py-2 text-right"},re={class:"text-sm font-bold"},se={class:"mt-6 p-4 bg-gray-50 rounded-lg"},oe=w({__name:"NonMainBusinessNetProfitContribution",setup(ne){var S;const l=M(),s=g(((S=l.query.period)==null?void 0:S.toString())||new Date().toISOString().slice(0,7)),N={items:[{financialSubject:"\u5904\u7F6E\u56FA\u5E9F\u6536\u5165",annualPlan:5,current:0,accumulated:0,executionProgress:0},{financialSubject:"\u8F66\u8F86\u79DF\u91D1\u6536\u5165",annualPlan:30,current:0,accumulated:0,executionProgress:0},{financialSubject:"\u5229\u606F\u6536\u5165",annualPlan:0,current:0,accumulated:0,executionProgress:0},{financialSubject:"\u8BBE\u5907\u5916\u670D\u6536\u5165",annualPlan:11.78,current:0,accumulated:0,executionProgress:0},{financialSubject:"\u653F\u5E9C\u8865\u8D34\u6536\u5165",annualPlan:50,current:0,accumulated:0,executionProgress:0},{financialSubject:"\u6D3E\u9063\u8865\u8D34\u6536\u5165",annualPlan:20.71,current:0,accumulated:0,executionProgress:0}]},o=g(JSON.parse(JSON.stringify(N))),c=g(""),d=g(""),i=g(""),p=t=>t===0?"0.00":t.toFixed(2),m=(t,e)=>!t||t===0?"0.00":(e/t*100).toFixed(2),b=C(()=>{const t={annualPlan:0,current:0,accumulated:0,executionProgress:0};return o.value.items.forEach(e=>{t.annualPlan+=e.annualPlan||0,t.current+=e.current||0,t.accumulated+=e.accumulated||0}),t.executionProgress=t.annualPlan>0?t.accumulated/t.annualPlan*100:0,t.executionProgress=parseFloat(t.executionProgress.toFixed(2)),t}),y=async t=>{try{const e=await fetch(`http://47.111.95.19:3000/nanhua-non-main-business-net-profit/${t}`);if(!e.ok){if(e.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const a=await e.json();a.data&&a.data.items&&(o.value.items=a.data.items.map(r=>({financialSubject:r.financialSubject,annualPlan:Number(r.annualPlan)||0,current:Number(r.current)||0,accumulated:Number(r.accumulated)||0,executionProgress:Number(r.executionProgress)||0}))),a.data&&a.data.assessment&&(c.value=a.data.assessment||"")}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e)}},x=async t=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${D.NANHUA_NON_MAIN_BUSINESS_NET_PROFIT}/${t}`);if(e.ok){const a=await e.json();a.success&&a.data&&(d.value=a.data.remarks||"",i.value=a.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};f(()=>o.value.items.map(t=>t.current),(t,e)=>{t&&e&&o.value.items.forEach((a,r)=>{t[r]!==e[r]&&(a.accumulated=a.current||0,a.executionProgress=parseFloat(m(a.annualPlan,a.accumulated)))})},{deep:!0}),f(()=>l.query.period,async t=>{if(t){const e=t.toString();s.value=e,await y(e),x(e)}}),f(s,async(t,e)=>{t&&t!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${t}`),await y(t),x(t))});const P=async()=>{try{if(o.value.items.forEach(e=>{e.executionProgress=parseFloat(m(e.annualPlan,e.accumulated))}),!(await fetch("http://47.111.95.19:3000/nanhua-non-main-business-net-profit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:s.value,data:{...o.value,assessment:c.value}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await $(D.NANHUA_NON_MAIN_BUSINESS_NET_PROFIT,s.value,o.value,d.value,i.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},E=()=>{o.value=JSON.parse(JSON.stringify(N)),c.value="",d.value="",i.value=""};return k(()=>{l.query.period?(y(l.query.period.toString()),x(l.query.period.toString())):(y(s.value),x(s.value))}),(t,e)=>(h(),_("div",R,[u("div",q,[e[5]||(e[5]=u("h1",{class:"text-2xl font-bold"},"\u975E\u4E3B\u8425\u4E1A\u52A1\u51C0\u5229\u6DA6\u8D21\u732E\u60C5\u51B5",-1)),u("div",J,[e[4]||(e[4]=u("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),F(u("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),type:"month",class:"px-3 py-2 border rounded"},null,512),[[v,s.value]])])]),u("div",V,[u("table",H,[e[7]||(e[7]=u("thead",{class:"sticky top-0 bg-white"},[u("tr",{class:"bg-gray-50"},[u("th",{class:"border border-gray-300 px-4 py-2"},"\u5E8F\u53F7"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u8D22\u52A1\u79D1\u76EE"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u6267\u884C\u8FDB\u5EA6")])],-1)),u("tbody",null,[(h(!0),_(j,null,O(o.value.items,(a,r)=>(h(),_("tr",{key:`item-${r}`},[u("td",L,n(r+1),1),u("td",z,n(a.financialSubject),1),u("td",G,n(p(a.annualPlan)),1),u("td",K,[F(u("input",{"onUpdate:modelValue":A=>a.current=A,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Q),[[v,a.current]])]),u("td",W,n(p(a.accumulated)),1),u("td",X,[u("span",Y,n(m(a.annualPlan,a.accumulated))+"%",1)])]))),128)),u("tr",Z,[e[6]||(e[6]=u("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),u("td",ee,n(p(b.value.annualPlan)),1),u("td",te,n(p(b.value.current)),1),u("td",ue,n(p(b.value.accumulated)),1),u("td",ae,[u("span",re,n(b.value.executionProgress)+"%",1)])])])])]),u("div",se,[e[8]||(e[8]=u("h3",{class:"text-lg font-semibold mb-3"},"\u5206\u516C\u53F8\u8BC4\u4F30\u610F\u89C1\uFF1A",-1)),F(u("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),class:"w-full p-3 border rounded-lg resize-none",rows:"4",placeholder:"\u8BF7\u8F93\u5165\u5206\u516C\u53F8\u8BC4\u4F30\u610F\u89C1..."},null,512),[[v,c.value]])]),U(T,{"module-id":I(D).NANHUA_NON_MAIN_BUSINESS_NET_PROFIT,period:s.value,remarks:d.value,"onUpdate:remarks":e[2]||(e[2]=a=>d.value=a),suggestions:i.value,"onUpdate:suggestions":e[3]||(e[3]=a=>i.value=a)},null,8,["module-id","period","remarks","suggestions"]),u("div",{class:"mt-4 flex justify-end space-x-4"},[u("button",{onClick:P,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),u("button",{onClick:E,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var de=B(oe,[["__scopeId","data-v-1e5ea8c7"]]);export{de as default};
