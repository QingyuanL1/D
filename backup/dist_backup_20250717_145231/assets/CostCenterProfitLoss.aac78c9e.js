import{_ as S,d as N,r as x,c as O,B as A,o as k,b as P,e,y as _,A as h,F as T,g as U,t as s,k as I,h as $,G as L,v as C}from"./index.33fb8541.js";import{_ as j,M as D,r as J}from"./FormAttachmentAndRemarks.441388b2.js";const M={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},q={class:"flex justify-between items-center mb-6"},Y={class:"flex items-center space-x-4"},G={class:"overflow-x-auto my-6"},z={class:"w-full border-collapse border border-gray-300"},H={class:"border border-gray-300 px-4 py-2 font-medium"},K={class:"border border-gray-300 px-4 py-2"},Q=["onUpdate:modelValue"],W={class:"border border-gray-300 px-4 py-2"},X=["onUpdate:modelValue","onInput"],Z={class:"border border-gray-300 px-4 py-2"},tt=["onUpdate:modelValue"],et={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"text-sm font-medium"},ut={class:"border border-gray-300 px-4 py-2 text-right"},at={class:"text-sm font-medium"},st={class:"border border-gray-300 px-4 py-2 text-right"},ot={class:"text-sm font-medium"},nt={class:"bg-gray-50 font-bold"},dt={class:"border border-gray-300 px-4 py-2 text-right"},lt={class:"border border-gray-300 px-4 py-2 text-right"},it={class:"border border-gray-300 px-4 py-2 text-right"},ct={class:"border border-gray-300 px-4 py-2 text-right"},pt={class:"text-sm font-bold"},gt={class:"border border-gray-300 px-4 py-2 text-right"},bt={class:"text-sm font-bold"},mt={class:"border border-gray-300 px-4 py-2 text-right"},yt={class:"text-sm font-bold"},xt=N({__name:"CostCenterProfitLoss",setup(_t){var V;const v=L(),o=x(((V=v.query.period)==null?void 0:V.toString())||new Date().toISOString().slice(0,7)),f={items:[{departmentAttribute:"\u603B\u7ECF\u7406\u5BA4",annualBudget:229.31,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0},{departmentAttribute:"\u4F01\u7BA1\u90E8",annualBudget:104.86,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0},{departmentAttribute:"\u8D22\u52A1\u90E8",annualBudget:82.01,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0},{departmentAttribute:"\u5E02\u573A\u90E8",annualBudget:599.32,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0},{departmentAttribute:"\u6280\u672F\u90E8",annualBudget:43.09,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0},{departmentAttribute:"\u54C1\u8D28\u90E8",annualBudget:18.58,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0},{departmentAttribute:"\u751F\u4EA7\u90E8",annualBudget:92.3,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0}]},d=x(JSON.parse(JSON.stringify(f))),g=x(""),b=x(""),B=t=>t===0?"0.00":t.toFixed(2),l=t=>t===0?"0.00":t.toFixed(2),E=t=>{t.annualBudget&&t.annualBudget!==0?t.executionProgress=t.cumulative/t.annualBudget*100:t.executionProgress=0,t.budgetVsPlanRatio=0,t.actualVsCurrentRatio=0},i=O(()=>{const t={annualBudget:0,currentPeriod:0,cumulative:0,executionProgress:0,budgetVsPlanRatio:0,actualVsCurrentRatio:0};return d.value.items.forEach(r=>{var u,p,a;t.annualBudget+=parseFloat(((u=r.annualBudget)==null?void 0:u.toString())||"0")||0,t.currentPeriod+=parseFloat(((p=r.currentPeriod)==null?void 0:p.toString())||"0")||0,t.cumulative+=parseFloat(((a=r.cumulative)==null?void 0:a.toString())||"0")||0}),t.annualBudget&&t.annualBudget!==0?t.executionProgress=t.cumulative/t.annualBudget*100:t.executionProgress=0,t.budgetVsPlanRatio=0,t.actualVsCurrentRatio=0,t}),m=async t=>{try{const r=await fetch(`http://47.111.95.19:3000/tuoyuan-cost-center-profit-loss/${t}`);if(!r.ok){if(r.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log(`${t}\u671F\u95F4\u65E0\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u72B6\u6001`),c();return}const u=await r.json();if(u.data&&u.data.items){const p=u.data.items;d.value.items=f.items.map(a=>{const n=p.find(y=>y.departmentAttribute===a.departmentAttribute);if(n){const y={departmentAttribute:a.departmentAttribute,annualBudget:Number(n.annualBudget)||0,currentPeriod:Number(n.currentPeriod)||0,cumulative:Number(n.cumulative)||0,executionProgress:Number(n.executionProgress)||0,budgetVsPlanRatio:Number(n.budgetVsPlanRatio)||0,actualVsCurrentRatio:Number(n.actualVsCurrentRatio)||0};return E(y),y}else return{...a}})}}catch(r){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",r),c()}},c=()=>{d.value=JSON.parse(JSON.stringify(f))},F=async t=>{try{const r=await fetch(`http://47.111.95.19:3000/forms/submission/${D.TUOYUAN_COST_CENTER_PROFIT_LOSS}/${t}`);if(r.ok){const u=await r.json();u.success&&u.data&&(g.value=u.data.remarks||"",b.value=u.data.suggestions||"")}}catch(r){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",r)}};A(()=>v.query.period,async t=>{t&&(o.value=t.toString(),c(),await m(t.toString()),F(t.toString()))}),A(o,async(t,r)=>{t&&t!==r&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${r} -> ${t}`),c(),await m(t),F(t))});const R=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/tuoyuan-cost-center-profit-loss",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:o.value,data:{items:d.value.items.map(r=>({departmentAttribute:r.departmentAttribute,annualBudget:r.annualBudget,currentPeriod:r.currentPeriod}))}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await J(D.TUOYUAN_COST_CENTER_PROFIT_LOSS,o.value,{items:d.value.items},g.value,b.value),await m(o.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},w=()=>{c(),g.value="",b.value=""};return k(async()=>{var r;c();const t=((r=v.query.period)==null?void 0:r.toString())||o.value;await m(t),F(t)}),(t,r)=>(C(),P("div",M,[e("div",q,[r[4]||(r[4]=e("h1",{class:"text-2xl font-bold"},"\u6210\u672C\u4E2D\u5FC3\u8BA1\u5165\u635F\u76CA\u60C5\u51B5",-1)),e("div",Y,[r[3]||(r[3]=e("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),_(e("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>o.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[h,o.value]])])]),e("div",G,[e("table",z,[r[6]||(r[6]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u90E8\u95E8\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u5E74\u5EA6\u9884\u7B97"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u5F53\u671F"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u7D2F\u8BA1"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u6267\u884C\u8FDB\u5EA6"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u9884\u7B97\u5360\u8BA1\u5212\u6536\u5165\u6BD4"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u5B9E\u9645\u5360\u5F53\u671F\u6536\u5165\u6BD4")])],-1)),e("tbody",null,[(C(!0),P(T,null,U(d.value.items,(u,p)=>(C(),P("tr",{key:`item-${p}`},[e("td",H,s(u.departmentAttribute),1),e("td",K,[_(e("input",{"onUpdate:modelValue":a=>u.annualBudget=a,type:"number",class:"w-full px-2 py-1 border rounded text-right bg-gray-100",step:"0.01",readonly:""},null,8,Q),[[h,u.annualBudget]])]),e("td",W,[_(e("input",{"onUpdate:modelValue":a=>u.currentPeriod=a,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:a=>E(u)},null,40,X),[[h,u.currentPeriod]])]),e("td",Z,[_(e("input",{"onUpdate:modelValue":a=>u.cumulative=a,type:"number",class:"w-full px-2 py-1 border rounded text-right bg-gray-100",step:"0.01",readonly:""},null,8,tt),[[h,u.cumulative]])]),e("td",et,[e("span",rt,s(l(u.executionProgress))+"%",1)]),e("td",ut,[e("span",at,s(l(u.budgetVsPlanRatio))+"%",1)]),e("td",st,[e("span",ot,s(l(u.actualVsCurrentRatio))+"%",1)])]))),128)),e("tr",nt,[r[5]||(r[5]=e("td",{class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),e("td",dt,s(B(i.value.annualBudget)),1),e("td",lt,s(B(i.value.currentPeriod)),1),e("td",it,s(B(i.value.cumulative)),1),e("td",ct,[e("span",pt,s(l(i.value.executionProgress))+"%",1)]),e("td",gt,[e("span",bt,s(l(i.value.budgetVsPlanRatio))+"%",1)]),e("td",mt,[e("span",yt,s(l(i.value.actualVsCurrentRatio))+"%",1)])])])])]),I(j,{"module-id":$(D).TUOYUAN_COST_CENTER_PROFIT_LOSS,period:o.value,remarks:g.value,"onUpdate:remarks":r[1]||(r[1]=u=>g.value=u),suggestions:b.value,"onUpdate:suggestions":r[2]||(r[2]=u=>b.value=u)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:R,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:w,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ft=S(xt,[["__scopeId","data-v-cacd5728"]]);export{ft as default};
