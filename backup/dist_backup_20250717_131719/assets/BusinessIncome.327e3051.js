import{_ as B,d as C,r as x,c as R,B as E,o as k,b as l,e as u,y as v,A as f,F as w,g as I,t as s,k as U,h as O,G as P,v as c,f as M}from"./index.c6cffffe.js";import{_ as $,M as _,r as V}from"./FormAttachmentAndRemarks.e72709f6.js";const j={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},q={class:"flex justify-between items-center mb-6"},J={class:"flex items-center space-x-4"},H={class:"overflow-x-auto my-6"},T={class:"w-full border-collapse border border-gray-300"},L=["rowspan"],G={class:"border border-gray-300 px-4 py-2"},z={key:0,class:"ml-4"},K={key:1},Q={class:"border border-gray-300 px-4 py-2 text-right"},W={class:"border border-gray-300 px-4 py-2"},X=["onUpdate:modelValue"],Y={class:"border border-gray-300 px-4 py-2 text-right"},Z={class:"border border-gray-300 px-4 py-2 text-right"},ee={class:"text-sm font-medium"},te={class:"bg-gray-50 font-bold"},ue={class:"border border-gray-300 px-4 py-2 text-right"},re={class:"border border-gray-300 px-4 py-2 text-right"},ae={class:"border border-gray-300 px-4 py-2 text-right"},se={class:"border border-gray-300 px-4 py-2 text-right"},oe={class:"text-sm font-bold"},ne=C({__name:"BusinessIncome",setup(le){var F;const d=P(),a=x(((F=d.query.period)==null?void 0:F.toString())||new Date().toISOString().slice(0,7)),h={customers:[{customerName:"\u4E00\u5305\u9879\u76EE",yearlyPlan:5355.05,current:0,accumulated:0,completionRate:0},{customerName:"\u4E8C\u5305\u9879\u76EE",yearlyPlan:2889.91,current:0,accumulated:0,completionRate:0},{customerName:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",yearlyPlan:4165.14,current:0,accumulated:0,completionRate:0},{customerName:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",yearlyPlan:2550.46,current:0,accumulated:0,completionRate:0},{customerName:"\u65B0\u80FD\u6E90\u9879\u76EE",yearlyPlan:3744.54,current:0,accumulated:0,completionRate:0},{customerName:"\u82CF\u5DDE\u9879\u76EE",yearlyPlan:752.29,current:0,accumulated:0,completionRate:0},{customerName:"\u62A2\u4FEE",yearlyPlan:137.61,current:0,accumulated:0,completionRate:0},{customerName:"\u8FD0\u68C0",yearlyPlan:1238.54,current:0,accumulated:0,completionRate:0},{customerName:"\u81EA\u5EFA\u9879\u76EE",yearlyPlan:0,current:0,accumulated:0,completionRate:0}]},o=x(JSON.parse(JSON.stringify(h))),i=x(""),p=x(""),m=t=>t===0?"0.00":t.toFixed(2),D=(t,e)=>!t||t===0?"0.00":(e/t*100).toFixed(2),y=R(()=>{const t={yearlyPlan:0,current:0,accumulated:0,completionRate:0};return o.value.customers.forEach(e=>{t.yearlyPlan+=e.yearlyPlan||0,t.current+=e.current||0,t.accumulated+=e.accumulated||0}),t.completionRate=t.yearlyPlan>0?t.accumulated/t.yearlyPlan*100:0,t.completionRate=parseFloat(t.completionRate.toFixed(2)),t}),b=async t=>{try{const e=await fetch(`http://47.111.95.19:3000/nanhua-business-income/${t}`);if(!e.ok){if(e.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const r=await e.json();r.data&&r.data.customers&&(o.value.customers=r.data.customers.map(n=>({customerName:n.customerName,yearlyPlan:Number(n.yearlyPlan)||0,current:Number(n.current)||0,accumulated:Number(n.accumulated)||0,completionRate:Number(n.completionRate)||0})))}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e)}},g=async t=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${_.NANHUA_BUSINESS_INCOME}/${t}`);if(e.ok){const r=await e.json();r.success&&r.data&&(i.value=r.data.remarks||"",p.value=r.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};E(o,t=>{},{deep:!0}),E(()=>d.query.period,t=>{t&&(a.value=t.toString(),b(t.toString()),g(t.toString()))}),E(a,(t,e)=>{t&&t!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${t}`),b(t),g(t))});const N=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-business-income",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:o.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await V(_.NANHUA_BUSINESS_INCOME,a.value,o.value,i.value,p.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},A=()=>{o.value=JSON.parse(JSON.stringify(h)),i.value="",p.value=""};return k(()=>{d.query.period?(b(d.query.period.toString()),g(d.query.period.toString())):(b(a.value),g(a.value))}),(t,e)=>(c(),l("div",j,[u("div",q,[e[5]||(e[5]=u("h1",{class:"text-2xl font-bold"},"\u8425\u4E1A\u6536\u5165\u7ED3\u6784\u4E0E\u8D28\u91CF",-1)),u("div",J,[e[3]||(e[3]=u("span",{class:"text-sm text-gray-600"},"\uFF08\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3\uFF09",-1)),e[4]||(e[4]=u("span",{class:"text-sm text-gray-600"},"\u5355\u4F4D\uFF1A\u4E07\u5143",-1)),v(u("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.value=r),type:"month",class:"px-3 py-2 border rounded"},null,512),[[f,a.value]])])]),e[8]||(e[8]=u("div",{class:"mb-4 text-sm font-medium text-gray-700"}," \u4E3B\u8425\u4E1A\u52A1\u6536\u5165\u5206\u89E3\u60C5\u51B5\uFF1A ",-1)),u("div",H,[u("table",T,[e[7]||(e[7]=u("thead",{class:"sticky top-0 bg-white"},[u("tr",{class:"bg-gray-50"},[u("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5B8C\u6210\u8FDB\u5EA6")])],-1)),u("tbody",null,[(c(!0),l(w,null,I(o.value.customers,(r,n)=>(c(),l("tr",{key:`customer-${n}`},[n===0?(c(),l("td",{key:0,rowspan:o.value.customers.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,L)):M("",!0),u("td",G,[["\u62A2\u4FEE","\u8FD0\u68C0"].includes(r.customerName)?(c(),l("span",z,s(r.customerName),1)):(c(),l("span",K,s(r.customerName),1))]),u("td",Q,s(m(r.yearlyPlan)),1),u("td",W,[v(u("input",{"onUpdate:modelValue":S=>r.current=S,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,X),[[f,r.current]])]),u("td",Y,s(m(r.accumulated)),1),u("td",Z,[u("span",ee,s(D(r.yearlyPlan,r.accumulated))+"%",1)])]))),128)),u("tr",te,[e[6]||(e[6]=u("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),u("td",ue,s(m(y.value.yearlyPlan)),1),u("td",re,s(m(y.value.current)),1),u("td",ae,s(m(y.value.accumulated)),1),u("td",se,[u("span",oe,s(y.value.completionRate)+"%",1)])])])])]),U($,{"module-id":O(_).NANHUA_BUSINESS_INCOME,period:a.value,remarks:i.value,"onUpdate:remarks":e[1]||(e[1]=r=>i.value=r),suggestions:p.value,"onUpdate:suggestions":e[2]||(e[2]=r=>p.value=r)},null,8,["module-id","period","remarks","suggestions"]),u("div",{class:"mt-4 flex justify-end space-x-4"},[u("button",{onClick:N,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),u("button",{onClick:A,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ie=B(ne,[["__scopeId","data-v-015d1d40"]]);export{ie as default};
