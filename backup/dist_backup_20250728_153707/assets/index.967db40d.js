import{_ as G,d as K,u as W,r as n,o as X,b as a,e,y as i,A as b,z as g,C as Y,x as j,t as l,f as x,F as Z,g as ee,m as _,v as d,l as M}from"./index.e99f28b3.js";const te={class:"p-6 bg-gray-50 min-h-screen"},se={class:"max-w-7xl mx-auto"},oe={class:"bg-white p-6 rounded-lg shadow-sm mb-6"},ue={class:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0"},le={class:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4"},re={key:0,class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"},ne={class:"bg-white p-6 rounded-lg shadow-sm"},ae={class:"flex items-center"},de={class:"ml-4"},ie={class:"text-2xl font-bold text-gray-900"},ce={class:"bg-white p-6 rounded-lg shadow-sm"},pe={class:"flex items-center"},ve={class:"ml-4"},me={class:"text-2xl font-bold text-gray-900"},be={class:"bg-white p-6 rounded-lg shadow-sm"},ge={class:"flex items-center"},xe={class:"ml-4"},fe={class:"text-2xl font-bold text-gray-900"},ye={class:"bg-white p-6 rounded-lg shadow-sm"},we={class:"flex items-center"},he={class:"ml-4"},Fe={class:"text-2xl font-bold text-gray-900"},ke={class:"bg-white rounded-lg shadow-sm"},_e={class:"p-6"},Ee={key:0,class:"text-center py-8 text-gray-500"},Be={key:1,class:"text-center py-8 text-gray-500"},De={key:2,class:"space-y-4"},Ce=["onClick"],Ae={class:"flex items-start justify-between"},je={class:"flex-1"},Me={class:"flex items-center space-x-2 mb-2"},Ve={class:"font-medium text-gray-900"},He={class:"text-gray-600 text-sm mb-2 line-clamp-2"},Se={class:"flex items-center space-x-4 text-xs text-gray-500"},Ue={key:0},Ne={key:1},Pe={class:"ml-4 flex space-x-2"},Te=["onClick"],Le=["onClick"],ze={key:3,class:"flex justify-center mt-6"},$e={class:"flex space-x-2"},Ie=["disabled"],qe={class:"px-3 py-2 text-sm text-gray-700"},Oe=["disabled"],Je={class:"text-lg font-semibold text-gray-900 mb-4"},Qe={class:"space-y-4"},Re={class:"grid grid-cols-2 gap-4"},Ge={class:"grid grid-cols-2 gap-4"},Ke={class:"flex justify-end space-x-2 mt-6"},We=["disabled"],Xe=K({__name:"index",setup(Ye){const N=W(),E=n([]),p=n(null),r=n(null),B=n(!0),f=n(!1),y=n(""),w=n(""),h=n(""),F=n(!1),v=n(!1),k=n(null),u=n({title:"",content:"",type:"info",priority:"medium",status:"published",start_time:"",end_time:""}),m=async(o=1)=>{try{B.value=!0;const t=new URLSearchParams({page:o.toString(),limit:"10"});y.value&&t.append("search",y.value),w.value&&t.append("type",w.value),h.value&&t.append("priority",h.value);const s=await fetch(`http://47.111.95.19:3000/notifications?${t}`);if(!s.ok)throw new Error("\u83B7\u53D6\u901A\u77E5\u5217\u8868\u5931\u8D25");const c=await s.json();c.success&&(E.value=c.data.notifications,r.value=c.data.pagination)}catch(t){console.error("\u83B7\u53D6\u901A\u77E5\u5217\u8868\u5931\u8D25:",t)}finally{B.value=!1}},V=async()=>{try{const o=await fetch("http://47.111.95.19:3000/notifications/stats/summary");if(!o.ok)throw new Error("\u83B7\u53D6\u7EDF\u8BA1\u6570\u636E\u5931\u8D25");const t=await o.json();t.success&&(p.value=t.data)}catch(o){console.error("\u83B7\u53D6\u7EDF\u8BA1\u6570\u636E\u5931\u8D25:",o)}},P=()=>{m(1)},H=()=>{m(1)},S=o=>{o>=1&&r.value&&o<=r.value.totalPages&&m(o)},D=()=>{var o;m(((o=r.value)==null?void 0:o.page)||1),V()},T=()=>{v.value=!1,k.value=null,u.value={title:"",content:"",type:"info",priority:"medium",status:"published",start_time:"",end_time:""},F.value=!0},L=o=>{v.value=!0,k.value=o.id,u.value={title:o.title,content:o.content,type:o.type,priority:o.priority,status:o.status,start_time:o.start_time?o.start_time.slice(0,16):"",end_time:o.end_time?o.end_time.slice(0,16):""},F.value=!0},C=()=>{F.value=!1,v.value=!1,k.value=null},z=async()=>{var o;try{f.value=!0;const t={...u.value,sender_id:((o=N.userInfo)==null?void 0:o.id)||1,start_time:u.value.start_time||null,end_time:u.value.end_time||null},s=v.value?`http://47.111.95.19:3000/notifications/${k.value}`:"http://47.111.95.19:3000/notifications",c=v.value?"PUT":"POST",U=await fetch(s,{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!U.ok)throw new Error("\u4FDD\u5B58\u901A\u77E5\u5931\u8D25");(await U.json()).success&&(C(),D())}catch(t){console.error("\u4FDD\u5B58\u901A\u77E5\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}finally{f.value=!1}},$=async o=>{if(!!confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u901A\u77E5\u5417\uFF1F"))try{const t=await fetch(`http://47.111.95.19:3000/notifications/${o}`,{method:"DELETE"});if(!t.ok)throw new Error("\u5220\u9664\u901A\u77E5\u5931\u8D25");(await t.json()).success&&D()}catch(t){console.error("\u5220\u9664\u901A\u77E5\u5931\u8D25:",t),alert("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},I=o=>{console.log("\u67E5\u770B\u901A\u77E5\u8BE6\u60C5:",o)},A=o=>new Date(o).toLocaleString("zh-CN"),q=o=>{const t={info:"bg-blue-100 text-blue-800",warning:"bg-yellow-100 text-yellow-800",error:"bg-red-100 text-red-800",success:"bg-green-100 text-green-800"};return t[o]||t.info},O=o=>({info:"\u4FE1\u606F",warning:"\u8B66\u544A",error:"\u9519\u8BEF",success:"\u6210\u529F"})[o]||"\u4FE1\u606F",J=o=>{const t={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-red-100 text-red-800"};return t[o]||t.medium},Q=o=>({low:"\u4F4E",medium:"\u4E2D",high:"\u9AD8"})[o]||"\u4E2D",R=o=>{const t={info:"border-blue-200",warning:"border-yellow-200",error:"border-red-200",success:"border-green-200"};return t[o]||t.info};return X(async()=>{await Promise.all([m(),V()])}),(o,t)=>(d(),a("div",te,[e("div",se,[t[30]||(t[30]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"\u901A\u77E5\u7BA1\u7406"),e("p",{class:"text-gray-600 mt-2"},"\u7BA1\u7406\u7CFB\u7EDF\u901A\u77E5\u548C\u516C\u544A")],-1)),e("div",oe,[e("div",ue,[e("div",le,[i(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),type:"text",placeholder:"\u641C\u7D22\u901A\u77E5\u6807\u9898\u6216\u5185\u5BB9...",class:"px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onInput:P},null,544),[[b,y.value]]),i(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),onChange:H,class:"px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[13]||(t[13]=[Y('<option value="" data-v-17a89bac>\u6240\u6709\u7C7B\u578B</option><option value="info" data-v-17a89bac>\u4FE1\u606F</option><option value="warning" data-v-17a89bac>\u8B66\u544A</option><option value="error" data-v-17a89bac>\u9519\u8BEF</option><option value="success" data-v-17a89bac>\u6210\u529F</option>',5)]),544),[[g,w.value]]),i(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>h.value=s),onChange:H,class:"px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[14]||(t[14]=[e("option",{value:""},"\u6240\u6709\u4F18\u5148\u7EA7",-1),e("option",{value:"high"},"\u9AD8",-1),e("option",{value:"medium"},"\u4E2D",-1),e("option",{value:"low"},"\u4F4E",-1)]),544),[[g,h.value]])]),e("div",{class:"flex space-x-2"},[e("button",{onClick:T,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center"},t[15]||(t[15]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" \u65B0\u5EFA\u901A\u77E5 ")])),e("button",{onClick:D,class:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors flex items-center"},t[16]||(t[16]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),j(" \u5237\u65B0 ")]))])])]),p.value?(d(),a("div",re,[e("div",ne,[e("div",ae,[t[18]||(t[18]=e("div",{class:"p-3 rounded-full bg-blue-100"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-1l-4 4z"})])],-1)),e("div",de,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600"},"\u603B\u901A\u77E5\u6570",-1)),e("p",ie,l(p.value.total_notifications),1)])])]),e("div",ce,[e("div",pe,[t[20]||(t[20]=e("div",{class:"p-3 rounded-full bg-green-100"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",ve,[t[19]||(t[19]=e("p",{class:"text-sm text-gray-600"},"\u5DF2\u53D1\u5E03",-1)),e("p",me,l(p.value.published_count),1)])])]),e("div",be,[e("div",ge,[t[22]||(t[22]=e("div",{class:"p-3 rounded-full bg-yellow-100"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.864-.833-2.634 0L4.18 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",xe,[t[21]||(t[21]=e("p",{class:"text-sm text-gray-600"},"\u8349\u7A3F",-1)),e("p",fe,l(p.value.draft_count),1)])])]),e("div",ye,[e("div",we,[t[24]||(t[24]=e("div",{class:"p-3 rounded-full bg-red-100"},[e("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"})])],-1)),e("div",he,[t[23]||(t[23]=e("p",{class:"text-sm text-gray-600"},"\u5DF2\u5F52\u6863",-1)),e("p",Fe,l(p.value.archived_count),1)])])])])):x("",!0),e("div",ke,[t[29]||(t[29]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"\u901A\u77E5\u5217\u8868")],-1)),e("div",_e,[B.value?(d(),a("div",Ee,t[25]||(t[25]=[e("div",{class:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"},null,-1),j(" \u52A0\u8F7D\u4E2D... ")]))):E.value.length===0?(d(),a("div",Be,t[26]||(t[26]=[e("svg",{class:"w-12 h-12 mx-auto mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})],-1),e("p",null,"\u6682\u65E0\u901A\u77E5\u6570\u636E",-1)]))):(d(),a("div",De,[(d(!0),a(Z,null,ee(E.value,s=>(d(),a("div",{key:s.id,class:M(["p-4 border rounded-lg hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer",R(s.type)]),onClick:c=>I(s)},[e("div",Ae,[e("div",je,[e("div",Me,[e("h4",Ve,l(s.title),1),e("span",{class:M(["px-2 py-1 text-xs rounded-full",q(s.type)])},l(O(s.type)),3),e("span",{class:M(["px-2 py-1 text-xs rounded-full",J(s.priority)])},l(Q(s.priority)),3)]),e("p",He,l(s.content),1),e("div",Se,[e("span",null,"\u53D1\u9001\u8005: "+l(s.sender_name||"\u7CFB\u7EDF"),1),e("span",null,"\u521B\u5EFA\u65F6\u95F4: "+l(A(s.created_at)),1),s.start_time?(d(),a("span",Ue,"\u5F00\u59CB\u65F6\u95F4: "+l(A(s.start_time)),1)):x("",!0),s.end_time?(d(),a("span",Ne,"\u7ED3\u675F\u65F6\u95F4: "+l(A(s.end_time)),1)):x("",!0)])]),e("div",Pe,[e("button",{onClick:_(c=>L(s),["stop"]),class:"p-1 text-blue-600 hover:text-blue-700",title:"\u7F16\u8F91"},t[27]||(t[27]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,Te),e("button",{onClick:_(c=>$(s.id),["stop"]),class:"p-1 text-red-600 hover:text-red-700",title:"\u5220\u9664"},t[28]||(t[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Le)])])],10,Ce))),128))])),r.value&&r.value.totalPages>1?(d(),a("div",ze,[e("nav",$e,[e("button",{onClick:t[3]||(t[3]=s=>S(r.value.page-1)),disabled:r.value.page<=1,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," \u4E0A\u4E00\u9875 ",8,Ie),e("span",qe," \u7B2C "+l(r.value.page)+" \u9875\uFF0C\u5171 "+l(r.value.totalPages)+" \u9875 ",1),e("button",{onClick:t[4]||(t[4]=s=>S(r.value.page+1)),disabled:r.value.page>=r.value.totalPages,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," \u4E0B\u4E00\u9875 ",8,Oe)])])):x("",!0)])])]),F.value?(d(),a("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:C},[e("div",{class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-screen overflow-y-auto",onClick:t[12]||(t[12]=_(()=>{},["stop"]))},[e("h3",Je,l(v.value?"\u7F16\u8F91\u901A\u77E5":"\u65B0\u5EFA\u901A\u77E5"),1),e("form",{onSubmit:_(z,["prevent"])},[e("div",Qe,[e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u6807\u9898 *",-1)),i(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>u.value.title=s),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"\u8BF7\u8F93\u5165\u901A\u77E5\u6807\u9898"},null,512),[[b,u.value.title]])]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u5185\u5BB9 *",-1)),i(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>u.value.content=s),required:"",rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"\u8BF7\u8F93\u5165\u901A\u77E5\u5185\u5BB9"},null,512),[[b,u.value.content]])]),e("div",Re,[e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u7C7B\u578B",-1)),i(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>u.value.type=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[33]||(t[33]=[e("option",{value:"info"},"\u4FE1\u606F",-1),e("option",{value:"warning"},"\u8B66\u544A",-1),e("option",{value:"error"},"\u9519\u8BEF",-1),e("option",{value:"success"},"\u6210\u529F",-1)]),512),[[g,u.value.type]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u4F18\u5148\u7EA7",-1)),i(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>u.value.priority=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[35]||(t[35]=[e("option",{value:"low"},"\u4F4E",-1),e("option",{value:"medium"},"\u4E2D",-1),e("option",{value:"high"},"\u9AD8",-1)]),512),[[g,u.value.priority]])])]),e("div",Ge,[e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u5F00\u59CB\u65F6\u95F4",-1)),i(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>u.value.start_time=s),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[b,u.value.start_time]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u7ED3\u675F\u65F6\u95F4",-1)),i(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>u.value.end_time=s),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[b,u.value.end_time]])])]),e("div",null,[t[40]||(t[40]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u72B6\u6001",-1)),i(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>u.value.status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[39]||(t[39]=[e("option",{value:"draft"},"\u8349\u7A3F",-1),e("option",{value:"published"},"\u5DF2\u53D1\u5E03",-1),e("option",{value:"archived"},"\u5DF2\u5F52\u6863",-1)]),512),[[g,u.value.status]])])]),e("div",Ke,[e("button",{type:"button",onClick:C,class:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50"}," \u53D6\u6D88 "),e("button",{type:"submit",disabled:f.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"},l(f.value?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58"),9,We)])],32)])])):x("",!0)]))}});var tt=G(Xe,[["__scopeId","data-v-17a89bac"]]);export{tt as default};
