import{_ as N,d as S,r as b,c as j,B as f,o as B,b as y,e as o,y as x,A as w,F as A,g as k,t as l,k as R,h as U,G as I,v as g,f as T}from"./index.e99f28b3.js";import{_ as O,M as D,r as V}from"./FormAttachmentAndRemarks.d1afaf1c.js";const $={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},q={class:"flex justify-between items-center mb-6"},J={class:"flex items-center space-x-4"},G={class:"overflow-x-auto my-6"},M={class:"w-full border-collapse border border-gray-300"},H=["rowspan"],L={class:"border border-gray-300 px-4 py-2"},W={class:"border border-gray-300 px-4 py-2"},z=["onUpdate:modelValue"],K={class:"border border-gray-300 px-4 py-2"},Q=["onUpdate:modelValue"],X={class:"border border-gray-300 px-4 py-2 text-center"},Y={class:"text-sm font-medium"},Z={class:"bg-gray-50 font-bold"},P={class:"border border-gray-300 px-4 py-2 text-center"},tt={class:"border border-gray-300 px-4 py-2 text-center"},et={class:"border border-gray-300 px-4 py-2 text-center"},ot={class:"text-sm font-bold"},st=S({__name:"BiddingStatus",setup(rt){var C;const n=I(),r=b(((C=n.query.period)==null?void 0:C.toString())||new Date().toISOString().slice(0,7)),v={projects:[{projectName:"\u4E00\u5305\u9879\u76EE",bidCount:0,winCount:0,winRate:0},{projectName:"\u4E8C\u5305\u9879\u76EE",bidCount:0,winCount:0,winRate:0},{projectName:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",bidCount:0,winCount:0,winRate:0},{projectName:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",bidCount:0,winCount:0,winRate:0},{projectName:"\u65B0\u80FD\u6E90\u9879\u76EE",bidCount:0,winCount:0,winRate:0},{projectName:"\u82CF\u5DDE\u9879\u76EE",bidCount:0,winCount:0,winRate:0}]},u=b(JSON.parse(JSON.stringify(v))),d=b(""),i=b(""),h=(e,t)=>!e||e===0?"0.00":(t/e*100).toFixed(2),_=j(()=>{const e={bidCount:0,winCount:0,winRate:0};return u.value.projects.forEach(t=>{e.bidCount+=t.bidCount||0,e.winCount+=t.winCount||0}),e.winRate=e.bidCount>0?e.winCount/e.bidCount*100:0,e.winRate=parseFloat(e.winRate.toFixed(2)),e}),c=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/nanhua-bidding-status/${e}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const s=await t.json();s.data&&s.data.projects&&(u.value.projects=s.data.projects.map(a=>({projectName:a.projectName,bidCount:Number(a.bidCount)||0,winCount:Number(a.winCount)||0,winRate:Number(a.winRate)||0})))}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t)}},p=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${D.NANHUA_BIDDING_STATUS}/${e}`);if(t.ok){const s=await t.json();s.success&&s.data&&(d.value=s.data.remarks||"",i.value=s.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",t)}};f(()=>n.query.period,e=>{e&&(r.value=e.toString(),c(e.toString()),p(e.toString()))}),f(r,(e,t)=>{e&&e!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${e}`),c(e),p(e))});const E=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-bidding-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:r.value,data:u.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await V(D.NANHUA_BIDDING_STATUS,r.value,u.value,d.value,i.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25")}},F=()=>{u.value=JSON.parse(JSON.stringify(v)),d.value="",i.value=""};return B(()=>{n.query.period?(c(n.query.period.toString()),p(n.query.period.toString())):(c(r.value),p(r.value))}),(e,t)=>(g(),y("div",$,[o("div",q,[t[4]||(t[4]=o("h1",{class:"text-2xl font-bold"},"\u62DB\u6295\u6807\u60C5\u51B5",-1)),o("div",J,[t[3]||(t[3]=o("span",{class:"text-sm text-gray-600"},"\u5355\u4F4D\uFF1A\u4E07\u5143",-1)),x(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),type:"month",class:"px-3 py-2 border rounded"},null,512),[[w,r.value]])])]),o("div",G,[o("table",M,[t[6]||(t[6]=o("thead",{class:"sticky top-0 bg-white"},[o("tr",{class:"bg-gray-50"},[o("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u6295\u6807"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u4E2D\u6807\u7D2F\u8BA1"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u4E2D\u6807\u7387")])],-1)),o("tbody",null,[(g(!0),y(A,null,k(u.value.projects,(s,a)=>(g(),y("tr",{key:`project-${a}`},[a===0?(g(),y("td",{key:0,rowspan:u.value.projects.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,H)):T("",!0),o("td",L,l(s.projectName),1),o("td",W,[x(o("input",{"onUpdate:modelValue":m=>s.bidCount=m,type:"number",min:"0",class:"w-full px-2 py-1 border rounded text-center"},null,8,z),[[w,s.bidCount]])]),o("td",K,[x(o("input",{"onUpdate:modelValue":m=>s.winCount=m,type:"number",min:"0",class:"w-full px-2 py-1 border rounded text-center"},null,8,Q),[[w,s.winCount]])]),o("td",X,[o("span",Y,l(h(s.bidCount,s.winCount))+"%",1)])]))),128)),o("tr",Z,[t[5]||(t[5]=o("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),o("td",P,l(_.value.bidCount),1),o("td",tt,l(_.value.winCount),1),o("td",et,[o("span",ot,l(_.value.winRate)+"%",1)])])])])]),R(O,{"module-id":U(D).NANHUA_BIDDING_STATUS,period:r.value,remarks:d.value,"onUpdate:remarks":t[1]||(t[1]=s=>d.value=s),suggestions:i.value,"onUpdate:suggestions":t[2]||(t[2]=s=>i.value=s)},null,8,["module-id","period","remarks","suggestions"]),o("div",{class:"mt-4 flex justify-end space-x-4"},[o("button",{onClick:E,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),o("button",{onClick:F,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var nt=N(st,[["__scopeId","data-v-830ac3a8"]]);export{nt as default};
