import{_ as R,d as O,r as m,c as I,B as S,o as k,b as E,e,y as _,A as x,F as V,g as z,t as o,k as M,h as $,G as L,v,f as j}from"./index.e99f28b3.js";import{_ as J,M as B,r as q}from"./FormAttachmentAndRemarks.d1afaf1c.js";const Y={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},G={class:"flex justify-between items-center mb-6"},H={class:"flex items-center space-x-4"},K={class:"overflow-x-auto my-6"},Q={class:"w-full border-collapse border border-gray-300"},W=["rowspan"],X={class:"border border-gray-300 px-4 py-2"},Z={class:"border border-gray-300 px-4 py-2"},tt=["onUpdate:modelValue","onInput"],at={class:"border border-gray-300 px-4 py-2"},et=["onUpdate:modelValue","onInput"],ut={class:"border border-gray-300 px-4 py-2"},st=["onUpdate:modelValue"],nt={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"text-sm font-medium"},ot={class:"border border-gray-300 px-4 py-2 text-right"},it={class:"text-sm font-medium"},ct={class:"bg-gray-50 font-bold"},lt={class:"border border-gray-300 px-4 py-2 text-right"},pt={class:"border border-gray-300 px-4 py-2 text-right"},yt={class:"border border-gray-300 px-4 py-2 text-right"},dt={class:"border border-gray-300 px-4 py-2 text-right"},gt={class:"text-sm font-bold"},Ct={class:"border border-gray-300 px-4 py-2 text-right"},bt={class:"text-sm font-bold"},mt=O({__name:"MainBusinessProductionValueSelfConstruction",setup(Et){var U;const D=L(),n=m(((U=D.query.period)==null?void 0:U.toString())||new Date().toISOString().slice(0,7)),A={items:[{businessType:"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C",customerAttribute:"\u7535\u4E1A\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentCapacityCumulative:0,planExecutionProgress:0,capacityUtilizationRate:0},{businessType:"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C",customerAttribute:"\u7528\u6237\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentCapacityCumulative:0,planExecutionProgress:0,capacityUtilizationRate:0},{businessType:"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C",customerAttribute:"\u8D38\u6613",companyDesignCapacity:0,annualCapacityPlan:0,currentCapacityCumulative:0,planExecutionProgress:0,capacityUtilizationRate:0},{businessType:"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C",customerAttribute:"\u4EE3\u7406\u8BBE\u5907",companyDesignCapacity:0,annualCapacityPlan:0,currentCapacityCumulative:0,planExecutionProgress:0,capacityUtilizationRate:0},{businessType:"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C",customerAttribute:"\u4EE3\u7406\u5DE5\u7A0B",companyDesignCapacity:0,annualCapacityPlan:0,currentCapacityCumulative:0,planExecutionProgress:0,capacityUtilizationRate:0},{businessType:"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C",customerAttribute:"\u4EE3\u7406\u8BBE\u8BA1",companyDesignCapacity:0,annualCapacityPlan:0,currentCapacityCumulative:0,planExecutionProgress:0,capacityUtilizationRate:0}]},r=m(JSON.parse(JSON.stringify(A))),p=m(""),y=m(""),f=t=>t===0?"0.00":t.toFixed(2),C=t=>t===0?"0.00":t.toFixed(2),h=t=>{t.annualCapacityPlan&&t.annualCapacityPlan!==0?t.planExecutionProgress=t.currentCapacityCumulative/t.annualCapacityPlan*100:t.planExecutionProgress=0,t.companyDesignCapacity&&t.companyDesignCapacity!==0?t.capacityUtilizationRate=t.currentCapacityCumulative/t.companyDesignCapacity*100:t.capacityUtilizationRate=0},P=t=>t===0?!0:r.value.items[t].businessType!==r.value.items[t-1].businessType,T=t=>r.value.items.filter(a=>a.businessType===t).length,d=I(()=>{const t={companyDesignCapacity:0,annualCapacityPlan:0,currentCapacityCumulative:0,planExecutionProgress:0,capacityUtilizationRate:0};return r.value.items.forEach(a=>{var u,i,s;t.companyDesignCapacity+=parseFloat(((u=a.companyDesignCapacity)==null?void 0:u.toString())||"0")||0,t.annualCapacityPlan+=parseFloat(((i=a.annualCapacityPlan)==null?void 0:i.toString())||"0")||0,t.currentCapacityCumulative+=parseFloat(((s=a.currentCapacityCumulative)==null?void 0:s.toString())||"0")||0}),t.annualCapacityPlan&&t.annualCapacityPlan!==0?t.planExecutionProgress=t.currentCapacityCumulative/t.annualCapacityPlan*100:t.planExecutionProgress=0,t.companyDesignCapacity&&t.companyDesignCapacity!==0?t.capacityUtilizationRate=t.currentCapacityCumulative/t.companyDesignCapacity*100:t.capacityUtilizationRate=0,t}),b=async t=>{try{const a=await fetch(`http://47.111.95.19:3000/tuoyuan-main-business-production-value-self-construction/${t}`);if(!a.ok){if(a.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log(`${t}\u671F\u95F4\u65E0\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u72B6\u6001`),c();return}const u=await a.json();if(u.data&&u.data.items){const i=u.data.items;r.value.items=A.items.map(s=>{const l=i.find(g=>g.businessType===s.businessType&&g.customerAttribute===s.customerAttribute);if(l){const g={businessType:s.businessType,customerAttribute:s.customerAttribute,companyDesignCapacity:Number(l.companyDesignCapacity)||0,annualCapacityPlan:Number(l.annualCapacityPlan)||0,currentCapacityCumulative:Number(l.currentCapacityCumulative)||0,planExecutionProgress:Number(l.planExecutionProgress)||0,capacityUtilizationRate:Number(l.capacityUtilizationRate)||0};return h(g),g}else return{...s}})}}catch(a){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",a),c()}},c=()=>{r.value=JSON.parse(JSON.stringify(A))},F=async t=>{try{const a=await fetch(`http://47.111.95.19:3000/forms/submission/${B.TUOYUAN_MAIN_BUSINESS_PRODUCTION_VALUE_SELF_CONSTRUCTION}/${t}`);if(a.ok){const u=await a.json();u.success&&u.data&&(p.value=u.data.remarks||"",y.value=u.data.suggestions||"")}}catch(a){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",a)}};S(()=>D.query.period,async t=>{t&&(n.value=t.toString(),c(),await b(t.toString()),F(t.toString()))}),S(n,async(t,a)=>{t&&t!==a&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${a} -> ${t}`),c(),await b(t),F(t))});const w=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/tuoyuan-main-business-production-value-self-construction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:n.value,data:{items:r.value.items.map(a=>({businessType:a.businessType,customerAttribute:a.customerAttribute,companyDesignCapacity:a.companyDesignCapacity,annualCapacityPlan:a.annualCapacityPlan,currentCapacityCumulative:a.currentCapacityCumulative}))}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await q(B.TUOYUAN_MAIN_BUSINESS_PRODUCTION_VALUE_SELF_CONSTRUCTION,n.value,{items:r.value.items},p.value,y.value),await b(n.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},N=()=>{c(),p.value="",y.value=""};return k(async()=>{var a;c();const t=((a=D.query.period)==null?void 0:a.toString())||n.value;await b(t),F(t)}),(t,a)=>(v(),E("div",Y,[e("div",G,[a[4]||(a[4]=e("h1",{class:"text-2xl font-bold"},"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C--\u81EA\u884C\u65BD\u5DE5\u60C5\u51B5\u5206\u6790",-1)),e("div",H,[a[3]||(a[3]=e("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),_(e("input",{"onUpdate:modelValue":a[0]||(a[0]=u=>n.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[x,n.value]])])]),e("div",K,[e("table",Q,[a[6]||(a[6]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u4E1A\u52A1\u7C7B\u578B"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u5BA2\u6237\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u516C\u53F8\u8BBE\u8BA1\u4EA7\u80FD"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u5E74\u5EA6\u4EA7\u80FD\u8BA1\u5212"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u5F53\u671F\u4EA7\u80FD\u7D2F\u8BA1"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u8BA1\u5212\u6267\u884C\u8FDB\u5EA6"),e("th",{class:"border border-gray-300 px-4 py-2 w-32"},"\u4EA7\u80FD\u5229\u7528\u7387")])],-1)),e("tbody",null,[(v(!0),E(V,null,z(r.value.items,(u,i)=>(v(),E("tr",{key:`item-${i}`},[P(i)?(v(),E("td",{key:0,rowspan:T(u.businessType),class:"border border-gray-300 px-4 py-2 font-medium text-center"},o(u.businessType),9,W)):j("",!0),e("td",X,o(u.customerAttribute),1),e("td",Z,[_(e("input",{"onUpdate:modelValue":s=>u.companyDesignCapacity=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:s=>h(u)},null,40,tt),[[x,u.companyDesignCapacity]])]),e("td",at,[_(e("input",{"onUpdate:modelValue":s=>u.annualCapacityPlan=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:s=>h(u)},null,40,et),[[x,u.annualCapacityPlan]])]),e("td",ut,[_(e("input",{"onUpdate:modelValue":s=>u.currentCapacityCumulative=s,type:"number",class:"w-full px-2 py-1 border rounded text-right bg-gray-100",step:"0.01",readonly:""},null,8,st),[[x,u.currentCapacityCumulative]])]),e("td",nt,[e("span",rt,o(C(u.planExecutionProgress))+"%",1)]),e("td",ot,[e("span",it,o(C(u.capacityUtilizationRate))+"%",1)])]))),128)),e("tr",ct,[a[5]||(a[5]=e("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),e("td",lt,o(f(d.value.companyDesignCapacity)),1),e("td",pt,o(f(d.value.annualCapacityPlan)),1),e("td",yt,o(f(d.value.currentCapacityCumulative)),1),e("td",dt,[e("span",gt,o(C(d.value.planExecutionProgress))+"%",1)]),e("td",Ct,[e("span",bt,o(C(d.value.capacityUtilizationRate))+"%",1)])])])])]),M(J,{"module-id":$(B).TUOYUAN_MAIN_BUSINESS_PRODUCTION_VALUE_SELF_CONSTRUCTION,period:n.value,remarks:p.value,"onUpdate:remarks":a[1]||(a[1]=u=>p.value=u),suggestions:y.value,"onUpdate:suggestions":a[2]||(a[2]=u=>y.value=u)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:w,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:N,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var vt=R(mt,[["__scopeId","data-v-58f2d4c7"]]);export{vt as default};
