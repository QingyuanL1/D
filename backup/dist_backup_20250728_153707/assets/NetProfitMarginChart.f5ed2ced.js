import{_ as N,d as $,r as u,c as j,o as Y,a as k,b as h,e as t,y as P,z as V,F as I,g as O,t as d,C as U,l as m,j as D,v as b}from"./index.e99f28b3.js";import{i as W,L as G}from"./index.0a005eaa.js";const T={class:"p-6 bg-gray-50 min-h-screen"},q={class:"max-w-7xl mx-auto"},H={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},J={class:"flex items-center justify-between"},K={class:"flex items-center space-x-3"},Q=["value"],X={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},Z={class:"flex justify-between items-center mb-6"},ee={class:"text-lg font-semibold text-gray-900"},te={class:"bg-white rounded-lg shadow-sm p-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se={class:"p-4 border border-gray-200 rounded-lg"},ue={class:"flex justify-between items-center mb-3"},le={class:"w-full bg-gray-200 rounded-full h-3 mb-2"},oe={class:"text-xs text-gray-600"},ne={class:"p-4 border border-gray-200 rounded-lg"},re={class:"flex justify-between items-center mb-3"},ie={class:"w-full bg-gray-200 rounded-full h-3 mb-2"},de={class:"text-xs text-gray-600"},ce=$({__name:"NetProfitMarginChart",setup(ve){const n=u(new Date().getFullYear().toString()),p=u([]),y=u(!0),x=u(null),r=u(null),o=u(6.85),l=u(0),i=u([]),c=u([]),v=j(()=>o.value>0?l.value/o.value*100:0),f=e=>e.toLocaleString("zh-CN",{maximumFractionDigits:2}),B=e=>e>=8?"text-green-600":e>=5?"text-blue-600":e>=2?"text-yellow-600":"text-red-600",F=e=>e>=8?"bg-green-500":e>=5?"bg-blue-500":e>=2?"bg-yellow-500":"bg-red-500",S=e=>e>=100?"text-green-600":e>=80?"text-blue-600":e>=60?"text-yellow-600":"text-red-600",z=e=>e>=100?"bg-green-500":e>=80?"bg-blue-500":e>=60?"bg-yellow-500":"bg-red-500",A=()=>{const e=new Date().getFullYear(),a=[];for(let s=0;s<5;s++)a.push((e-s).toString());p.value=a},E=async()=>{try{y.value=!0,await R(),M()}catch(e){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",e),g()}finally{y.value=!1}},R=async()=>{try{const e=await fetch(`http://47.111.95.19:3000/analytics/net-profit-margin/${n.value}`);if(e.ok){const a=await e.json();a.success&&a.data?a.data.hasData===!1?(i.value=[],c.value=[],l.value=0):(i.value=a.data.months||[],c.value=a.data.monthlyData||[],l.value=a.data.currentRate||0,o.value=a.data.targetRate||8):g()}else g()}catch(e){console.error("\u83B7\u53D6\u51C0\u5229\u7387\u6570\u636E\u5931\u8D25:",e),g()}},g=()=>{i.value=[],c.value=[],l.value=0},L=()=>{x.value&&(r.value=W(x.value))},M=()=>{if(!r.value)return;if(i.value.length===0||c.value.length===0){const s={title:{text:`${n.value}\u5E74\u6682\u65E0\u51C0\u5229\u7387\u6570\u636E`,textStyle:{fontSize:16,fontWeight:"bold",color:"#9CA3AF"},left:"center",top:"middle"},graphic:{type:"text",left:"center",top:"60%",style:{text:"\u8BF7\u9009\u62E9\u5176\u4ED6\u5E74\u4EFD\u67E5\u770B\u6570\u636E",fontSize:14,fill:"#9CA3AF"}}};r.value.setOption(s,!0);return}const e=i.value.map(()=>o.value),a={title:{text:`${n.value}\u5E74\u51C0\u5229\u7387\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(s){let w=`${s[0].name}<br/>`;return s.forEach(C=>{w+=`${C.seriesName}: ${f(C.value)}%<br/>`}),w}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:i.value,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u767E\u5206\u6BD4(%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(s){return f(s)+"%"},fontSize:12}},series:[{name:"\u5B9E\u9645\u51C0\u5229\u7387",type:"line",data:c.value,smooth:!0,lineStyle:{color:"#3B82F6",width:3},itemStyle:{color:"#3B82F6"},areaStyle:{color:new G(0,0,0,1,[{offset:0,color:"#3B82F640"},{offset:1,color:"#3B82F610"}])}},{name:"\u76EE\u6807\u7EBF",type:"line",data:e,lineStyle:{color:"#EF4444",width:2,type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]};r.value.setOption(a,!0)},_=()=>{var e;(e=r.value)==null||e.resize()};return Y(async()=>{A(),L(),await E(),window.addEventListener("resize",_)}),k(()=>{var e;(e=r.value)==null||e.dispose(),window.removeEventListener("resize",_)}),(e,a)=>(b(),h("div",T,[t("div",q,[a[7]||(a[7]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u51C0\u5229\u7387\u5206\u6790"),t("p",{class:"text-gray-600 mt-2"},"\u51C0\u5229\u6DA6\u7387\u5206\u6790\u4E0E\u8D8B\u52BF\u76D1\u63A7")],-1)),t("div",H,[t("div",J,[a[2]||(a[2]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),t("div",K,[a[1]||(a[1]=t("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),P(t("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>n.value=s),onChange:E,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(b(!0),h(I,null,O(p.value,s=>(b(),h("option",{key:s,value:s},d(s)+"\u5E74",9,Q))),128))],544),[[V,n.value]])])])]),t("div",X,[t("div",Z,[t("h3",ee,d(n.value)+"\u5E74\u51C0\u5229\u7387\u6708\u5EA6\u8D8B\u52BF",1),a[3]||(a[3]=U('<div class="flex items-center space-x-4" data-v-085a304e><div class="flex items-center" data-v-085a304e><div class="w-4 h-4 bg-blue-500 rounded mr-2" data-v-085a304e></div><span class="text-sm text-gray-600" data-v-085a304e>\u5B9E\u9645\u51C0\u5229\u7387</span></div><div class="flex items-center" data-v-085a304e><div class="w-4 h-4 bg-red-500 rounded mr-2" data-v-085a304e></div><span class="text-sm text-gray-600" data-v-085a304e>\u76EE\u6807\u7EBF</span></div></div>',1))]),t("div",{class:"h-[400px]",ref_key:"chartRef",ref:x},null,512)]),t("div",te,[a[6]||(a[6]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5F53\u524D\u51C0\u5229\u7387\u6982\u51B5",-1)),t("div",ae,[t("div",se,[t("div",ue,[a[4]||(a[4]=t("h4",{class:"font-medium text-gray-900"},"\u5F53\u524D\u51C0\u5229\u7387",-1)),t("span",{class:m(["text-2xl font-bold",B(l.value)])},d(f(l.value))+"% ",3)]),t("div",le,[t("div",{class:m(["h-3 rounded-full transition-all duration-300",F(l.value)]),style:D(`width: ${Math.min(Math.abs(l.value/o.value*100),100)}%`)},null,6)]),t("p",oe," \u76EE\u6807: "+d(o.value)+"% ",1)]),t("div",ne,[t("div",re,[a[5]||(a[5]=t("h4",{class:"font-medium text-gray-900"},"\u76EE\u6807\u5B8C\u6210\u7387",-1)),t("span",{class:m(["text-2xl font-bold",S(v.value)])},d(f(v.value))+"% ",3)]),t("div",ie,[t("div",{class:m(["h-3 rounded-full transition-all duration-300",z(v.value)]),style:D(`width: ${Math.min(v.value,100)}%`)},null,6)]),t("p",de," \u57FA\u4E8E\u76EE\u6807\u51C0\u5229\u7387 "+d(o.value)+"% ",1)])])])])]))}});var me=N(ce,[["__scopeId","data-v-085a304e"]]);export{me as default};
