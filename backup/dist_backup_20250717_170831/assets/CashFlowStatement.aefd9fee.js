import{r as _,_ as U,d as j,B as b,o as I,b as c,e,y as C,A as g,F as h,g as w,h as x,k as T,G as V,v as F,t as S,l as $}from"./index.9dc00bb4.js";import{_ as q,M as N,r as M,l as R}from"./FormAttachmentAndRemarks.c9862839.js";const J=()=>{const B=_([{title:"\u4E00\u3001\u7ECF\u8425\u6D3B\u52A8\u4EA7\u751F\u7684\u73B0\u91D1\u6D41\u91CF\uFF1A",items:[{name:"\u9500\u552E\u5546\u54C1\u3001\u63D0\u4F9B\u52B3\u52A1\u6536\u5230\u7684\u73B0\u91D1",field:"sales_cash",currentAmount:null,yearAmount:null},{name:"\u6536\u5230\u7684\u7A0E\u8D39\u8FD4\u8FD8",field:"tax_refund",currentAmount:null,yearAmount:null},{name:"\u6536\u5230\u5176\u4ED6\u4E0E\u7ECF\u8425\u6D3B\u52A8\u6709\u5173\u7684\u73B0\u91D1",field:"other_operating_cash_received",currentAmount:null,yearAmount:null},{name:"\u7ECF\u8425\u6D3B\u52A8\u73B0\u91D1\u6D41\u5165\u5C0F\u8BA1",field:"operating_cash_inflow_total",currentAmount:null,yearAmount:null,isBold:!0},{name:"\u8D2D\u4E70\u5546\u54C1\u3001\u63A5\u53D7\u52B3\u52A1\u652F\u4ED8\u7684\u73B0\u91D1",field:"purchase_payment",currentAmount:null,yearAmount:null},{name:"\u652F\u4ED8\u7ED9\u804C\u5DE5\u53CA\u4E3A\u804C\u5DE5\u652F\u4ED8\u7684\u73B0\u91D1",field:"employee_payment",currentAmount:null,yearAmount:null},{name:"\u652F\u4ED8\u7684\u5404\u9879\u7A0E\u8D39",field:"tax_payment",currentAmount:null,yearAmount:null},{name:"\u652F\u4ED8\u5176\u4ED6\u4E0E\u7ECF\u8425\u6D3B\u52A8\u6709\u5173\u7684\u73B0\u91D1",field:"other_operating_payment",currentAmount:null,yearAmount:null},{name:"\u7ECF\u8425\u6D3B\u52A8\u73B0\u91D1\u6D41\u51FA\u5C0F\u8BA1",field:"operating_cash_outflow_total",currentAmount:null,yearAmount:null,isBold:!0},{name:"\u8425\u6D3B\u52A8\u4EA7\u751F\u7684\u73B0\u91D1\u6D41\u91CF\u51C0\u989D",field:"operating_cash_flow_net",currentAmount:null,yearAmount:null,isBold:!0}]},{title:"\u4E8C\u3001\u6295\u8D44\u6D3B\u52A8\u4EA7\u751F\u7684\u73B0\u91D1\u6D41\u91CF\uFF1A",items:[{name:"\u6536\u56DE\u6295\u8D44\u6536\u5230\u7684\u73B0\u91D1",field:"investment_recovery",currentAmount:null,yearAmount:null},{name:"\u53D6\u5F97\u6295\u8D44\u6536\u76CA\u6536\u5230\u7684\u73B0\u91D1",field:"investment_income",currentAmount:null,yearAmount:null},{name:"\u5904\u7F6E\u56FA\u5B9A\u8D44\u4EA7\u3001\u65E0\u5F62\u8D44\u4EA7\u548C\u5176\u4ED6\u957F\u671F\u8D44\u4EA7\u6536\u56DE\u7684\u73B0\u91D1\u51C0\u989D",field:"fixed_assets_disposal",currentAmount:null,yearAmount:null},{name:"\u5904\u7F6E\u5B50\u516C\u53F8\u53CA\u5176\u4ED6\u8425\u4E1A\u5355\u4F4D\u6536\u5230\u7684\u73B0\u91D1\u51C0\u989D",field:"subsidiary_disposal",currentAmount:null,yearAmount:null},{name:"\u6536\u5230\u5176\u4ED6\u4E0E\u6295\u8D44\u6D3B\u52A8\u6709\u5173\u7684\u73B0\u91D1",field:"other_investment_received",currentAmount:null,yearAmount:null},{name:"\u6295\u8D44\u6D3B\u52A8\u73B0\u91D1\u6D41\u5165\u5C0F\u8BA1",field:"investment_cash_inflow_total",currentAmount:null,yearAmount:null,isBold:!0},{name:"\u8D2D\u5EFA\u56FA\u5B9A\u8D44\u4EA7\u3001\u65E0\u5F62\u8D44\u4EA7\u548C\u5176\u4ED6\u957F\u671F\u8D44\u4EA7\u652F\u4ED8\u7684\u73B0\u91D1",field:"fixed_assets_acquisition",currentAmount:null,yearAmount:null},{name:"\u6295\u8D44\u652F\u4ED8\u7684\u73B0\u91D1",field:"investment_payment",currentAmount:null,yearAmount:null},{name:"\u53D6\u5F97\u5B50\u516C\u53F8\u53CA\u5176\u4ED6\u8425\u4E1A\u5355\u4F4D\u652F\u4ED8\u7684\u73B0\u91D1\u51C0\u989D",field:"subsidiary_acquisition",currentAmount:null,yearAmount:null},{name:"\u652F\u4ED8\u5176\u4ED6\u4E0E\u6295\u8D44\u6D3B\u52A8\u6709\u5173\u7684\u73B0\u91D1",field:"other_investment_payment",currentAmount:null,yearAmount:null},{name:"\u6295\u8D44\u6D3B\u52A8\u73B0\u91D1\u6D41\u51FA\u5C0F\u8BA1",field:"investment_cash_outflow_total",currentAmount:null,yearAmount:null,isBold:!0},{name:"\u6295\u8D44\u6D3B\u52A8\u4EA7\u751F\u7684\u73B0\u91D1\u6D41\u91CF\u51C0\u989D",field:"investment_cash_flow_net",currentAmount:null,yearAmount:null,isBold:!0}]},{title:"\u4E09\u3001\u7B79\u8D44\u6D3B\u52A8\u4EA7\u751F\u7684\u73B0\u91D1\u6D41\u91CF\uFF1A",items:[{name:"\u5438\u6536\u6295\u8D44\u6536\u5230\u7684\u73B0\u91D1",field:"investment_received",currentAmount:null,yearAmount:null},{name:"\u5176\u4E2D\uFF1A\u5B50\u516C\u53F8\u5438\u6536\u5C11\u6570\u80A1\u4E1C\u6295\u8D44\u6536\u5230\u7684\u73B0\u91D1",field:"subsidiary_investment_received",currentAmount:null,yearAmount:null,isSubItem:!0},{name:"\u53D6\u5F97\u501F\u6B3E\u6536\u5230\u7684\u73B0\u91D1",field:"loan_received",currentAmount:null,yearAmount:null},{name:"\u6536\u5230\u5176\u4ED6\u4E0E\u7B79\u8D44\u6D3B\u52A8\u6709\u5173\u7684\u73B0\u91D1",field:"other_financing_received",currentAmount:null,yearAmount:null},{name:"\u7B79\u8D44\u6D3B\u52A8\u73B0\u91D1\u6D41\u5165\u5C0F\u8BA1",field:"financing_cash_inflow_total",currentAmount:null,yearAmount:null,isBold:!0},{name:"\u507F\u8FD8\u503A\u52A1\u652F\u4ED8\u7684\u73B0\u91D1",field:"debt_payment",currentAmount:null,yearAmount:null},{name:"\u5206\u914D\u80A1\u5229\u3001\u5229\u6DA6\u6216\u507F\u4ED8\u5229\u606F\u652F\u4ED8\u7684\u73B0\u91D1",field:"dividend_interest_payment",currentAmount:null,yearAmount:null},{name:"\u5176\u4E2D\uFF1A\u5B50\u516C\u53F8\u652F\u4ED8\u7ED9\u5C11\u6570\u80A1\u4E1C\u7684\u80A1\u5229\u3001\u5229\u6DA6",field:"subsidiary_dividend_payment",currentAmount:null,yearAmount:null,isSubItem:!0},{name:"\u652F\u4ED8\u5176\u4ED6\u4E0E\u7B79\u8D44\u6D3B\u52A8\u6709\u5173\u7684\u73B0\u91D1",field:"other_financing_payment",currentAmount:null,yearAmount:null},{name:"\u7B79\u8D44\u6D3B\u52A8\u73B0\u91D1\u6D41\u51FA\u5C0F\u8BA1",field:"financing_cash_outflow_total",currentAmount:null,yearAmount:null,isBold:!0},{name:"\u7B79\u8D44\u6D3B\u52A8\u4EA7\u751F\u7684\u73B0\u91D1\u6D41\u91CF\u51C0\u989D",field:"financing_cash_flow_net",currentAmount:null,yearAmount:null,isBold:!0}]},{title:"\u56DB\u3001\u6C47\u7387\u53D8\u52A8\u5BF9\u73B0\u91D1\u53CA\u73B0\u91D1\u7B49\u4EF7\u7269\u7684\u5F71\u54CD",items:[{name:"\u6C47\u7387\u53D8\u52A8\u5BF9\u73B0\u91D1\u53CA\u73B0\u91D1\u7B49\u4EF7\u7269\u7684\u5F71\u54CD",field:"exchange_rate_effect",currentAmount:null,yearAmount:null,isBold:!0}]},{title:"\u4E94\u3001\u73B0\u91D1\u53CA\u73B0\u91D1\u7B49\u4EF7\u7269\u51C0\u589E\u52A0\u989D",items:[{name:"\u73B0\u91D1\u53CA\u73B0\u91D1\u7B49\u4EF7\u7269\u51C0\u589E\u52A0\u989D",field:"cash_net_increase",currentAmount:null,yearAmount:null,isBold:!0},{name:"\u52A0\uFF1A\u671F\u521D\u73B0\u91D1\u53CA\u73B0\u91D1\u7B49\u4EF7\u7269\u4F59\u989D",field:"beginning_cash_balance",currentAmount:null,yearAmount:null}]},{title:"\u516D\u3001\u671F\u672B\u73B0\u91D1\u53CA\u73B0\u91D1\u7B49\u4EF7\u7269\u4F59\u989D",items:[{name:"\u671F\u672B\u73B0\u91D1\u53CA\u73B0\u91D1\u7B49\u4EF7\u7269\u4F59\u989D",field:"ending_cash_balance",currentAmount:null,yearAmount:null,isBold:!0}]}]);return{cashFlowData:B,convertToStorageFormat:D=>{const m={};return B.value.forEach(E=>{E.items.forEach(l=>{m[l.field]={current_amount:l.currentAmount,year_amount:l.yearAmount}})}),{period:D,data:JSON.stringify(m)}},restoreFromStorageFormat:D=>{const m=JSON.parse(D.data);B.value.forEach(E=>{E.items.forEach(l=>{const s=m[l.field];s&&(l.currentAmount=s.current_amount,l.yearAmount=s.year_amount)})})}}};const L={class:"max-w-[1200px] mx-auto bg-white rounded-lg shadow-lg p-6"},z={class:"flex justify-between items-center mb-6"},G={class:"flex items-center space-x-4"},H={class:"overflow-x-auto"},W={class:"w-full border-collapse border border-gray-300"},K={class:"border border-gray-300 px-4 py-2 font-bold"},Q={class:"border border-gray-300 px-4 py-2"},X=["onUpdate:modelValue","data-field"],Y={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue","data-field"],P=j({__name:"CashFlowStatement",setup(B){var v;const d=V(),o=_(((v=d.query.period)==null?void 0:v.toString())||new Date().toISOString().slice(0,7)),{cashFlowData:D,convertToStorageFormat:m,restoreFromStorageFormat:E}=J(),l=N.CASH_FLOW,s=_(""),f=_(""),y=async t=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u73B0\u91D1\u6D41\u91CF\u8868\u6570\u636E\uFF0C\u671F\u95F4: ${t}`);const u=await fetch(`http://47.111.95.19:3000/cash-flow/${t}`);if(!u.ok){if(u.status===404){console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4F7F\u7528\u521D\u59CB\u6A21\u677F");return}throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25")}const n=await u.json();if(console.log("API\u8FD4\u56DE\u6570\u636E:",n),n.success&&n.data){console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u6062\u590D...");const a=typeof n.data=="string"?JSON.parse(n.data):n.data;console.log("\u89E3\u6790\u540E\u7684\u6570\u636E:",a),Object.keys(a).forEach(r=>{const A=D.value.flatMap(i=>i.items).find(i=>i.field===r);A&&(A.currentAmount=a[r].current_amount,A.yearAmount=a[r].year_amount,console.log(`\u6062\u590D\u5B57\u6BB5 ${r}:`,a[r]))}),console.log("\u6570\u636E\u6062\u590D\u5B8C\u6210")}}catch(u){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",u)}};b(()=>d.query.period,t=>{t&&(o.value=t.toString(),y(t.toString()),p())}),b(o,t=>{y(t),p()});const k=async()=>{try{const t=m(o.value),u=await fetch("http://47.111.95.19:3000/cash-flow",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!u.ok){const a=await u.json();throw new Error(a.error||"\u4FDD\u5B58\u5931\u8D25")}const n=await u.json();console.log("\u4FDD\u5B58\u6210\u529F:",n.message),await M(l,o.value,t,s.value,f.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25: "+(t instanceof Error?t.message:"\u672A\u77E5\u9519\u8BEF"))}},O=()=>{D.value.forEach(t=>{t.items.forEach(u=>{u.currentAmount=null,u.yearAmount=null})})},p=async()=>{const{remarks:t,suggestions:u}=await R(l,o.value);s.value=t,f.value=u};return I(()=>{console.log("\u73B0\u91D1\u6D41\u91CF\u8868\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",o.value),d.query.period?y(d.query.period.toString()):y(o.value),p()}),(t,u)=>(F(),c("div",L,[e("div",z,[u[3]||(u[3]=e("h1",{class:"text-2xl font-bold"},"\u73B0\u91D1\u6D41\u91CF\u8868",-1)),e("div",G,[C(e("input",{"onUpdate:modelValue":u[0]||(u[0]=n=>o.value=n),type:"month",class:"px-3 py-2 border rounded"},null,512),[[g,o.value]])])]),e("div",H,[e("table",W,[u[6]||(u[6]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2"},"\u9879\u76EE"),e("th",{class:"border border-gray-300 px-4 py-2 w-40"},"\u672C\u671F\u91D1\u989D"),e("th",{class:"border border-gray-300 px-4 py-2 w-40"},"\u672C\u5E74\u7D2F\u8BA1")])],-1)),e("tbody",null,[(F(!0),c(h,null,w(x(D),(n,a)=>(F(),c(h,{key:a},[e("tr",null,[e("td",K,S(n.title),1),u[4]||(u[4]=e("td",{class:"border border-gray-300 px-4 py-2"},null,-1)),u[5]||(u[5]=e("td",{class:"border border-gray-300 px-4 py-2"},null,-1))]),(F(!0),c(h,null,w(n.items,(r,A)=>(F(),c("tr",{key:`${a}-${A}`},[e("td",{class:$(["border border-gray-300 px-4 py-2",r.isSubItem?"pl-8":"",r.isBold?"font-bold":""])},S(r.name),3),e("td",Q,[C(e("input",{"onUpdate:modelValue":i=>r.currentAmount=i,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01","data-field":r.field},null,8,X),[[g,r.currentAmount]])]),e("td",Y,[C(e("input",{"onUpdate:modelValue":i=>r.yearAmount=i,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01","data-field":`${r.field}_year`},null,8,Z),[[g,r.yearAmount]])])]))),128))],64))),128))])])]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:k,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:O,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")]),T(q,{"module-id":x(l),period:o.value,remarks:s.value,"onUpdate:remarks":u[1]||(u[1]=n=>s.value=n),suggestions:f.value,"onUpdate:suggestions":u[2]||(u[2]=n=>f.value=n)},null,8,["module-id","period","remarks","suggestions"])]))}});var tu=U(P,[["__scopeId","data-v-61f2feb6"]]);export{tu as default};
