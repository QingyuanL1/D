import{_ as O,d as S,r as o,o as A,a as z,b as v,e as s,y as L,z as Y,F as k,g as N,t as _,C as $,v as f}from"./index.442dcde9.js";import{i as j,L as T}from"./index.0a005eaa.js";const V={class:"p-6 bg-gray-50 min-h-screen"},I={class:"max-w-7xl mx-auto"},M={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},U={class:"flex items-center justify-between"},W={class:"flex items-center space-x-3"},G=["value"],q={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},H={class:"flex justify-between items-center mb-6"},J={class:"text-lg font-semibold text-gray-900"},K=S({__name:"ROEChart",setup(P){const u=o(new Date().getFullYear().toString()),h=o([]),g=o(!0),c=o(null),r=o(null),d=o([]),n=o({}),E=o({currentROE:0,completion_rate:0,targetROE:20}),p=t=>t.toLocaleString("zh-CN",{maximumFractionDigits:2}),w=()=>{const t=new Date().getFullYear(),a=[];for(let e=0;e<5;e++)a.push((t-e).toString());h.value=a},y=async()=>{try{g.value=!0,await F(),C()}catch(t){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",t)}finally{g.value=!1}},m=()=>{d.value=[],n.value={roe:[]},E.value={currentROE:0,completion_rate:0,targetROE:20}},F=async()=>{var t;try{console.log("Fetching ROE data for year:",u.value);const a=await fetch(`http://47.111.95.19:3000/analytics/roe/${u.value}`);if(a.ok){const e=await a.json();if(console.log("ROE data response:",e),e.success&&e.data){d.value=e.data.months||[],n.value=e.data.monthlyData||{roe:[]};const l=((t=e.data.monthlyData)==null?void 0:t.roe)&&e.data.monthlyData.roe.length>0?e.data.monthlyData.roe[e.data.monthlyData.roe.length-1]:0;E.value={currentROE:l,completion_rate:l/20*100,targetROE:20}}else m()}else m()}catch(a){console.error("\u83B7\u53D6ROE\u6570\u636E\u5931\u8D25:",a),m()}},B=()=>{c.value&&(r.value=j(c.value))},C=()=>{if(!!r.value)try{const t=d.value||[],a=n.value&&n.value.roe?n.value.roe:[],e=t.length>0&&a.length>0,l=e?t.map(()=>20):[];console.log("Chart data:",{monthsData:t,roeData:a,targetData:l,hasData:e});const R={title:{text:`${u.value}\u5E74\u51C0\u8D44\u4EA7\u6536\u76CA\u7387\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(i){if(!e)return"\u6682\u65E0\u6570\u636E";let D=`${i[0].name}<br/>`;return i.forEach(b=>{D+=`${b.seriesName}: ${p(b.value)}%<br/>`}),D}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:e?t:[],axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u767E\u5206\u6BD4(%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(i){return p(i)+"%"},fontSize:12}},series:e?[{name:"\u51C0\u8D44\u4EA7\u6536\u76CA\u7387",type:"line",data:a,smooth:!0,lineStyle:{color:"#3B82F6",width:3},itemStyle:{color:"#3B82F6"},areaStyle:{color:new T(0,0,0,1,[{offset:0,color:"#3B82F640"},{offset:1,color:"#3B82F610"}])}},{name:"\u76EE\u6807\u7EBF",type:"line",data:l,lineStyle:{color:"#EF4444",width:2,type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]:[],graphic:e?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};r.value.setOption(R,!0)}catch(t){console.error("\u66F4\u65B0\u8D8B\u52BF\u56FE\u8868\u5931\u8D25:",t)}},x=()=>{var t;(t=r.value)==null||t.resize()};return A(async()=>{w(),B(),await y(),window.addEventListener("resize",x)}),z(()=>{var t;(t=r.value)==null||t.dispose(),window.removeEventListener("resize",x)}),(t,a)=>(f(),v("div",V,[s("div",I,[a[4]||(a[4]=s("div",{class:"mb-8"},[s("h1",{class:"text-3xl font-bold text-gray-900"},"\u51C0\u8D44\u4EA7\u6536\u76CA\u7387\u5206\u6790"),s("p",{class:"text-gray-600 mt-2"},"\u51C0\u8D44\u4EA7\u6536\u76CA\u7387 (ROE) \u8D28\u91CF\u60C5\u51B5\u5206\u6790")],-1)),s("div",M,[s("div",U,[a[2]||(a[2]=s("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),s("div",W,[a[1]||(a[1]=s("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),L(s("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),onChange:y,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(f(!0),v(k,null,N(h.value,e=>(f(),v("option",{key:e,value:e},_(e)+"\u5E74",9,G))),128))],544),[[Y,u.value]])])])]),s("div",q,[s("div",H,[s("h3",J,_(u.value)+"\u5E74ROE\u6708\u5EA6\u8D8B\u52BF\u53D8\u5316",1),a[3]||(a[3]=$('<div class="flex items-center space-x-4" data-v-7527ecc6><div class="flex items-center" data-v-7527ecc6><div class="w-4 h-4 bg-blue-500 rounded mr-2" data-v-7527ecc6></div><span class="text-sm text-gray-600" data-v-7527ecc6>\u6708\u5EA6ROE\u53D8\u5316</span></div><div class="flex items-center" data-v-7527ecc6><div class="w-4 h-4 bg-red-500 rounded mr-2" data-v-7527ecc6></div><span class="text-sm text-gray-600" data-v-7527ecc6>\u76EE\u6807\u7EBF (20%)</span></div></div>',1))]),s("div",{class:"h-[500px]",ref_key:"chartRef",ref:c},null,512)])])]))}});var Z=O(K,[["__scopeId","data-v-7527ecc6"]]);export{Z as default};
