import{_ as P,d as T,r as u,o as U,j as V,c as i,a as e,y as q,z as G,F as _,l as y,t as l,f as c,q as H,n as k}from"./index.8819038a.js";import{i as L,L as J}from"./index.0a005eaa.js";const K={class:"p-6 bg-gray-50 min-h-screen"},Q={class:"max-w-7xl mx-auto"},X={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},Z={class:"flex items-center justify-between"},ee={class:"flex items-center space-x-3"},te=["value"],se={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},ae={class:"text-lg font-semibold text-gray-900 mb-4"},oe={class:"space-y-3"},ue={class:"flex justify-between"},le={class:"font-medium text-blue-600"},ne={class:"flex justify-between"},re={class:"font-medium text-green-600"},ie={class:"flex justify-between"},ce={class:"w-full bg-gray-200 rounded-full h-2"},de={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},fe={class:"flex justify-between items-center mb-6"},me={class:"text-lg font-semibold text-gray-900"},ve={class:"bg-white rounded-lg shadow-sm p-6"},he={class:"text-lg font-semibold text-gray-900 mb-6"},pe={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ge={class:"space-y-4"},xe={class:"space-y-2"},_e={class:"flex items-center"},ye={class:"text-sm font-medium text-gray-900"},be={class:"text-right"},Be={class:"text-sm font-medium text-gray-900"},we={class:"text-xs text-gray-500"},Ee=T({__name:"NewOrdersChart",setup(De){const r=u(new Date().getFullYear().toString()),b=u([]),B=u(!0),p=u(null),g=u(null),v=u(null),h=u(null),w=u(["\u8BBE\u5907","\u5143\u4EF6","\u5DE5\u7A0B"]),E=u([]),D=u({}),d=u({}),x=u([]),f=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],m=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),C=s=>f[s%f.length],j=s=>s>=80?"text-green-600":s>=60?"text-yellow-600":"text-red-600",N=()=>{const s=new Date().getFullYear(),t=[];for(let a=0;a<5;a++)t.push((s-a).toString());b.value=t},F=async()=>{try{B.value=!0,await Promise.all([O(),R()]),W()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s)}finally{B.value=!1}},O=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/new-orders/${r.value}`);if(s.ok){const t=await s.json();t.success&&(E.value=t.data.months,D.value=t.data.monthlyData,d.value=t.data.summary)}}catch(s){console.error("\u83B7\u53D6\u65B0\u7B7E\u8BA2\u5355\u6570\u636E\u5931\u8D25:",s)}},R=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/new-orders-breakdown/${r.value}`);if(s.ok){const t=await s.json();t.success&&(x.value=t.data)}}catch(s){console.error("\u83B7\u53D6\u997C\u56FE\u6570\u636E\u5931\u8D25:",s)}},Y=()=>{p.value&&(v.value=L(p.value)),g.value&&(h.value=L(g.value))},W=()=>{I(),M()},I=()=>{if(!v.value)return;const s=[];w.value.forEach((a,o)=>{const n=D.value[a];n&&s.push({name:`${a}`,type:"line",data:n.current_total,smooth:!0,lineStyle:{color:f[o],width:3},itemStyle:{color:f[o]},areaStyle:{color:new J(0,0,0,1,[{offset:0,color:f[o]+"40"},{offset:1,color:f[o]+"10"}])}})});const t={title:{text:`${r.value}\u5E74\u65B0\u7B7E\u8BA2\u5355\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(a){let o=`${a[0].name}<br/>`;return a.forEach(n=>{o+=`${n.seriesName}: ${m(n.value)} \u4E07\u5143<br/>`}),o}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:E.value,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u4E07\u5143",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(a){return m(a)},fontSize:12}},series:s};v.value.setOption(t)},M=()=>{if(!h.value)return;const s={title:{text:"\u7C7B\u522B\u5360\u6BD4",textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"item",formatter:function(t){return`${t.name}<br/>\u6570\u503C: ${m(t.value)} \u4E07\u5143<br/>\u5360\u6BD4: ${t.percent}%`}},legend:{orient:"vertical",left:"left",top:"middle",textStyle:{fontSize:12}},series:[{name:"\u7C7B\u522B\u5360\u6BD4",type:"pie",radius:["30%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},labelLine:{show:!1},data:x.value.map((t,a)=>({value:t.value,name:t.name,itemStyle:{color:C(a)}}))}]};h.value.setOption(s)},S=()=>{var s,t;(s=v.value)==null||s.resize(),(t=h.value)==null||t.resize()};return U(async()=>{N(),Y(),await F(),window.addEventListener("resize",S)}),V(()=>{var s,t;(s=v.value)==null||s.dispose(),(t=h.value)==null||t.dispose(),window.removeEventListener("resize",S)}),(s,t)=>(c(),i("div",K,[e("div",Q,[t[8]||(t[8]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"\u65B0\u7B7E\u8BA2\u5355\u6570\u636E\u5206\u6790"),e("p",{class:"text-gray-600 mt-2"},"\u5E74\u5EA6\u8BA1\u5212\u4E0E\u5F53\u671F\u7D2F\u8BA1\u5BF9\u6BD4\u5206\u6790")],-1)),e("div",X,[e("div",Z,[t[2]||(t[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),e("div",ee,[t[1]||(t[1]=e("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),onChange:F,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(c(!0),i(_,null,y(b.value,a=>(c(),i("option",{key:a,value:a},l(a)+"\u5E74",9,te))),128))],544),[[G,r.value]])])])]),e("div",se,[(c(!0),i(_,null,y(w.value,a=>{var o,n,z,A,$;return c(),i("div",{key:a,class:"bg-white rounded-lg shadow-sm p-6"},[e("h3",ae,l(a),1),e("div",oe,[e("div",ue,[t[3]||(t[3]=e("span",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212:",-1)),e("span",le,l(m(((o=d.value[a])==null?void 0:o.yearly_plan)||0))+" \u4E07\u5143",1)]),e("div",ne,[t[4]||(t[4]=e("span",{class:"text-sm text-gray-600"},"\u5F53\u671F\u7D2F\u8BA1:",-1)),e("span",re,l(m(((n=d.value[a])==null?void 0:n.current_total)||0))+" \u4E07\u5143",1)]),e("div",ie,[t[5]||(t[5]=e("span",{class:"text-sm text-gray-600"},"\u5B8C\u6210\u7387:",-1)),e("span",{class:H(["font-medium",j(((z=d.value[a])==null?void 0:z.completion_rate)||0)])},l(((A=d.value[a])==null?void 0:A.completion_rate)||0)+"% ",3)]),e("div",ce,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:k(`width: ${Math.min((($=d.value[a])==null?void 0:$.completion_rate)||0,100)}%`)},null,4)])])])}),128))]),e("div",de,[e("div",fe,[e("h3",me,l(r.value)+"\u5E74\u6708\u5EA6\u8D8B\u52BF\u5BF9\u6BD4",1),t[6]||(t[6]=e("div",{class:"flex items-center space-x-4"},[e("div",{class:"flex items-center"},[e("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),e("span",{class:"text-sm text-gray-600"},"\u6708\u5EA6\u53D8\u5316\u8D8B\u52BF")])],-1))]),e("div",{class:"h-[500px]",ref_key:"chartRef",ref:p},null,512)]),e("div",ve,[e("h3",he,l(r.value)+"\u5E74\u5404\u7C7B\u522B\u5360\u6BD4\u5206\u6790",1),e("div",pe,[e("div",{class:"h-[350px]",ref_key:"pieChartRef",ref:g},null,512),e("div",ge,[t[7]||(t[7]=e("h4",{class:"text-md font-medium text-gray-800"},"\u5360\u6BD4\u8BE6\u60C5",-1)),e("div",xe,[(c(!0),i(_,null,y(x.value,(a,o)=>(c(),i("div",{key:o,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",_e,[e("div",{class:"w-3 h-3 rounded-full mr-3",style:k(`background-color: ${C(o)}`)},null,4),e("span",ye,l(a.name),1)]),e("div",be,[e("div",Be,l(m(a.value))+" \u4E07\u5143",1),e("div",we,l(a.percentage)+"%",1)])]))),128))])])])])])]))}});var Se=P(Ee,[["__scopeId","data-v-049fa511"]]);export{Se as default};
