import{_ as I,d as f,r as g,h as B,B as D,o as A,c as m,a as u,y as S,A as C,F as w,l as k,t as a,b as M,m as U,G as R,f as b}from"./index.8819038a.js";import{_ as T,r as N,M as E,l as P}from"./FormAttachmentAndRemarks.405534b8.js";const O={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},$={class:"flex justify-between items-center mb-6"},j={class:"flex items-center space-x-4"},q={class:"overflow-x-auto my-6"},V={class:"w-full border-collapse border border-gray-300"},L={class:"border border-gray-300 px-4 py-2 text-center"},G={class:"border border-gray-300 px-4 py-2"},J={class:"border border-gray-300 px-4 py-2"},z={class:"border border-gray-300 px-4 py-2"},H={class:"border border-gray-300 px-4 py-2"},K={class:"border border-gray-300 px-4 py-2"},Q={class:"text-sm font-medium"},W={class:"bg-gray-50 font-bold"},X={class:"border border-gray-300 px-4 py-2"},Y={class:"border border-gray-300 px-4 py-2"},Z={class:"border border-gray-300 px-4 py-2"},ee={class:"border border-gray-300 px-4 py-2"},ue=f({__name:"BusinessIncomeStructure",setup(oe){var x;const i=R(),t=g(((x=i.query.period)==null?void 0:x.toString())||new Date().toISOString().slice(0,7)),l=()=>[{id:1,category:"\u4E3B\u8425\u4E1A\u52A1",yearlyPlan:59400,currentMonthIncome:0,accumulatedIncome:0},{id:2,category:"\u975E\u4E3B\u8425\u4E1A\u52A1",yearlyPlan:600,currentMonthIncome:0,accumulatedIncome:0}],s=g(l()),d=g(""),c=g(""),_=(e,o)=>!e||e===0?"0.00":(o/e*100).toFixed(2),p=B(()=>{const e={yearlyPlan:0,currentMonthIncome:0,accumulatedIncome:0,progress:0};return s.value.forEach(o=>{e.yearlyPlan+=o.yearlyPlan||0,e.currentMonthIncome+=o.currentMonthIncome||0,e.accumulatedIncome+=o.accumulatedIncome||0}),e.progress=e.yearlyPlan>0?e.accumulatedIncome/e.yearlyPlan*100:0,e.progress=parseFloat(e.progress.toFixed(2)),e}),y=async e=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u8425\u4E1A\u6536\u5165\u7ED3\u6784\u6570\u636E\uFF0C\u671F\u95F4: ${e}`);const o=await fetch(`http://47.111.95.19:3000/business-income/${e}`);if(!o.ok){if(o.status===404){console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4F7F\u7528\u521D\u59CB\u6A21\u677F"),s.value=l();return}throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25")}const r=await o.json();console.log("API\u8FD4\u56DE\u6570\u636E:",r),r.success&&r.data&&Array.isArray(r.data)?(console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u76F4\u63A5\u4F7F\u7528\u540E\u7AEF\u8BA1\u7B97\u7684\u7ED3\u679C"),s.value=r.data.map(n=>({id:n.id,category:n.category,yearlyPlan:n.id===1?59400:600,currentMonthIncome:n.currentMonthIncome||0,accumulatedIncome:n.accumulatedIncome||0})),console.log("\u5904\u7406\u540E\u7684\u6570\u636E:",s.value)):(console.log("\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u4F7F\u7528\u521D\u59CB\u6A21\u677F"),s.value=l())}catch(o){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",o),s.value=l()}};D(()=>i.query.period,e=>{e&&(t.value=e.toString(),y(e.toString()),F())}),D(t,e=>{y(e),F()});const v=async()=>{try{console.log("\u4FDD\u5B58\u6570\u636E:",{period:t.value,data:s.value});const e=await fetch("http://47.111.95.19:3000/business-income",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:t.value,data:s.value})});if(!e.ok){const o=await e.text();throw new Error(`\u4FDD\u5B58\u5931\u8D25: ${e.status} - ${o}`)}await N(E.BUSINESS_INCOME_STRUCTURE,t.value,s.value,d.value,c.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25: "+(e instanceof Error?e.message:"\u672A\u77E5\u9519\u8BEF"))}},h=()=>{s.value=l(),d.value="",c.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")},F=async()=>{const{remarks:e,suggestions:o}=await P(E.BUSINESS_INCOME_STRUCTURE,t.value);d.value=e,c.value=o};return A(()=>{console.log("\u8425\u4E1A\u6536\u5165\u7ED3\u6784\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",t.value),i.query.period?y(i.query.period.toString()):y(t.value),F()}),(e,o)=>(b(),m("div",O,[u("div",$,[o[3]||(o[3]=u("h1",{class:"text-2xl font-bold"},"\u8425\u4E1A\u6536\u5165\u7ED3\u6784\u4E0E\u8D28\u91CF\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),u("div",j,[S(u("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>t.value=r),type:"month",class:"px-3 py-2 border rounded"},null,512),[[C,t.value]])])]),u("div",q,[u("table",V,[o[6]||(o[6]=u("thead",{class:"sticky top-0 bg-white"},[u("tr",{class:"bg-gray-50"},[u("th",{class:"border border-gray-300 px-4 py-2"},"\u5E8F\u53F7"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u8D22\u52A1\u79D1\u76EE"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u6708\u6536\u5165"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u6536\u5165"),u("th",{class:"border border-gray-300 px-4 py-2"},"\u6267\u884C\u8FDB\u5EA6")])],-1)),u("tbody",null,[(b(!0),m(w,null,k(s.value,(r,n)=>(b(),m("tr",{key:n},[u("td",L,a(r.id),1),u("td",G,a(r.category),1),u("td",J,a(r.yearlyPlan.toFixed(2)),1),u("td",z,a(r.currentMonthIncome.toFixed(2)),1),u("td",H,a(r.accumulatedIncome.toFixed(2)),1),u("td",K,[u("span",Q,a(_(r.yearlyPlan,r.accumulatedIncome))+"%",1)])]))),128)),u("tr",W,[o[4]||(o[4]=u("td",{class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),o[5]||(o[5]=u("td",{class:"border border-gray-300 px-4 py-2"},null,-1)),u("td",X,a(p.value.yearlyPlan.toFixed(2)),1),u("td",Y,a(p.value.currentMonthIncome.toFixed(2)),1),u("td",Z,a(p.value.accumulatedIncome.toFixed(2)),1),u("td",ee,a(p.value.progress.toFixed(2))+"% ",1)])])])]),M(T,{"module-id":U(E).BUSINESS_INCOME_STRUCTURE,period:t.value,remarks:d.value,"onUpdate:remarks":o[1]||(o[1]=r=>d.value=r),suggestions:c.value,"onUpdate:suggestions":o[2]||(o[2]=r=>c.value=r)},null,8,["module-id","period","remarks","suggestions"]),u("div",{class:"mt-4 flex justify-end space-x-4"},[u("button",{onClick:v,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),u("button",{onClick:h,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var se=I(ue,[["__scopeId","data-v-d000aeda"]]);export{se as default};
