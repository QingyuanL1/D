import{_ as j,d as Y,r as a,h as k,o as P,j as T,c as b,a as u,y as V,z as I,F as O,l as U,t as o,A as W,q as f,n as B,f as h}from"./index.75a6becc.js";import{i as q,L as G}from"./index.0a005eaa.js";const H={class:"p-6 bg-gray-50 min-h-screen"},J={class:"max-w-7xl mx-auto"},K={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},Q={class:"flex items-center justify-between"},X={class:"flex items-center space-x-3"},Z=["value"],ee={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},te={class:"flex justify-between items-center mb-6"},ue={class:"text-lg font-semibold text-gray-900"},se={class:"bg-white rounded-lg shadow-sm p-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},le={class:"p-4 border border-gray-200 rounded-lg"},re={class:"flex justify-between items-center mb-3"},ne={class:"w-full bg-gray-200 rounded-full h-3 mb-2"},oe={class:"text-xs text-gray-600"},ie={class:"p-4 border border-gray-200 rounded-lg"},de={class:"flex justify-between items-center mb-3"},ce={class:"w-full bg-gray-200 rounded-full h-3 mb-2"},fe={class:"text-xs text-gray-600"},ve={class:"p-4 border border-gray-200 rounded-lg"},ge={class:"flex justify-between items-center mb-3"},me=Y({__name:"NetProfitMarginChart",setup(xe){const i=a(new Date().getFullYear().toString()),y=a([]),p=a(!0),x=a(null),d=a(null),r=a(8),l=a(0),c=a([]),n=a([]),v=k(()=>r.value>0?l.value/r.value*100:0),g=e=>e.toLocaleString("zh-CN",{maximumFractionDigits:2}),F=e=>e>=8?"text-green-600":e>=5?"text-blue-600":e>=2?"text-yellow-600":"text-red-600",C=e=>e>=8?"bg-green-500":e>=5?"bg-blue-500":e>=2?"bg-yellow-500":"bg-red-500",S=e=>e>=100?"text-green-600":e>=80?"text-blue-600":e>=60?"text-yellow-600":"text-red-600",A=e=>e>=100?"bg-green-500":e>=80?"bg-blue-500":e>=60?"bg-yellow-500":"bg-red-500",z=()=>{const e=n.value.slice(-3);if(e.length<2)return"text-gray-600";const t=e[e.length-1]-e[0];return t>.5?"text-green-600":t<-.5?"text-red-600":"text-yellow-600"},R=()=>{const e=n.value.slice(-3);if(e.length<2)return"\u6570\u636E\u4E0D\u8DB3";const t=e[e.length-1]-e[0];return t>.5?"\u4E0A\u5347\u8D8B\u52BF":t<-.5?"\u4E0B\u964D\u8D8B\u52BF":"\u4FDD\u6301\u7A33\u5B9A"},L=()=>{const e=new Date().getFullYear(),t=[];for(let s=0;s<5;s++)t.push((e-s).toString());y.value=t},E=async()=>{try{p.value=!0,await M(),$()}catch(e){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",e),m()}finally{p.value=!1}},M=async()=>{try{const e=await fetch(`http://47.111.95.19:3000/analytics/net-profit-margin/${i.value}`);if(e.ok){const t=await e.json();t.success&&t.data?t.data.hasData===!1?(c.value=[],n.value=[],l.value=0):(c.value=t.data.months||[],n.value=t.data.monthlyData||[],l.value=t.data.currentRate||0,r.value=t.data.targetRate||8):m()}else m()}catch(e){console.error("\u83B7\u53D6\u51C0\u5229\u7387\u6570\u636E\u5931\u8D25:",e),m()}},m=()=>{c.value=[],n.value=[],l.value=0},N=()=>{x.value&&(d.value=q(x.value))},$=()=>{if(!d.value)return;if(c.value.length===0||n.value.length===0){const s={title:{text:`${i.value}\u5E74\u6682\u65E0\u51C0\u5229\u7387\u6570\u636E`,textStyle:{fontSize:16,fontWeight:"bold",color:"#9CA3AF"},left:"center",top:"middle"},graphic:{type:"text",left:"center",top:"60%",style:{text:"\u8BF7\u9009\u62E9\u5176\u4ED6\u5E74\u4EFD\u67E5\u770B\u6570\u636E",fontSize:14,fill:"#9CA3AF"}}};d.value.setOption(s,!0);return}const e=c.value.map(()=>r.value),t={title:{text:`${i.value}\u5E74\u51C0\u5229\u7387\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(s){let D=`${s[0].name}<br/>`;return s.forEach(w=>{D+=`${w.seriesName}: ${g(w.value)}%<br/>`}),D}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:c.value,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u767E\u5206\u6BD4(%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(s){return g(s)+"%"},fontSize:12}},series:[{name:"\u5B9E\u9645\u51C0\u5229\u7387",type:"line",data:n.value,smooth:!0,lineStyle:{color:"#3B82F6",width:3},itemStyle:{color:"#3B82F6"},areaStyle:{color:new G(0,0,0,1,[{offset:0,color:"#3B82F640"},{offset:1,color:"#3B82F610"}])}},{name:"\u76EE\u6807\u7EBF",type:"line",data:e,lineStyle:{color:"#EF4444",width:2,type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]};d.value.setOption(t,!0)},_=()=>{var e;(e=d.value)==null||e.resize()};return P(async()=>{L(),N(),await E(),window.addEventListener("resize",_)}),T(()=>{var e;(e=d.value)==null||e.dispose(),window.removeEventListener("resize",_)}),(e,t)=>(h(),b("div",H,[u("div",J,[t[9]||(t[9]=u("div",{class:"mb-8"},[u("h1",{class:"text-3xl font-bold text-gray-900"},"\u51C0\u5229\u7387\u5206\u6790"),u("p",{class:"text-gray-600 mt-2"},"\u51C0\u5229\u6DA6\u7387\u5206\u6790\u4E0E\u8D8B\u52BF\u76D1\u63A7")],-1)),u("div",K,[u("div",Q,[t[2]||(t[2]=u("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),u("div",X,[t[1]||(t[1]=u("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),V(u("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),onChange:E,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(h(!0),b(O,null,U(y.value,s=>(h(),b("option",{key:s,value:s},o(s)+"\u5E74",9,Z))),128))],544),[[I,i.value]])])])]),u("div",ee,[u("div",te,[u("h3",ue,o(i.value)+"\u5E74\u51C0\u5229\u7387\u6708\u5EA6\u8D8B\u52BF",1),t[3]||(t[3]=W('<div class="flex items-center space-x-4" data-v-18022cdb><div class="flex items-center" data-v-18022cdb><div class="w-4 h-4 bg-blue-500 rounded mr-2" data-v-18022cdb></div><span class="text-sm text-gray-600" data-v-18022cdb>\u5B9E\u9645\u51C0\u5229\u7387</span></div><div class="flex items-center" data-v-18022cdb><div class="w-4 h-4 bg-red-500 rounded mr-2" data-v-18022cdb></div><span class="text-sm text-gray-600" data-v-18022cdb>\u76EE\u6807\u7EBF</span></div></div>',1))]),u("div",{class:"h-[400px]",ref_key:"chartRef",ref:x},null,512)]),u("div",se,[t[8]||(t[8]=u("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5F53\u524D\u51C0\u5229\u7387\u6982\u51B5",-1)),u("div",ae,[u("div",le,[u("div",re,[t[4]||(t[4]=u("h4",{class:"font-medium text-gray-900"},"\u5F53\u524D\u51C0\u5229\u7387",-1)),u("span",{class:f(["text-2xl font-bold",F(l.value)])},o(g(l.value))+"% ",3)]),u("div",ne,[u("div",{class:f(["h-3 rounded-full transition-all duration-300",C(l.value)]),style:B(`width: ${Math.min(Math.abs(l.value/r.value*100),100)}%`)},null,6)]),u("p",oe," \u76EE\u6807: "+o(r.value)+"% ",1)]),u("div",ie,[u("div",de,[t[5]||(t[5]=u("h4",{class:"font-medium text-gray-900"},"\u76EE\u6807\u5B8C\u6210\u7387",-1)),u("span",{class:f(["text-2xl font-bold",S(v.value)])},o(g(v.value))+"% ",3)]),u("div",ce,[u("div",{class:f(["h-3 rounded-full transition-all duration-300",A(v.value)]),style:B(`width: ${Math.min(v.value,100)}%`)},null,6)]),u("p",fe," \u57FA\u4E8E\u76EE\u6807\u51C0\u5229\u7387 "+o(r.value)+"% ",1)]),u("div",ve,[u("div",ge,[t[6]||(t[6]=u("h4",{class:"font-medium text-gray-900"},"\u8D8B\u52BF\u72B6\u6001",-1)),u("span",{class:f(["text-sm font-semibold",z()])},o(R()),3)]),t[7]||(t[7]=u("div",{class:"text-xs text-gray-600"},[u("p",null,"\u57FA\u4E8E\u6700\u8FD13\u4E2A\u6708\u6570\u636E\u5206\u6790")],-1))])])])])]))}});var ye=j(me,[["__scopeId","data-v-18022cdb"]]);export{ye as default};
