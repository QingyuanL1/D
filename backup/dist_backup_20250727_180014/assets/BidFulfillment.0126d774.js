import{_ as S,d as V,r as y,h as $,B as k,o as M,c as i,a as r,y as v,A as D,F as x,l as E,t as c,b as I,m as O,G as R,f as l,k as f}from"./index.c1c40606.js";import{_ as z,M as C,r as G}from"./FormAttachmentAndRemarks.518d63f2.js";const J={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},H={class:"flex justify-between items-center mb-6"},K={class:"flex items-center space-x-4"},Q={class:"overflow-x-auto my-6"},W={class:"w-full border-collapse border border-gray-300"},X=["rowspan"],Y={class:"border border-gray-300 px-4 py-2"},Z={class:"border border-gray-300 px-4 py-2 text-right"},P={class:"border border-gray-300 px-4 py-2"},uu=["onUpdate:modelValue"],tu={class:"border border-gray-300 px-4 py-2 text-right"},eu=["rowspan"],ru={class:"border border-gray-300 px-4 py-2"},ou={class:"border border-gray-300 px-4 py-2 text-right"},nu={class:"border border-gray-300 px-4 py-2"},su=["onUpdate:modelValue"],au={class:"border border-gray-300 px-4 py-2 text-right"},cu=["rowspan"],iu={class:"border border-gray-300 px-4 py-2"},lu={class:"border border-gray-300 px-4 py-2 text-right"},pu={class:"border border-gray-300 px-4 py-2"},du=["onUpdate:modelValue"],mu={class:"border border-gray-300 px-4 py-2 text-right"},yu={class:"bg-gray-50 font-bold"},Fu={class:"border border-gray-300 px-4 py-2 text-right"},Au={class:"border border-gray-300 px-4 py-2 text-right"},bu={class:"border border-gray-300 px-4 py-2 text-right"},gu=V({__name:"BidFulfillment",setup(_u){var w;const B=R(),a=y(((w=B.query.period)==null?void 0:w.toString())||new Date().toISOString().slice(0,7)),F=y(""),A=y(""),s={equipment:{\u4E0A\u6D77:31055.26,\u56FD\u7F51:2798.76,\u6C5F\u82CF:5085.93,\u8F93\u914D\u7535\u5185\u914D:0,\u897F\u95E8\u5B50:0,\u540C\u4E1A:0,\u7528\u6237:0,\u5176\u5B83:0},component:{\u7528\u6237:0},project:{\u4E00\u5305:8281.13,\u4E8C\u5305:444.83,\u57DF\u5185\u5408\u4F5C:702.04,\u57DF\u5916\u5408\u4F5C:0,\u5176\u5B83:21.93}},h=()=>({equipment:[{customerType:"\u4E0A\u6D77",initialAmount:s.equipment.\u4E0A\u6D77,currentAmount:0},{customerType:"\u56FD\u7F51",initialAmount:s.equipment.\u56FD\u7F51,currentAmount:0},{customerType:"\u6C5F\u82CF",initialAmount:s.equipment.\u6C5F\u82CF,currentAmount:0},{customerType:"\u8F93\u914D\u7535\u5185\u914D",initialAmount:s.equipment.\u8F93\u914D\u7535\u5185\u914D,currentAmount:0},{customerType:"\u897F\u95E8\u5B50",initialAmount:s.equipment.\u897F\u95E8\u5B50,currentAmount:0},{customerType:"\u540C\u4E1A",initialAmount:s.equipment.\u540C\u4E1A,currentAmount:0},{customerType:"\u7528\u6237",initialAmount:s.equipment.\u7528\u6237,currentAmount:0},{customerType:"\u5176\u5B83",initialAmount:s.equipment.\u5176\u5B83,currentAmount:0}],component:[{customerType:"\u7528\u6237",initialAmount:s.component.\u7528\u6237,currentAmount:0}],project:[{customerType:"\u4E00\u5305",initialAmount:s.project.\u4E00\u5305,currentAmount:0},{customerType:"\u4E8C\u5305",initialAmount:s.project.\u4E8C\u5305,currentAmount:0},{customerType:"\u57DF\u5185\u5408\u4F5C",initialAmount:s.project.\u57DF\u5185\u5408\u4F5C,currentAmount:0},{customerType:"\u57DF\u5916\u5408\u4F5C",initialAmount:s.project.\u57DF\u5916\u5408\u4F5C,currentAmount:0},{customerType:"\u5176\u5B83",initialAmount:s.project.\u5176\u5B83,currentAmount:0}]}),N=(t,e)=>(!e||typeof e!="object"||(e.equipment&&Array.isArray(e.equipment)&&(t.equipment=t.equipment.map(u=>{const o=e.equipment.find(n=>n.customerType===u.customerType);return o?{...u,initialAmount:u.initialAmount,currentAmount:Number(o.currentAmount)||0}:u})),e.component&&Array.isArray(e.component)&&(t.component=t.component.map(u=>{const o=e.component.find(n=>n.customerType===u.customerType);return o?{...u,initialAmount:u.initialAmount,currentAmount:Number(o.currentAmount)||0}:u})),e.project&&Array.isArray(e.project)&&(t.project=t.project.map(u=>{const o=e.project.find(n=>n.customerType===u.customerType);return o?{...u,initialAmount:u.initialAmount,currentAmount:Number(o.currentAmount)||0}:u}))),t),T=()=>{const t=h();p.value=t.equipment,d.value=t.component,m.value=t.project},p=y([]),d=y([]),m=y([]),g=(t,e)=>t===0?"0.00":((e-t)/t*100).toFixed(2),b=t=>isNaN(t)||t===null||t===void 0?"0.00":t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),_=$(()=>{const t={initialAmount:0,currentAmount:0};return[...p.value,...d.value,...m.value].forEach(u=>{t.initialAmount+=Number(u.initialAmount)||0,t.currentAmount+=Number(u.currentAmount)||0}),t}),j=async t=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${C.BID_FULFILLMENT}/${t}`);if(e.ok){const u=await e.json();u.success&&u.data&&(F.value=u.data.remarks||"",A.value=u.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u548C\u5EFA\u8BAE\u5931\u8D25:",e)}},q=async t=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u6807\u4E66\u5C65\u7EA6\u72B6\u51B5\u6570\u636E\uFF0C\u671F\u95F4: ${t}`);const e=await fetch(`http://47.111.95.19:3000/bid-fulfillment/${t}`);if(!e.ok){if(e.status===404){console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4F7F\u7528\u9884\u7B97\u6570\u636E\u521D\u59CB\u5316");const o=h();p.value=o.equipment,d.value=o.component,m.value=o.project;return}throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25")}const u=await e.json();if(console.log("API\u8FD4\u56DE\u6570\u636E:",u),u.success&&u.data){console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76...");const o=h(),n=N(o,u.data);p.value=n.equipment,d.value=n.component,m.value=n.project,console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{equipmentData:p.value,componentData:d.value,projectData:m.value})}}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e),T()}};k(()=>B.query.period,t=>{t&&t!==a.value&&(a.value=t.toString())},{immediate:!0}),k(a,(t,e)=>{t&&t!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${t}`),q(t),j(t))});const U=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/bid-fulfillment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:{equipment:p.value,component:d.value,project:m.value}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await G(C.BID_FULFILLMENT,a.value,{equipment:p.value,component:d.value,project:m.value},F.value,A.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},L=()=>{T(),F.value="",A.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return M(()=>{console.log("\u6807\u4E66\u5C65\u7EA6\u72B6\u51B5\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",a.value),a.value&&(q(a.value),j(a.value))}),(t,e)=>(l(),i("div",J,[r("div",H,[e[3]||(e[3]=r("h1",{class:"text-2xl font-bold"},"\u4E2D\u6807\u672A\u5C65\u7EA6\u60C5\u51B5\uFF08\u4E2D\u6807\u6807\u5305\u5C65\u7EA6\u7387\u8BE6\u89C1\u516C\u53F8\u9644\u8868\uFF09\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),r("div",K,[v(r("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>a.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[D,a.value]])])]),r("div",Q,[r("table",W,[e[5]||(e[5]=r("thead",{class:"sticky top-0 bg-white"},[r("tr",{class:"bg-gray-50"},[r("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u671F\u521D\u4F59\u989D"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u4F59\u989D"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u6CE2\u52A8\u7387")])],-1)),r("tbody",null,[(l(!0),i(x,null,E(p.value,(u,o)=>(l(),i("tr",{key:`equipment-${o}`},[o===0?(l(),i("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:p.value.length}," \u8BBE\u5907 ",8,X)):f("",!0),r("td",Y,c(u.customerType),1),r("td",Z,[r("span",null,c(b(u.initialAmount)),1)]),r("td",P,[v(r("input",{"onUpdate:modelValue":n=>u.currentAmount=n,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,uu),[[D,u.currentAmount,void 0,{number:!0}]])]),r("td",tu,c(g(u.initialAmount,u.currentAmount||0))+"% ",1)]))),128)),(l(!0),i(x,null,E(d.value,(u,o)=>(l(),i("tr",{key:`component-${o}`},[o===0?(l(),i("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:d.value.length}," \u5143\u4EF6 ",8,eu)):f("",!0),r("td",ru,c(u.customerType),1),r("td",ou,[r("span",null,c(b(u.initialAmount)),1)]),r("td",nu,[v(r("input",{"onUpdate:modelValue":n=>u.currentAmount=n,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,su),[[D,u.currentAmount,void 0,{number:!0}]])]),r("td",au,c(g(u.initialAmount,u.currentAmount||0))+"% ",1)]))),128)),(l(!0),i(x,null,E(m.value,(u,o)=>(l(),i("tr",{key:`project-${o}`},[o===0?(l(),i("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:m.value.length}," \u5DE5\u7A0B ",8,cu)):f("",!0),r("td",iu,c(u.customerType),1),r("td",lu,[r("span",null,c(b(u.initialAmount)),1)]),r("td",pu,[v(r("input",{"onUpdate:modelValue":n=>u.currentAmount=n,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,du),[[D,u.currentAmount,void 0,{number:!0}]])]),r("td",mu,c(g(u.initialAmount,u.currentAmount||0))+"% ",1)]))),128)),r("tr",yu,[e[4]||(e[4]=r("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),r("td",Fu,c(b(_.value.initialAmount)),1),r("td",Au,c(b(_.value.currentAmount)),1),r("td",bu,c(g(_.value.initialAmount,_.value.currentAmount))+"% ",1)])])])]),I(z,{"module-id":O(C).BID_FULFILLMENT,period:a.value,remarks:F.value,"onUpdate:remarks":e[1]||(e[1]=u=>F.value=u),suggestions:A.value,"onUpdate:suggestions":e[2]||(e[2]=u=>A.value=u)},null,8,["module-id","period","remarks","suggestions"]),r("div",{class:"mt-4 flex justify-end space-x-4"},[r("button",{onClick:U,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),r("button",{onClick:L,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var hu=S(gu,[["__scopeId","data-v-67a4c936"]]);export{hu as default};
