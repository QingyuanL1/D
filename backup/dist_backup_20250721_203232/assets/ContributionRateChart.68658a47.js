import{_ as k,d as Y,r as s,o as $,l as j,c as i,a as u,z as N,A as M,F as D,p as B,t as n,i as V,f as c,j as w,n as I}from"./index.e3067c1a.js";import{i as U,L as G}from"./index.0a005eaa.js";const O={class:"p-6 bg-gray-50 min-h-screen"},T={class:"max-w-7xl mx-auto"},W={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},q={class:"flex items-center justify-between"},H={class:"flex items-center space-x-3"},J=["value"],K={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},P={class:"flex justify-between items-center mb-6"},Q={class:"text-lg font-semibold text-gray-900"},X={class:"bg-white rounded-lg shadow-sm p-6"},Z={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},tt={class:"flex justify-between items-center mb-3"},et={class:"font-medium text-gray-900"},at={class:"w-full bg-gray-200 rounded-full h-2 mb-2"},ut={class:"text-xs text-gray-600"},st=Y({__name:"ContributionRateChart",setup(nt){const l=s(new Date().getFullYear().toString()),b=s([]),g=s(!0),v=s(null),o=s(null),F=s(21.98),p=s(0),d=s([]),r=s([]),f=s([{name:"\u8BBE\u5907",plan:25.5,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:22.8,actual:0,rate:0}]),h=e=>e.toLocaleString("zh-CN",{maximumFractionDigits:2}),S=e=>e>=20?"text-green-600":e>=15?"text-blue-600":e>=10?"text-yellow-600":"text-red-600",C=e=>e>=20?"bg-green-500":e>=15?"bg-blue-500":e>=10?"bg-yellow-500":"bg-red-500",z=()=>{const e=new Date().getFullYear(),a=[];for(let t=0;t<5;t++)a.push((e-t).toString());b.value=a},x=async()=>{try{g.value=!0,await A(),L()}catch(e){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",e),m()}finally{g.value=!1}},m=()=>{d.value=["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],r.value=[18.5,19.2,20.1,21.3,22,21.8,22.5,23.1,22.8,23.5,24.2,24.8],p.value=r.value[r.value.length-1]||0,f.value=[{name:"\u8BBE\u5907",plan:25.5,actual:24.2,rate:24.2},{name:"\u5143\u4EF6",plan:15,actual:16.8,rate:16.8},{name:"\u5DE5\u7A0B",plan:22.8,actual:23.5,rate:23.5}]},A=async()=>{try{const e=await fetch(`http://47.111.95.19:3000/analytics/contribution-rate/${l.value}`);if(e.ok){const a=await e.json();a.success&&a.data?(d.value=a.data.months||[],r.value=a.data.monthlyData||[],p.value=a.data.currentRate||0,a.data.segmentData&&(f.value=a.data.segmentData.map(t=>({name:t.name,plan:t.plan,actual:t.actual,rate:t.rate})))):m()}else m()}catch(e){console.error("\u83B7\u53D6\u8FB9\u9645\u8D21\u732E\u7387\u6570\u636E\u5931\u8D25:",e),m()}},R=()=>{v.value&&(o.value=U(v.value))},L=()=>{if(!o.value)return;const e=d.value.map(()=>F.value),a={title:{text:`${l.value}\u5E74\u8FB9\u9645\u8D21\u732E\u7387\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(t){let E=`${t[0].name}<br/>`;return t.forEach(_=>{E+=`${_.seriesName}: ${h(_.value)}%<br/>`}),E}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:d.value,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u767E\u5206\u6BD4(%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(t){return h(t)+"%"},fontSize:12}},series:[{name:"\u5B9E\u9645\u8D21\u732E\u7387",type:"line",data:r.value,smooth:!0,lineStyle:{color:"#3B82F6",width:3},itemStyle:{color:"#3B82F6"},areaStyle:{color:new G(0,0,0,1,[{offset:0,color:"#3B82F640"},{offset:1,color:"#3B82F610"}])}},{name:"\u8BA1\u5212\u76EE\u6807\u7EBF",type:"line",data:e,lineStyle:{color:"#EF4444",width:2,type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]};o.value.setOption(a,!0)},y=()=>{var e;(e=o.value)==null||e.resize()};return $(async()=>{z(),R(),await x(),window.addEventListener("resize",y)}),j(()=>{var e;(e=o.value)==null||e.dispose(),window.removeEventListener("resize",y)}),(e,a)=>(c(),i("div",O,[u("div",T,[a[5]||(a[5]=u("div",{class:"mb-8"},[u("h1",{class:"text-3xl font-bold text-gray-900"},"\u8FB9\u9645\u8D21\u732E\u7387\u5206\u6790"),u("p",{class:"text-gray-600 mt-2"},"\u4E3B\u8425\u4E1A\u52A1\u8FB9\u9645\u8D21\u732E\u7387\u7ED3\u6784\u4E0E\u8D28\u91CF\u5206\u6790")],-1)),u("div",W,[u("div",q,[a[2]||(a[2]=u("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),u("div",H,[a[1]||(a[1]=u("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),N(u("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>l.value=t),onChange:x,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(c(!0),i(D,null,B(b.value,t=>(c(),i("option",{key:t,value:t},n(t)+"\u5E74",9,J))),128))],544),[[M,l.value]])])])]),u("div",K,[u("div",P,[u("h3",Q,n(l.value)+"\u5E74\u8FB9\u9645\u8D21\u732E\u7387\u6708\u5EA6\u8D8B\u52BF",1),a[3]||(a[3]=V('<div class="flex items-center space-x-4" data-v-0691149b><div class="flex items-center" data-v-0691149b><div class="w-4 h-4 bg-blue-500 rounded mr-2" data-v-0691149b></div><span class="text-sm text-gray-600" data-v-0691149b>\u5B9E\u9645\u8D21\u732E\u7387</span></div><div class="flex items-center" data-v-0691149b><div class="w-4 h-4 bg-red-500 rounded mr-2" data-v-0691149b></div><span class="text-sm text-gray-600" data-v-0691149b>\u8BA1\u5212\u76EE\u6807\u7EBF</span></div></div>',1))]),u("div",{class:"h-[400px]",ref_key:"chartRef",ref:v},null,512)]),u("div",X,[a[4]||(a[4]=u("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5404\u677F\u5757\u8D21\u732E\u7387\u5206\u6790",-1)),u("div",Z,[(c(!0),i(D,null,B(f.value,t=>(c(),i("div",{key:t.name,class:"p-4 border border-gray-200 rounded-lg"},[u("div",tt,[u("h4",et,n(t.name),1),u("span",{class:w(["text-sm font-semibold",S(t.rate)])},n(t.rate)+"% ",3)]),u("div",at,[u("div",{class:w(["h-2 rounded-full transition-all duration-300",C(t.rate)]),style:I(`width: ${Math.min(Math.abs(t.rate),100)}%`)},null,6)]),u("p",ut," \u8BA1\u5212: "+n(t.plan)+"% | \u5B9E\u9645: "+n(t.actual)+"% ",1)]))),128))])])])]))}});var rt=k(st,[["__scopeId","data-v-0691149b"]]);export{rt as default};
