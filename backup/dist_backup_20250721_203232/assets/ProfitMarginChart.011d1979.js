import{_ as E,d as D,r as o,C as _,o as w,k as b,l as F,c as p,a as t,z as S,A as C,t as l,F as A,p as z,f as v,n as M}from"./index.e3067c1a.js";import{i as k}from"./index.0a005eaa.js";const j={class:"min-h-screen bg-gray-50 py-8"},L={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},$={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},P={class:"flex items-center justify-between"},N={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},R={class:"flex items-center justify-between mb-6"},I={class:"text-lg font-semibold text-gray-900"},T={class:"text-sm text-gray-500"},U={class:"bg-white rounded-lg shadow-sm p-6"},V={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},W={class:"flex items-center justify-between mb-3"},O={class:"font-medium text-gray-900"},Y={class:"text-lg font-bold text-blue-600"},q={class:"space-y-2"},G={class:"flex justify-between text-sm"},H={class:"font-medium"},J={class:"flex justify-between text-sm"},K={class:"font-medium"},Q={class:"w-full bg-gray-200 rounded-full h-2"},X=D({__name:"ProfitMarginChart",setup(Z){const n=o("2025"),d=o();let s=null;const y=o(24),c=o(0),i=o([]),r=o([]),f=o([{name:"\u8BBE\u5907",plan:21.99,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:26,actual:0,rate:0}]),B=u=>u.toFixed(2),m=()=>{i.value=["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],r.value=[22.5,23.2,24.1,25.3,26,25.8,26.5,27.1,26.8,27.5,28.2,28.8],c.value=r.value[r.value.length-1]||0,f.value=[{name:"\u8BBE\u5907",plan:21.99,actual:24.2,rate:24.2},{name:"\u5143\u4EF6",plan:15,actual:16.8,rate:16.8},{name:"\u5DE5\u7A0B",plan:26,actual:23.5,rate:23.5}]},h=async()=>{try{const u=await fetch(`http://47.111.95.19:3000/analytics/profit-margin/${n.value}`);if(u.ok){const e=await u.json();e.success&&e.data?(i.value=e.data.months||[],r.value=e.data.monthlyData||[],c.value=e.data.currentRate||0,e.data.segmentData&&(f.value=e.data.segmentData.map(a=>({name:a.name,plan:a.plan,actual:a.actual,rate:a.rate})))):m()}else m()}catch(u){console.error("\u83B7\u53D6\u6BDB\u5229\u7387\u6570\u636E\u5931\u8D25:",u),m()}},x=()=>{if(!d.value)return;s&&s.dispose(),s=k(d.value);const u={title:{text:`${n.value}\u5E74\u6BDB\u5229\u7387\u8D8B\u52BF`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(e){let a=`${e[0].name}<br/>`;return e.forEach(g=>{a+=`${g.seriesName}: ${B(g.value)}%<br/>`}),a}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:i.value,axisLabel:{rotate:0,fontSize:12}},yAxis:{type:"value",name:"\u6BDB\u5229\u7387 (%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:"{value}%"}},series:[{name:"\u5B9E\u9645\u6BDB\u5229\u7387",type:"line",data:r.value,smooth:!0,lineStyle:{width:3,color:"#3B82F6"},itemStyle:{color:"#3B82F6",borderWidth:2,borderColor:"#ffffff"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(59, 130, 246, 0.3)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}]}}},{name:"\u76EE\u6807\u6BDB\u5229\u7387",type:"line",data:new Array(i.value.length).fill(y.value),lineStyle:{width:2,color:"#EF4444",type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]};s.setOption(u)};return _(n,()=>{h()}),_([i,r],()=>{b(()=>{x()})}),w(async()=>{await h(),await b(),x(),window.addEventListener("resize",()=>{s&&s.resize()})}),F(()=>{s&&s.dispose(),window.removeEventListener("resize",()=>{s&&s.resize()})}),(u,e)=>(v(),p("div",j,[t("div",L,[e[6]||(e[6]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u6BDB\u5229\u7387\u5206\u6790"),t("p",{class:"mt-2 text-gray-600"},"\u4E3B\u8425\u4E1A\u52A1\u6BDB\u5229\u7387\u8D8B\u52BF\u5206\u6790\u4E0E\u677F\u5757\u5BF9\u6BD4")],-1)),t("div",$,[t("div",P,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u5206\u6790\u5E74\u4EFD",-1)),S(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},e[1]||(e[1]=[t("option",{value:"2024"},"2024\u5E74",-1),t("option",{value:"2025"},"2025\u5E74",-1),t("option",{value:"2023"},"2023\u5E74",-1)]),512),[[C,n.value]])])]),t("div",N,[t("div",R,[t("h3",I,l(n.value)+"\u5E74\u6708\u5EA6\u6BDB\u5229\u7387\u8D8B\u52BF",1),t("div",T," \u5F53\u524D\u6BDB\u5229\u7387: "+l(c.value.toFixed(2))+"% | \u76EE\u6807: "+l(y.value)+"% ",1)]),t("div",{ref_key:"chartContainer",ref:d,class:"w-full h-96"},null,512)]),t("div",U,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5404\u677F\u5757\u6BDB\u5229\u7387\u5206\u6790",-1)),t("div",V,[(v(!0),p(A,null,z(f.value,a=>(v(),p("div",{key:a.name,class:"bg-gray-50 rounded-lg p-4"},[t("div",W,[t("h4",O,l(a.name)+"\u677F\u5757",1),t("span",Y,l(a.rate)+"%",1)]),t("div",q,[t("div",G,[e[3]||(e[3]=t("span",{class:"text-gray-600"},"\u8BA1\u5212\u503C",-1)),t("span",H,l(a.plan)+"%",1)]),t("div",J,[e[4]||(e[4]=t("span",{class:"text-gray-600"},"\u5B9E\u9645\u503C",-1)),t("span",K,l(a.actual)+"%",1)]),t("div",Q,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:M(`width: ${Math.min(a.actual/Math.max(a.plan,a.actual)*100,100)}%`)},null,4)])])]))),128))])])])]))}});var at=E(X,[["__scopeId","data-v-74b65e47"]]);export{at as default};
