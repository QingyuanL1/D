import{_ as W,d as X,u as Y,r as d,c as b,o as Z,b as a,e,y as x,A as D,z as T,F as y,g as f,x as j,t as u,f as v,m as ee,v as n,l as U}from"./index.97f4c543.js";const te={class:"p-6 bg-gray-50 min-h-screen"},se={class:"max-w-7xl mx-auto"},oe={class:"bg-white p-6 rounded-lg shadow-sm mb-6"},ue={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},re={class:"flex items-center space-x-4"},le={class:"relative"},ae=["value"],ne={class:"bg-white rounded-lg shadow-sm"},de={class:"px-6 py-4 border-b border-gray-200"},ie={class:"text-sm text-gray-600 mt-1"},ce={class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},xe={key:0,class:"text-center"},ve={key:1,class:"text-center"},ge={class:"px-6 py-4 whitespace-nowrap"},be={class:"flex items-center"},ye={class:"ml-4"},fe={class:"text-sm font-medium text-gray-900"},he={class:"text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap"},we={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"},ke=["onClick"],De=["onClick"],Ce=["onClick"],Be={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between"},Ee={class:"text-sm text-gray-700"},Ae={class:"flex items-center space-x-2"},je=["disabled"],Ue={class:"px-3 py-1 text-sm text-gray-700"},Me=["disabled"],$e={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Se={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},ze={class:"px-6 py-4 border-b border-gray-200"},Pe={class:"text-lg font-semibold text-gray-900"},Ve={key:0},Le=["value"],Te={class:"px-6 py-4 border-t border-gray-200 flex justify-end space-x-2"},Ne={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},qe={class:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden"},Ie={class:"px-6 py-4 border-b border-gray-200"},Oe={class:"text-lg font-semibold text-gray-900"},Re={class:"p-6 overflow-y-auto max-h-[60vh]"},He={key:0,class:"space-y-6"},Je={class:"bg-blue-50 p-4 rounded-lg"},Qe={class:"text-blue-700 mt-1"},Ge={class:"grid grid-cols-2 gap-4"},Ke={class:"bg-green-50 p-4 rounded-lg"},We={class:"text-2xl font-bold text-green-700 mt-1"},Xe={class:"bg-orange-50 p-4 rounded-lg"},Ye={class:"text-2xl font-bold text-orange-700 mt-1"},Ze={class:"font-semibold text-gray-800 mb-3 flex items-center"},et={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},tt={class:"text-sm text-gray-700"},st={class:"px-6 py-4 border-t border-gray-200 flex justify-end"},ot=X({__name:"index",setup(ut){const N=Y(),M=d([]),C=d([]),$=d(!0),h=d(""),_=d(""),m=d(1),w=d(10),c=d(!1),B=d(!1),E=d(!1),l=d({id:null,username:"",email:"",password:"",role_id:null}),S=d(null),p=d(null),q=b(()=>{var o;return(o=N.userInfo)==null?void 0:o.id}),g=b(()=>{let o=M.value;if(h.value){const t=h.value.toLowerCase();o=o.filter(r=>r.username.toLowerCase().includes(t)||r.email.toLowerCase().includes(t)||r.role_name.toLowerCase().includes(t))}return _.value&&(o=o.filter(t=>t.role_id===parseInt(_.value))),o}),z=b(()=>Math.ceil(g.value.length/w.value)),F=b(()=>(m.value-1)*w.value),P=b(()=>g.value.slice(F.value,F.value+w.value)),k=async()=>{try{const t=await(await fetch("http://47.111.95.19:3000/users")).json();t.success&&(M.value=t.data.users)}catch(o){console.error("\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25:",o)}},I=async()=>{try{const t=await(await fetch("http://47.111.95.19:3000/permissions/roles")).json();t.success&&(C.value=t.data)}catch(o){console.error("\u83B7\u53D6\u89D2\u8272\u5217\u8868\u5931\u8D25:",o)}},V=async()=>{try{const t=await(await fetch("http://47.111.95.19:3000/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.value.username,email:l.value.email,password:l.value.password,role_id:l.value.role_id})})).json();t.success?(alert("\u7528\u6237\u521B\u5EFA\u6210\u529F"),A(),k()):alert("\u521B\u5EFA\u5931\u8D25: "+t.error)}catch(o){console.error("\u521B\u5EFA\u7528\u6237\u5931\u8D25:",o),alert("\u521B\u5EFA\u7528\u6237\u5931\u8D25")}},L=async()=>{try{const t=await(await fetch(`http://47.111.95.19:3000/users/${l.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.value.username,email:l.value.email,role_id:l.value.role_id})})).json();t.success?(alert("\u7528\u6237\u66F4\u65B0\u6210\u529F"),A(),k()):alert("\u66F4\u65B0\u5931\u8D25: "+t.error)}catch(o){console.error("\u66F4\u65B0\u7528\u6237\u5931\u8D25:",o),alert("\u66F4\u65B0\u7528\u6237\u5931\u8D25")}},O=async o=>{if(!!confirm(`\u786E\u5B9A\u8981\u5220\u9664\u7528\u6237 ${o.username} \u5417\uFF1F`))try{const r=await(await fetch(`http://47.111.95.19:3000/users/${o.id}`,{method:"DELETE"})).json();r.success?(alert("\u7528\u6237\u5220\u9664\u6210\u529F"),k()):alert("\u5220\u9664\u5931\u8D25: "+r.error)}catch(t){console.error("\u5220\u9664\u7528\u6237\u5931\u8D25:",t),alert("\u5220\u9664\u7528\u6237\u5931\u8D25")}},R=o=>{l.value={id:o.id,username:o.username,email:o.email,password:"",role_id:o.role_id},B.value=!0},H=async o=>{S.value=o,E.value=!0;try{const r=await(await fetch(`http://47.111.95.19:3000/permissions/user/${o.id}`)).json();r.success&&(p.value=r.data)}catch(t){console.error("\u83B7\u53D6\u7528\u6237\u6743\u9650\u5931\u8D25:",t)}},A=()=>{c.value=!1,B.value=!1,l.value={id:null,username:"",email:"",password:"",role_id:null}},J=o=>({super_admin:"bg-red-100 text-red-800",admin:"bg-purple-100 text-purple-800",financial_manager:"bg-blue-100 text-blue-800",marketing_manager:"bg-green-100 text-green-800",production_manager:"bg-yellow-100 text-yellow-800",enterprise_manager:"bg-indigo-100 text-indigo-800",leader:"bg-gray-100 text-gray-800"})[o]||"bg-gray-100 text-gray-800",Q=o=>new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"}),G=()=>{if(!p.value)return[];const o=new Map;p.value.permissions.read.forEach(r=>{o.has(r.module_category)||o.set(r.module_category,[]),o.get(r.module_category).push(r)});const t=[];return o.forEach((r,s)=>{t.push({name:s,modules:r.sort((i,K)=>i.module_name.localeCompare(K.module_name))})}),t.sort((r,s)=>r.name.localeCompare(s.name))};return Z(async()=>{await Promise.all([k(),I()]),$.value=!1}),(o,t)=>{var r;return n(),a("div",te,[e("div",se,[t[21]||(t[21]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"\u7528\u6237\u7BA1\u7406"),e("p",{class:"text-gray-600 mt-2"},"\u7BA1\u7406\u7CFB\u7EDF\u7528\u6237\u548C\u89D2\u8272\u5206\u914D")],-1)),e("div",oe,[e("div",ue,[e("div",re,[e("div",le,[x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),type:"text",placeholder:"\u641C\u7D22\u7528\u6237...",class:"pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,h.value]]),t[12]||(t[12]=e("svg",{class:"w-5 h-5 text-gray-400 absolute left-3 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),class:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[t[13]||(t[13]=e("option",{value:""},"\u6240\u6709\u89D2\u8272",-1)),(n(!0),a(y,null,f(C.value,s=>(n(),a("option",{key:s.id,value:s.id},u(s.role_name),9,ae))),128))],512),[[T,_.value]])]),e("button",{onClick:t[2]||(t[2]=s=>c.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center"},t[14]||(t[14]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" \u65B0\u589E\u7528\u6237 ")]))])]),e("div",ne,[e("div",de,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold text-gray-900"},"\u7528\u6237\u5217\u8868",-1)),e("p",ie,"\u5171 "+u(g.value.length)+" \u4E2A\u7528\u6237",1)]),e("div",ce,[e("table",pe,[t[20]||(t[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"\u7528\u6237\u4FE1\u606F"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"\u89D2\u8272"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"\u72B6\u6001"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"\u521B\u5EFA\u65F6\u95F4"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"\u64CD\u4F5C")])],-1)),e("tbody",me,[$.value?(n(),a("tr",xe,t[16]||(t[16]=[e("td",{colspan:"5",class:"px-6 py-4 whitespace-nowrap"},[e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin w-6 h-6 border-4 border-blue-600 border-t-transparent rounded-full mr-2"}),j(" \u52A0\u8F7D\u4E2D... ")])],-1)]))):P.value.length===0?(n(),a("tr",ve,t[17]||(t[17]=[e("td",{colspan:"5",class:"px-6 py-4 whitespace-nowrap"},"\u6682\u65E0\u7528\u6237\u6570\u636E",-1)]))):v("",!0),(n(!0),a(y,null,f(P.value,s=>(n(),a("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ge,[e("div",be,[t[18]||(t[18]=e("div",{class:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z","clip-rule":"evenodd"})])],-1)),e("div",ye,[e("div",fe,u(s.username),1),e("div",he,u(s.email),1)])])]),e("td",_e,[e("span",{class:U(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",J(s.role_name)])},u(s.role_description||s.role_name),3)]),t[19]||(t[19]=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"}," \u6D3B\u8DC3 ")],-1)),e("td",we,u(Q(s.created_at)),1),e("td",Fe,[e("button",{onClick:i=>R(s),class:"text-blue-600 hover:text-blue-900"}," \u7F16\u8F91 ",8,ke),e("button",{onClick:i=>H(s),class:"text-green-600 hover:text-green-900"}," \u6743\u9650 ",8,De),s.id!==q.value?(n(),a("button",{key:0,onClick:i=>O(s),class:"text-red-600 hover:text-red-900"}," \u5220\u9664 ",8,Ce)):v("",!0)])]))),128))])])]),e("div",Be,[e("div",Ee," \u663E\u793A "+u(F.value+1)+" \u5230 "+u(Math.min(F.value+w.value,g.value.length))+" \u7684 "+u(g.value.length)+" \u4E2A\u7ED3\u679C ",1),e("div",Ae,[e("button",{onClick:t[3]||(t[3]=s=>m.value--),disabled:m.value===1,class:"px-3 py-1 border border-gray-300 rounded-md text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," \u4E0A\u4E00\u9875 ",8,je),e("span",Ue," \u7B2C "+u(m.value)+" \u9875\uFF0C\u5171 "+u(z.value)+" \u9875 ",1),e("button",{onClick:t[4]||(t[4]=s=>m.value++),disabled:m.value===z.value,class:"px-3 py-1 border border-gray-300 rounded-md text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," \u4E0B\u4E00\u9875 ",8,Me)])])])]),c.value||B.value?(n(),a("div",$e,[e("div",Se,[e("div",ze,[e("h3",Pe,u(c.value?"\u65B0\u589E\u7528\u6237":"\u7F16\u8F91\u7528\u6237"),1)]),e("form",{onSubmit:t[9]||(t[9]=ee(s=>c.value?V():L(),["prevent"])),class:"px-6 py-4 space-y-4"},[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u7528\u6237\u540D",-1)),x(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.username=s),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,l.value.username]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u90AE\u7BB1",-1)),x(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.email=s),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,l.value.email]])]),c.value?(n(),a("div",Ve,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u5BC6\u7801",-1)),x(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.password=s),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,l.value.password]])])):v("",!0),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"\u89D2\u8272",-1)),x(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.role_id=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[t[25]||(t[25]=e("option",{value:""},"\u8BF7\u9009\u62E9\u89D2\u8272",-1)),(n(!0),a(y,null,f(C.value,s=>(n(),a("option",{key:s.id,value:s.id},u(s.role_name)+" - "+u(s.role_description),9,Le))),128))],512),[[T,l.value.role_id]])])],32),e("div",Te,[e("button",{onClick:A,type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50"}," \u53D6\u6D88 "),e("button",{onClick:t[10]||(t[10]=s=>c.value?V():L()),type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700"},u(c.value?"\u521B\u5EFA":"\u4FDD\u5B58"),1)])])])):v("",!0),E.value?(n(),a("div",Ne,[e("div",qe,[e("div",Ie,[e("h3",Oe,u((r=S.value)==null?void 0:r.username)+" \u7684\u6743\u9650\u8BE6\u60C5 ",1)]),e("div",Re,[p.value?(n(),a("div",He,[e("div",Je,[t[27]||(t[27]=e("h4",{class:"font-semibold text-blue-900"},"\u89D2\u8272\u4FE1\u606F",-1)),e("p",Qe,u(p.value.user.role_name)+" - "+u(p.value.user.role_description),1)]),e("div",Ge,[e("div",Ke,[t[28]||(t[28]=e("h4",{class:"font-semibold text-green-900"},"\u53EF\u67E5\u770B\u6A21\u5757",-1)),e("p",We,u(p.value.permissions.read.length),1)]),e("div",Xe,[t[29]||(t[29]=e("h4",{class:"font-semibold text-orange-900"},"\u53EF\u7F16\u8F91\u6A21\u5757",-1)),e("p",Ye,u(p.value.permissions.write.length),1)])]),(n(!0),a(y,null,f(G(),s=>(n(),a("div",{key:s.name,class:"border rounded-lg p-4"},[e("h4",Ze,[e("span",{class:U(["w-3 h-3 rounded-full mr-2",{"bg-blue-500":s.name==="\u8D22\u52A1","bg-green-500":s.name==="\u8425\u9500","bg-yellow-500":s.name==="\u751F\u4EA7","bg-purple-500":s.name==="\u4F01\u7BA1"}])},null,2),j(" "+u(s.name)+" ("+u(s.modules.length)+" \u4E2A\u6A21\u5757) ",1)]),e("div",et,[(n(!0),a(y,null,f(s.modules,i=>(n(),a("div",{key:i.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded"},[e("span",tt,u(i.module_name),1),e("span",{class:U(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",{"bg-green-100 text-green-800":i.permission_type==="write","bg-blue-100 text-blue-800":i.permission_type==="read"}])},u(i.permission_type==="write"?"\u53EF\u7F16\u8F91":"\u53EA\u8BFB"),3)]))),128))])]))),128))])):v("",!0)]),e("div",st,[e("button",{onClick:t[11]||(t[11]=s=>E.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50"}," \u5173\u95ED ")])])])):v("",!0)])}}});var lt=W(ot,[["__scopeId","data-v-762c7ef3"]]);export{lt as default};
