import{_ as q,d as G,r as a,c as L,o as H,a as J,b as v,e,y as K,z as Q,F as D,g as F,t as l,l as X,j as A,f as Z,v as f}from"./index.64cd8a51.js";import{i as k,L as ee}from"./index.0a005eaa.js";const te={class:"p-6 bg-gray-50 min-h-screen"},se={class:"max-w-7xl mx-auto"},oe={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},ue={class:"flex items-center justify-between"},ae={class:"flex items-center space-x-3"},le=["value"],ne={key:0,class:"bg-white rounded-lg shadow-sm p-6 mb-8"},re={class:"text-lg font-semibold text-gray-900 mb-4"},ie={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ce={class:"text-center"},de={class:"text-2xl font-bold text-blue-600"},me={class:"text-center"},ve={class:"text-2xl font-bold text-green-600"},fe={class:"text-center"},ge={class:"mt-4"},he={class:"w-full bg-gray-200 rounded-full h-3"},xe={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},pe={class:"text-lg font-semibold text-gray-900 mb-4"},ye={class:"space-y-3"},be={class:"flex justify-between"},_e={class:"font-medium text-blue-600"},Ee={class:"w-full bg-gray-200 rounded-full h-2"},Ce={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},we={class:"flex justify-between items-center mb-6"},Be={class:"text-lg font-semibold text-gray-900"},De={class:"bg-white rounded-lg shadow-sm p-6"},Fe={class:"text-lg font-semibold text-gray-900 mb-6"},Ae={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Se={class:"space-y-4"},ze={class:"space-y-2"},Ie={class:"flex items-center"},Re={class:"text-sm font-medium text-gray-900"},$e={class:"text-right"},je={class:"text-sm font-medium text-gray-900"},Le={class:"text-xs text-gray-500"},ke=G({__name:"CostCenterChart",setup(Ne){const i=a(new Date().getFullYear().toString()),S=a([]),z=a(!0),C=a(null),w=a(null),x=a(null),p=a(null),c={equipment:{name:"\u8BBE\u5907",color:"#3B82F6"},component:{name:"\u5143\u4EF6",color:"#10B981"},engineering:{name:"\u5DE5\u7A0B",color:"#F59E0B"},nonMainBusiness:{name:"\u975E\u4E3B\u8425\u4E1A\u52A1",color:"#EF4444"}},b=a([]),_=a({}),g=a({}),h=a([]),d=a(0),I=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],N=L(()=>{const s={};return Object.keys(c).forEach(t=>{const o=g.value[t]||{cumulativeIncome:0,currentPeriodTotal:0};s[t]={...o,ratio:o.cumulativeIncome>0?Number((o.currentPeriodTotal/o.cumulativeIncome*100).toFixed(2)):0}}),s}),E=L(()=>{const s=Object.keys(c).reduce((o,u)=>{var n;return o+(((n=g.value[u])==null?void 0:n.cumulativeIncome)||0)},0),t=d.value>0?Number((s/d.value*100).toFixed(2)):0;return{totalCumulativeIncome:s,yearlyPlan:d.value,completionRate:t}}),m=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),R=s=>I[s%I.length],O=s=>s>=90?"text-green-600":s>=70?"text-blue-600":s>=50?"text-yellow-600":"text-red-600",P=()=>{const s=new Date().getFullYear(),t=[];for(let o=0;o<5;o++)t.push((s-o).toString());S.value=t},$=async()=>{try{z.value=!0,await W(),await Y(),T()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s)}finally{z.value=!1}},W=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/cost-center/${i.value}`);if(s.ok){const t=await s.json();t.success&&t.data?(b.value=t.data.months||[],_.value=t.data.monthlyData||{},g.value=t.data.summary||{},d.value=t.data.yearlyPlan||0):B()}else B()}catch(s){console.error("\u83B7\u53D6\u6210\u672C\u4E2D\u5FC3\u6570\u636E\u5931\u8D25:",s),B()}},B=()=>{b.value=[],_.value={},g.value={},d.value=0,h.value=[]},Y=async()=>{try{const s=[];let t=0;Object.keys(c).forEach(o=>{const u=g.value[o],n=c[o];u&&u.cumulativeIncome>0&&(s.push({name:n.name,value:u.cumulativeIncome}),t+=u.cumulativeIncome)}),h.value=s.map(o=>({...o,percentage:t>0?Number((o.value/t*100).toFixed(2)):0}))}catch(s){console.error("\u751F\u6210\u997C\u56FE\u6570\u636E\u5931\u8D25:",s),h.value=[]}},M=()=>{C.value&&(x.value=k(C.value)),w.value&&(p.value=k(w.value))},T=()=>{V(),U()},V=()=>{if(!x.value)return;const s=[],t=b.value.length>0&&Object.keys(_.value).length>0;t&&Object.keys(c).forEach((u,n)=>{const r=_.value[u],y=c[u];r&&s.push({name:`${y.name}`,type:"line",data:r.cumulativeIncome,smooth:!0,lineStyle:{color:y.color,width:3},itemStyle:{color:y.color},areaStyle:{color:new ee(0,0,0,1,[{offset:0,color:y.color+"40"},{offset:1,color:y.color+"10"}])}})});const o={title:{text:`${i.value}\u5E74\u6210\u672C\u4E2D\u5FC3\u6708\u5EA6\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(u){if(!t)return"\u6682\u65E0\u6570\u636E";let n=`${u[0].name}<br/>`;return u.forEach(r=>{n+=`${r.seriesName}: ${m(r.value)} \u4E07\u5143<br/>`}),n}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:t?b.value:[],axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u4E07\u5143",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(u){return m(u)},fontSize:12}},series:t?s:[],graphic:t?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};x.value.setOption(o,!0)},U=()=>{if(!p.value)return;const s=h.value.length>0,t={title:{text:"\u677F\u5757\u5360\u6BD4",textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"item",formatter:function(o){return s?`${o.name}<br/>\u6570\u503C: ${m(o.value)} \u4E07\u5143<br/>\u5360\u6BD4: ${o.percent}%`:"\u6682\u65E0\u6570\u636E"}},legend:{orient:"vertical",left:"left",top:"middle",textStyle:{fontSize:12},show:s},series:[{name:"\u677F\u5757\u5360\u6BD4",type:"pie",radius:["30%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},labelLine:{show:!1},data:s?h.value.map((o,u)=>({value:o.value,name:o.name,itemStyle:{color:R(u)}})):[]}],graphic:s?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};p.value.setOption(t,!0)},j=()=>{var s,t;(s=x.value)==null||s.resize(),(t=p.value)==null||t.resize()};return H(async()=>{P(),M(),await $(),window.addEventListener("resize",j)}),J(()=>{var s,t;(s=x.value)==null||s.dispose(),(t=p.value)==null||t.dispose(),window.removeEventListener("resize",j)}),(s,t)=>(f(),v("div",te,[e("div",se,[t[9]||(t[9]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"\u6210\u672C\u4E2D\u5FC3\u7ED3\u6784\u5206\u6790"),e("p",{class:"text-gray-600 mt-2"},"\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3 - \u8BA1\u5165\u635F\u76CA\u7ED3\u6784\u5206\u6790")],-1)),e("div",oe,[e("div",ue,[t[2]||(t[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),e("div",ae,[t[1]||(t[1]=e("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),K(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),onChange:$,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(f(!0),v(D,null,F(S.value,o=>(f(),v("option",{key:o,value:o},l(o)+"\u5E74",9,le))),128))],544),[[Q,i.value]])])])]),d.value>0?(f(),v("div",ne,[e("h3",re,l(i.value)+"\u5E74\u5EA6\u8BA1\u5212\u5B8C\u6210\u60C5\u51B5",1),e("div",ie,[e("div",ce,[e("div",de,l(m(d.value))+" \u4E07\u5143",1),t[3]||(t[3]=e("div",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212",-1))]),e("div",me,[e("div",ve,l(m(E.value.totalCumulativeIncome))+" \u4E07\u5143",1),t[4]||(t[4]=e("div",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA",-1))]),e("div",fe,[e("div",{class:X(["text-2xl font-bold",O(E.value.completionRate)])},l(E.value.completionRate)+"%",3),t[5]||(t[5]=e("div",{class:"text-sm text-gray-600"},"\u6267\u884C\u7387",-1))])]),e("div",ge,[e("div",he,[e("div",{class:"bg-blue-600 h-3 rounded-full transition-all duration-500",style:A(`width: ${Math.min(E.value.completionRate,100)}%`)},null,4)])])])):Z("",!0),e("div",xe,[(f(),v(D,null,F(c,(o,u)=>{var n,r;return e("div",{key:u,class:"bg-white rounded-lg shadow-sm p-6"},[e("h3",pe,l(o.name),1),e("div",ye,[e("div",be,[t[6]||(t[6]=e("span",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA:",-1)),e("span",_e,l(m(((n=g.value[u])==null?void 0:n.cumulativeIncome)||0))+" \u4E07\u5143",1)]),e("div",Ee,[e("div",{class:"bg-green-600 h-2 rounded-full transition-all duration-500",style:A(`width: ${Math.min(((r=N.value[u])==null?void 0:r.ratio)||0,100)}%`)},null,4)])])])}),64))]),e("div",Ce,[e("div",we,[e("h3",Be,l(i.value)+"\u5E74\u6708\u5EA6\u8D8B\u52BF\u5BF9\u6BD4",1),t[7]||(t[7]=e("div",{class:"flex items-center space-x-4"},[e("div",{class:"flex items-center"},[e("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),e("span",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA\u6708\u5EA6\u53D8\u5316")])],-1))]),e("div",{class:"h-[500px]",ref_key:"chartRef",ref:C},null,512)]),e("div",De,[e("h3",Fe,l(i.value)+"\u5E74\u5404\u677F\u5757\u8BA1\u5165\u635F\u76CA\u5360\u6BD4\u5206\u6790",1),e("div",Ae,[e("div",{class:"h-[350px]",ref_key:"pieChartRef",ref:w},null,512),e("div",Se,[t[8]||(t[8]=e("h4",{class:"text-md font-medium text-gray-800"},"\u5360\u6BD4\u8BE6\u60C5",-1)),e("div",ze,[(f(!0),v(D,null,F(h.value,(o,u)=>(f(),v("div",{key:u,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",Ie,[e("div",{class:"w-3 h-3 rounded-full mr-3",style:A(`background-color: ${R(u)}`)},null,4),e("span",Re,l(o.name),1)]),e("div",$e,[e("div",je,l(m(o.value))+" \u4E07\u5143",1),e("div",Le,l(o.percentage)+"%",1)])]))),128))])])])])])]))}});var We=q(ke,[["__scopeId","data-v-4c84afb5"]]);export{We as default};
