import{_ as w,d as k,r as y,h as U,C as v,o as L,c as b,a as e,y as A,B as N,F as I,l as O,t as n,q as R,b as M,m as $,G as q,f as g,k as T}from"./index.4d187047.js";import{_ as V,M as x,r as j}from"./FormAttachmentAndRemarks.e918c8a2.js";const J={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},H={class:"flex justify-between items-center mb-6"},z={class:"flex items-center space-x-4"},G={class:"overflow-x-auto my-6"},K={class:"w-full border-collapse border border-gray-300"},Q=["rowspan"],W={class:"border border-gray-300 px-4 py-2"},X={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],P={class:"border border-gray-300 px-4 py-2 text-right"},tt={class:"text-sm font-medium"},ut={class:"bg-gray-50 font-bold"},et={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"border border-gray-300 px-4 py-2 text-right"},at={class:"border border-gray-300 px-4 py-2 text-right"},ot={class:"text-sm font-bold"},st=k({__name:"BidFulfillment",setup(nt){var E;const l=q(),a=y(((E=l.query.period)==null?void 0:E.toString())||new Date().toISOString().slice(0,7)),_={customers:[{customerName:"\u4E00\u5305\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u4E8C\u5305\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u65B0\u80FD\u6E90\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u82CF\u5DDE\u9879\u76EE",initialAmount:1300,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u62A2\u4FEE\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u8FD0\u68C0\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u81EA\u5EFA\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0}]},o=y(JSON.parse(JSON.stringify(_))),c=y(""),i=y(""),d=t=>t===0?"0.00":t.toFixed(2),h=t=>t===0?"0.00%":t.toFixed(2)+"%",F=t=>t>0?"text-green-600":t<0?"text-red-600":"",D=(t,u)=>!t||t===0?0:(u-t)/t*100,m=U(()=>{const t={initialAmount:0,current:0,accumulated:0,fluctuationRate:0};return o.value.customers.forEach(u=>{t.initialAmount+=u.initialAmount||0,t.current+=u.current||0,t.accumulated+=u.accumulated||0}),t.fluctuationRate=D(t.initialAmount,t.accumulated),t}),p=async t=>{try{const u=await fetch(`http://47.111.95.19:3000/nanhua-bid-fulfillment/${t}`);if(!u.ok){if(u.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const r=await u.json();r.data&&r.data.customers&&(o.value.customers=r.data.customers.map(s=>({customerName:s.customerName,initialAmount:Number(s.initialAmount)||0,current:Number(s.current)||0,accumulated:Number(s.accumulated)||0,fluctuationRate:Number(s.fluctuationRate)||0})))}catch(u){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",u)}},f=async t=>{try{const u=await fetch(`http://47.111.95.19:3000/forms/submission/${x.NANHUA_BID_FULFILLMENT}/${t}`);if(u.ok){const r=await u.json();r.success&&r.data&&(c.value=r.data.remarks||"",i.value=r.data.suggestions||"")}}catch(u){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",u)}};v(()=>l.query.period,t=>{t&&(a.value=t.toString(),p(t.toString()),f(t.toString()))}),v(a,(t,u)=>{t&&t!==u&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${u} -> ${t}`),p(t),f(t))});const B=async()=>{try{if(o.value.customers.forEach(u=>{u.fluctuationRate=D(u.initialAmount,u.accumulated)}),!(await fetch("http://47.111.95.19:3000/nanhua-bid-fulfillment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:o.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await j(x.NANHUA_BID_FULFILLMENT,a.value,o.value,c.value,i.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},C=()=>{o.value=JSON.parse(JSON.stringify(_)),c.value="",i.value=""};return L(()=>{l.query.period?(p(l.query.period.toString()),f(l.query.period.toString())):(p(a.value),f(a.value))}),(t,u)=>(g(),b("div",J,[e("div",H,[u[4]||(u[4]=e("h1",{class:"text-2xl font-bold"},"\u4E2D\u6807\u672A\u5C65\u7EA6\u60C5\u51B5",-1)),e("div",z,[u[3]||(u[3]=e("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),A(e("input",{"onUpdate:modelValue":u[0]||(u[0]=r=>a.value=r),type:"month",class:"px-3 py-2 border rounded"},null,512),[[N,a.value]])])]),e("div",G,[e("table",K,[u[6]||(u[6]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u671F\u521D\u91D1\u989D"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u6CE2\u52A8\u7387")])],-1)),e("tbody",null,[(g(!0),b(I,null,O(o.value.customers,(r,s)=>(g(),b("tr",{key:`customer-${s}`},[s===0?(g(),b("td",{key:0,rowspan:o.value.customers.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,Q)):T("",!0),e("td",W,n(r.customerName),1),e("td",X,n(d(r.initialAmount)),1),e("td",Y,[A(e("input",{"onUpdate:modelValue":S=>r.current=S,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Z),[[N,r.current]])]),e("td",P,n(d(r.accumulated)),1),e("td",{class:R(["border border-gray-300 px-4 py-2 text-right",F(r.fluctuationRate)])},[e("span",tt,n(h(r.fluctuationRate)),1)],2)]))),128)),e("tr",ut,[u[5]||(u[5]=e("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),e("td",et,n(d(m.value.initialAmount)),1),e("td",rt,n(d(m.value.current)),1),e("td",at,n(d(m.value.accumulated)),1),e("td",{class:R(["border border-gray-300 px-4 py-2 text-right",F(m.value.fluctuationRate)])},[e("span",ot,n(h(m.value.fluctuationRate)),1)],2)])])])]),M(V,{"module-id":$(x).NANHUA_BID_FULFILLMENT,period:a.value,remarks:c.value,"onUpdate:remarks":u[1]||(u[1]=r=>c.value=r),suggestions:i.value,"onUpdate:suggestions":u[2]||(u[2]=r=>i.value=r)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:B,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:C,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var it=w(st,[["__scopeId","data-v-6f665ae2"]]);export{it as default};
