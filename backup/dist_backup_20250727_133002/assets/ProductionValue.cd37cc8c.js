import{_ as K,d as Q,r as f,h as i,C as E,o as W,c,a as t,y,B as b,F as S,l as k,t as s,b as X,m as Z,G as ee,f as d,k as V}from"./index.4d187047.js";import{_ as te,l as ue,M as C,r as re}from"./FormAttachmentAndRemarks.e918c8a2.js";const oe={class:"production-value-container"},se={class:"mx-auto bg-white rounded-lg shadow-lg"},ae={class:"p-6 border-b border-gray-200"},ne={class:"flex flex-col space-y-4"},le={class:"flex justify-between items-center"},ce={class:"flex items-center space-x-4"},de={class:"p-6"},ie={class:"overflow-x-auto rounded-lg border border-gray-200"},pe={class:"w-full border-collapse text-base"},ge=["rowspan"],ye={class:"border border-gray-200 px-6 py-3 text-center"},be={class:"border border-gray-200 px-6 py-3 text-right"},xe=["onUpdate:modelValue","onInput"],me={class:"border border-gray-200 px-6 py-3 text-right"},Fe={class:"w-full px-3 py-2"},_e={class:"border border-gray-200 px-6 py-3 text-right"},he=["onUpdate:modelValue"],De={class:"border border-gray-200 px-6 py-3 text-right"},fe={class:"font-medium"},Ee={class:"border border-gray-200 px-6 py-3 text-right"},ve={class:"border border-gray-200 px-6 py-3 text-right"},Ae=["rowspan"],Be={class:"border border-gray-200 px-6 py-3 text-center"},Ce={class:"border border-gray-200 px-6 py-3 text-right"},Pe=["onUpdate:modelValue","onInput"],we={class:"border border-gray-200 px-6 py-3 text-right"},Re={class:"w-full px-3 py-2"},Te={class:"border border-gray-200 px-6 py-3 text-right"},Ue=["onUpdate:modelValue"],Se={class:"border border-gray-200 px-6 py-3 text-right"},ke={class:"font-medium"},Ve={class:"border border-gray-200 px-6 py-3 text-right"},ze={class:"border border-gray-200 px-6 py-3 text-right"},Ie=["rowspan"],Ne={class:"border border-gray-200 px-6 py-3 text-center"},$e={class:"border border-gray-200 px-6 py-3 text-right"},Oe=["onUpdate:modelValue","onInput"],Le={class:"border border-gray-200 px-6 py-3 text-right"},je={class:"w-full px-3 py-2"},Me={class:"border border-gray-200 px-6 py-3 text-right"},qe=["onUpdate:modelValue"],Ye={class:"border border-gray-200 px-6 py-3 text-right"},Ge={class:"font-medium"},Je={class:"border border-gray-200 px-6 py-3 text-right"},He={class:"border border-gray-200 px-6 py-3 text-right"},Ke={class:"bg-gray-50 font-bold"},Qe={class:"border border-gray-200 px-6 py-4 text-right"},We={class:"border border-gray-200 px-6 py-4 text-right"},Xe={class:"border border-gray-200 px-6 py-4 text-right"},Ze={class:"border border-gray-200 px-6 py-4 text-right"},et={class:"border border-gray-200 px-6 py-4 text-right"},tt={class:"border border-gray-200 px-6 py-4 text-right"},ut=Q({__name:"ProductionValue",setup(rt){var L;const v=ee(),l=f(((L=v.query.period)==null?void 0:L.toString())||new Date().toISOString().slice(0,7)),F=f(""),_=f(""),A=()=>[{id:1,segment:"\u8BBE\u5907",customerType:"\u4E0A\u6D77",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:2,segment:"\u8BBE\u5907",customerType:"\u56FD\u7F51",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:3,segment:"\u8BBE\u5907",customerType:"\u6C5F\u82CF",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:4,segment:"\u8BBE\u5907",customerType:"\u8F93\u914D\u7535\u5185\u914D",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:5,segment:"\u8BBE\u5907",customerType:"\u897F\u95E8\u5B50",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:6,segment:"\u8BBE\u5907",customerType:"\u540C\u4E1A",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:7,segment:"\u8BBE\u5907",customerType:"\u7528\u6237",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:8,segment:"\u5143\u4EF6",customerType:"\u5176\u5B83",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:9,segment:"\u5143\u4EF6",customerType:"\u7528\u6237",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:10,segment:"\u5DE5\u7A0B",customerType:"\u4E00\u5305",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:11,segment:"\u5DE5\u7A0B",customerType:"\u4E8C\u5305",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:12,segment:"\u5DE5\u7A0B",customerType:"\u57DF\u5185\u5408\u4F5C",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:13,segment:"\u5DE5\u7A0B",customerType:"\u57DF\u5916\u5408\u4F5C",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0},{id:14,segment:"\u5DE5\u7A0B",customerType:"\u5176\u5B83",designCapacity:0,yearlyPlan:0,currentPeriod:0,currentAccumulated:0,executionProgress:0,utilizationRate:0}],a=f(A()),x=e=>(Number(e)||0).toLocaleString(),z=f([]),I=async e=>{try{const r=[],u=e.substring(0,4),n=parseInt(e.substring(5,7));for(let o=1;o<n;o++){const p=`${u}-${o.toString().padStart(2,"0")}`;try{const g=await fetch(`http://47.111.95.19:3000/production-value/${p}`);if(g.ok){const U=await g.json();U.success&&U.data&&r.push({period:p,data:U.data})}}catch(g){console.log(`\u8DF3\u8FC7\u6708\u4EFD ${p}:`,g)}}z.value=r,console.log("\u52A0\u8F7D\u7684\u6240\u6709\u6708\u4EFD\u6570\u636E:",r)}catch(r){console.error("\u52A0\u8F7D\u6240\u6709\u6708\u4EFD\u6570\u636E\u5931\u8D25:",r)}},j=(e,r)=>{let u=0;for(const o of z.value){const p=o.data.find(g=>g.segment===e&&g.customerType===r);p&&p.currentPeriod&&(u+=parseFloat(p.currentPeriod.toString())||0)}const n=a.value.find(o=>o.segment===e&&o.customerType===r);return n&&n.currentPeriod&&(u+=parseFloat(n.currentPeriod.toString())||0),u},P=()=>{a.value.forEach(e=>{const r=j(e.segment,e.customerType);e.currentAccumulated=r,h(e)})},h=e=>{e.yearlyPlan>0?e.executionProgress=parseFloat((e.currentAccumulated/e.yearlyPlan*100).toFixed(2)):e.executionProgress=0,e.designCapacity>0?e.utilizationRate=parseFloat((e.currentAccumulated/e.designCapacity*100).toFixed(2)):e.utilizationRate=0},m=e=>isNaN(e)||e===null||e===void 0?"0.00%":e.toFixed(2)+"%",N=i(()=>a.value.filter(e=>e.segment==="\u8BBE\u5907")),$=i(()=>a.value.filter(e=>e.segment==="\u5143\u4EF6")),O=i(()=>a.value.filter(e=>e.segment==="\u5DE5\u7A0B")),w=i(()=>a.value.reduce((e,r)=>e+Number(r.designCapacity||0),0)),R=i(()=>a.value.reduce((e,r)=>e+Number(r.yearlyPlan||0),0)),M=i(()=>a.value.reduce((e,r)=>e+Number(r.currentPeriod||0),0)),T=i(()=>a.value.reduce((e,r)=>e+Number(r.currentAccumulated||0),0)),q=i(()=>R.value>0?parseFloat((T.value/R.value*100).toFixed(2)):0),Y=i(()=>w.value>0?parseFloat((T.value/w.value*100).toFixed(2)):0),G=(e,r)=>!r||!Array.isArray(r)?e:e.map(u=>{const n=r.find(o=>o.segment===u.segment&&o.customerType===u.customerType);return n?{...u,...n}:u}),D=async e=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u4EA7\u503C\u7ED3\u6784\u6570\u636E\uFF0C\u671F\u95F4: ${e}`);const r=await fetch(`http://47.111.95.19:3000/production-structure/${e}`);if(!r.ok){if(r.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log("\u672A\u627E\u5230\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u521D\u59CB\u6A21\u677F"),a.value=A(),await I(e),P();return}const u=await r.json();console.log("API\u8FD4\u56DE\u6570\u636E:",u),u.success&&u.data&&(console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76..."),a.value=G(A(),u.data),console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",a.value)),await I(e),P()}catch(r){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",r)}},B=async()=>{const{remarks:e,suggestions:r}=await ue(C.PRODUCTION_VALUE,l.value);F.value=e,_.value=r};E(()=>a.value,()=>{a.value.forEach(e=>h(e))},{deep:!0}),E(l,e=>{D(e),B()}),E(()=>a.value,()=>{P()},{deep:!0}),E(()=>v.query.period,e=>{e&&(l.value=e.toString(),D(e.toString()),B())}),E(l,e=>{D(e),B()});const J=async()=>{try{console.log("=== \u5F00\u59CB\u4FDD\u5B58\u4EA7\u503C\u7ED3\u6784\u6570\u636E ==="),console.log("\u671F\u95F4:",l.value),console.log("\u6A21\u5757ID:",C.PRODUCTION_VALUE),console.log("\u8868\u5355\u6570\u636E:",a.value),console.log("\u6B65\u9AA41\uFF1A\u4FDD\u5B58\u5230\u4E13\u7528\u8868...");const e=await fetch("http://47.111.95.19:3000/production-structure",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:l.value,data:a.value})});if(!e.ok){const n=await e.text();throw console.error("\u4E13\u7528\u8868\u4FDD\u5B58\u5931\u8D25\uFF0C\u54CD\u5E94:",n),new Error("\u4FDD\u5B58\u5931\u8D25")}const r=await e.json();console.log("\u4E13\u7528\u8868\u4FDD\u5B58\u6210\u529F:",r),console.log("\u6B65\u9AA42\uFF1A\u8BB0\u5F55\u63D0\u4EA4\u72B6\u6001...");const u=await re(C.PRODUCTION_VALUE,l.value,a.value,F.value,_.value);console.log("\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u7ED3\u679C:",u),u?(console.log("=== \u4FDD\u5B58\u5B8C\u6210\uFF0C\u6240\u6709\u6B65\u9AA4\u6210\u529F ==="),alert("\u4FDD\u5B58\u6210\u529F")):(console.warn("=== \u4E13\u7528\u8868\u4FDD\u5B58\u6210\u529F\uFF0C\u4F46\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u5931\u8D25 ==="),alert("\u4FDD\u5B58\u6210\u529F\uFF0C\u4F46\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u5931\u8D25"))}catch(e){console.error("=== \u4FDD\u5B58\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF ===",e),alert("\u4FDD\u5B58\u5931\u8D25: "+(e instanceof Error?e.message:"\u672A\u77E5\u9519\u8BEF"))}},H=()=>{a.value=A(),F.value="",_.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return W(()=>{console.log("\u4EA7\u503C\u7ED3\u6784\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",l.value),v.query.period?D(v.query.period.toString()):D(l.value),B()}),(e,r)=>(d(),c("div",oe,[t("div",se,[t("div",ae,[t("div",ne,[t("div",le,[r[3]||(r[3]=t("h1",{class:"text-2xl font-bold text-gray-800"},"\u4EA7\u503C\u7ED3\u6784\u4E0E\u8D28\u91CF(\u4E3B\u8868)\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),t("div",ce,[y(t("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>l.value=u),type:"month",class:"px-4 py-2 border rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[b,l.value]])])]),r[4]||(r[4]=t("div",{class:"bg-blue-50 p-4 rounded-lg"},[t("p",{class:"text-blue-800"}," \u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C\u2014\u2014\u81EA\u5236/\u81EA\u884C\u65BD\u5DE5\u60C5\u51B5\u5206\u6790 ")],-1))])]),t("div",de,[t("div",ie,[t("table",pe,[r[6]||(r[6]=t("thead",{class:"sticky top-0 bg-white shadow-sm z-10"},[t("tr",{class:"bg-gray-50"},[t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[100px]"}," \u677F\u5757 "),t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[120px]"}," \u5BA2\u6237\u5C5E\u6027 "),t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[120px]"}," \u516C\u53F8\u8BBE\u8BA1\u4EA7\u80FD "),t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[120px]"}," \u5E74\u5EA6\u4EA7\u80FD\u8BA1\u5212 "),t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[120px]"}," \u5F53\u671F\u4EA7\u80FD "),t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[120px]"}," \u7D2F\u8BA1\u4EA7\u80FD "),t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[120px]"}," \u8BA1\u5212\u6267\u884C\u8FDB\u5EA6 "),t("th",{rowspan:"2",class:"border border-gray-200 px-6 py-4 text-center font-semibold text-gray-600 min-w-[120px]"}," \u4EA7\u80FD\u5229\u7528\u7387 ")])],-1)),t("tbody",null,[(d(!0),c(S,null,k(N.value,(u,n)=>(d(),c("tr",{key:`equipment-${n}`},[n===0?(d(),c("td",{key:0,rowspan:N.value.length,class:"border border-gray-200 px-6 py-3 text-center font-bold"},"\u8BBE\u5907",8,ge)):V("",!0),t("td",ye,s(u.customerType),1),t("td",be,[y(t("input",{"onUpdate:modelValue":o=>u.designCapacity=o,type:"number",class:"w-full px-3 py-2 border rounded-lg text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01",onInput:o=>h(u)},null,40,xe),[[b,u.designCapacity,void 0,{number:!0}]])]),t("td",me,[t("span",Fe,s(x(u.yearlyPlan)),1)]),t("td",_e,[y(t("input",{"onUpdate:modelValue":o=>u.currentPeriod=o,type:"number",class:"w-full px-3 py-2 border rounded-lg text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01"},null,8,he),[[b,u.currentPeriod,void 0,{number:!0}]])]),t("td",De,[t("span",fe,s(x(u.currentAccumulated)),1)]),t("td",Ee,s(m(u.executionProgress)),1),t("td",ve,s(m(u.utilizationRate)),1)]))),128)),(d(!0),c(S,null,k($.value,(u,n)=>(d(),c("tr",{key:`component-${n}`},[n===0?(d(),c("td",{key:0,rowspan:$.value.length,class:"border border-gray-200 px-6 py-3 text-center font-bold"},"\u5143\u4EF6",8,Ae)):V("",!0),t("td",Be,s(u.customerType),1),t("td",Ce,[y(t("input",{"onUpdate:modelValue":o=>u.designCapacity=o,type:"number",class:"w-full px-3 py-2 border rounded-lg text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01",onInput:o=>h(u)},null,40,Pe),[[b,u.designCapacity,void 0,{number:!0}]])]),t("td",we,[t("span",Re,s(x(u.yearlyPlan)),1)]),t("td",Te,[y(t("input",{"onUpdate:modelValue":o=>u.currentPeriod=o,type:"number",class:"w-full px-3 py-2 border rounded-lg text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01"},null,8,Ue),[[b,u.currentPeriod,void 0,{number:!0}]])]),t("td",Se,[t("span",ke,s(x(u.currentAccumulated)),1)]),t("td",Ve,s(m(u.executionProgress)),1),t("td",ze,s(m(u.utilizationRate)),1)]))),128)),(d(!0),c(S,null,k(O.value,(u,n)=>(d(),c("tr",{key:`project-${n}`},[n===0?(d(),c("td",{key:0,rowspan:O.value.length,class:"border border-gray-200 px-6 py-3 text-center font-bold"},"\u5DE5\u7A0B",8,Ie)):V("",!0),t("td",Ne,s(u.customerType),1),t("td",$e,[y(t("input",{"onUpdate:modelValue":o=>u.designCapacity=o,type:"number",class:"w-full px-3 py-2 border rounded-lg text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01",onInput:o=>h(u)},null,40,Oe),[[b,u.designCapacity,void 0,{number:!0}]])]),t("td",Le,[t("span",je,s(x(u.yearlyPlan)),1)]),t("td",Me,[y(t("input",{"onUpdate:modelValue":o=>u.currentPeriod=o,type:"number",class:"w-full px-3 py-2 border rounded-lg text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01"},null,8,qe),[[b,u.currentPeriod,void 0,{number:!0}]])]),t("td",Ye,[t("span",Ge,s(x(u.currentAccumulated)),1)]),t("td",Je,s(m(u.executionProgress)),1),t("td",He,s(m(u.utilizationRate)),1)]))),128)),t("tr",Ke,[r[5]||(r[5]=t("td",{colspan:"2",class:"border border-gray-200 px-6 py-4 text-center"},"\u5408\u8BA1",-1)),t("td",Qe,s(w.value.toLocaleString()),1),t("td",We,s(R.value.toLocaleString()),1),t("td",Xe,s(M.value.toLocaleString()),1),t("td",Ze,s(T.value.toLocaleString()),1),t("td",et,s(q.value)+"%",1),t("td",tt,s(Y.value)+"%",1)])])])]),X(te,{"module-id":Z(C).PRODUCTION_VALUE,period:l.value,remarks:F.value,"onUpdate:remarks":r[1]||(r[1]=u=>F.value=u),suggestions:_.value,"onUpdate:suggestions":r[2]||(r[2]=u=>_.value=u)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-6 flex justify-end space-x-4"},[t("button",{onClick:J,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"}," \u4FDD\u5B58 "),t("button",{onClick:H,class:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500"}," \u91CD\u7F6E ")])])])]))}});var at=K(ut,[["__scopeId","data-v-32822478"]]);export{at as default};
