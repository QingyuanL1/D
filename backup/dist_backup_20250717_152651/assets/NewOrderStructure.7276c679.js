import{_ as A,d as B,r as b,c as k,B as v,o as C,b as m,e as t,y as E,A as D,F as O,g as P,t as s,k as R,h as U,G as $,v as _,f as V}from"./index.d2ddcc02.js";import{_ as j,M as h,r as q}from"./FormAttachmentAndRemarks.9aada3ae.js";const J={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},M={class:"flex justify-between items-center mb-6"},H={class:"flex items-center space-x-4"},I={class:"overflow-x-auto my-6"},T={class:"w-full border-collapse border border-gray-300"},W=["rowspan"],L={class:"border border-gray-300 px-4 py-2"},G={class:"border border-gray-300 px-4 py-2 text-right"},z={class:"border border-gray-300 px-4 py-2"},K=["onUpdate:modelValue"],Q={class:"border border-gray-300 px-4 py-2 text-right"},X={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"text-sm font-medium"},Z={class:"bg-gray-50 font-bold"},ee={class:"border border-gray-300 px-4 py-2 text-right"},re={class:"border border-gray-300 px-4 py-2 text-right"},te={class:"border border-gray-300 px-4 py-2 text-right"},ue={class:"border border-gray-300 px-4 py-2 text-right"},ae={class:"text-sm font-bold"},se=B({__name:"NewOrderStructure",setup(oe){var f;const l=$(),a=b(((f=l.query.period)==null?void 0:f.toString())||new Date().toISOString().slice(0,7)),x={engineering:[{customer:"\u4E00\u5305\u9879\u76EE",yearlyPlan:7e3,current:0,accumulated:0},{customer:"\u4E8C\u5305\u9879\u76EE",yearlyPlan:2e3,current:0,accumulated:0},{customer:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",yearlyPlan:6e3,current:0,accumulated:0},{customer:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",yearlyPlan:2e3,current:0,accumulated:0},{customer:"\u65B0\u80FD\u6E90\u9879\u76EE",yearlyPlan:4e3,current:0,accumulated:0},{customer:"\u82CF\u5DDE\u9879\u76EE",yearlyPlan:1e3,current:0,accumulated:0},{customer:"\u81EA\u5EFA\u9879\u76EE",yearlyPlan:0,current:0,accumulated:0}]},o=b(JSON.parse(JSON.stringify(x))),c=b(""),d=b(""),i=e=>e===0?"0.00":e.toFixed(2),F=(e,r)=>!e||e===0?"0.00":(r/e*100).toFixed(2),p=k(()=>{const e={yearlyPlan:0,current:0,accumulated:0,progress:0};return o.value.engineering.forEach(r=>{e.yearlyPlan+=r.yearlyPlan||0,e.current+=r.current||0,e.accumulated+=r.accumulated||0}),e.progress=e.yearlyPlan>0?e.accumulated/e.yearlyPlan*100:0,e.progress=parseFloat(e.progress.toFixed(2)),e}),y=async e=>{try{const r=await fetch(`http://47.111.95.19:3000/nanhua-new-orders/${e}`);if(!r.ok){if(r.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const u=await r.json();u.data&&u.data.engineering&&(o.value.engineering=u.data.engineering.map(n=>({customer:n.customer,yearlyPlan:Number(n.yearlyPlan)||0,current:Number(n.current)||0,accumulated:Number(n.accumulated)||0})))}catch(r){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",r)}},g=async e=>{try{const r=await fetch(`http://47.111.95.19:3000/forms/submission/${h.NANHUA_NEW_ORDERS}/${e}`);if(r.ok){const u=await r.json();u.success&&u.data&&(c.value=u.data.remarks||"",d.value=u.data.suggestions||"")}}catch(r){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",r)}};v(()=>l.query.period,e=>{e&&(a.value=e.toString(),y(e.toString()),g(e.toString()))}),v(a,(e,r)=>{e&&e!==r&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${r} -> ${e}`),y(e),g(e))});const S=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-new-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:o.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await q(h.NANHUA_NEW_ORDERS,a.value,o.value,c.value,d.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25")}},N=()=>{o.value=JSON.parse(JSON.stringify(x)),c.value="",d.value=""};return C(()=>{l.query.period?(y(l.query.period.toString()),g(l.query.period.toString())):(y(a.value),g(a.value))}),(e,r)=>(_(),m("div",J,[t("div",M,[r[3]||(r[3]=t("h1",{class:"text-2xl font-bold"},"\u65B0\u7B7E\u8BA2\u5355\u7ED3\u6784\u4E0E\u8D28\u91CF",-1)),t("div",H,[E(t("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>a.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[D,a.value]])])]),t("div",I,[t("table",T,[r[5]||(r[5]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u6267\u884C\u8FDB\u5EA6")])],-1)),t("tbody",null,[(_(!0),m(O,null,P(o.value.engineering,(u,n)=>(_(),m("tr",{key:`engineering-${n}`},[n===0?(_(),m("td",{key:0,rowspan:o.value.engineering.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,W)):V("",!0),t("td",L,s(u.customer),1),t("td",G,s(i(u.yearlyPlan)),1),t("td",z,[E(t("input",{"onUpdate:modelValue":w=>u.current=w,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,K),[[D,u.current]])]),t("td",Q,s(i(u.accumulated)),1),t("td",X,[t("span",Y,s(F(u.yearlyPlan,u.accumulated))+"%",1)])]))),128)),t("tr",Z,[r[4]||(r[4]=t("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),t("td",ee,s(i(p.value.yearlyPlan)),1),t("td",re,s(i(p.value.current)),1),t("td",te,s(i(p.value.accumulated)),1),t("td",ue,[t("span",ae,s(p.value.progress)+"%",1)])])])])]),R(j,{"module-id":U(h).NANHUA_NEW_ORDERS,period:a.value,remarks:c.value,"onUpdate:remarks":r[1]||(r[1]=u=>c.value=u),suggestions:d.value,"onUpdate:suggestions":r[2]||(r[2]=u=>d.value=u)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:S,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:N,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ce=A(se,[["__scopeId","data-v-4f027045"]]);export{ce as default};
