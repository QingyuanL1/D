import{_ as z,d as H,r as _,h as K,B as M,o as Q,c as v,a as t,y as g,A as F,F as S,l as V,t as c,b as W,m as X,G as Y,f as b,k as U}from"./index.3ed95e87.js";import{_ as Z,l as ee,M as k,r as te}from"./FormAttachmentAndRemarks.1f80b5db.js";const ae={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},oe={class:"flex justify-between items-center mb-6"},re={class:"flex items-center space-x-4"},ue={class:"overflow-x-auto my-6"},ne={class:"w-full border-collapse border border-gray-300"},ce=["rowspan"],le={class:"border border-gray-300 px-4 py-2"},se={class:"border border-gray-300 px-4 py-2"},ie=["onUpdate:modelValue"],pe={class:"border border-gray-300 px-4 py-2"},de=["onUpdate:modelValue","onInput"],ye={class:"border border-gray-300 px-4 py-2"},ve={class:"font-medium"},ge={class:"border border-gray-300 px-4 py-2"},Fe=["onUpdate:modelValue","onInput"],be={class:"border border-gray-300 px-4 py-2"},Be={class:"font-medium"},_e={class:"border border-gray-300 px-4 py-2"},De=["rowspan"],Ee={class:"border border-gray-300 px-4 py-2"},me={class:"border border-gray-300 px-4 py-2"},he=["onUpdate:modelValue"],we={class:"border border-gray-300 px-4 py-2"},xe=["onUpdate:modelValue","onInput"],Re={class:"border border-gray-300 px-4 py-2"},Ie={class:"font-medium"},fe={class:"border border-gray-300 px-4 py-2"},Te=["onUpdate:modelValue","onInput"],Ae={class:"border border-gray-300 px-4 py-2"},Ce={class:"font-medium"},Ne={class:"border border-gray-300 px-4 py-2"},Se=["rowspan"],Ve={class:"border border-gray-300 px-4 py-2"},Ue={class:"border border-gray-300 px-4 py-2"},ke=["onUpdate:modelValue"],$e={class:"border border-gray-300 px-4 py-2"},Le=["onUpdate:modelValue","onInput"],je={class:"border border-gray-300 px-4 py-2"},qe={class:"font-medium"},Me={class:"border border-gray-300 px-4 py-2"},Oe=["onUpdate:modelValue","onInput"],Ge={class:"border border-gray-300 px-4 py-2"},Je={class:"font-medium"},Pe={class:"border border-gray-300 px-4 py-2"},ze={class:"bg-gray-50 font-bold"},He={class:"border border-gray-300 px-4 py-2"},Ke={class:"border border-gray-300 px-4 py-2"},Qe={class:"border border-gray-300 px-4 py-2"},We={class:"border border-gray-300 px-4 py-2"},Xe={class:"border border-gray-300 px-4 py-2"},Ye={class:"border border-gray-300 px-4 py-2"},Ze=H({__name:"AccountsReceivable",setup(et){var q;const w=Y(),d=_(((q=w.query.period)==null?void 0:q.toString())||new Date().toISOString().slice(0,7)),x=()=>[{customerType:"\u4E0A\u6D77",initialBalance:"3558.98",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"3558.98"},{customerType:"\u56FD\u7F51",initialBalance:"5190.93",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"5190.93"},{customerType:"\u6C5F\u82CF",initialBalance:"1154.56",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"1154.56"},{customerType:"\u8F93\u914D\u7535\u5185\u914D",initialBalance:"176.86",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"176.86"},{customerType:"\u897F\u95E8\u5B50",initialBalance:"0.00",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"0.00"},{customerType:"\u540C\u4E1A",initialBalance:"2028.53",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"2028.53"},{customerType:"\u7528\u6237",initialBalance:"1727.31",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"1727.31"},{customerType:"\u5176\u5B83",initialBalance:"303.55",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"303.55"}],R=()=>[{customerType:"\u7528\u6237",initialBalance:"458.54",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"458.54"}],I=()=>[{customerType:"\u4E00\u5305",initialBalance:"385.47",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"385.47"},{customerType:"\u4E8C\u5305",initialBalance:"189.12",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"189.12"},{customerType:"\u57DF\u5185\u5408\u4F5C",initialBalance:"2772.83",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"2772.83"},{customerType:"\u57DF\u5916\u5408\u4F5C",initialBalance:"752.14",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"752.14"},{customerType:"\u5176\u5B83",initialBalance:"488.67",newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:"488.67"}],s=_(x()),i=_(R()),p=_(I()),$=_([]),f=_(""),T=_(""),D=a=>a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),E=a=>{const r=parseFloat(a.initialBalance.replace(/,/g,""))||0,e=parseFloat(a.newInvoice.replace(/,/g,""))||0;parseFloat(a.currentReceipt.replace(/,/g,""));const n=A(a.customerType,O(a));a.totalReceipt=n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});const o=r+e-n;a.currentBalance=o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})},O=a=>s.value.includes(a)?"\u8BBE\u5907":i.value.includes(a)?"\u5143\u4EF6":p.value.includes(a)?"\u5DE5\u7A0B":"",A=(a,r)=>{var l;let e=0;for(const u of $.value){if(u.period===d.value)continue;const y=(l=u.data)==null?void 0:l.find(B=>B.segment===r&&B.customerType===a);y&&y.currentReceipt&&(e+=parseFloat(y.currentReceipt.toString().replace(/,/g,""))||0)}const o=(r==="\u8BBE\u5907"?s.value:r==="\u5143\u4EF6"?i.value:p.value).find(u=>u.customerType===a);return o&&o.currentReceipt&&(e+=parseFloat(o.currentReceipt.toString().replace(/,/g,""))||0),e},m=K(()=>{let a=0,r=0,e=0,n=0,o=0,l=0;return s.value.forEach(u=>{a+=parseFloat(u.initialBalance.replace(/,/g,""))||0,r+=parseFloat(u.newInvoice.replace(/,/g,""))||0,e+=parseFloat(u.totalNewInvoice.replace(/,/g,""))||0,n+=parseFloat(u.currentReceipt.replace(/,/g,""))||0,o+=parseFloat(u.totalReceipt.replace(/,/g,""))||0,l+=parseFloat(u.currentBalance.replace(/,/g,""))||0}),i.value.forEach(u=>{a+=parseFloat(u.initialBalance.replace(/,/g,""))||0,r+=parseFloat(u.newInvoice.replace(/,/g,""))||0,e+=parseFloat(u.totalNewInvoice.replace(/,/g,""))||0,n+=parseFloat(u.currentReceipt.replace(/,/g,""))||0,o+=parseFloat(u.totalReceipt.replace(/,/g,""))||0,l+=parseFloat(u.currentBalance.replace(/,/g,""))||0}),p.value.forEach(u=>{a+=parseFloat(u.initialBalance.replace(/,/g,""))||0,r+=parseFloat(u.newInvoice.replace(/,/g,""))||0,e+=parseFloat(u.totalNewInvoice.replace(/,/g,""))||0,n+=parseFloat(u.currentReceipt.replace(/,/g,""))||0,o+=parseFloat(u.totalReceipt.replace(/,/g,""))||0,l+=parseFloat(u.currentBalance.replace(/,/g,""))||0}),{initialBalance:a,newInvoice:r,totalNewInvoice:e,currentReceipt:n,totalReceipt:o,currentBalance:l}}),G={\u8BBE\u5907:{\u4E0A\u6D77:3558.98,\u56FD\u7F51:5190.93,\u6C5F\u82CF:1154.56,\u8F93\u914D\u7535\u5185\u914D:176.86,\u897F\u95E8\u5B50:0,\u540C\u4E1A:2028.53,\u7528\u6237:1727.31,\u5176\u5B83:303.55},\u5143\u4EF6:{\u7528\u6237:458.54},\u5DE5\u7A0B:{\u4E00\u5305:385.47,\u4E8C\u5305:189.12,\u57DF\u5185\u5408\u4F5C:2772.83,\u57DF\u5916\u5408\u4F5C:752.14,\u5176\u5B83:488.67}},h=(a,r,e)=>a.map(n=>{var u;const o=r==null?void 0:r.find(y=>y.segment===e&&y.customerType===n.customerType),l=((u=G[e])==null?void 0:u[n.customerType])||0;return o?{customerType:n.customerType,initialBalance:l.toString(),newInvoice:o.newInvoice||"0",totalNewInvoice:o.totalNewInvoice||"0",currentReceipt:o.currentReceipt||"0",totalReceipt:o.totalReceipt||"0",currentBalance:o.currentBalance||"0",yearlyPlan:l}:{customerType:n.customerType,initialBalance:l.toString(),newInvoice:"0",totalNewInvoice:"0",currentReceipt:"0",totalReceipt:"0",currentBalance:l.toString(),yearlyPlan:l}}),L=async a=>{try{const[r,e]=a.split("-"),n=parseInt(e),o=[];for(let l=1;l<=n;l++){const u=`${r}-${l.toString().padStart(2,"0")}`;try{const y=await fetch(`http://47.111.95.19:3000/accounts-receivable/${u}`);if(y.ok){const B=await y.json();B.data&&Array.isArray(B.data)&&o.push({period:u,data:B.data})}}catch(y){console.log(`\u8DF3\u8FC7\u6708\u4EFD ${u}:`,y)}}$.value=o,console.log("\u52A0\u8F7D\u7684\u6240\u6709\u6708\u4EFD\u6570\u636E:",o)}catch(r){console.error("\u52A0\u8F7D\u6240\u6709\u6708\u4EFD\u6570\u636E\u5931\u8D25:",r)}},j=()=>{s.value.forEach(a=>{const r=A(a.customerType,"\u8BBE\u5907");a.totalReceipt=r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),i.value.forEach(a=>{const r=A(a.customerType,"\u5143\u4EF6");a.totalReceipt=r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),p.value.forEach(a=>{const r=A(a.customerType,"\u5DE5\u7A0B");a.totalReceipt=r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})},C=async a=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u5E94\u6536\u8D26\u6B3E\u6570\u636E\uFF0C\u671F\u95F4: ${a}`);const r=await fetch(`http://47.111.95.19:3000/accounts-receivable/${a}`);let e=[];if(r.ok){const n=await r.json();console.log("API\u8FD4\u56DE\u6570\u636E:",n),n.success&&n.data&&Array.isArray(n.data)&&(e=n.data,console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76..."))}else r.status===404?console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4F7F\u7528\u9884\u7B97\u6570\u636E\u586B\u5145"):console.log("\u52A0\u8F7D\u6570\u636E\u5931\u8D25\uFF0C\u4F7F\u7528\u9884\u7B97\u6570\u636E\u586B\u5145");s.value=h(x(),e,"\u8BBE\u5907"),i.value=h(R(),e,"\u5143\u4EF6"),p.value=h(I(),e,"\u5DE5\u7A0B"),console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{equipmentData:s.value,componentData:i.value,projectData:p.value}),await L(a),j()}catch(r){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",r),s.value=h(x(),[],"\u8BBE\u5907"),i.value=h(R(),[],"\u5143\u4EF6"),p.value=h(I(),[],"\u5DE5\u7A0B");try{await L(a),j()}catch(e){console.error("\u52A0\u8F7D\u5386\u53F2\u6570\u636E\u5931\u8D25:",e)}}},N=async()=>{const{remarks:a,suggestions:r}=await ee(k.ACCOUNTS_RECEIVABLE,d.value);f.value=a,T.value=r};M(()=>w.query.period,a=>{a&&(d.value=a.toString(),C(a.toString()),N())}),M(d,a=>{C(a),N()});const J=async()=>{try{const a=[...s.value.map(o=>({...o,segment:"\u8BBE\u5907"})),...i.value.map(o=>({...o,segment:"\u5143\u4EF6"})),...p.value.map(o=>({...o,segment:"\u5DE5\u7A0B"}))],r={period:d.value,data:a};console.log("\u4FDD\u5B58\u6570\u636E:",r);const e=await fetch("http://47.111.95.19:3000/accounts-receivable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const o=await e.text();throw new Error(`\u4FDD\u5B58\u5931\u8D25: ${e.status} - ${o}`)}const n={equipment:s.value,component:i.value,project:p.value};await te(k.ACCOUNTS_RECEIVABLE,d.value,n,f.value,T.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(a){console.error("\u4FDD\u5B58\u5931\u8D25:",a),alert("\u4FDD\u5B58\u5931\u8D25: "+(a instanceof Error?a.message:"\u672A\u77E5\u9519\u8BEF"))}},P=()=>{s.value=x(),i.value=R(),p.value=I(),console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return Q(()=>{console.log("\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",d.value),w.query.period?C(w.query.period.toString()):C(d.value),N()}),(a,r)=>(b(),v("div",ae,[t("div",oe,[r[3]||(r[3]=t("h1",{class:"text-2xl font-bold"},"\u5E94\u6536\u8D26\u6B3E\u60C5\u51B5\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),t("div",re,[g(t("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),type:"month",class:"px-3 py-2 border rounded"},null,512),[[F,d.value]])])]),t("div",ue,[t("table",ne,[r[5]||(r[5]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u521D\u5E94\u6536\u4F59\u989D"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u65B0\u589E\u5F00\u7968"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u65B0\u589E\u5F00\u7968"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u6536\u6B3E"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u6536\u6B3E"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u5E94\u6536\u4F59\u989D")])],-1)),t("tbody",null,[(b(!0),v(S,null,V(s.value,(e,n)=>(b(),v("tr",{key:`equipment-${n}`},[n===0?(b(),v("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:s.value.length}," \u8BBE\u5907 ",8,ce)):U("",!0),t("td",le,c(e.customerType),1),t("td",se,[g(t("input",{"onUpdate:modelValue":o=>e.initialBalance=o,type:"text",class:"w-full px-2 py-1 border rounded bg-gray-50",readonly:""},null,8,ie),[[F,e.initialBalance]])]),t("td",pe,[g(t("input",{"onUpdate:modelValue":o=>e.newInvoice=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,de),[[F,e.newInvoice]])]),t("td",ye,[t("span",ve,c(e.totalNewInvoice),1)]),t("td",ge,[g(t("input",{"onUpdate:modelValue":o=>e.currentReceipt=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,Fe),[[F,e.currentReceipt]])]),t("td",be,[t("span",Be,c(e.totalReceipt),1)]),t("td",_e,c(e.currentBalance),1)]))),128)),(b(!0),v(S,null,V(i.value,(e,n)=>(b(),v("tr",{key:`component-${n}`},[n===0?(b(),v("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:i.value.length}," \u5143\u4EF6 ",8,De)):U("",!0),t("td",Ee,c(e.customerType),1),t("td",me,[g(t("input",{"onUpdate:modelValue":o=>e.initialBalance=o,type:"text",class:"w-full px-2 py-1 border rounded bg-gray-50",readonly:""},null,8,he),[[F,e.initialBalance]])]),t("td",we,[g(t("input",{"onUpdate:modelValue":o=>e.newInvoice=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,xe),[[F,e.newInvoice]])]),t("td",Re,[t("span",Ie,c(e.totalNewInvoice),1)]),t("td",fe,[g(t("input",{"onUpdate:modelValue":o=>e.currentReceipt=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,Te),[[F,e.currentReceipt]])]),t("td",Ae,[t("span",Ce,c(e.totalReceipt),1)]),t("td",Ne,c(e.currentBalance),1)]))),128)),(b(!0),v(S,null,V(p.value,(e,n)=>(b(),v("tr",{key:`project-${n}`},[n===0?(b(),v("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:p.value.length}," \u5DE5\u7A0B ",8,Se)):U("",!0),t("td",Ve,c(e.customerType),1),t("td",Ue,[g(t("input",{"onUpdate:modelValue":o=>e.initialBalance=o,type:"text",class:"w-full px-2 py-1 border rounded bg-gray-50",readonly:""},null,8,ke),[[F,e.initialBalance]])]),t("td",$e,[g(t("input",{"onUpdate:modelValue":o=>e.newInvoice=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,Le),[[F,e.newInvoice]])]),t("td",je,[t("span",qe,c(e.totalNewInvoice),1)]),t("td",Me,[g(t("input",{"onUpdate:modelValue":o=>e.currentReceipt=o,type:"text",class:"w-full px-2 py-1 border rounded",onInput:o=>E(e)},null,40,Oe),[[F,e.currentReceipt]])]),t("td",Ge,[t("span",Je,c(e.totalReceipt),1)]),t("td",Pe,c(e.currentBalance),1)]))),128)),t("tr",ze,[r[4]||(r[4]=t("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),t("td",He,c(D(m.value.initialBalance)),1),t("td",Ke,c(D(m.value.newInvoice)),1),t("td",Qe,c(D(m.value.totalNewInvoice)),1),t("td",We,c(D(m.value.currentReceipt)),1),t("td",Xe,c(D(m.value.totalReceipt)),1),t("td",Ye,c(D(m.value.currentBalance)),1)])])])]),W(Z,{"module-id":X(k).ACCOUNTS_RECEIVABLE,period:d.value,remarks:f.value,"onUpdate:remarks":r[1]||(r[1]=e=>f.value=e),suggestions:T.value,"onUpdate:suggestions":r[2]||(r[2]=e=>T.value=e)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:J,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:P,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ot=z(Ze,[["__scopeId","data-v-3fdb5ddb"]]);export{ot as default};
