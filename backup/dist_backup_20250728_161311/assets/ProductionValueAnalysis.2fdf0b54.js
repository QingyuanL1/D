import{d as A,r as v,u as C,c as y,o as k,b as c,e as t,y as l,A as d,F as h,g as R,t as m,k as N,h as j,v as p,f as T}from"./index.ca1d2dfd.js";import{_ as O,M as _,r as S}from"./FormAttachmentAndRemarks.48623b78.js";const $={class:"container mx-auto p-6"},I={class:"bg-white rounded-lg shadow-md p-6 mb-6"},L={class:"flex items-center justify-between mb-4"},P={class:"flex items-center"},M={class:"overflow-x-auto"},J={class:"min-w-full border-collapse"},Q=["rowspan"],z={class:"border px-4 py-2"},G={class:"border px-4 py-2"},H=["onUpdate:modelValue"],K={class:"border px-4 py-2"},W=["onUpdate:modelValue"],X={class:"border px-4 py-2"},Y=["onUpdate:modelValue"],Z={class:"border px-4 py-2"},ee=["onUpdate:modelValue"],te=["rowspan"],ae={class:"border px-4 py-2"},ue={class:"border px-4 py-2"},oe=["onUpdate:modelValue"],se={class:"border px-4 py-2"},re=["onUpdate:modelValue"],ne={class:"border px-4 py-2"},le=["onUpdate:modelValue"],de={class:"border px-4 py-2"},ie=["onUpdate:modelValue"],ce=["rowspan"],pe={class:"border px-4 py-2"},ye={class:"border px-4 py-2"},me=["onUpdate:modelValue"],ge={class:"border px-4 py-2"},fe=["onUpdate:modelValue"],ve={class:"border px-4 py-2"},he=["onUpdate:modelValue"],Re={class:"border px-4 py-2"},Te=["onUpdate:modelValue"],_e={class:"bg-gray-100 font-bold"},be={class:"border px-4 py-2"},xe={class:"border px-4 py-2"},Ee={class:"border px-4 py-2"},qe=A({__name:"ProductionValueAnalysis",setup(De){const n=v(new Date().toISOString().substr(0,7));C();const g=v(""),f=v(""),b=v([{id:1,segment:"\u8BBE\u5907",customerType:"\u4E0A\u6D77",yearlyTarget:"100%",onTimeRate:"99%",qualifiedRate:"99.99%",achievementRate:"80%",date:n.value},{id:2,segment:"\u8BBE\u5907",customerType:"\u56FD\u7F51",yearlyTarget:"100%",onTimeRate:"98%",qualifiedRate:"99.95%",achievementRate:"85%",date:n.value},{id:3,segment:"\u8BBE\u5907",customerType:"\u6C5F\u82CF",yearlyTarget:"100%",onTimeRate:"97%",qualifiedRate:"99.98%",achievementRate:"82%",date:n.value},{id:4,segment:"\u8BBE\u5907",customerType:"\u8F93\u914D\u7535\u5185\u914D",yearlyTarget:"100%",onTimeRate:"98.5%",qualifiedRate:"99.97%",achievementRate:"84%",date:n.value},{id:5,segment:"\u8BBE\u5907",customerType:"\u897F\u95E8\u5B50",yearlyTarget:"100%",onTimeRate:"99.5%",qualifiedRate:"100%",achievementRate:"88%",date:n.value},{id:6,segment:"\u8BBE\u5907",customerType:"\u540C\u4E1A",yearlyTarget:"100%",onTimeRate:"97.5%",qualifiedRate:"99.96%",achievementRate:"83%",date:n.value},{id:7,segment:"\u8BBE\u5907",customerType:"\u7528\u6237",yearlyTarget:"100%",onTimeRate:"98%",qualifiedRate:"99.98%",achievementRate:"81%",date:n.value},{id:8,segment:"\u8BBE\u5907",customerType:"\u5176\u5B83",yearlyTarget:"100%",onTimeRate:"96%",qualifiedRate:"99.9%",achievementRate:"79%",date:n.value},{id:9,segment:"\u5143\u4EF6",customerType:"\u7528\u6237",yearlyTarget:"100%",onTimeRate:"97%",qualifiedRate:"99.95%",achievementRate:"83%",date:n.value},{id:10,segment:"\u5DE5\u7A0B",customerType:"\u4E00\u5305",yearlyTarget:"100%",onTimeRate:"95%",qualifiedRate:"99.8%",achievementRate:"78%",date:n.value},{id:11,segment:"\u5DE5\u7A0B",customerType:"\u4E8C\u5305",yearlyTarget:"100%",onTimeRate:"94%",qualifiedRate:"99.85%",achievementRate:"77%",date:n.value},{id:12,segment:"\u5DE5\u7A0B",customerType:"\u57DF\u5185\u5408\u4F5C",yearlyTarget:"100%",onTimeRate:"96%",qualifiedRate:"99.7%",achievementRate:"80%",date:n.value},{id:13,segment:"\u5DE5\u7A0B",customerType:"\u57DF\u5916\u5408\u4F5C",yearlyTarget:"100%",onTimeRate:"93%",qualifiedRate:"99.6%",achievementRate:"75%",date:n.value},{id:14,segment:"\u5DE5\u7A0B",customerType:"\u5176\u5B83",yearlyTarget:"100%",onTimeRate:"92%",qualifiedRate:"99.5%",achievementRate:"73%",date:n.value}]),i=y(()=>b.value.filter(u=>u.date===n.value)),x=y(()=>i.value.filter(u=>u.segment==="\u8BBE\u5907")),E=y(()=>i.value.filter(u=>u.segment==="\u5143\u4EF6")),D=y(()=>i.value.filter(u=>u.segment==="\u5DE5\u7A0B")),F=y(()=>{const u=i.value.map(e=>{const a=parseFloat(e.onTimeRate.replace("%",""));return isNaN(a)?0:a});return u.length===0?"0%":(u.reduce((e,a)=>e+a,0)/u.length).toFixed(2)+"%"}),q=y(()=>{const u=i.value.map(e=>{const a=parseFloat(e.qualifiedRate.replace("%",""));return isNaN(a)?0:a});return u.length===0?"0%":(u.reduce((e,a)=>e+a,0)/u.length).toFixed(2)+"%"}),w=y(()=>{const u=i.value.map(e=>{const a=parseFloat(e.achievementRate.replace("%",""));return isNaN(a)?0:a});return u.length===0?"0%":(u.reduce((e,a)=>e+a,0)/u.length).toFixed(2)+"%"}),B=async()=>{try{const u=await fetch(`http://47.111.95.19:3000/production-plan-execution/${n.value}`);if(!u.ok){if(u.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const o=await u.json();if(o.data){const e=[];o.data.equipment&&o.data.equipment.forEach((a,s)=>{e.push({id:s+1,segment:"\u8BBE\u5907",customerType:a.customerType,yearlyTarget:a.yearlyTarget,onTimeRate:a.onTimeRate,qualifiedRate:a.qualifiedRate,achievementRate:a.achievementRate,date:n.value})}),o.data.component&&o.data.component.forEach((a,s)=>{e.push({id:e.length+1,segment:"\u5143\u4EF6",customerType:a.customerType,yearlyTarget:a.yearlyTarget,onTimeRate:a.onTimeRate,qualifiedRate:a.qualifiedRate,achievementRate:a.achievementRate,date:n.value})}),o.data.project&&o.data.project.forEach((a,s)=>{e.push({id:e.length+1,segment:"\u5DE5\u7A0B",customerType:a.customerType,yearlyTarget:a.yearlyTarget,onTimeRate:a.onTimeRate,qualifiedRate:a.qualifiedRate,achievementRate:a.achievementRate,date:n.value})}),e.length>0&&(b.value=e)}}catch(u){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",u)}},U=async()=>{try{const u=await fetch(`http://47.111.95.19:3000/forms/submission/${_.PRODUCTION_VALUE}/${n.value}`);if(u.ok){const o=await u.json();o.data&&(g.value=o.data.remarks||"",f.value=o.data.suggestions||"")}}catch(u){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",u)}},V=async()=>{try{const u=i.value.filter(r=>r.segment==="\u8BBE\u5907"),o=i.value.filter(r=>r.segment==="\u5143\u4EF6"),e=i.value.filter(r=>r.segment==="\u5DE5\u7A0B");if(!(await fetch("http://47.111.95.19:3000/production-plan-execution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:n.value,data:{equipment:u.map(r=>({customerType:r.customerType,yearlyTarget:r.yearlyTarget,onTimeRate:r.onTimeRate,qualifiedRate:r.qualifiedRate,achievementRate:r.achievementRate})),component:o.map(r=>({customerType:r.customerType,yearlyTarget:r.yearlyTarget,onTimeRate:r.onTimeRate,qualifiedRate:r.qualifiedRate,achievementRate:r.achievementRate})),project:e.map(r=>({customerType:r.customerType,yearlyTarget:r.yearlyTarget,onTimeRate:r.onTimeRate,qualifiedRate:r.qualifiedRate,achievementRate:r.achievementRate}))}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");const s={equipment:i.value.filter(r=>r.segment==="\u8BBE\u5907"),component:i.value.filter(r=>r.segment==="\u5143\u4EF6"),project:i.value.filter(r=>r.segment==="\u5DE5\u7A0B")};await S(_.PRODUCTION_VALUE,n.value,s,g.value,f.value),alert("\u6570\u636E\u4FDD\u5B58\u6210\u529F\uFF01")}catch(u){console.error("\u4FDD\u5B58\u5931\u8D25:",u),alert("\u4FDD\u5B58\u5931\u8D25: "+(u instanceof Error?u.message:"\u672A\u77E5\u9519\u8BEF"))}};return k(()=>{B(),U()}),(u,o)=>(p(),c("div",$,[o[7]||(o[7]=t("h1",{class:"text-2xl font-bold mb-6"},"\u751F\u4EA7/\u65BD\u5DE5\u8BA1\u5212\u6267\u884C\u60C5\u51B5",-1)),t("div",I,[t("div",L,[t("div",P,[o[3]||(o[3]=t("span",{class:"mr-2"},"\u9009\u62E9\u6708\u4EFD\uFF1A",-1)),l(t("input",{type:"month","onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),class:"border rounded px-2 py-1",onChange:B},null,544),[[d,n.value]])]),t("button",{onClick:V,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors"}," \u4FDD\u5B58\u6570\u636E ")]),t("div",M,[t("table",J,[o[6]||(o[6]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"border px-4 py-2 text-left"},"\u677F\u5757"),t("th",{class:"border px-4 py-2 text-left"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border px-4 py-2 text-center"},"\u5E74\u5EA6\u76EE\u6807"),t("th",{class:"border px-4 py-2 text-center"},"\u51C6\u65F6\u5B8C\u5DE5\u7387"),t("th",{class:"border px-4 py-2 text-center"},"\u51FA\u5382\u5408\u683C\u7387"),t("th",{class:"border px-4 py-2 text-center"},"\u8BA1\u5212\u8FBE\u6210\u7387")])],-1)),t("tbody",null,[(p(!0),c(h,null,R(x.value,(e,a)=>(p(),c("tr",{key:`equipment-${a}`},[a===0?(p(),c("td",{key:0,class:"border px-4 py-2",rowspan:x.value.length},"\u8BBE\u5907",8,Q)):T("",!0),t("td",z,m(e.customerType),1),t("td",G,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.yearlyTarget=s,class:"w-full border-0 focus:ring-0"},null,8,H),[[d,e.yearlyTarget]])]),t("td",K,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.onTimeRate=s,class:"w-full border-0 focus:ring-0"},null,8,W),[[d,e.onTimeRate]])]),t("td",X,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.qualifiedRate=s,class:"w-full border-0 focus:ring-0"},null,8,Y),[[d,e.qualifiedRate]])]),t("td",Z,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.achievementRate=s,class:"w-full border-0 focus:ring-0"},null,8,ee),[[d,e.achievementRate]])])]))),128)),(p(!0),c(h,null,R(E.value,(e,a)=>(p(),c("tr",{key:`component-${a}`},[a===0?(p(),c("td",{key:0,class:"border px-4 py-2",rowspan:E.value.length},"\u5143\u4EF6",8,te)):T("",!0),t("td",ae,m(e.customerType),1),t("td",ue,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.yearlyTarget=s,class:"w-full border-0 focus:ring-0"},null,8,oe),[[d,e.yearlyTarget]])]),t("td",se,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.onTimeRate=s,class:"w-full border-0 focus:ring-0"},null,8,re),[[d,e.onTimeRate]])]),t("td",ne,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.qualifiedRate=s,class:"w-full border-0 focus:ring-0"},null,8,le),[[d,e.qualifiedRate]])]),t("td",de,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.achievementRate=s,class:"w-full border-0 focus:ring-0"},null,8,ie),[[d,e.achievementRate]])])]))),128)),(p(!0),c(h,null,R(D.value,(e,a)=>(p(),c("tr",{key:`project-${a}`},[a===0?(p(),c("td",{key:0,class:"border px-4 py-2",rowspan:D.value.length},"\u5DE5\u7A0B",8,ce)):T("",!0),t("td",pe,m(e.customerType),1),t("td",ye,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.yearlyTarget=s,class:"w-full border-0 focus:ring-0"},null,8,me),[[d,e.yearlyTarget]])]),t("td",ge,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.onTimeRate=s,class:"w-full border-0 focus:ring-0"},null,8,fe),[[d,e.onTimeRate]])]),t("td",ve,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.qualifiedRate=s,class:"w-full border-0 focus:ring-0"},null,8,he),[[d,e.qualifiedRate]])]),t("td",Re,[l(t("input",{type:"text","onUpdate:modelValue":s=>e.achievementRate=s,class:"w-full border-0 focus:ring-0"},null,8,Te),[[d,e.achievementRate]])])]))),128)),t("tr",_e,[o[4]||(o[4]=t("td",{class:"border px-4 py-2",colspan:"2"},"\u5408\u8BA1",-1)),o[5]||(o[5]=t("td",{class:"border px-4 py-2"},null,-1)),t("td",be,m(F.value),1),t("td",xe,m(q.value),1),t("td",Ee,m(w.value),1)])])])])]),N(O,{"module-id":j(_).PRODUCTION_VALUE,period:n.value,remarks:g.value,"onUpdate:remarks":o[1]||(o[1]=e=>g.value=e),suggestions:f.value,"onUpdate:suggestions":o[2]||(o[2]=e=>f.value=e)},null,8,["module-id","period","remarks","suggestions"])]))}});export{qe as default};
