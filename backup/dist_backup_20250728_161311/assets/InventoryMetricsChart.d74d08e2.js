import{_ as O,d as R,r as u,o as j,a as T,b as n,e as t,y as W,z as P,F as D,g as F,t as m,C as V,v as r,l as U}from"./index.ca1d2dfd.js";import{i as S,L as G}from"./index.0a005eaa.js";const q={class:"p-6 bg-gray-50 min-h-screen"},H={class:"max-w-7xl mx-auto"},J={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},K={class:"flex items-center justify-between"},Q={class:"flex items-center space-x-3"},X=["value"],Z={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},ee={class:"text-center"},te={class:"text-4xl font-bold text-blue-600"},se={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},ae={class:"flex justify-between items-center mb-6"},oe={class:"text-lg font-semibold text-gray-900"},ue={class:"bg-white rounded-lg shadow-sm p-6"},le={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ne={class:"space-y-4"},re={key:0,class:"space-y-3"},ie={class:"flex items-center"},de={class:"font-medium text-gray-900"},ce={class:"text-right"},ve={class:"font-semibold text-gray-900"},me={class:"text-sm text-gray-600"},pe={key:1,class:"text-center text-gray-500 py-8"},fe=R({__name:"InventoryMetricsChart",setup(ge){const i=u(new Date().getFullYear().toString()),x=u([]),_=u(!0),h=u(null),y=u(null),d=u(null),c=u(null),b=u(0),f=u([]),l=u([]),v=u([]),p=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),z=s=>{switch(s){case"\u9884\u4E2D\u6807":return"bg-green-500";case"\u5728\u4EA7":return"bg-blue-500";case"\u5E93\u5B58":return"bg-purple-500";default:return"bg-gray-500"}},A=()=>{const s=new Date().getFullYear(),e=[];for(let a=0;a<5;a++)e.push((s-a).toString());x.value=e},E=async()=>{try{_.value=!0,await L(),$()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s),g()}finally{_.value=!1}},L=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/inventory-metrics/${i.value}`);if(s.ok){const e=await s.json();e.success&&e.data?(f.value=e.data.months||[],l.value=e.data.monthlyData||[],v.value=e.data.compositionData||[],b.value=e.data.currentTotal||0):g()}else g()}catch(s){console.error("\u83B7\u53D6\u5B58\u91CF\u6307\u6807\u6570\u636E\u5931\u8D25:",s),g()}},g=()=>{f.value=[],l.value=[],v.value=[],b.value=0},k=()=>{h.value&&(d.value=S(h.value)),y.value&&(c.value=S(y.value))},$=()=>{I(),M()},I=()=>{if(!d.value)return;if(f.value.length===0||l.value.length===0){const o={title:{text:`${i.value}\u5E74\u6682\u65E0\u5B58\u91CF\u6570\u636E`,textStyle:{fontSize:16,fontWeight:"bold",color:"#9CA3AF"},left:"center",top:"middle"}};d.value.setOption(o,!0);return}const s=l.value.map(o=>o.preBid),e=l.value.map(o=>o.inProgress),a=l.value.map(o=>o.inventory),Y=l.value.map(o=>o.total),N={title:{text:`${i.value}\u5E74\u5B58\u91CF\u53D8\u5316\u8D8B\u52BF`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(o){let C=`${o[0].name}<br/>`;return o.forEach(w=>{C+=`${w.seriesName}: ${p(w.value)}\u4E07\u5143<br/>`}),C}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:f.value,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u91D1\u989D(\u4E07\u5143)",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(o){return p(o)},fontSize:12}},series:[{name:"\u9884\u4E2D\u6807",type:"line",data:s,smooth:!0,lineStyle:{color:"#10B981",width:2},itemStyle:{color:"#10B981"}},{name:"\u5728\u4EA7",type:"line",data:e,smooth:!0,lineStyle:{color:"#3B82F6",width:2},itemStyle:{color:"#3B82F6"}},{name:"\u5E93\u5B58",type:"line",data:a,smooth:!0,lineStyle:{color:"#8B5CF6",width:2},itemStyle:{color:"#8B5CF6"}},{name:"\u603B\u8BA1",type:"line",data:Y,smooth:!0,lineStyle:{color:"#8B5CF6",width:3},itemStyle:{color:"#8B5CF6"},areaStyle:{color:new G(0,0,0,1,[{offset:0,color:"#8B5CF640"},{offset:1,color:"#8B5CF610"}])}}]};d.value.setOption(N,!0)},M=()=>{if(!c.value)return;if(v.value.length===0){const e={title:{text:"\u6682\u65E0\u6784\u6210\u6570\u636E",textStyle:{fontSize:14,color:"#9CA3AF"},left:"center",top:"middle"}};c.value.setOption(e,!0);return}const s={title:{text:"\u5B58\u91CF\u6784\u6210\u5206\u5E03",textStyle:{fontSize:14,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"item",formatter:function(e){return`${e.name}<br/>\u91D1\u989D: ${p(e.value)}\u4E07\u5143<br/>\u5360\u6BD4: ${e.percent}%`}},series:[{type:"pie",radius:["40%","70%"],center:["50%","60%"],avoidLabelOverlap:!1,label:{show:!0,formatter:"{b}: {d}%",fontSize:12},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:v.value.map((e,a)=>({name:e.name,value:e.value,itemStyle:{color:["#10B981","#3B82F6","#8B5CF6"][a]}}))}]};c.value.setOption(s,!0)},B=()=>{var s,e;(s=d.value)==null||s.resize(),(e=c.value)==null||e.resize()};return j(async()=>{A(),k(),await E(),window.addEventListener("resize",B)}),T(()=>{var s,e;(s=d.value)==null||s.dispose(),(e=c.value)==null||e.dispose(),window.removeEventListener("resize",B)}),(s,e)=>(r(),n("div",q,[t("div",H,[e[8]||(e[8]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u5B58\u91CF\u6307\u6807\u5206\u6790"),t("p",{class:"text-gray-600 mt-2"},"\u9884\u4E2D\u6807+\u5728\u4EA7+\u5E93\u5B58\u7EFC\u5408\u5206\u6790")],-1)),t("div",J,[t("div",K,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),t("div",Q,[e[1]||(e[1]=t("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),W(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),onChange:E,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(r(!0),n(D,null,F(x.value,a=>(r(),n("option",{key:a,value:a},m(a)+"\u5E74",9,X))),128))],544),[[P,i.value]])])])]),t("div",Z,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5F53\u524D\u5B58\u91CF\u603B\u91CF",-1)),t("div",ee,[t("div",te,m(p(b.value)),1),e[3]||(e[3]=t("div",{class:"text-sm text-gray-600 mt-2"},"\u4E07\u5143",-1))])]),t("div",se,[t("div",ae,[t("h3",oe,m(i.value)+"\u5E74\u5B58\u91CF\u53D8\u5316\u8D8B\u52BF",1),e[5]||(e[5]=V('<div class="flex items-center space-x-4" data-v-7332257b><div class="flex items-center" data-v-7332257b><div class="w-4 h-4 bg-green-500 rounded mr-2" data-v-7332257b></div><span class="text-sm text-gray-600" data-v-7332257b>\u9884\u4E2D\u6807</span></div><div class="flex items-center" data-v-7332257b><div class="w-4 h-4 bg-blue-500 rounded mr-2" data-v-7332257b></div><span class="text-sm text-gray-600" data-v-7332257b>\u5728\u4EA7</span></div><div class="flex items-center" data-v-7332257b><div class="w-4 h-4 bg-purple-500 rounded mr-2" data-v-7332257b></div><span class="text-sm text-gray-600" data-v-7332257b>\u5E93\u5B58</span></div><div class="flex items-center" data-v-7332257b><div class="w-4 h-4 bg-purple-500 rounded mr-2" data-v-7332257b></div><span class="text-sm text-gray-600" data-v-7332257b>\u603B\u8BA1</span></div></div>',1))]),t("div",{class:"h-[400px]",ref_key:"trendChartRef",ref:h},null,512)]),t("div",ue,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5F53\u524D\u5B58\u91CF\u6784\u6210\u5206\u5E03",-1)),t("div",le,[t("div",{class:"h-[300px]",ref_key:"pieChartRef",ref:y},null,512),t("div",ne,[e[6]||(e[6]=t("h4",{class:"font-medium text-gray-900"},"\u6784\u6210\u8BE6\u60C5",-1)),v.value.length>0?(r(),n("div",re,[(r(!0),n(D,null,F(v.value,a=>(r(),n("div",{key:a.name,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg"},[t("div",ie,[t("div",{class:U(["w-4 h-4 rounded mr-3",z(a.name)])},null,2),t("span",de,m(a.name),1)]),t("div",ce,[t("div",ve,m(p(a.value))+"\u4E07\u5143",1),t("div",me,m(a.percentage)+"%",1)])]))),128))])):(r(),n("div",pe," \u6682\u65E0\u6784\u6210\u6570\u636E "))])])])])]))}});var be=O(fe,[["__scopeId","data-v-7332257b"]]);export{be as default};
