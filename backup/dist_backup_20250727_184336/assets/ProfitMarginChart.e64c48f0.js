import{_,d as b,r,B as x,o as D,i as g,j as w,c as m,a as t,y as F,z as S,t as i,F as A,l as C,f as p,n as z}from"./index.8145f88e.js";import{i as M}from"./index.0a005eaa.js";const j={class:"min-h-screen bg-gray-50 py-8"},$={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},k={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},L={class:"flex items-center justify-between"},P={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},N={class:"flex items-center justify-between mb-6"},R={class:"text-lg font-semibold text-gray-900"},W={class:"text-sm text-gray-500"},I={class:"bg-white rounded-lg shadow-sm p-6"},O={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},T={class:"flex items-center justify-between mb-3"},U={class:"font-medium text-gray-900"},V={class:"text-lg font-bold text-blue-600"},Y={class:"space-y-2"},q={class:"flex justify-between text-sm"},G={class:"font-medium"},H={class:"flex justify-between text-sm"},J={class:"font-medium"},K={class:"w-full bg-gray-200 rounded-full h-2"},Q=b({__name:"ProfitMarginChart",setup(X){const n=r("2025"),f=r();let u=null;const v=r(24),c=r(0),l=r([]),o=r([]),d=r([{name:"\u8BBE\u5907",plan:21.99,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:26,actual:0,rate:0}]),E=s=>s.toFixed(2),y=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/profit-margin/${n.value}`);if(s.ok){const e=await s.json();e.success&&e.data?e.data.hasData===!1?(l.value=[],o.value=[],c.value=0,d.value=e.data.segmentData||[{name:"\u8BBE\u5907",plan:21.99,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:26,actual:0,rate:0}]):(l.value=e.data.months||[],o.value=e.data.monthlyData||[],c.value=e.data.currentRate||0,e.data.segmentData&&(d.value=e.data.segmentData.map(a=>({name:a.name,plan:a.plan,actual:a.actual,rate:a.rate})))):(l.value=[],o.value=[],c.value=0,d.value=[{name:"\u8BBE\u5907",plan:21.99,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:26,actual:0,rate:0}])}else l.value=[],o.value=[],c.value=0,d.value=[{name:"\u8BBE\u5907",plan:21.99,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:26,actual:0,rate:0}]}catch(s){console.error("\u83B7\u53D6\u6BDB\u5229\u7387\u6570\u636E\u5931\u8D25:",s),l.value=[],o.value=[],c.value=0,d.value=[{name:"\u8BBE\u5907",plan:21.99,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:26,actual:0,rate:0}]}},B=()=>{if(!f.value)return;if(u&&u.dispose(),u=M(f.value),l.value.length===0||o.value.length===0){const e={title:{text:`${n.value}\u5E74\u6682\u65E0\u6BDB\u5229\u7387\u6570\u636E`,textStyle:{fontSize:16,fontWeight:"bold",color:"#9CA3AF"},left:"center",top:"middle"},graphic:{type:"text",left:"center",top:"60%",style:{text:"\u8BF7\u9009\u62E9\u5176\u4ED6\u5E74\u4EFD\u67E5\u770B\u6570\u636E",fontSize:14,fill:"#9CA3AF"}}};u.setOption(e);return}const s={title:{text:`${n.value}\u5E74\u6BDB\u5229\u7387\u8D8B\u52BF`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(e){let a=`${e[0].name}<br/>`;return e.forEach(h=>{a+=`${h.seriesName}: ${E(h.value)}%<br/>`}),a}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:l.value,axisLabel:{rotate:0,fontSize:12}},yAxis:{type:"value",name:"\u6BDB\u5229\u7387 (%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:"{value}%"}},series:[{name:"\u5B9E\u9645\u6BDB\u5229\u7387",type:"line",data:o.value,smooth:!0,lineStyle:{width:3,color:"#3B82F6"},itemStyle:{color:"#3B82F6",borderWidth:2,borderColor:"#ffffff"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(59, 130, 246, 0.3)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}]}}},{name:"\u76EE\u6807\u6BDB\u5229\u7387",type:"line",data:new Array(l.value.length).fill(v.value),lineStyle:{width:2,color:"#EF4444",type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]};u.setOption(s)};return x(n,()=>{y()}),x([l,o],()=>{g(()=>{B()})}),D(async()=>{await y(),await g(),B(),window.addEventListener("resize",()=>{u&&u.resize()})}),w(()=>{u&&u.dispose(),window.removeEventListener("resize",()=>{u&&u.resize()})}),(s,e)=>(p(),m("div",j,[t("div",$,[e[6]||(e[6]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u6BDB\u5229\u7387\u5206\u6790"),t("p",{class:"mt-2 text-gray-600"},"\u4E3B\u8425\u4E1A\u52A1\u6BDB\u5229\u7387\u8D8B\u52BF\u5206\u6790\u4E0E\u677F\u5757\u5BF9\u6BD4")],-1)),t("div",k,[t("div",L,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u5206\u6790\u5E74\u4EFD",-1)),F(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},e[1]||(e[1]=[t("option",{value:"2024"},"2024\u5E74",-1),t("option",{value:"2025"},"2025\u5E74",-1),t("option",{value:"2023"},"2023\u5E74",-1)]),512),[[S,n.value]])])]),t("div",P,[t("div",N,[t("h3",R,i(n.value)+"\u5E74\u6708\u5EA6\u6BDB\u5229\u7387\u8D8B\u52BF",1),t("div",W," \u5F53\u524D\u6BDB\u5229\u7387: "+i(c.value.toFixed(2))+"% | \u76EE\u6807: "+i(v.value)+"% ",1)]),t("div",{ref_key:"chartContainer",ref:f,class:"w-full h-96"},null,512)]),t("div",I,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5404\u677F\u5757\u6BDB\u5229\u7387\u5206\u6790",-1)),t("div",O,[(p(!0),m(A,null,C(d.value,a=>(p(),m("div",{key:a.name,class:"bg-gray-50 rounded-lg p-4"},[t("div",T,[t("h4",U,i(a.name)+"\u677F\u5757",1),t("span",V,i(a.rate)+"%",1)]),t("div",Y,[t("div",q,[e[3]||(e[3]=t("span",{class:"text-gray-600"},"\u8BA1\u5212\u503C",-1)),t("span",G,i(a.plan)+"%",1)]),t("div",H,[e[4]||(e[4]=t("span",{class:"text-gray-600"},"\u5B9E\u9645\u503C",-1)),t("span",J,i(a.actual)+"%",1)]),t("div",K,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:z(`width: ${Math.min(a.actual/Math.max(a.plan,a.actual)*100,100)}%`)},null,4)])])]))),128))])])])]))}});var et=_(Q,[["__scopeId","data-v-ccc17b4e"]]);export{et as default};
