import{_ as U,d as N,r as g,B as h,c as B,o as w,b as m,e,y as b,A as C,F as R,g as k,t as n,k as z,h as O,G as T,v as x,f as V}from"./index.ecbb4849.js";import{_ as I,M as f,r as L}from"./FormAttachmentAndRemarks.a0b77378.js";const $={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},j={class:"flex justify-between items-center mb-6"},J={class:"flex items-center space-x-4"},M={class:"overflow-x-auto my-6"},q={class:"w-full border-collapse border border-gray-300"},H=["rowspan"],Y={class:"border border-gray-300 px-4 py-2"},G={class:"border border-gray-300 px-4 py-2"},K=["onUpdate:modelValue"],Q={class:"border border-gray-300 px-4 py-2"},W=["onUpdate:modelValue"],X={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],aa={class:"border border-gray-300 px-4 py-2 text-right"},ta={class:"text-sm font-medium"},ea={class:"border border-gray-300 px-4 py-2 text-right"},ua={class:"text-sm font-medium"},ra={class:"bg-gray-50 font-bold"},sa={class:"border border-gray-300 px-4 py-2 text-right"},oa={class:"border border-gray-300 px-4 py-2 text-right"},na={class:"border border-gray-300 px-4 py-2 text-right"},ca={class:"border border-gray-300 px-4 py-2 text-right"},ia={class:"text-sm font-bold"},la={class:"border border-gray-300 px-4 py-2 text-right"},pa={class:"text-sm font-bold"},da=N({__name:"SelfConstructionAnalysis",setup(ya){var P;const E=T(),s=g(((P=E.query.period)==null?void 0:P.toString())||new Date().toISOString().slice(0,7)),F={items:[{customerAttribute:"\u4E00\u5305\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:18.35,planExecutionProgress:0,capacityUtilizationRate:0},{customerAttribute:"\u4E8C\u5305\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:26.85,planExecutionProgress:0,capacityUtilizationRate:0},{customerAttribute:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:0,planExecutionProgress:0,capacityUtilizationRate:0},{customerAttribute:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:0,planExecutionProgress:0,capacityUtilizationRate:0},{customerAttribute:"\u65B0\u80FD\u6E90\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:48.62,planExecutionProgress:0,capacityUtilizationRate:0},{customerAttribute:"\u82CF\u5DDE\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:0,planExecutionProgress:0,capacityUtilizationRate:0},{customerAttribute:"\u62A2\u4FEE\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:7.8,planExecutionProgress:0,capacityUtilizationRate:0},{customerAttribute:"\u8FD0\u68C0\u9879\u76EE",companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:44.61,planExecutionProgress:0,capacityUtilizationRate:0}]},o=g(JSON.parse(JSON.stringify(F))),i=g(""),l=g(""),A=t=>t===0?"0.00":t.toFixed(2),y=t=>t===0?"0.00":t.toFixed(2);h(()=>o.value.items,t=>{t.forEach(a=>{a.planExecutionProgress=a.annualCapacityPlan>0?a.currentPeriodCapacityAccumulated/a.annualCapacityPlan*100:0,a.capacityUtilizationRate=a.companyDesignCapacity>0?a.currentPeriodCapacityAccumulated/a.companyDesignCapacity*100:0})},{deep:!0});const p=B(()=>{const t={companyDesignCapacity:0,annualCapacityPlan:0,currentPeriodCapacityAccumulated:0,planExecutionProgress:0,capacityUtilizationRate:0};return o.value.items.forEach(a=>{t.companyDesignCapacity+=a.companyDesignCapacity||0,t.annualCapacityPlan+=a.annualCapacityPlan||0,t.currentPeriodCapacityAccumulated+=a.currentPeriodCapacityAccumulated||0}),t.planExecutionProgress=t.annualCapacityPlan>0?t.currentPeriodCapacityAccumulated/t.annualCapacityPlan*100:0,t.capacityUtilizationRate=t.companyDesignCapacity>0?t.currentPeriodCapacityAccumulated/t.companyDesignCapacity*100:0,t}),_=async t=>{try{const a=await fetch(`http://47.111.95.19:3000/nanhua-self-construction-analysis/${t}`);if(!a.ok){if(a.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log(`${t}\u671F\u95F4\u65E0\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u72B6\u6001`),c();return}const u=await a.json();u.data&&u.data.items&&(o.value.items=u.data.items.map(r=>({customerAttribute:r.customerAttribute,companyDesignCapacity:Number(r.companyDesignCapacity)||0,annualCapacityPlan:Number(r.annualCapacityPlan)||0,currentPeriodCapacityAccumulated:Number(r.currentPeriodCapacityAccumulated)||0,planExecutionProgress:Number(r.planExecutionProgress)||0,capacityUtilizationRate:Number(r.capacityUtilizationRate)||0})))}catch(a){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",a),c()}},c=()=>{o.value=JSON.parse(JSON.stringify(F))},D=async t=>{try{const a=await fetch(`http://47.111.95.19:3000/forms/submission/${f.NANHUA_SELF_CONSTRUCTION_ANALYSIS}/${t}`);if(a.ok){const u=await a.json();u.success&&u.data&&(i.value=u.data.remarks||"",l.value=u.data.suggestions||"")}}catch(a){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",a)}};h(()=>E.query.period,async t=>{t&&(s.value=t.toString(),c(),await _(t.toString()),D(t.toString()))}),h(s,async(t,a)=>{t&&t!==a&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${a} -> ${t}`),c(),await _(t),D(t))});const v=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-self-construction-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:s.value,data:o.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await L(f.NANHUA_SELF_CONSTRUCTION_ANALYSIS,s.value,o.value,i.value,l.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},S=()=>{c(),i.value="",l.value=""};return w(async()=>{var a;c();const t=((a=E.query.period)==null?void 0:a.toString())||s.value;await _(t),D(t)}),(t,a)=>(x(),m("div",$,[e("div",j,[a[4]||(a[4]=e("h1",{class:"text-2xl font-bold"},"\u4E3B\u8425\u4E1A\u52A1\u4EA7\u503C\u2014\u2014\u81EA\u884C\u65BD\u5DE5\u60C5\u51B5\u5206\u6790",-1)),e("div",J,[a[3]||(a[3]=e("span",{class:"text-sm text-gray-600"},"\uFF08\u53EF\u4FEE\u8BA2\uFF09",-1)),b(e("input",{"onUpdate:modelValue":a[0]||(a[0]=u=>s.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[C,s.value]])])]),e("div",M,[e("table",q,[a[6]||(a[6]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u516C\u53F8\u8BBE\u8BA1\u4EA7\u80FD"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u4EA7\u80FD\u8BA1\u5212"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u4EA7\u80FD\u7D2F\u8BA1"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u8BA1\u5212\u6267\u884C\u8FDB\u5EA6"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u4EA7\u80FD\u5229\u7528\u7387")])],-1)),e("tbody",null,[(x(!0),m(R,null,k(o.value.items,(u,r)=>(x(),m("tr",{key:`item-${r}`},[r===0?(x(),m("td",{key:0,rowspan:o.value.items.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,H)):V("",!0),e("td",Y,n(u.customerAttribute),1),e("td",G,[b(e("input",{"onUpdate:modelValue":d=>u.companyDesignCapacity=d,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,K),[[C,u.companyDesignCapacity]])]),e("td",Q,[b(e("input",{"onUpdate:modelValue":d=>u.annualCapacityPlan=d,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,W),[[C,u.annualCapacityPlan]])]),e("td",X,[b(e("input",{"onUpdate:modelValue":d=>u.currentPeriodCapacityAccumulated=d,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Z),[[C,u.currentPeriodCapacityAccumulated]])]),e("td",aa,[e("span",ta,n(y(u.planExecutionProgress))+"%",1)]),e("td",ea,[e("span",ua,n(y(u.capacityUtilizationRate))+"%",1)])]))),128)),e("tr",ra,[a[5]||(a[5]=e("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),e("td",sa,n(A(p.value.companyDesignCapacity)),1),e("td",oa,n(A(p.value.annualCapacityPlan)),1),e("td",na,n(A(p.value.currentPeriodCapacityAccumulated)),1),e("td",ca,[e("span",ia,n(y(p.value.planExecutionProgress))+"%",1)]),e("td",la,[e("span",pa,n(y(p.value.capacityUtilizationRate))+"%",1)])])])])]),z(I,{"module-id":O(f).NANHUA_SELF_CONSTRUCTION_ANALYSIS,period:s.value,remarks:i.value,"onUpdate:remarks":a[1]||(a[1]=u=>i.value=u),suggestions:l.value,"onUpdate:suggestions":a[2]||(a[2]=u=>l.value=u)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:v,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:S,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ba=U(da,[["__scopeId","data-v-0799a1fc"]]);export{ba as default};
