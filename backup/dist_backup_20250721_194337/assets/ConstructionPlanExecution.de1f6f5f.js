import{_ as F,d as U,r as g,h as S,C as T,o as O,c as b,a as o,y as d,B as m,F as k,l as Q,t as l,b as V,m as I,G as $,f as h,k as j}from"./index.7237b4cb.js";import{_ as J,M as A,r as L}from"./FormAttachmentAndRemarks.84a79a09.js";const M={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},q={class:"flex justify-between items-center mb-6"},X={class:"flex items-center space-x-4"},Y={class:"overflow-x-auto my-6"},G={class:"w-full border-collapse border border-gray-300"},P=["rowspan"],z={class:"border border-gray-300 px-4 py-2"},H={class:"border border-gray-300 px-4 py-2"},K=["onUpdate:modelValue"],W={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],ee={class:"border border-gray-300 px-4 py-2"},te=["onUpdate:modelValue"],ae={class:"border border-gray-300 px-4 py-2"},oe=["onUpdate:modelValue"],re={class:"bg-gray-50 font-bold"},ne={class:"border border-gray-300 px-4 py-2 text-right"},ue={class:"border border-gray-300 px-4 py-2 text-right"},se={class:"text-sm font-bold"},ie={class:"border border-gray-300 px-4 py-2 text-right"},le={class:"text-sm font-bold"},ce={class:"border border-gray-300 px-4 py-2 text-right"},pe={class:"text-sm font-bold"},de=U({__name:"ConstructionPlanExecution",setup(me){var E;const f=$(),u=g(((E=f.query.period)==null?void 0:E.toString())||new Date().toISOString().slice(0,7)),R={items:[{segmentAttribute:"\u8BBE\u5907",customerAttribute:"\u7535\u4E1A\u9879\u76EE",yearlyTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{segmentAttribute:"\u8BBE\u5907",customerAttribute:"\u7528\u6237\u9879\u76EE",yearlyTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{segmentAttribute:"\u8BBE\u5907",customerAttribute:"\u8D38\u6613",yearlyTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{segmentAttribute:"\u8BBE\u5907",customerAttribute:"\u4EE3\u7406\u8BBE\u5907",yearlyTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{segmentAttribute:"\u8BBE\u5907",customerAttribute:"\u4EE3\u7406\u5DE5\u7A0B",yearlyTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{segmentAttribute:"\u8BBE\u5907",customerAttribute:"\u4EE3\u7406\u8BBE\u8BA1",yearlyTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0}]},r=g(JSON.parse(JSON.stringify(R))),c=g(""),p=g(""),C=e=>e===0?"0.00":e.toFixed(2),_=e=>e===0?"0.00":e.toFixed(2),D=e=>e===0?!0:r.value.items[e].segmentAttribute!==r.value.items[e-1].segmentAttribute,B=e=>r.value.items.filter(t=>t.segmentAttribute===e).length,y=S(()=>{const e={yearlyTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0};r.value.items.filter(a=>a.yearlyTarget>0||a.onTimeCompletionRate>0||a.acceptanceQualificationRate>0||a.planAchievementRate>0),r.value.items.forEach(a=>{e.yearlyTarget+=a.yearlyTarget||0,e.onTimeCompletionRate+=a.onTimeCompletionRate||0,e.acceptanceQualificationRate+=a.acceptanceQualificationRate||0,e.planAchievementRate+=a.planAchievementRate||0});const t=r.value.items.length;return t>0&&(e.onTimeCompletionRate=e.onTimeCompletionRate/t,e.acceptanceQualificationRate=e.acceptanceQualificationRate/t,e.planAchievementRate=e.planAchievementRate/t),e}),v=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/tuoyuan-construction-plan-execution/${e}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log(`${e}\u671F\u95F4\u65E0\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u72B6\u6001`),i();return}const a=await t.json();a.data&&a.data.items&&(r.value.items=a.data.items.map(n=>({segmentAttribute:n.segmentAttribute,customerAttribute:n.customerAttribute,yearlyTarget:Number(n.yearlyTarget)||0,onTimeCompletionRate:Number(n.onTimeCompletionRate)||0,acceptanceQualificationRate:Number(n.acceptanceQualificationRate)||0,planAchievementRate:Number(n.planAchievementRate)||0})))}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t),i()}},i=()=>{r.value=JSON.parse(JSON.stringify(R))},x=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${A.TUOYUAN_CONSTRUCTION_PLAN_EXECUTION}/${e}`);if(t.ok){const a=await t.json();a.success&&a.data&&(c.value=a.data.remarks||"",p.value=a.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",t)}};T(()=>f.query.period,async e=>{e&&(u.value=e.toString(),i(),await v(e.toString()),x(e.toString()))}),T(u,async(e,t)=>{e&&e!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${e}`),i(),await v(e),x(e))});const w=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/tuoyuan-construction-plan-execution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:u.value,data:{items:r.value.items}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await L(A.TUOYUAN_CONSTRUCTION_PLAN_EXECUTION,u.value,{items:r.value.items},c.value,p.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25")}},N=()=>{i(),c.value="",p.value=""};return O(async()=>{var t;i();const e=((t=f.query.period)==null?void 0:t.toString())||u.value;await v(e),x(e)}),(e,t)=>(h(),b("div",M,[o("div",q,[t[3]||(t[3]=o("h1",{class:"text-2xl font-bold"},"\u65BD\u5DE5\u8BA1\u5212\u6267\u884C\u60C5\u51B5",-1)),o("div",X,[d(o("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),type:"month",class:"px-3 py-2 border rounded"},null,512),[[m,u.value]])])]),o("div",Y,[o("table",G,[t[5]||(t[5]=o("thead",{class:"sticky top-0 bg-white"},[o("tr",{class:"bg-gray-50"},[o("th",{class:"border border-gray-300 px-4 py-2 w-20"},"\u677F\u5757"),o("th",{class:"border border-gray-300 px-4 py-2 w-24"},"\u5BA2\u6237\u5C5E\u6027"),o("th",{class:"border border-gray-300 px-4 py-2 w-24"},"\u5E74\u5EA6\u76EE\u6807"),o("th",{class:"border border-gray-300 px-4 py-2 w-24"},"\u51C6\u65F6\u5B8C\u5DE5\u7387"),o("th",{class:"border border-gray-300 px-4 py-2 w-24"},"\u9A8C\u6536\u5408\u683C\u7387"),o("th",{class:"border border-gray-300 px-4 py-2 w-24"},"\u8BA1\u5212\u8FBE\u6210\u7387")])],-1)),o("tbody",null,[(h(!0),b(k,null,Q(r.value.items,(a,n)=>(h(),b("tr",{key:`construction-${n}`},[D(n)?(h(),b("td",{key:0,rowspan:B(a.segmentAttribute),class:"border border-gray-300 px-4 py-2 font-medium text-center"},l(a.segmentAttribute),9,P)):j("",!0),o("td",z,l(a.customerAttribute),1),o("td",H,[d(o("input",{"onUpdate:modelValue":s=>a.yearlyTarget=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,K),[[m,a.yearlyTarget]])]),o("td",W,[d(o("input",{"onUpdate:modelValue":s=>a.onTimeCompletionRate=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",min:"0",max:"100"},null,8,Z),[[m,a.onTimeCompletionRate]])]),o("td",ee,[d(o("input",{"onUpdate:modelValue":s=>a.acceptanceQualificationRate=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",min:"0",max:"100"},null,8,te),[[m,a.acceptanceQualificationRate]])]),o("td",ae,[d(o("input",{"onUpdate:modelValue":s=>a.planAchievementRate=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",min:"0",max:"100"},null,8,oe),[[m,a.planAchievementRate]])])]))),128)),o("tr",re,[t[4]||(t[4]=o("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),o("td",ne,l(C(y.value.yearlyTarget)),1),o("td",ue,[o("span",se,l(_(y.value.onTimeCompletionRate))+"%",1)]),o("td",ie,[o("span",le,l(_(y.value.acceptanceQualificationRate))+"%",1)]),o("td",ce,[o("span",pe,l(_(y.value.planAchievementRate))+"%",1)])])])])]),V(J,{"module-id":I(A).TUOYUAN_CONSTRUCTION_PLAN_EXECUTION,period:u.value,remarks:c.value,"onUpdate:remarks":t[1]||(t[1]=a=>c.value=a),suggestions:p.value,"onUpdate:suggestions":t[2]||(t[2]=a=>p.value=a)},null,8,["module-id","period","remarks","suggestions"]),o("div",{class:"mt-4 flex justify-end space-x-4"},[o("button",{onClick:w,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),o("button",{onClick:N,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var be=F(de,[["__scopeId","data-v-70eff5a2"]]);export{be as default};
