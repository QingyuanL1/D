import{_ as Y,d as N,r as l,o as V,j as I,c as v,a as t,y as T,z as U,F,l as S,t as s,n as C,q as x,A as q,f}from"./index.8819bd40.js";import{i as G,L as O}from"./index.0a005eaa.js";const W={class:"p-6 bg-gray-50 min-h-screen"},H={class:"max-w-7xl mx-auto"},J={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},K={class:"flex items-center justify-between"},P={class:"flex items-center space-x-3"},Q=["value"],X={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},Z={class:"flex justify-between items-center mb-6"},tt={class:"text-lg font-semibold text-gray-900"},et={class:"text-right"},at={class:"text-3xl font-bold text-blue-600"},ut={class:"mb-4"},st={class:"flex justify-between text-sm text-gray-600 mb-2"},lt={class:"w-full bg-gray-200 rounded-full h-3"},nt={class:"flex items-center space-x-4 text-sm"},ot={class:"flex items-center"},rt={class:"text-gray-600"},it={class:"text-gray-500"},dt={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},ct={class:"flex justify-between items-center mb-6"},vt={class:"text-lg font-semibold text-gray-900"},ft={class:"bg-white rounded-lg shadow-sm p-6"},mt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},gt={class:"flex justify-between items-center mb-3"},bt={class:"font-medium text-gray-900"},ht={class:"w-full bg-gray-200 rounded-full h-2 mb-2"},xt={class:"text-xs text-gray-600"},Et=N({__name:"ContributionRateChart",setup(pt){const o=l(new Date().getFullYear().toString()),E=l([]),p=l(!0),b=l(null),r=l(null),i=l(21.98),d=l(0),n=l(0),m=l([]),c=l([]),h=l([{name:"\u8BBE\u5907",plan:25.5,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:22.8,actual:0,rate:0}]),y=a=>a.toLocaleString("zh-CN",{maximumFractionDigits:2}),A=()=>n.value>=90?"bg-green-500":n.value>=70?"bg-blue-500":n.value>=50?"bg-yellow-500":"bg-red-500",z=()=>n.value>=90?"\u76EE\u6807\u8FBE\u6210\u826F\u597D":n.value>=70?"\u76EE\u6807\u5B8C\u6210\u4E2D":n.value>=50?"\u9700\u8981\u5173\u6CE8":"\u9700\u8981\u6539\u8FDB",R=a=>a>=20?"text-green-600":a>=15?"text-blue-600":a>=10?"text-yellow-600":"text-red-600",L=a=>a>=20?"bg-green-500":a>=15?"bg-blue-500":a>=10?"bg-yellow-500":"bg-red-500",j=()=>{const a=new Date().getFullYear(),e=[];for(let u=0;u<5;u++)e.push((a-u).toString());E.value=e},_=async()=>{try{p.value=!0,await M(),k()}catch(a){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",a),g()}finally{p.value=!1}},g=()=>{m.value=["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],c.value=[18.5,19.2,20.1,21.3,22,21.8,22.5,23.1,22.8,23.5,24.2,24.8],d.value=c.value[c.value.length-1]||0,n.value=Math.round(d.value/i.value*100),h.value=[{name:"\u8BBE\u5907",plan:25.5,actual:24.2,rate:24.2},{name:"\u5143\u4EF6",plan:15,actual:16.8,rate:16.8},{name:"\u5DE5\u7A0B",plan:22.8,actual:23.5,rate:23.5}]},M=async()=>{try{const a=await fetch(`http://47.111.95.19:3000/analytics/contribution-rate/${o.value}`);if(a.ok){const e=await a.json();e.success&&e.data?(m.value=e.data.months||[],c.value=e.data.monthlyData||[],d.value=e.data.currentRate||0,n.value=Math.round(d.value/i.value*100),e.data.segmentData&&(h.value=e.data.segmentData)):g()}else g()}catch(a){console.error("\u83B7\u53D6\u8FB9\u9645\u8D21\u732E\u7387\u6570\u636E\u5931\u8D25:",a),g()}},$=()=>{b.value&&(r.value=G(b.value))},k=()=>{if(!r.value)return;const a=m.value.map(()=>i.value),e={title:{text:`${o.value}\u5E74\u8FB9\u9645\u8D21\u732E\u7387\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(u){let D=`${u[0].name}<br/>`;return u.forEach(w=>{D+=`${w.seriesName}: ${y(w.value)}%<br/>`}),D}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:m.value,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u767E\u5206\u6BD4(%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(u){return y(u)+"%"},fontSize:12}},series:[{name:"\u5B9E\u9645\u8D21\u732E\u7387",type:"line",data:c.value,smooth:!0,lineStyle:{color:"#3B82F6",width:3},itemStyle:{color:"#3B82F6"},areaStyle:{color:new O(0,0,0,1,[{offset:0,color:"#3B82F640"},{offset:1,color:"#3B82F610"}])}},{name:"\u8BA1\u5212\u76EE\u6807\u7EBF",type:"line",data:a,lineStyle:{color:"#EF4444",width:2,type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]};r.value.setOption(e,!0)},B=()=>{var a;(a=r.value)==null||a.resize()};return V(async()=>{j(),$(),await _(),window.addEventListener("resize",B)}),I(()=>{var a;(a=r.value)==null||a.dispose(),window.removeEventListener("resize",B)}),(a,e)=>(f(),v("div",W,[t("div",H,[e[7]||(e[7]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u8FB9\u9645\u8D21\u732E\u7387\u5206\u6790"),t("p",{class:"text-gray-600 mt-2"},"\u4E3B\u8425\u4E1A\u52A1\u8FB9\u9645\u8D21\u732E\u7387\u7ED3\u6784\u4E0E\u8D28\u91CF\u5206\u6790")],-1)),t("div",J,[t("div",K,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),t("div",P,[e[1]||(e[1]=t("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),T(t("select",{"onUpdate:modelValue":e[0]||(e[0]=u=>o.value=u),onChange:_,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(f(!0),v(F,null,S(E.value,u=>(f(),v("option",{key:u,value:u},s(u)+"\u5E74",9,Q))),128))],544),[[U,o.value]])])])]),t("div",X,[t("div",Z,[t("h3",tt,s(o.value)+"\u5E74\u8FB9\u9645\u8D21\u732E\u7387\u8BA1\u5212\u76EE\u6807",1),t("div",et,[t("div",at,s(i.value)+"%",1),e[3]||(e[3]=t("div",{class:"text-sm text-gray-500"},"\u5E74\u5EA6\u8BA1\u5212\u76EE\u6807",-1))])]),t("div",ut,[t("div",st,[e[4]||(e[4]=t("span",null,"\u5F53\u524D\u5B8C\u6210\u7387",-1)),t("span",null,s(n.value)+"%",1)]),t("div",lt,[t("div",{class:"bg-blue-600 h-3 rounded-full transition-all duration-500 ease-out",style:C(`width: ${Math.min(n.value,100)}%`)},null,4)])]),t("div",nt,[t("div",ot,[t("div",{class:x(["w-3 h-3 rounded-full mr-2",A()])},null,2),t("span",rt,s(z()),1)]),t("div",it," \u76EE\u6807: "+s(i.value)+"% | \u5F53\u524D: "+s(d.value.toFixed(2))+"% ",1)])]),t("div",dt,[t("div",ct,[t("h3",vt,s(o.value)+"\u5E74\u8FB9\u9645\u8D21\u732E\u7387\u6708\u5EA6\u8D8B\u52BF",1),e[5]||(e[5]=q('<div class="flex items-center space-x-4" data-v-ca15fb04><div class="flex items-center" data-v-ca15fb04><div class="w-4 h-4 bg-blue-500 rounded mr-2" data-v-ca15fb04></div><span class="text-sm text-gray-600" data-v-ca15fb04>\u5B9E\u9645\u8D21\u732E\u7387</span></div><div class="flex items-center" data-v-ca15fb04><div class="w-4 h-4 bg-red-500 rounded mr-2" data-v-ca15fb04></div><span class="text-sm text-gray-600" data-v-ca15fb04>\u8BA1\u5212\u76EE\u6807\u7EBF</span></div></div>',1))]),t("div",{class:"h-[400px]",ref_key:"chartRef",ref:b},null,512)]),t("div",ft,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5404\u677F\u5757\u8D21\u732E\u7387\u5206\u6790",-1)),t("div",mt,[(f(!0),v(F,null,S(h.value,u=>(f(),v("div",{key:u.name,class:"p-4 border border-gray-200 rounded-lg"},[t("div",gt,[t("h4",bt,s(u.name),1),t("span",{class:x(["text-sm font-semibold",R(u.rate)])},s(u.rate)+"% ",3)]),t("div",ht,[t("div",{class:x(["h-2 rounded-full transition-all duration-300",L(u.rate)]),style:C(`width: ${Math.min(Math.abs(u.rate),100)}%`)},null,6)]),t("p",xt," \u8BA1\u5212: "+s(u.plan)+"% | \u5B9E\u9645: "+s(u.actual)+"% ",1)]))),128))])])])]))}});var Bt=Y(Et,[["__scopeId","data-v-ca15fb04"]]);export{Bt as default};
