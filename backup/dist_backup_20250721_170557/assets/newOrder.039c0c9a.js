import{_ as N,d as O,r as x,h as U,C as A,o as V,c as d,a as e,y as R,B as E,F as P,l as w,t as a,b as $,m as T,G as j,f as c,k as B}from"./index.8819bd40.js";import{_ as M,M as k,r as L}from"./FormAttachmentAndRemarks.dcfcaa75.js";const W={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},G={class:"flex justify-between items-center mb-6"},J={class:"flex items-center space-x-4"},z={class:"overflow-x-auto my-6"},H={class:"w-full border-collapse border border-gray-300"},K=["rowspan"],Q={class:"border border-gray-300 px-4 py-2"},X={class:"border border-gray-300 px-4 py-2 bg-gray-50"},Y={class:"text-sm font-medium"},Z={class:"border border-gray-300 px-4 py-2"},I=["onUpdate:modelValue"],ee={class:"border border-gray-300 px-4 py-2 bg-gray-50"},ue={class:"text-sm font-medium"},te={class:"border border-gray-300 px-4 py-2"},re={class:"text-sm font-medium"},oe=["rowspan"],ne={class:"border border-gray-300 px-4 py-2"},se={class:"border border-gray-300 px-4 py-2 bg-gray-50"},ae={class:"text-sm font-medium"},le={class:"border border-gray-300 px-4 py-2"},de=["onUpdate:modelValue"],ce={class:"border border-gray-300 px-4 py-2 bg-gray-50"},ye={class:"text-sm font-medium"},ie={class:"border border-gray-300 px-4 py-2"},pe={class:"text-sm font-medium"},me=["rowspan"],ve={class:"border border-gray-300 px-4 py-2"},ge={class:"border border-gray-300 px-4 py-2 bg-gray-50"},_e={class:"text-sm font-medium"},be={class:"border border-gray-300 px-4 py-2"},he=["onUpdate:modelValue"],xe={class:"border border-gray-300 px-4 py-2 bg-gray-50"},Re={class:"text-sm font-medium"},Ee={class:"border border-gray-300 px-4 py-2"},fe={class:"text-sm font-medium"},De={class:"bg-gray-50 font-bold"},Fe={class:"border border-gray-300 px-4 py-2 bg-gray-50"},Pe={class:"text-sm font-bold"},we={class:"border border-gray-300 px-4 py-2 bg-gray-50"},Be={class:"text-sm font-bold"},ke={class:"border border-gray-300 px-4 py-2 bg-gray-50"},Ce={class:"text-sm font-bold"},Ae={class:"border border-gray-300 px-4 py-2"},Se={class:"text-sm font-bold"},qe=O({__name:"newOrder",setup(Ne){var C;const p=j(),y=x(((C=p.query.period)==null?void 0:C.toString())||new Date().toISOString().slice(0,7)),f=()=>({equipment:[{customer:"\u4E0A\u6D77\u9879\u76EE",yearlyPlan:3e4,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u56FD\u7F51\u9879\u76EE",yearlyPlan:8e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u6C5F\u82CF\u9879\u76EE",yearlyPlan:5e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u8F93\u914D\u7535\u5185\u914D",yearlyPlan:4e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u897F\u95E8\u5B50\u9879\u76EE",yearlyPlan:5e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u540C\u4E1A\u9879\u76EE",yearlyPlan:5e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u7528\u6237\u9879\u76EE",yearlyPlan:5e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u5176\u5B83\u9879\u76EE",yearlyPlan:0,monthlyRevenue:0,cumulativeRevenue:0}],components:[{customer:"\u7528\u6237\u9879\u76EE",yearlyPlan:4e3,monthlyRevenue:0,cumulativeRevenue:0}],engineering:[{customer:"\u4E00\u5305\u9879\u76EE",yearlyPlan:3900,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u4E8C\u5305\u9879\u76EE",yearlyPlan:2200,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",yearlyPlan:5e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",yearlyPlan:1e3,monthlyRevenue:0,cumulativeRevenue:0},{customer:"\u5176\u5B83\u9879\u76EE",yearlyPlan:1900,monthlyRevenue:0,cumulativeRevenue:0}]}),l=x(f()),m=x(""),v=x(""),D=(r,t)=>!r||r===0?"0.00":(t/r*100).toFixed(2),i=r=>isNaN(r)||r===null||r===void 0?"0.00":r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),F=async()=>{console.log("\u5F53\u6708\u6536\u5165\u5DF2\u66F4\u65B0\uFF0C\u7D2F\u8BA1\u6536\u5165\u5C06\u5728\u4FDD\u5B58\u540E\u7531\u540E\u7AEF\u81EA\u52A8\u8BA1\u7B97")},_=U(()=>{const r={yearlyPlan:0,monthlyRevenue:0,cumulativeRevenue:0,progress:0};return[...l.value.equipment,...l.value.components,...l.value.engineering].forEach(u=>{r.yearlyPlan+=u.yearlyPlan||0,r.monthlyRevenue+=u.monthlyRevenue||0,r.cumulativeRevenue+=u.cumulativeRevenue||0}),r.progress=r.yearlyPlan>0?r.cumulativeRevenue/r.yearlyPlan*100:0,r.progress=parseFloat(r.progress.toFixed(2)),r}),b=async r=>{try{const t=await fetch(`http://47.111.95.19:3000/new-orders/${r}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const u=await t.json();if(u.data){const s=f();u.data.equipment&&(s.equipment=s.equipment.map(n=>{const o=u.data.equipment.find(g=>g.customer===n.customer);return{...n,yearlyPlan:(o==null?void 0:o.yearlyPlan)||n.yearlyPlan,monthlyRevenue:(o==null?void 0:o.currentPeriod)||0,cumulativeRevenue:(o==null?void 0:o.cumulativeTotal)||0}})),u.data.components&&(s.components=s.components.map(n=>{const o=u.data.components.find(g=>g.customer===n.customer);return{...n,yearlyPlan:(o==null?void 0:o.yearlyPlan)||n.yearlyPlan,monthlyRevenue:(o==null?void 0:o.currentPeriod)||0,cumulativeRevenue:(o==null?void 0:o.cumulativeTotal)||0}})),u.data.engineering&&(s.engineering=s.engineering.map(n=>{const o=u.data.engineering.find(g=>g.customer===n.customer);return{...n,yearlyPlan:(o==null?void 0:o.yearlyPlan)||n.yearlyPlan,monthlyRevenue:(o==null?void 0:o.currentPeriod)||0,cumulativeRevenue:(o==null?void 0:o.cumulativeTotal)||0}})),l.value=s}}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t)}},h=async r=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${k.NEW_ORDERS}/${r}`);if(t.ok){const u=await t.json();u.success&&u.data&&(m.value=u.data.remarks||"",v.value=u.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",t)}};A(()=>p.query.period,r=>{r&&(y.value=r.toString(),b(r.toString()),h(r.toString()))}),A(y,(r,t)=>{r&&r!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${r}`),b(r),h(r))});const S=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/new-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:y.value,data:{equipment:l.value.equipment.map(t=>({customer:t.customer,yearlyPlan:t.yearlyPlan,currentPeriod:t.monthlyRevenue})),components:l.value.components.map(t=>({customer:t.customer,yearlyPlan:t.yearlyPlan,currentPeriod:t.monthlyRevenue})),engineering:l.value.engineering.map(t=>({customer:t.customer,yearlyPlan:t.yearlyPlan,currentPeriod:t.monthlyRevenue}))}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await L(k.NEW_ORDERS,y.value,l.value,m.value,v.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(r){console.error("\u4FDD\u5B58\u5931\u8D25:",r),alert("\u4FDD\u5B58\u5931\u8D25")}},q=()=>{l.value=f(),m.value="",v.value=""};return V(()=>{p.query.period?(b(p.query.period.toString()),h(p.query.period.toString())):(b(y.value),h(y.value))}),(r,t)=>(c(),d("div",W,[e("div",G,[t[3]||(t[3]=e("h1",{class:"text-2xl font-bold"},"\u65B0\u7B7E\u8BA2\u5355\u7ED3\u6784\u4E0E\u8D28\u91CF\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),e("div",J,[R(e("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>y.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[E,y.value]])])]),e("div",z,[e("table",H,[t[5]||(t[5]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u6708\u6536\u5165"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u6536\u5165"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u6267\u884C\u8FDB\u5EA6")])],-1)),e("tbody",null,[(c(!0),d(P,null,w(l.value.equipment,(u,s)=>(c(),d("tr",{key:`equipment-${s}`},[s===0?(c(),d("td",{key:0,rowspan:l.value.equipment.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u8BBE\u5907 ",8,K)):B("",!0),e("td",Q,a(u.customer),1),e("td",X,[e("span",Y,a(i(u.yearlyPlan)),1)]),e("td",Z,[R(e("input",{"onUpdate:modelValue":n=>u.monthlyRevenue=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01",onInput:F},null,40,I),[[E,u.monthlyRevenue]])]),e("td",ee,[e("span",ue,a(i(u.cumulativeRevenue)),1)]),e("td",te,[e("span",re,a(D(u.yearlyPlan,u.cumulativeRevenue))+"%",1)])]))),128)),(c(!0),d(P,null,w(l.value.components,(u,s)=>(c(),d("tr",{key:`components-${s}`},[s===0?(c(),d("td",{key:0,rowspan:l.value.components.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5143\u4EF6 ",8,oe)):B("",!0),e("td",ne,a(u.customer),1),e("td",se,[e("span",ae,a(i(u.yearlyPlan)),1)]),e("td",le,[R(e("input",{"onUpdate:modelValue":n=>u.monthlyRevenue=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01",onInput:F},null,40,de),[[E,u.monthlyRevenue]])]),e("td",ce,[e("span",ye,a(i(u.cumulativeRevenue)),1)]),e("td",ie,[e("span",pe,a(D(u.yearlyPlan,u.cumulativeRevenue))+"%",1)])]))),128)),(c(!0),d(P,null,w(l.value.engineering,(u,s)=>(c(),d("tr",{key:`engineering-${s}`},[s===0?(c(),d("td",{key:0,rowspan:l.value.engineering.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,me)):B("",!0),e("td",ve,a(u.customer),1),e("td",ge,[e("span",_e,a(i(u.yearlyPlan)),1)]),e("td",be,[R(e("input",{"onUpdate:modelValue":n=>u.monthlyRevenue=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01",onInput:F},null,40,he),[[E,u.monthlyRevenue]])]),e("td",xe,[e("span",Re,a(i(u.cumulativeRevenue)),1)]),e("td",Ee,[e("span",fe,a(D(u.yearlyPlan,u.cumulativeRevenue))+"%",1)])]))),128)),e("tr",De,[t[4]||(t[4]=e("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),e("td",Fe,[e("span",Pe,a(i(_.value.yearlyPlan)),1)]),e("td",we,[e("span",Be,a(i(_.value.monthlyRevenue)),1)]),e("td",ke,[e("span",Ce,a(i(_.value.cumulativeRevenue)),1)]),e("td",Ae,[e("span",Se,a(_.value.progress)+"%",1)])])])])]),$(M,{"module-id":T(k).NEW_ORDERS,period:y.value,remarks:m.value,"onUpdate:remarks":t[1]||(t[1]=u=>m.value=u),suggestions:v.value,"onUpdate:suggestions":t[2]||(t[2]=u=>v.value=u)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:S,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:q,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var Ve=N(qe,[["__scopeId","data-v-40d724a4"]]);export{Ve as default};
