import{u as C,d as R,r as U,B as m,o as p,b as c,e as u,t as T,f as F,F as f,g as b,v as A}from"./index.403d91d0.js";async function du(r,l,t,s,n){var E;try{console.log("=== recordFormSubmission \u5F00\u59CB\u6267\u884C ===");const i=C(),N=(E=i.userInfo)==null?void 0:E.id;if(console.log("\u7528\u6237\u4FE1\u606F:",i.userInfo),console.log("\u7528\u6237ID:",N),!N)return console.warn("\u7528\u6237\u4FE1\u606F\u4E0D\u5B58\u5728\uFF0C\u8DF3\u8FC7\u63D0\u4EA4\u8BB0\u5F55"),!1;const d={userId:N,moduleId:r,period:l,formData:t,remarks:s,suggestions:n};console.log("\u53D1\u9001\u5230 /forms/submit \u7684\u6570\u636E:",d);const _=await fetch("http://47.111.95.19:3000/forms/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(console.log("API \u54CD\u5E94\u72B6\u6001:",_.status),console.log("API \u54CD\u5E94\u72B6\u6001\u6587\u672C:",_.statusText),!_.ok){const I=await _.text();return console.error("\u63D0\u4EA4\u8BB0\u5F55\u4FDD\u5B58\u5931\u8D25\uFF0C\u54CD\u5E94\u5185\u5BB9:",I),!1}const S=await _.json();return console.log("\u63D0\u4EA4\u8BB0\u5F55\u4FDD\u5B58\u6210\u529F\uFF0C\u54CD\u5E94\u6570\u636E:",S),console.log("=== recordFormSubmission \u6267\u884C\u5B8C\u6210 ==="),!0}catch(i){return console.error("=== recordFormSubmission \u6267\u884C\u5F02\u5E38 ===",i),!1}}const Tu={BALANCE_SHEET:1,CASH_FLOW:2,INCOME_STATEMENT:3,BUSINESS_INCOME_STRUCTURE:4,MAIN_BUSINESS_INCOME:5,ORDER_TO_INCOME:6,STOCK_ORDER_TO_INCOME:7,NON_MAIN_BUSINESS:8,COST_CENTER_STRUCTURE:9,BUSINESS_CONTRIBUTION:10,BUSINESS_PROFIT_MARGIN:11,NET_PROFIT_STRUCTURE:12,MAIN_BUSINESS_NET_PROFIT:13,NON_MAIN_BUSINESS_NET_PROFIT:14,RECEIPT_STRUCTURE:15,ACCOUNTS_RECEIVABLE:16,OVERDUE_RECEIVABLES:17,BAD_DEBT_PROVISION:18,MAIN_BUSINESS_COST:26,COST_ESTIMATION:27,NEW_ORDERS:19,PROJECT_TRACKING:20,BIDDING_STATUS:21,BID_FULFILLMENT:22,INVENTORY_STRUCTURE:23,INVENTORY_IN_PROGRESS:24,CONTRACT_INVENTORY:25,PRODUCTION_VALUE:28,PRODUCTION_PLAN_EXECUTION:29,PRODUCTION_EXECUTION_ANALYSIS:30,DEPARTMENT_COST_CENTER:31,DEPARTMENT_COST_INPUT:32,MAJOR_INVESTMENT_ANALYSIS:33,BUDGET_EXECUTION:34,BUDGET_PLANNING:35,EXAMPLE_CASH_FLOW:201,EXAMPLE_COST_CENTER:202,EXAMPLE_INCOME_STATEMENT:203,EXAMPLE_PRODUCTION_VALUE:204,EXAMPLE_PROJECT_TRACKING:205,EXAMPLE_BALANCE_SHEET:206,NANHUA_NEW_ORDERS:300,NANHUA_PROJECT_TRACKING:301,NANHUA_BIDDING_STATUS:302,NANHUA_BUSINESS_INCOME:303,NANHUA_ORDER_TO_INCOME:304,NANHUA_NON_MAIN_BUSINESS:305,NANHUA_STOCK_ORDER_TO_INCOME:306,NANHUA_INVENTORY_STRUCTURE:307,NANHUA_BID_FULFILLMENT:308,NANHUA_MAIN_BUSINESS_COST:309,NANHUA_CONTRACT_INVENTORY:310,NANHUA_COST_PROVISION:311,NANHUA_COST_CENTER_STRUCTURE:312,DEPARTMENT_COST_CENTER_ACTUAL:313,NANHUA_DEPARTMENT_COST_INPUT:314,NANHUA_BUSINESS_CONTRIBUTION_WITH_SELF_BUILT:315,NANHUA_BUSINESS_PROFIT_MARGIN_WITH_SELF_BUILT:316,NANHUA_RECEIPT_STRUCTURE:317,NANHUA_CONTRACT_INVENTORY_EVALUATION:318,NANHUA_MAIN_BUSINESS_NET_PROFIT:319,NANHUA_NON_MAIN_BUSINESS_NET_PROFIT:320,NANHUA_ANALYSIS_APPENDIX:321,NANHUA_OVERDUE_RECEIVABLES:322,NANHUA_SELF_CONSTRUCTION_ANALYSIS:323,NANHUA_BAD_DEBT_PROVISION:324,NANHUA_CONSTRUCTION_PLAN_EXECUTION:325,NANHUA_CONSTRUCTION_EXECUTION_STATUS:326,NANHUA_MAJOR_INVESTMENT:327,TUOYUAN_NEW_ORDER_STRUCTURE:401,TUOYUAN_PROJECT_TRACKING:402,TUOYUAN_BIDDING_STATUS:403,MAIN_BUSINESS_INCOME_BREAKDOWN:404,TUOYUAN_ORDER_TO_INCOME:405,STOCK_ORDER_TO_INCOME:406,TUOYUAN_NON_MAIN_BUSINESS:407,TUOYUAN_INVENTORY_STRUCTURE:408,TUOYUAN_BID_FULFILLMENT:409,TUOYUAN_INVENTORY_IN_PROGRESS:410,TUOYUAN_INVENTORY_STATUS:411,TUOYUAN_MAIN_BUSINESS_COST_STRUCTURE_QUALITY:412,TUOYUAN_COST_ESTIMATION:413,TUOYUAN_COST_CENTER_PROFIT_LOSS:414,TUOYUAN_MAIN_BUSINESS_CONTRIBUTION_RATE:415,TUOYUAN_MAIN_BUSINESS_PROFIT_MARGIN:416,TUOYUAN_MAIN_BUSINESS_NET_PROFIT_CONTRIBUTION:417,PAYMENT_STRUCTURE_QUALITY:418,TUOYUAN_ACCOUNTS_RECEIVABLE:419,TUOYUAN_OVERDUE_RECEIVABLES:420,TUOYUAN_BAD_DEBT_PROVISION:421,TUOYUAN_CONSTRUCTION_PLAN_EXECUTION:422,TUOYUAN_MAJOR_INVESTMENT:423,TUOYUAN_MAIN_BUSINESS_PRODUCTION_VALUE_SELF_CONSTRUCTION:424,TUOYUAN_CONSTRUCTION_EXECUTION_STATUS:425};async function B(r,l,t,s){var n;try{const i=(n=C().userInfo)==null?void 0:n.id;if(!i)throw new Error("\u7528\u6237\u4FE1\u606F\u4E0D\u5B58\u5728");console.log("\u4E0A\u4F20\u6587\u4EF6\u4FE1\u606F:",{fileName:r.name,fileSize:r.size,fileType:r.type,moduleId:l,period:t,userId:i,description:s});const N=new FormData;N.append("file",r),N.append("moduleId",l.toString()),N.append("period",t),N.append("userId",i.toString()),s&&N.append("description",s);const d=await fetch("http://47.111.95.19:3000/files/upload",{method:"POST",body:N});if(console.log("\u4E0A\u4F20\u54CD\u5E94\u72B6\u6001:",d.status),!d.ok){const S=await d.text();throw console.error("\u4E0A\u4F20\u5931\u8D25\u54CD\u5E94:",S),new Error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25")}const _=await d.json();return console.log("\u4E0A\u4F20\u6210\u529F\u54CD\u5E94:",_),_.data}catch(E){throw console.error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25:",E),E}}async function D(r,l){try{const t=await fetch(`http://47.111.95.19:3000/files/attachments/${r}/${l}`);if(!t.ok)throw new Error("\u83B7\u53D6\u9644\u4EF6\u5217\u8868\u5931\u8D25");return(await t.json()).data||[]}catch(t){return console.error("\u83B7\u53D6\u9644\u4EF6\u5217\u8868\u5931\u8D25:",t),[]}}async function y(r){var l;try{const s=(l=C().userInfo)==null?void 0:l.id;if(!s)throw new Error("\u7528\u6237\u4FE1\u606F\u4E0D\u5B58\u5728");if(!(await fetch(`http://47.111.95.19:3000/files/delete/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s})})).ok)throw new Error("\u6587\u4EF6\u5220\u9664\u5931\u8D25");return!0}catch(t){return console.error("\u6587\u4EF6\u5220\u9664\u5931\u8D25:",t),!1}}async function h(r,l){var t,s;try{const n=await fetch(`http://47.111.95.19:3000/forms/submission/${r}/${l}`);if(n.status===404)return{remarks:"",suggestions:""};if(!n.ok)throw new Error("\u83B7\u53D6\u5907\u6CE8\u4FE1\u606F\u5931\u8D25");const E=await n.json();return{remarks:((t=E.data)==null?void 0:t.remarks)||"",suggestions:((s=E.data)==null?void 0:s.suggestions)||""}}catch(n){return console.error("\u83B7\u53D6\u5907\u6CE8\u4FE1\u606F\u5931\u8D25:",n),{remarks:"",suggestions:""}}}async function cu(r,l){return await h(r,l)}const x={class:"mt-8 bg-white border border-gray-200 rounded-lg shadow-sm"},v={class:"border-b border-gray-200 px-6 py-4 bg-gray-50"},M={class:"flex items-center justify-between"},P={class:"inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200"},L={class:"p-6 space-y-6"},w={class:"border border-gray-200 rounded-lg"},Y={class:"p-4"},H={class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors duration-200"},k={class:"space-y-4"},V={class:"text-sm text-gray-600"},G={for:"file-upload",class:"relative cursor-pointer font-medium text-blue-600 hover:text-blue-500"},X={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},j={class:"flex items-center justify-between"},J={class:"text-sm font-medium text-gray-900"},$={class:"text-xs text-gray-500"},K=["disabled"],W={key:0,class:"border border-gray-200 rounded-lg"},z={class:"divide-y divide-gray-200"},Q={class:"flex items-center justify-between"},q={class:"flex-1 min-w-0"},Z={class:"flex items-center space-x-3"},uu={class:"text-sm font-medium text-gray-900 truncate"},eu={class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800"},tu={class:"mt-1 text-xs text-gray-500 space-x-4"},su={key:0,class:"mt-2 text-xs text-gray-600 bg-gray-50 rounded px-3 py-1"},ou={class:"flex items-center space-x-2 ml-4"},ru=["href"],nu=["onClick"],au={class:"border border-gray-200 rounded-lg"},lu={class:"p-4"},Eu={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},_u=["value"],iu=["value"],Au=R({__name:"FormAttachmentAndRemarks",props:{moduleId:{},period:{},remarks:{},suggestions:{}},emits:["update:remarks","update:suggestions"],setup(r,{emit:l}){const t=r,s=U(null),n=U(!1),E=U([]),i=U(null),N=o=>{const e=o.target;e.files&&e.files.length>0&&(s.value=e.files[0])},d=async()=>{if(!!s.value){n.value=!0;try{await B(s.value,t.moduleId,t.period,`\u6A21\u5757${t.moduleId}\u76F8\u5173\u6587\u4EF6`),s.value=null,i.value&&(i.value.value=""),await _(),alert("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F")}catch(o){console.error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25:",o),alert("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25")}finally{n.value=!1}}},_=async()=>{try{E.value=await D(t.moduleId,t.period)}catch(o){console.error("\u52A0\u8F7D\u9644\u4EF6\u5217\u8868\u5931\u8D25:",o)}},S=async o=>{if(!!confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u6587\u4EF6\u5417\uFF1F"))try{await y(o)&&(await _(),alert("\u6587\u4EF6\u5220\u9664\u6210\u529F"))}catch(e){console.error("\u6587\u4EF6\u5220\u9664\u5931\u8D25:",e),alert("\u6587\u4EF6\u5220\u9664\u5931\u8D25")}},I=o=>{if(o===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],O=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,O)).toFixed(2))+" "+a[O]},g=o=>new Date(o).toLocaleString("zh-CN");return m(()=>t.period,()=>{_()}),p(()=>{_()}),(o,e)=>(A(),c("div",x,[u("div",v,[u("div",M,[e[2]||(e[2]=u("h3",{class:"text-lg font-semibold text-gray-900"},"\u9644\u4EF6\u548C\u5907\u6CE8",-1)),u("span",P," \u5171 "+T(E.value.length)+" \u4E2A\u9644\u4EF6 ",1)])]),u("div",L,[u("div",w,[e[6]||(e[6]=u("div",{class:"border-b border-gray-200 px-4 py-3 bg-gray-50"},[u("h4",{class:"text-sm font-medium text-gray-900"},"\u6587\u4EF6\u4E0A\u4F20")],-1)),u("div",Y,[u("div",H,[u("div",k,[u("div",V,[u("label",G,[e[3]||(e[3]=u("span",null,"\u70B9\u51FB\u9009\u62E9\u6587\u4EF6",-1)),u("input",{id:"file-upload",ref_key:"fileInput",ref:i,type:"file",onChange:N,class:"sr-only",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.txt"},null,544)]),e[4]||(e[4]=u("span",{class:"ml-1"},"\u6216\u62D6\u62FD\u6587\u4EF6\u5230\u6B64\u5904",-1))]),e[5]||(e[5]=u("p",{class:"text-xs text-gray-500"},"\u652F\u6301\u683C\u5F0F\uFF1APDF\u3001DOC\u3001DOCX\u3001XLS\u3001XLSX\u3001JPG\u3001PNG\u3001GIF\u3001TXT",-1))])]),s.value?(A(),c("div",X,[u("div",j,[u("div",null,[u("p",J,T(s.value.name),1),u("p",$,"\u6587\u4EF6\u5927\u5C0F\uFF1A"+T(I(s.value.size)),1)]),u("button",{onClick:d,disabled:n.value,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200"},T(n.value?"\u4E0A\u4F20\u4E2D...":"\u786E\u8BA4\u4E0A\u4F20"),9,K)])])):F("",!0)])]),E.value.length>0?(A(),c("div",W,[e[7]||(e[7]=u("div",{class:"border-b border-gray-200 px-4 py-3 bg-gray-50"},[u("h4",{class:"text-sm font-medium text-gray-900"},"\u5DF2\u4E0A\u4F20\u6587\u4EF6")],-1)),u("div",z,[(A(!0),c(f,null,b(E.value,a=>(A(),c("div",{key:a.id,class:"p-4 hover:bg-gray-50 transition-colors duration-150"},[u("div",Q,[u("div",q,[u("div",Z,[u("h5",uu,T(a.original_name),1),u("span",eu,T(I(a.file_size)),1)]),u("div",tu,[u("span",null,"\u4E0A\u4F20\u65F6\u95F4\uFF1A"+T(g(a.uploaded_at)),1),u("span",null,"\u4E0A\u4F20\u4EBA\uFF1A"+T(a.uploaded_by),1)]),a.description?(A(),c("div",su,T(a.description),1)):F("",!0)]),u("div",ou,[u("a",{href:`http://47.111.95.19:3000/files/download/${a.id}`,target:"_blank",class:"px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-150"}," \u4E0B\u8F7D ",8,ru),u("button",{onClick:O=>S(a.id),class:"px-3 py-1.5 text-xs font-medium text-red-700 bg-red-50 border border-red-200 rounded hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-150"}," \u5220\u9664 ",8,nu)])])]))),128))])])):F("",!0),u("div",au,[e[10]||(e[10]=u("div",{class:"border-b border-gray-200 px-4 py-3 bg-gray-50"},[u("h4",{class:"text-sm font-medium text-gray-900"},"\u7BA1\u7406\u5206\u6790\u4E0E\u5EFA\u8BAE")],-1)),u("div",lu,[u("div",Eu,[u("div",null,[e[8]||(e[8]=u("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"\u7BA1\u7406\u5206\u6790",-1)),u("textarea",{value:o.remarks,onInput:e[0]||(e[0]=a=>o.$emit("update:remarks",a.target.value)),rows:"5",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200",placeholder:"\u8981\u6C42\u586B\u5199\u5BF9\u5F53\u524D\u6570\u636E\u7684\u603B\u7ED3\u548C\u8BF4\u660E"},null,40,_u)]),u("div",null,[e[9]||(e[9]=u("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"\u5EFA\u8BAE\u4FE1\u606F",-1)),u("textarea",{value:o.suggestions,onInput:e[1]||(e[1]=a=>o.$emit("update:suggestions",a.target.value)),rows:"5",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200",placeholder:"\u8981\u6C42\u586B\u5199\u76F8\u5173\u6539\u8FDB\u610F\u89C1\u548C\u4F18\u5316\u63AA\u65BD\u7B49"},null,40,iu)])])])])])]))}});export{Tu as M,Au as _,cu as l,du as r};
