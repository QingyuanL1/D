import{_ as F,d as C,r as g,h as S,B as D,o as w,c as b,a as t,y as f,A as v,F as R,l as k,t as a,b as T,m as P,G as U,f as x}from"./index.da96efc3.js";import{_ as O,M as _,r as I}from"./FormAttachmentAndRemarks.ceb20ed9.js";const M={class:"max-w-[1600px] mx-auto bg-white rounded-lg shadow-lg p-6"},$={class:"flex justify-between items-center mb-6"},j={class:"flex items-center space-x-4"},q={class:"overflow-x-auto my-6"},J={class:"w-full border-collapse border border-gray-300"},V={class:"border border-gray-300 px-4 py-2 font-medium"},H={class:"border border-gray-300 px-4 py-2 text-right"},L={class:"border border-gray-300 px-4 py-2"},G=["onUpdate:modelValue"],z={class:"border border-gray-300 px-4 py-2 text-right"},K={class:"border border-gray-300 px-4 py-2 text-right"},Q={class:"text-sm font-medium"},W={class:"border border-gray-300 px-4 py-2 text-right"},X={class:"text-sm font-medium"},Y={class:"bg-gray-50 font-bold"},Z={class:"border border-gray-300 px-4 py-2 text-right"},tt={class:"border border-gray-300 px-4 py-2 text-right"},et={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"border border-gray-300 px-4 py-2 text-right"},ut={class:"text-sm font-bold"},at={class:"border border-gray-300 px-4 py-2 text-right"},ot={class:"text-sm font-bold"},st=C({__name:"DepartmentCostInput",setup(nt){var h;const l=U(),o=g(((h=l.query.period)==null?void 0:h.toString())||new Date().toISOString().slice(0,7)),A={departments:[{departmentName:"\u603B\u7ECF\u7406\u5BA4",yearlyBudget:361.36,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u7EFC\u5408\u90E8",yearlyBudget:461.45,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8D22\u52A1\u90E8",yearlyBudget:93.07,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u5B89\u8D28\u90E8",yearlyBudget:116,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u5DE5\u7A0B\u90E8",yearlyBudget:821.07,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8FD0\u68C0\u90E8",yearlyBudget:569.9,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0},{departmentName:"\u8425\u9500\u90E8",yearlyBudget:1048.86,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0}]},d=g(JSON.parse(JSON.stringify(A))),c=g(""),p=g(""),s=r=>r===0?"0.00":r.toFixed(2),i=S(()=>{const r={yearlyBudget:0,currentAmount:0,accumulatedAmount:0,executionProgress:0,actualRatio:0};return d.value.departments.forEach(e=>{r.yearlyBudget+=e.yearlyBudget||0,r.currentAmount+=e.currentAmount||0,r.accumulatedAmount+=e.accumulatedAmount||0}),r.executionProgress=r.yearlyBudget>0?r.accumulatedAmount/r.yearlyBudget*100:0,r.actualRatio=0,r}),m=async r=>{try{const e=await fetch(`http://47.111.95.19:3000/nanhua-department-cost-input/${r}`);if(!e.ok){if(e.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const u=await e.json();u.data&&u.data.departments&&(d.value.departments=u.data.departments.map(n=>({departmentName:n.departmentName,yearlyBudget:Number(n.yearlyBudget)||0,currentAmount:Number(n.currentAmount)||0,accumulatedAmount:Number(n.accumulatedAmount)||0,executionProgress:Number(n.executionProgress)||0,actualRatio:Number(n.actualRatio)||0})))}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e)}},y=async r=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${_.NANHUA_DEPARTMENT_COST_INPUT}/${r}`);if(e.ok){const u=await e.json();u.success&&u.data&&(c.value=u.data.remarks||"",p.value=u.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};D(()=>l.query.period,async r=>{r&&(o.value=r.toString(),await m(r.toString()),y(r.toString()))}),D(o,async(r,e)=>{r&&r!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${r}`),await m(r),y(r))});const E=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-department-cost-input",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:o.value,data:{departments:d.value.departments}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await I(_.NANHUA_DEPARTMENT_COST_INPUT,o.value,{departments:d.value.departments},c.value,p.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(r){console.error("\u4FDD\u5B58\u5931\u8D25:",r),alert("\u4FDD\u5B58\u5931\u8D25")}},B=()=>{d.value=JSON.parse(JSON.stringify(A)),c.value="",p.value=""};return w(async()=>{l.query.period?(await m(l.query.period.toString()),y(l.query.period.toString())):(await m(o.value),y(o.value))}),(r,e)=>(x(),b("div",M,[t("div",$,[e[4]||(e[4]=t("h1",{class:"text-2xl font-bold"},"\u4E0A\u6D77\u5357\u534E\u5B9E\u4E1A\u516C\u53F8 - \u90E8\u95E8\u6210\u672C\u4E2D\u5FC3\u8BA1\u5165\u635F\u76CA\u60C5\u51B5",-1)),t("div",j,[e[3]||(e[3]=t("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>o.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[v,o.value]])])]),t("div",q,[t("table",J,[e[8]||(e[8]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u90E8\u95E8\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u9884\u7B97"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u6267\u884C\u8FDB\u5EA6"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u9884\u7B97\u5360\u4EA7\u503C\u6BD4"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5B9E\u9645\u5360\u4EA7\u503C\u6BD4")])],-1)),t("tbody",null,[(x(!0),b(R,null,k(d.value.departments,(u,n)=>(x(),b("tr",{key:`department-${n}`},[t("td",V,a(u.departmentName),1),t("td",H,a(s(u.yearlyBudget)),1),t("td",L,[f(t("input",{"onUpdate:modelValue":N=>u.currentAmount=N,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,G),[[v,u.currentAmount]])]),t("td",z,a(s(u.accumulatedAmount)),1),t("td",K,[t("span",Q,a(s(u.executionProgress))+"%",1)]),e[5]||(e[5]=t("td",{class:"border border-gray-300 px-4 py-2 text-right"}," / ",-1)),t("td",W,[t("span",X,a(s(u.actualRatio))+"%",1)])]))),128)),t("tr",Y,[e[6]||(e[6]=t("td",{class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),t("td",Z,a(s(i.value.yearlyBudget)),1),t("td",tt,a(s(i.value.currentAmount)),1),t("td",et,a(s(i.value.accumulatedAmount)),1),t("td",rt,[t("span",ut,a(s(i.value.executionProgress))+"%",1)]),e[7]||(e[7]=t("td",{class:"border border-gray-300 px-4 py-2 text-right"}," / ",-1)),t("td",at,[t("span",ot,a(s(i.value.actualRatio))+"%",1)])])])])]),T(O,{"module-id":P(_).NANHUA_DEPARTMENT_COST_INPUT,period:o.value,remarks:c.value,"onUpdate:remarks":e[1]||(e[1]=u=>c.value=u),suggestions:p.value,"onUpdate:suggestions":e[2]||(e[2]=u=>p.value=u)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:E,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:B,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ct=F(st,[["__scopeId","data-v-340de856"]]);export{ct as default};
