import{_ as L,d as W,u as G,r as b,c as w,B as H,o as J,b as r,e as t,y as B,A as Q,z as V,F as x,g as h,t as l,f as D,x as M,p as X,v as a,m as U,l as $}from"./index.da884363.js";const Y={class:"p-6 bg-gray-50 min-h-screen"},Z={class:"max-w-7xl mx-auto"},ee={class:"bg-white p-6 rounded-lg shadow-sm mb-6"},te={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},se=["value"],ue=["disabled"],oe=["value"],ne={key:0,class:"text-green-600"},re={class:"mt-6 flex items-center space-x-4"},ae=["disabled"],ie={key:0,class:"text-sm text-gray-600"},le={key:0,class:"text-green-600"},de={key:0,class:"text-xs mt-1"},ce={key:1,class:"text-orange-600"},_e={class:"bg-white rounded-lg shadow-sm mb-6"},me={class:"px-6 py-4 border-b border-gray-200"},pe={class:"text-sm text-gray-600 mt-1"},be={class:"p-6"},ve={key:0,class:"text-center py-8 text-gray-500"},ge={key:1,class:"text-center py-8 text-gray-500"},ye={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},xe=["onClick"],he={class:"flex items-start justify-between"},fe={class:"flex-1"},Fe={class:"font-medium text-gray-900 text-sm"},we={class:"text-xs text-gray-600 mt-1"},De=["onClick"],ke={class:"bg-white rounded-lg shadow-sm"},Ee={class:"p-6"},Ce={key:0,class:"text-center py-8 text-gray-500"},Ae={key:1,class:"space-y-6"},Be={class:"text-md font-semibold text-gray-800 mb-3 flex items-center"},Me={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},$e=["onClick"],Se={class:"flex items-center justify-between"},je={class:"flex-1"},Ie={class:"font-medium text-gray-900 text-sm"},Pe={class:"text-xs text-gray-600 mt-1"},Ve={class:"mt-2 flex flex-col text-xs space-y-1"},Ue={key:0,class:"text-green-600"},Te={key:1,class:"text-orange-600"},qe={key:2,class:"text-gray-500"},ze={class:"ml-3"},Ne=["onClick"],Oe=W({__name:"index",setup(Re){const k=X(),f=G(),S=b([]),F=b([]),E=b([]),C=b(!0),d=b((()=>{const s=new Date;return s.setMonth(s.getMonth()-1),s.toISOString().slice(0,7)})()),v=b(""),c=b(null),A=w(()=>S.value.filter(s=>s.permission_type==="write")),T=w(()=>[...new Set(A.value.map(e=>e.module_category))].sort()),q=w(()=>v.value?A.value.filter(s=>s.module_category===v.value):[]),j=w(()=>{const s=new Map;A.value.forEach(n=>{s.has(n.module_category)||s.set(n.module_category,[]),s.get(n.module_category).push(n)});const e=[];return s.forEach((n,i)=>{e.push({name:i,modules:n.sort((u,o)=>{const _=u.display_order||999,p=o.display_order||999;return _!==p?_-p:u.module_name.localeCompare(o.module_name)})})}),e.sort((n,i)=>n.name.localeCompare(i.name))}),m=s=>s?F.value.some(e=>e.module_id===s.id&&e.period===d.value):!1,g=s=>s?F.value.find(e=>e.module_id===s.id&&e.period===d.value):null,z=async()=>{var s;try{const e=((s=f.userInfo)==null?void 0:s.id)||1,n=await fetch(`http://47.111.95.19:3000/permissions/user/${e}`);if(!n.ok)throw new Error("\u83B7\u53D6\u7528\u6237\u6743\u9650\u5931\u8D25");const i=await n.json();i.success&&(S.value=i.data.accessible_modules||[])}catch(e){console.error("\u83B7\u53D6\u7528\u6237\u6A21\u5757\u5931\u8D25:",e)}},I=async()=>{var s,e,n;try{const i=((s=f.userInfo)==null?void 0:s.id)||1,u=await fetch(`http://47.111.95.19:3000/forms/status/${d.value}?userId=${i}`);if(!u.ok)throw new Error("\u83B7\u53D6\u63D0\u4EA4\u8BB0\u5F55\u5931\u8D25");const o=await u.json();o.success&&((e=o.data)==null?void 0:e.modules)&&(F.value=o.data.modules.filter(_=>{var p;return((p=_.submission_status)==null?void 0:p.status)==="submitted"}).map(_=>({module_id:_.module_id,period:d.value,submitted_at:_.submission_status.submitted_at,last_submitted_by:_.submission_status.last_submitted_by,submission_count:_.submission_status.submission_count})))}catch(i){console.error("\u83B7\u53D6\u63D0\u4EA4\u8BB0\u5F55\u5931\u8D25:",i);try{const u=await fetch(`http://47.111.95.19:3000/permissions/user/${((n=f.userInfo)==null?void 0:n.id)||1}/submissions?period=${d.value}`);if(u.ok){const o=await u.json();o.success&&(F.value=o.data||[])}}catch(u){console.error("\u56DE\u9000API\u4E5F\u5931\u8D25:",u)}}},P=async()=>{var s;try{const e=((s=f.userInfo)==null?void 0:s.id)||1,n=await fetch(`http://47.111.95.19:3000/permissions/user/${e}/pending-forms?period=${d.value}`);if(!n.ok)throw new Error("\u83B7\u53D6\u5F85\u63D0\u4EA4\u8868\u5355\u5931\u8D25");const i=await n.json();i.success&&(E.value=i.data||[])}catch(e){console.error("\u83B7\u53D6\u5F85\u63D0\u4EA4\u8868\u5355\u5931\u8D25:",e)}},N=()=>{c.value=null},O=()=>{},R=()=>{c.value&&y(c.value)},y=s=>{const e={"/example/CostCenterStructure":"/cost-center-structure","/example/BalanceSheet":"/example","/example/CashFlowStatement":"/cashflow","/example/IncomeStatement":"/incomestatement","/example/ProductionValue":"/production-value","/example/ProjectTracking":"/projecttracking","/Users/yaowenya/Desktop/\u5927\u4E9A\u53D1\u5C55\u96C6\u56E2/financial-analytics-platform/src/views/submit/index.vue":"/budget-execution"},n={balance_sheet:"/example",cash_flow:"/cashflow",income_statement:"/incomestatement",cost_center_structure:"/cost-center-structure-quality",production_value:"/production-value",project_tracking:"/projecttracking",business_income_structure:"/business-income-structure",main_business_income:"/main-business-income",order_to_income:"/order-to-income",stock_order_to_income:"/stock-order-to-income",non_main_business:"/non-main-business",business_contribution:"/business-contribution",business_profit_margin:"/business-profit-margin",net_profit_structure:"/net-profit-structure",main_business_net_profit:"/main-business-net-profit",non_main_business_net_profit:"/non-main-business-net-profit",receipt_structure:"/receipt-structure",accounts_receivable:"/accounts-receivable",overdue_receivables:"/overdue-receivables",bad_debt_provision:"/bad-debt-provision",new_orders:"/new-orders",bidding_status:"/bidding-status",bid_fulfillment:"/bid-fulfillment",inventory_structure:"/inventory-structure",inventory_in_progress:"/inventory-in-progress",main_business_cost:"/main-business-cost",contract_inventory:"/contract-inventory",cost_estimation:"/cost-estimation",production_value_analysis:"/production-value-analysis",production_plan_execution:"/production-plan-execution",production_execution_analysis:"/production-execution-analysis",department_cost_center:"/department-cost-center",department_cost_input:"/department-cost-input",major_investment_analysis:"/major-investment-analysis",budget_execution:"/budget-execution"};if(n[s.module_key]){console.log(`\u901A\u8FC7key\u6620\u5C04\u5BFC\u822A\u5230\u6A21\u5757: ${s.module_name}, \u8DEF\u5F84: ${n[s.module_key]}`),k.push({path:n[s.module_key],query:{period:d.value}});return}if(s.route_path&&s.route_path!=="/"){const i=e[s.route_path]||s.route_path;console.log(`\u901A\u8FC7\u8DEF\u5F84\u5BFC\u822A\u5230\u6A21\u5757: ${s.module_name}, \u8DEF\u5F84: ${i}`),k.push({path:i,query:{period:d.value}})}else{const i=s.module_key.replace(/_/g,"-");console.log(`\u901A\u8FC7\u751F\u6210\u8DEF\u5F84\u5BFC\u822A\u5230\u6A21\u5757: ${s.module_name}, \u8DEF\u5F84: /${i}`),k.push({path:`/${i}`,query:{period:d.value}})}},K=async()=>{C.value=!0,await Promise.all([z(),I(),P()]),C.value=!1};return H(d,()=>{I(),P()}),J(()=>{K()}),(s,e)=>{var n,i;return a(),r("div",Y,[t("div",Z,[e[14]||(e[14]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"\u63D0\u4EA4\u8868\u5355"),t("p",{class:"text-gray-600 mt-2"},"\u9009\u62E9\u9700\u8981\u586B\u5199\u7684\u8868\u5355\u6A21\u5757")],-1)),t("div",ee,[t("div",te,[t("div",null,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"\u9009\u62E9\u671F\u95F4",-1)),B(t("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>d.value=u),type:"month",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[Q,d.value]])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"\u9009\u62E9\u5206\u7C7B",-1)),B(t("select",{"onUpdate:modelValue":e[1]||(e[1]=u=>v.value=u),onChange:N,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[e[4]||(e[4]=t("option",{value:""},"\u8BF7\u9009\u62E9\u5206\u7C7B",-1)),(a(!0),r(x,null,h(T.value,u=>(a(),r("option",{key:u,value:u},l(u),9,se))),128))],544),[[V,v.value]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"\u9009\u62E9\u8868\u5355",-1)),B(t("select",{"onUpdate:modelValue":e[2]||(e[2]=u=>c.value=u),onChange:O,disabled:!v.value,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100"},[e[6]||(e[6]=t("option",{value:""},"\u8BF7\u9009\u62E9\u8868\u5355",-1)),(a(!0),r(x,null,h(q.value,u=>(a(),r("option",{key:u.id,value:u},[M(l(u.module_name)+" ",1),m(u)?(a(),r("span",ne,"(\u5DF2\u63D0\u4EA4)")):D("",!0)],8,oe))),128))],40,ue),[[V,c.value]])])]),t("div",re,[t("button",{onClick:R,disabled:!c.value,class:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},l(m(c.value)?"\u7F16\u8F91\u8868\u5355":"\u586B\u5199\u8868\u5355"),9,ae),c.value?(a(),r("div",ie,[m(c.value)?(a(),r("div",le,[e[8]||(e[8]=t("div",null,"\u2713 \u5F53\u524D\u671F\u95F4\u5DF2\u63D0\u4EA4",-1)),g(c.value)?(a(),r("div",de," \u6700\u540E\u63D0\u4EA4\u4EBA: "+l(((n=g(c.value))==null?void 0:n.last_submitted_by)||"\u7CFB\u7EDF")+" ("+l(((i=g(c.value))==null?void 0:i.submission_count)||1)+"\u6B21\u63D0\u4EA4) ",1)):D("",!0)])):(a(),r("span",ce," \u26A0 \u5F53\u524D\u671F\u95F4\u672A\u63D0\u4EA4 "))])):D("",!0)])]),t("div",_e,[t("div",me,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold text-gray-900"},"\u672C\u6708\u5F85\u63D0\u4EA4\u8868\u5355",-1)),t("p",pe,"\u5F53\u524D\u671F\u95F4: "+l(d.value),1)]),t("div",be,[C.value?(a(),r("div",ve,e[10]||(e[10]=[t("div",{class:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"},null,-1),M(" \u52A0\u8F7D\u4E2D... ")]))):E.value.length===0?(a(),r("div",ge,e[11]||(e[11]=[t("svg",{class:"w-12 h-12 mx-auto mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),t("p",null,"\u606D\u559C\uFF01\u5F53\u524D\u671F\u95F4\u6240\u6709\u8868\u5355\u90FD\u5DF2\u63D0\u4EA4",-1)]))):(a(),r("div",ye,[(a(!0),r(x,null,h(E.value,u=>(a(),r("div",{key:u.id,class:"p-4 border border-red-200 bg-red-50 rounded-lg hover:border-red-300 hover:shadow-sm transition-all cursor-pointer",onClick:o=>y(u)},[t("div",he,[t("div",fe,[t("h5",Fe,l(u.module_name),1),t("p",we,l(u.module_category),1),e[12]||(e[12]=t("p",{class:"text-xs text-red-600 mt-2"},"\u5F85\u63D0\u4EA4",-1))]),t("button",{onClick:U(o=>y(u),["stop"]),class:"px-3 py-1 bg-red-600 text-white text-xs rounded-md hover:bg-red-700 transition-colors"}," \u586B\u5199 ",8,De)])],8,xe))),128))]))])]),t("div",ke,[e[13]||(e[13]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"\u53EF\u586B\u5199\u7684\u8868\u5355\u5217\u8868")],-1)),t("div",Ee,[j.value.length===0?(a(),r("div",Ce," \u6682\u65E0\u53EF\u586B\u5199\u7684\u8868\u5355 ")):(a(),r("div",Ae,[(a(!0),r(x,null,h(j.value,u=>(a(),r("div",{key:u.name,class:"border rounded-lg p-4"},[t("h4",Be,[t("span",{class:$(["w-3 h-3 rounded-full mr-2",{"bg-blue-500":u.name==="\u8D22\u52A1","bg-green-500":u.name==="\u8425\u9500","bg-yellow-500":u.name==="\u751F\u4EA7","bg-purple-500":u.name==="\u4F01\u7BA1"}])},null,2),M(" "+l(u.name)+" ("+l(u.modules.length)+" \u4E2A\u6A21\u5757) ",1)]),t("div",Me,[(a(!0),r(x,null,h(u.modules,o=>{var _;return a(),r("div",{key:o.id,class:$(["p-3 border rounded-lg hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer",{"border-gray-200":!m(o),"border-green-200 bg-green-50":m(o)}]),onClick:p=>y(o)},[t("div",Se,[t("div",je,[t("h5",Ie,l(o.module_name),1),t("p",Pe,l(o.description),1),t("div",Ve,[m(o)?(a(),r("span",Ue," \u2713 "+l(d.value)+" \u5DF2\u63D0\u4EA4 ",1)):(a(),r("span",Te," \u26A0 "+l(d.value)+" \u672A\u63D0\u4EA4 ",1)),g(o)?(a(),r("span",qe," \u6700\u540E\u63D0\u4EA4: "+l(((_=g(o))==null?void 0:_.last_submitted_by)||"\u7CFB\u7EDF"),1)):D("",!0)])]),t("div",ze,[t("button",{onClick:U(p=>y(o),["stop"]),class:$(["px-2 py-1 text-xs rounded-md transition-colors",{"bg-blue-600 text-white hover:bg-blue-700":!m(o),"bg-green-600 text-white hover:bg-green-700":m(o)}])},l(m(o)?"\u7F16\u8F91":"\u586B\u5199"),11,Ne)])])],10,$e)}),128))])]))),128))]))])])])])}}});var Le=L(Oe,[["__scopeId","data-v-fc5b9d72"]]);export{Le as default};
