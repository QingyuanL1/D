import{_ as L,d as $,r as l,o as k,a as Y,b as v,e as u,y as j,z as N,F as B,g as D,t as c,C as M,v as m,l as _,j as V}from"./index.da884363.js";import{i as I,L as O}from"./index.0a005eaa.js";const U={class:"p-6 bg-gray-50 min-h-screen"},W={class:"max-w-7xl mx-auto"},G={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},T={class:"flex items-center justify-between"},q={class:"flex items-center space-x-3"},H=["value"],J={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},K={class:"flex justify-between items-center mb-6"},P={class:"text-lg font-semibold text-gray-900"},Q={class:"bg-white rounded-lg shadow-sm p-6"},X={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Z={class:"flex justify-between items-center mb-3"},ee={class:"font-medium text-gray-900"},te={class:"w-full bg-gray-200 rounded-full h-2 mb-2"},ae={class:"text-xs text-gray-600"},ue=$({__name:"ContributionRateChart",setup(le){const o=l(new Date().getFullYear().toString()),p=l([]),E=l(!0),f=l(null),r=l(null),F=l(21.98),d=l(0),s=l([]),n=l([]),i=l([{name:"\u8BBE\u5907",plan:25.5,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:22.8,actual:0,rate:0}]),g=t=>t.toLocaleString("zh-CN",{maximumFractionDigits:2}),w=t=>t>=20?"text-green-600":t>=15?"text-blue-600":t>=10?"text-yellow-600":"text-red-600",S=t=>t>=20?"bg-green-500":t>=15?"bg-blue-500":t>=10?"bg-yellow-500":"bg-red-500",C=()=>{const t=new Date().getFullYear(),a=[];for(let e=0;e<5;e++)a.push((t-e).toString());p.value=a},h=async()=>{try{E.value=!0,await A(),R()}catch(t){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",t),setDefaultData()}finally{E.value=!1}},A=async()=>{try{const t=await fetch(`http://47.111.95.19:3000/analytics/contribution-rate/${o.value}`);if(t.ok){const a=await t.json();a.success&&a.data?a.data.hasData===!1?(s.value=[],n.value=[],d.value=0,i.value=a.data.segmentData||[{name:"\u8BBE\u5907",plan:25.5,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:22.8,actual:0,rate:0}]):(s.value=a.data.months||[],n.value=a.data.monthlyData||[],d.value=a.data.currentRate||0,a.data.segmentData&&(i.value=a.data.segmentData.map(e=>({name:e.name,plan:e.plan,actual:e.actual,rate:e.rate})))):(s.value=[],n.value=[],d.value=0,i.value=[{name:"\u8BBE\u5907",plan:25.5,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:22.8,actual:0,rate:0}])}else s.value=[],n.value=[],d.value=0,i.value=[{name:"\u8BBE\u5907",plan:25.5,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:22.8,actual:0,rate:0}]}catch(t){console.error("\u83B7\u53D6\u8FB9\u9645\u8D21\u732E\u7387\u6570\u636E\u5931\u8D25:",t),s.value=[],n.value=[],d.value=0,i.value=[{name:"\u8BBE\u5907",plan:25.5,actual:0,rate:0},{name:"\u5143\u4EF6",plan:15,actual:0,rate:0},{name:"\u5DE5\u7A0B",plan:22.8,actual:0,rate:0}]}},z=()=>{f.value&&(r.value=I(f.value))},R=()=>{if(!r.value)return;if(s.value.length===0||n.value.length===0){const e={title:{text:`${o.value}\u5E74\u6682\u65E0\u8FB9\u9645\u8D21\u732E\u7387\u6570\u636E`,textStyle:{fontSize:16,fontWeight:"bold",color:"#9CA3AF"},left:"center",top:"middle"},graphic:{type:"text",left:"center",top:"60%",style:{text:"\u8BF7\u9009\u62E9\u5176\u4ED6\u5E74\u4EFD\u67E5\u770B\u6570\u636E",fontSize:14,fill:"#9CA3AF"}}};r.value.setOption(e,!0);return}const t=s.value.map(()=>F.value),a={title:{text:`${o.value}\u5E74\u8FB9\u9645\u8D21\u732E\u7387\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(e){let b=`${e[0].name}<br/>`;return e.forEach(y=>{b+=`${y.seriesName}: ${g(y.value)}%<br/>`}),b}},legend:{top:40,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:s.value,axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u767E\u5206\u6BD4(%)",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(e){return g(e)+"%"},fontSize:12}},series:[{name:"\u5B9E\u9645\u8D21\u732E\u7387",type:"line",data:n.value,smooth:!0,lineStyle:{color:"#3B82F6",width:3},itemStyle:{color:"#3B82F6"},areaStyle:{color:new O(0,0,0,1,[{offset:0,color:"#3B82F640"},{offset:1,color:"#3B82F610"}])}},{name:"\u8BA1\u5212\u76EE\u6807\u7EBF",type:"line",data:t,lineStyle:{color:"#EF4444",width:2,type:"dashed"},itemStyle:{color:"#EF4444"},symbol:"none"}]};r.value.setOption(a,!0)},x=()=>{var t;(t=r.value)==null||t.resize()};return k(async()=>{C(),z(),await h(),window.addEventListener("resize",x)}),Y(()=>{var t;(t=r.value)==null||t.dispose(),window.removeEventListener("resize",x)}),(t,a)=>(m(),v("div",U,[u("div",W,[a[5]||(a[5]=u("div",{class:"mb-8"},[u("h1",{class:"text-3xl font-bold text-gray-900"},"\u8FB9\u9645\u8D21\u732E\u7387\u5206\u6790"),u("p",{class:"text-gray-600 mt-2"},"\u4E3B\u8425\u4E1A\u52A1\u8FB9\u9645\u8D21\u732E\u7387\u7ED3\u6784\u4E0E\u8D28\u91CF\u5206\u6790")],-1)),u("div",G,[u("div",T,[a[2]||(a[2]=u("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),u("div",q,[a[1]||(a[1]=u("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),j(u("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),onChange:h,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(m(!0),v(B,null,D(p.value,e=>(m(),v("option",{key:e,value:e},c(e)+"\u5E74",9,H))),128))],544),[[N,o.value]])])])]),u("div",J,[u("div",K,[u("h3",P,c(o.value)+"\u5E74\u8FB9\u9645\u8D21\u732E\u7387\u6708\u5EA6\u8D8B\u52BF",1),a[3]||(a[3]=M('<div class="flex items-center space-x-4" data-v-54caf9e0><div class="flex items-center" data-v-54caf9e0><div class="w-4 h-4 bg-blue-500 rounded mr-2" data-v-54caf9e0></div><span class="text-sm text-gray-600" data-v-54caf9e0>\u5B9E\u9645\u8D21\u732E\u7387</span></div><div class="flex items-center" data-v-54caf9e0><div class="w-4 h-4 bg-red-500 rounded mr-2" data-v-54caf9e0></div><span class="text-sm text-gray-600" data-v-54caf9e0>\u8BA1\u5212\u76EE\u6807\u7EBF</span></div></div>',1))]),u("div",{class:"h-[400px]",ref_key:"chartRef",ref:f},null,512)]),u("div",Q,[a[4]||(a[4]=u("h3",{class:"text-lg font-semibold text-gray-900 mb-6"},"\u5404\u677F\u5757\u8D21\u732E\u7387\u5206\u6790",-1)),u("div",X,[(m(!0),v(B,null,D(i.value,e=>(m(),v("div",{key:e.name,class:"p-4 border border-gray-200 rounded-lg"},[u("div",Z,[u("h4",ee,c(e.name),1),u("span",{class:_(["text-sm font-semibold",w(e.rate)])},c(e.rate)+"% ",3)]),u("div",te,[u("div",{class:_(["h-2 rounded-full transition-all duration-300",S(e.rate)]),style:V(`width: ${Math.min(Math.abs(e.rate),100)}%`)},null,6)]),u("p",ae," \u8BA1\u5212: "+c(e.plan)+"% | \u5B9E\u9645: "+c(e.actual)+"% ",1)]))),128))])])])]))}});var oe=L(ue,[["__scopeId","data-v-54caf9e0"]]);export{oe as default};
