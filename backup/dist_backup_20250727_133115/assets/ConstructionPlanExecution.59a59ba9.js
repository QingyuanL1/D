import{_ as F,d as N,r as y,h as w,C,o as B,c as h,a as o,y as p,B as d,F as S,l as U,t as m,b as Q,m as k,G as O,f,k as V}from"./index.d001ed47.js";import{_ as I,M as x,r as $}from"./FormAttachmentAndRemarks.e157dde2.js";const j={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},J={class:"flex justify-between items-center mb-6"},L={class:"flex items-center space-x-4"},M={class:"overflow-x-auto my-6"},q={class:"w-full border-collapse border border-gray-300"},H=["rowspan"],X={class:"border border-gray-300 px-4 py-2"},G={class:"border border-gray-300 px-4 py-2"},z=["onUpdate:modelValue"],K={class:"border border-gray-300 px-4 py-2"},P=["onUpdate:modelValue"],W={class:"border border-gray-300 px-4 py-2"},Y=["onUpdate:modelValue"],Z={class:"border border-gray-300 px-4 py-2"},ee=["onUpdate:modelValue"],te={class:"bg-gray-50 font-bold"},ae={class:"border border-gray-300 px-4 py-2 text-right"},oe={class:"border border-gray-300 px-4 py-2 text-right"},ne={class:"border border-gray-300 px-4 py-2 text-right"},ue={class:"border border-gray-300 px-4 py-2 text-right"},re=N({__name:"ConstructionPlanExecution",setup(se){var A;const v=O(),n=y(((A=v.query.period)==null?void 0:A.toString())||new Date().toISOString().slice(0,7)),E={items:[{customerAttribute:"\u4E00\u5305\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{customerAttribute:"\u4E8C\u5305\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{customerAttribute:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{customerAttribute:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{customerAttribute:"\u65B0\u80FD\u6E90\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{customerAttribute:"\u82CF\u5DDE\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{customerAttribute:"\u62A2\u4FEE\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},{customerAttribute:"\u8FD0\u68C0\u9879\u76EE",annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0}]},r=y(JSON.parse(JSON.stringify(E))),l=y(""),c=y(""),g=e=>e===0?"0.00":e.toFixed(2),b=w(()=>{const e={annualTarget:0,onTimeCompletionRate:0,acceptanceQualificationRate:0,planAchievementRate:0},t=r.value.items.filter(a=>a.annualTarget>0||a.onTimeCompletionRate>0||a.acceptanceQualificationRate>0||a.planAchievementRate>0);return t.length===0||(t.forEach(a=>{e.annualTarget+=a.annualTarget||0,e.onTimeCompletionRate+=a.onTimeCompletionRate||0,e.acceptanceQualificationRate+=a.acceptanceQualificationRate||0,e.planAchievementRate+=a.planAchievementRate||0}),e.onTimeCompletionRate=e.onTimeCompletionRate/t.length,e.acceptanceQualificationRate=e.acceptanceQualificationRate/t.length,e.planAchievementRate=e.planAchievementRate/t.length),e}),R=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/nanhua-construction-plan-execution/${e}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log(`${e}\u671F\u95F4\u65E0\u6570\u636E\uFF0C\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u72B6\u6001`),i();return}const a=await t.json();a.data&&a.data.items&&(r.value.items=a.data.items.map(u=>({customerAttribute:u.customerAttribute,annualTarget:Number(u.annualTarget)||0,onTimeCompletionRate:Number(u.onTimeCompletionRate)||0,acceptanceQualificationRate:Number(u.acceptanceQualificationRate)||0,planAchievementRate:Number(u.planAchievementRate)||0})))}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t),i()}},i=()=>{r.value=JSON.parse(JSON.stringify(E))},_=async e=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${x.NANHUA_CONSTRUCTION_PLAN_EXECUTION}/${e}`);if(t.ok){const a=await t.json();a.success&&a.data&&(l.value=a.data.remarks||"",c.value=a.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",t)}};C(()=>v.query.period,async e=>{e&&(n.value=e.toString(),i(),await R(e.toString()),_(e.toString()))}),C(n,async(e,t)=>{e&&e!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${e}`),i(),await R(e),_(e))});const T=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-construction-plan-execution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:n.value,data:{items:r.value.items}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await $(x.NANHUA_CONSTRUCTION_PLAN_EXECUTION,n.value,{items:r.value.items},l.value,c.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25")}},D=()=>{i(),l.value="",c.value=""};return B(async()=>{var t;i();const e=((t=v.query.period)==null?void 0:t.toString())||n.value;await R(e),_(e)}),(e,t)=>(f(),h("div",j,[o("div",J,[t[4]||(t[4]=o("h1",{class:"text-2xl font-bold"},"\u65BD\u5DE5\u8BA1\u5212\u6267\u884C\u60C5\u51B5\uFF08\u53EF\u4FEE\u8BA2\uFF09",-1)),o("div",L,[t[3]||(t[3]=o("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A%\uFF09",-1)),p(o("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),type:"month",class:"px-3 py-2 border rounded"},null,512),[[d,n.value]])])]),o("div",M,[o("table",q,[t[6]||(t[6]=o("thead",{class:"sticky top-0 bg-white"},[o("tr",{class:"bg-gray-50"},[o("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u76EE\u6807"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u51C6\u65F6\u5B8C\u5DE5\u7387"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u9A8C\u6536\u5408\u683C\u7387"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u8BA1\u5212\u8FBE\u6210\u7387")])],-1)),o("tbody",null,[(f(!0),h(S,null,U(r.value.items,(a,u)=>(f(),h("tr",{key:`item-${u}`},[u===0?(f(),h("td",{key:0,rowspan:r.value.items.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,H)):V("",!0),o("td",X,m(a.customerAttribute),1),o("td",G,[p(o("input",{"onUpdate:modelValue":s=>a.annualTarget=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,z),[[d,a.annualTarget]])]),o("td",K,[p(o("input",{"onUpdate:modelValue":s=>a.onTimeCompletionRate=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,P),[[d,a.onTimeCompletionRate]])]),o("td",W,[p(o("input",{"onUpdate:modelValue":s=>a.acceptanceQualificationRate=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Y),[[d,a.acceptanceQualificationRate]])]),o("td",Z,[p(o("input",{"onUpdate:modelValue":s=>a.planAchievementRate=s,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,ee),[[d,a.planAchievementRate]])])]))),128)),o("tr",te,[t[5]||(t[5]=o("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),o("td",ae,m(g(b.value.annualTarget)),1),o("td",oe,m(g(b.value.onTimeCompletionRate)),1),o("td",ne,m(g(b.value.acceptanceQualificationRate)),1),o("td",ue,m(g(b.value.planAchievementRate)),1)])])])]),Q(I,{"module-id":k(x).NANHUA_CONSTRUCTION_PLAN_EXECUTION,period:n.value,remarks:l.value,"onUpdate:remarks":t[1]||(t[1]=a=>l.value=a),suggestions:c.value,"onUpdate:suggestions":t[2]||(t[2]=a=>c.value=a)},null,8,["module-id","period","remarks","suggestions"]),o("div",{class:"mt-4 flex justify-end space-x-4"},[o("button",{onClick:T,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),o("button",{onClick:D,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ce=F(re,[["__scopeId","data-v-075bc25f"]]);export{ce as default};
