import{_ as A,d as I,r as E,h as w,C as f,o as k,c as l,a as r,y as F,B as D,F as C,l as U,t as n,b as P,m as T,G as O,f as c,k as L}from"./index.d001ed47.js";import{_ as $,M as v,r as H}from"./FormAttachmentAndRemarks.e157dde2.js";const R={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},V={class:"flex justify-between items-center mb-6"},W={class:"flex items-center space-x-4"},j={class:"overflow-x-auto my-6"},q={class:"w-full border-collapse border border-gray-300"},J=["rowspan"],M={class:"border border-gray-300 px-4 py-2"},G={key:0,class:"ml-4"},z={key:1},K={class:"border border-gray-300 px-4 py-2 text-right"},Q={class:"border border-gray-300 px-4 py-2"},X=["onUpdate:modelValue"],Y={class:"border border-gray-300 px-4 py-2 text-right"},Z={class:"bg-gray-50 font-bold"},ee={class:"border border-gray-300 px-4 py-2 text-right"},te={class:"border border-gray-300 px-4 py-2 text-right"},re={class:"border border-gray-300 px-4 py-2 text-right"},ue=I({__name:"BusinessIncomeWithSelfBuilt",setup(se){var x;const d=O(),s=E(((x=d.query.period)==null?void 0:x.toString())||new Date().toISOString().slice(0,7)),_={customers:[{customerName:"\u4E00\u5305\u9879\u76EE",yearlyPlan:26.52,current:0,deviation:0},{customerName:"\u4E8C\u5305\u9879\u76EE",yearlyPlan:18,current:0,deviation:0},{customerName:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",yearlyPlan:8,current:0,deviation:0},{customerName:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",yearlyPlan:5.48,current:0,deviation:0},{customerName:"\u65B0\u80FD\u6E90\u9879\u76EE",yearlyPlan:25,current:0,deviation:0},{customerName:"\u82CF\u5DDE\u9879\u76EE",yearlyPlan:6,current:0,deviation:0},{customerName:"\u62A2\u4FEE",yearlyPlan:100,current:0,deviation:0},{customerName:"\u8FD0\u68C0",yearlyPlan:30,current:0,deviation:0},{customerName:"\u81EA\u5EFA\u9879\u76EE",yearlyPlan:0,current:0,deviation:0}]},a=E(JSON.parse(JSON.stringify(_))),i=E(""),y=E(""),p=t=>t===0?"0.00%":t.toFixed(2)+"%",h=(t,e)=>(e||0)-(t||0),m=w(()=>{const t={yearlyPlan:0,current:0};return a.value.customers.forEach(e=>{t.yearlyPlan+=e.yearlyPlan||0,t.current+=e.current||0}),t.yearlyPlan=t.yearlyPlan/a.value.customers.length,t.current=t.current/a.value.customers.length,t}),g=async t=>{try{const e=await fetch(`http://47.111.95.19:3000/nanhua-business-contribution-with-self-built/${t}`);if(!e.ok){if(e.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const u=await e.json();u.data&&u.data.customers&&(a.value.customers=u.data.customers.map(o=>({customerName:o.customerName,yearlyPlan:Number(o.yearlyPlan)||0,current:Number(o.current)||0,deviation:Number(o.deviation)||0})))}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e)}},b=async t=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${v.NANHUA_BUSINESS_CONTRIBUTION_WITH_SELF_BUILT}/${t}`);if(e.ok){const u=await e.json();u.success&&u.data&&(i.value=u.data.remarks||"",y.value=u.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};f(()=>d.query.period,t=>{t&&(s.value=t.toString(),g(t.toString()),b(t.toString()))}),f(s,(t,e)=>{t&&t!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${t}`),g(t),b(t))});const N=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-business-contribution-with-self-built",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:s.value,data:a.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await H(v.NANHUA_BUSINESS_CONTRIBUTION_WITH_SELF_BUILT,s.value,a.value,i.value,y.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},B=()=>{a.value=JSON.parse(JSON.stringify(_)),i.value="",y.value=""};return k(()=>{d.query.period?(g(d.query.period.toString()),b(d.query.period.toString())):(g(s.value),b(s.value))}),(t,e)=>(c(),l("div",R,[r("div",V,[e[4]||(e[4]=r("h1",{class:"text-2xl font-bold"},"\u4E3B\u8425\u4E1A\u52A1\u8FB9\u9645\u8D21\u732E\u7387\u7ED3\u6784\u4E0E\u8D28\u91CF",-1)),r("div",W,[e[3]||(e[3]=r("span",{class:"text-sm text-gray-600"},"\uFF08\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3\uFF09",-1)),F(r("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>s.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[D,s.value]])])]),e[7]||(e[7]=r("div",{class:"mb-4 text-sm font-medium text-gray-700"}," \u5BF9\u5E94\u4E3B\u8425\u6536\u5165\uFF1A ",-1)),r("div",j,[r("table",q,[e[6]||(e[6]=r("thead",{class:"sticky top-0 bg-white"},[r("tr",{class:"bg-gray-50"},[r("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u5B9E\u9645"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u504F\u5DEE")])],-1)),r("tbody",null,[(c(!0),l(C,null,U(a.value.customers,(u,o)=>(c(),l("tr",{key:`customer-${o}`},[o===0?(c(),l("td",{key:0,rowspan:a.value.customers.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,J)):L("",!0),r("td",M,[["\u62A2\u4FEE","\u8FD0\u68C0","\u81EA\u5EFA\u9879\u76EE"].includes(u.customerName)?(c(),l("span",G,n(u.customerName),1)):(c(),l("span",z,n(u.customerName),1))]),r("td",K,n(p(u.yearlyPlan)),1),r("td",Q,[F(r("input",{"onUpdate:modelValue":S=>u.current=S,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",max:"100"},null,8,X),[[D,u.current]])]),r("td",Y,n(p(h(u.yearlyPlan,u.current))),1)]))),128)),r("tr",Z,[e[5]||(e[5]=r("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),r("td",ee,n(p(m.value.yearlyPlan)),1),r("td",te,n(p(m.value.current)),1),r("td",re,n(p(h(m.value.yearlyPlan,m.value.current))),1)])])])]),P($,{"module-id":T(v).NANHUA_BUSINESS_CONTRIBUTION_WITH_SELF_BUILT,period:s.value,remarks:i.value,"onUpdate:remarks":e[1]||(e[1]=u=>i.value=u),suggestions:y.value,"onUpdate:suggestions":e[2]||(e[2]=u=>y.value=u)},null,8,["module-id","period","remarks","suggestions"]),r("div",{class:"mt-4 flex justify-end space-x-4"},[r("button",{onClick:N,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),r("button",{onClick:B,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ne=A(ue,[["__scopeId","data-v-2ea393f3"]]);export{ne as default};
