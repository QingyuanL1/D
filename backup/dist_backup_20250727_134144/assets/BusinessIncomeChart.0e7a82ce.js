import{_ as G,d as H,r,o as J,j as K,c as y,a as e,y as Q,z as X,F as S,l as A,t as c,f as x,q as I,n as P}from"./index.37f627aa.js";import{i as R,L as Z}from"./index.0a005eaa.js";const ee={class:"p-6 bg-gray-50 min-h-screen"},te={class:"max-w-7xl mx-auto"},se={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},ae={class:"flex items-center justify-between"},oe={class:"flex items-center space-x-3"},ne=["value"],ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},le={class:"text-lg font-semibold text-gray-900 mb-4"},re={class:"space-y-3"},ie={class:"flex justify-between"},ce={class:"font-medium text-blue-600"},de={class:"flex justify-between"},me={class:"font-medium text-green-600"},fe={class:"flex justify-between"},ve={class:"w-full bg-gray-200 rounded-full h-2"},ge={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},he={class:"flex justify-between items-center mb-6"},pe={class:"text-lg font-semibold text-gray-900"},ye={class:"bg-white rounded-lg shadow-sm p-6"},xe={class:"text-lg font-semibold text-gray-900 mb-6"},be={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},_e={class:"space-y-4"},Ee={class:"space-y-2"},we={class:"flex items-center"},De={class:"text-sm font-medium text-gray-900"},Be={class:"text-right"},Ce={class:"text-sm font-medium text-gray-900"},Fe={class:"text-xs text-gray-500"},Se=H({__name:"BusinessIncomeChart",setup(Ae){const v=r(new Date().getFullYear().toString()),z=r([]),M=r(!0),B=r(null),C=r(null),b=r(null),_=r(null),E={main:{name:"\u4E3B\u8425\u4E1A\u52A1",color:"#3B82F6",progressColor:"bg-blue-600"},nonMain:{name:"\u975E\u4E3B\u8425\u4E1A\u52A1",color:"#10B981",progressColor:"bg-green-600"}},D=r([]),d=r({}),m=r({}),g=r([]),T=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],h=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),j=s=>T[s%T.length],O=s=>s>=90?"text-green-600":s>=70?"text-blue-600":s>=50?"text-yellow-600":"text-red-600",W=()=>{const s=new Date().getFullYear(),t=[];for(let a=0;a<5;a++)t.push((s-a).toString());z.value=t},L=async()=>{try{M.value=!0,await Y(),await N(),U()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s)}finally{M.value=!1}},F=()=>{D.value=[],d.value={},m.value={},g.value=[]},Y=async()=>{var s,t,a,o,n,u,l,w;try{const f=await fetch(`http://47.111.95.19:3000/analytics/business-income/${v.value}`);if(f.ok){const i=await f.json();if(i.success&&i.data){D.value=i.data.months||[],d.value=i.data.monthlyData||{};const p={main:59400,nonMain:600};m.value={main:{yearlyPlan:p.main,currentTotal:((t=(s=i.data.summary)==null?void 0:s.main)==null?void 0:t.currentTotal)||0,completion_rate:(o=(a=i.data.summary)==null?void 0:a.main)!=null&&o.currentTotal?Math.round(i.data.summary.main.currentTotal/p.main*100):0},nonMain:{yearlyPlan:p.nonMain,currentTotal:((u=(n=i.data.summary)==null?void 0:n.nonMain)==null?void 0:u.currentTotal)||0,completion_rate:(w=(l=i.data.summary)==null?void 0:l.nonMain)!=null&&w.currentTotal?Math.round(i.data.summary.nonMain.currentTotal/p.nonMain*100):0}},d.value.main&&(d.value.main.yearlyPlan=p.main),d.value.nonMain&&(d.value.nonMain.yearlyPlan=p.nonMain)}else F()}else F()}catch(f){console.error("\u83B7\u53D6\u8425\u4E1A\u6536\u5165\u6570\u636E\u5931\u8D25:",f),F()}},N=async()=>{try{const s=[];let t=0;Object.keys(E).forEach(a=>{const o=m.value[a],n=E[a];o&&o.currentTotal>0&&(s.push({name:n.name,value:o.currentTotal}),t+=o.currentTotal)}),g.value=s.map(a=>({...a,percentage:t>0?Number((a.value/t*100).toFixed(1)):0}))}catch(s){console.error("\u751F\u6210\u997C\u56FE\u6570\u636E\u5931\u8D25:",s),g.value=[]}},k=()=>{B.value&&(b.value=R(B.value)),C.value&&(_.value=R(C.value))},U=()=>{V(),q()},V=()=>{if(!b.value)return;const s=[],t=D.value.length>0&&Object.keys(d.value).length>0;t&&Object.keys(E).forEach((o,n)=>{const u=d.value[o],l=E[o];u&&s.push({name:`${l.name}`,type:"line",data:u.currentTotal,smooth:!0,lineStyle:{color:l.color,width:3},itemStyle:{color:l.color},areaStyle:{color:new Z(0,0,0,1,[{offset:0,color:l.color+"40"},{offset:1,color:l.color+"10"}])}})});const a={title:{text:`${v.value}\u5E74\u8425\u4E1A\u6536\u5165\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(o){if(!t)return"\u6682\u65E0\u6570\u636E";let n=`${o[0].name}<br/>`;return o.forEach(u=>{n+=`${u.seriesName}: ${h(u.value)} \u4E07\u5143<br/>`}),n}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:t?D.value:[],axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u4E07\u5143",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(o){return h(o)},fontSize:12}},series:t?s:[],graphic:t?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};b.value.setOption(a,!0)},q=()=>{if(!_.value)return;const s=g.value.length>0,t={title:{text:"\u6536\u5165\u7ED3\u6784\u5360\u6BD4",textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"item",formatter:function(a){return s?`${a.name}<br/>\u6570\u503C: ${h(a.value)} \u4E07\u5143<br/>\u5360\u6BD4: ${a.percent}%`:"\u6682\u65E0\u6570\u636E"}},legend:{orient:"vertical",left:"left",top:"middle",textStyle:{fontSize:12},show:s},series:[{name:"\u6536\u5165\u7ED3\u6784\u5360\u6BD4",type:"pie",radius:["30%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},labelLine:{show:!1},data:s?g.value.map((a,o)=>({value:a.value,name:a.name,itemStyle:{color:j(o)}})):[]}],graphic:s?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};_.value.setOption(t,!0)},$=()=>{var s,t;(s=b.value)==null||s.resize(),(t=_.value)==null||t.resize()};return J(async()=>{W(),k(),await L(),window.addEventListener("resize",$)}),K(()=>{var s,t;(s=b.value)==null||s.dispose(),(t=_.value)==null||t.dispose(),window.removeEventListener("resize",$)}),(s,t)=>(x(),y("div",ee,[e("div",te,[t[8]||(t[8]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"\u8425\u4E1A\u6536\u5165\u6570\u636E\u5206\u6790"),e("p",{class:"text-gray-600 mt-2"},"\u5E74\u5EA6\u8BA1\u5212\u4E0E\u5F53\u671F\u7D2F\u8BA1\u5BF9\u6BD4\u5206\u6790")],-1)),e("div",se,[e("div",ae,[t[2]||(t[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),e("div",oe,[t[1]||(t[1]=e("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),Q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),onChange:L,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(x(!0),y(S,null,A(z.value,a=>(x(),y("option",{key:a,value:a},c(a)+"\u5E74",9,ne))),128))],544),[[X,v.value]])])])]),e("div",ue,[(x(),y(S,null,A(E,(a,o)=>{var n,u,l,w,f;return e("div",{key:o,class:"bg-white rounded-lg shadow-sm p-6"},[e("h3",le,c(a.name),1),e("div",re,[e("div",ie,[t[3]||(t[3]=e("span",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212:",-1)),e("span",ce,c(h(((n=m.value[o])==null?void 0:n.yearlyPlan)||0))+" \u4E07\u5143",1)]),e("div",de,[t[4]||(t[4]=e("span",{class:"text-sm text-gray-600"},"\u5F53\u671F\u7D2F\u8BA1:",-1)),e("span",me,c(h(((u=m.value[o])==null?void 0:u.currentTotal)||0))+" \u4E07\u5143",1)]),e("div",fe,[t[5]||(t[5]=e("span",{class:"text-sm text-gray-600"},"\u6267\u884C\u7387:",-1)),e("span",{class:I(["font-medium",O(((l=m.value[o])==null?void 0:l.completion_rate)||0)])},c(((w=m.value[o])==null?void 0:w.completion_rate)||0)+"% ",3)]),e("div",ve,[e("div",{class:I(["h-2 rounded-full transition-all duration-500",a.progressColor]),style:P(`width: ${Math.min(((f=m.value[o])==null?void 0:f.completion_rate)||0,100)}%`)},null,6)])])])}),64))]),e("div",ge,[e("div",he,[e("h3",pe,c(v.value)+"\u5E74\u6708\u5EA6\u8D8B\u52BF\u5BF9\u6BD4",1),t[6]||(t[6]=e("div",{class:"flex items-center space-x-4"},[e("div",{class:"flex items-center"},[e("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),e("span",{class:"text-sm text-gray-600"},"\u6708\u5EA6\u53D8\u5316\u8D8B\u52BF")])],-1))]),e("div",{class:"h-[500px]",ref_key:"chartRef",ref:B},null,512)]),e("div",ye,[e("h3",xe,c(v.value)+"\u5E74\u8425\u4E1A\u6536\u5165\u7ED3\u6784\u5360\u6BD4\u5206\u6790",1),e("div",be,[e("div",{class:"h-[350px]",ref_key:"pieChartRef",ref:C},null,512),e("div",_e,[t[7]||(t[7]=e("h4",{class:"text-md font-medium text-gray-800"},"\u5360\u6BD4\u8BE6\u60C5",-1)),e("div",Ee,[(x(!0),y(S,null,A(g.value,(a,o)=>(x(),y("div",{key:o,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",we,[e("div",{class:"w-3 h-3 rounded-full mr-3",style:P(`background-color: ${j(o)}`)},null,4),e("span",De,c(a.name),1)]),e("div",Be,[e("div",Ce,c(h(a.value))+" \u4E07\u5143",1),e("div",Fe,c(a.percentage)+"%",1)])]))),128))])])])])])]))}});var Te=G(Se,[["__scopeId","data-v-647fc7fe"]]);export{Te as default};
