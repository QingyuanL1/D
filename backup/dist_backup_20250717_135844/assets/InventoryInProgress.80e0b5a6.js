import{_ as q,d as R,r as m,c as V,B as w,o as O,b as l,e as t,y as F,A as I,F as f,g as E,t as s,k as U,h as $,G,v as y,f as D}from"./index.e5d3bc04.js";import{_ as M,M as N,r as L}from"./FormAttachmentAndRemarks.eb96265a.js";const Y={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},P={class:"flex justify-between items-center mb-6"},z={class:"flex items-center space-x-4"},J={class:"overflow-x-auto my-6"},H={class:"w-full border-collapse border border-gray-300"},K=["rowspan"],Q={class:"border border-gray-300 px-4 py-2"},W={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},X={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],ee={class:"border border-gray-300 px-4 py-2 text-right"},oe=["rowspan"],re={class:"border border-gray-300 px-4 py-2"},te={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},ue={class:"border border-gray-300 px-4 py-2"},ne=["onUpdate:modelValue"],se={class:"border border-gray-300 px-4 py-2 text-right"},ae=["rowspan"],le={class:"border border-gray-300 px-4 py-2"},ye={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},ce={class:"border border-gray-300 px-4 py-2"},de=["onUpdate:modelValue"],pe={class:"border border-gray-300 px-4 py-2 text-right"},me={class:"bg-gray-50 font-bold"},ge={class:"border border-gray-300 px-4 py-2 text-right"},ie={class:"border border-gray-300 px-4 py-2 text-right"},he={class:"border border-gray-300 px-4 py-2 text-right"},be=R({__name:"InventoryInProgress",setup(_e){var C;const g=G(),a=m(((C=g.query.period)==null?void 0:C.toString())||new Date().toISOString().slice(0,7)),i=m(""),h=m(""),T=()=>({equipment:[{customerType:"\u4E0A\u6D77",yearlyBudget:0,monthlyIncome:0},{customerType:"\u56FD\u7F51",yearlyBudget:0,monthlyIncome:0},{customerType:"\u6C5F\u82CF",yearlyBudget:0,monthlyIncome:0},{customerType:"\u8F93\u914D\u7535\u5185\u914D",yearlyBudget:0,monthlyIncome:0},{customerType:"\u897F\u95E8\u5B50",yearlyBudget:0,monthlyIncome:0},{customerType:"\u540C\u4E1A",yearlyBudget:0,monthlyIncome:0},{customerType:"\u7528\u6237",yearlyBudget:0,monthlyIncome:0},{customerType:"\u5176\u5B83",yearlyBudget:0,monthlyIncome:0}],component:[{customerType:"\u7528\u6237",yearlyBudget:0,monthlyIncome:0}],project:[{customerType:"\u4E00\u5305",yearlyBudget:0,monthlyIncome:0},{customerType:"\u4E8C\u5305",yearlyBudget:0,monthlyIncome:0},{customerType:"\u57DF\u5185\u5408\u4F5C",yearlyBudget:0,monthlyIncome:0},{customerType:"\u57DF\u5916\u5408\u4F5C",yearlyBudget:0,monthlyIncome:0},{customerType:"\u5176\u5B83",yearlyBudget:0,monthlyIncome:0}]}),k=(o,e)=>(!e||typeof e!="object"||(e.equipment&&Array.isArray(e.equipment)&&(o.equipment=o.equipment.map(r=>{const u=e.equipment.find(n=>n.customerType===r.customerType);return u?{...r,yearlyBudget:Number(u.yearlyPlan)||Number(u.yearlyBudget)||0,monthlyIncome:Number(u.monthlyIncome)||Number(u.currentAmount)||0}:r})),e.component&&Array.isArray(e.component)&&(o.component=o.component.map(r=>{const u=e.component.find(n=>n.customerType===r.customerType);return u?{...r,yearlyBudget:Number(u.yearlyPlan)||Number(u.yearlyBudget)||0,monthlyIncome:Number(u.monthlyIncome)||Number(u.currentAmount)||0}:r})),e.project&&Array.isArray(e.project)&&(o.project=o.project.map(r=>{const u=e.project.find(n=>n.customerType===r.customerType);return u?{...r,yearlyBudget:Number(u.yearlyPlan)||Number(u.yearlyBudget)||0,monthlyIncome:Number(u.monthlyIncome)||Number(u.currentAmount)||0}:r}))),o),A=()=>{const o=T();c.value=o.equipment,d.value=o.component,p.value=o.project},c=m([]),d=m([]),p=m([]),_=(o,e)=>e===0?"0.00":(o/e*100).toFixed(2),v=V(()=>{const o={yearlyBudget:0,monthlyIncome:0};return c.value.forEach(e=>{o.yearlyBudget+=Number(e.yearlyBudget)||0,o.monthlyIncome+=Number(e.monthlyIncome)||0}),d.value.forEach(e=>{o.yearlyBudget+=Number(e.yearlyBudget)||0,o.monthlyIncome+=Number(e.monthlyIncome)||0}),p.value.forEach(e=>{o.yearlyBudget+=Number(e.yearlyBudget)||0,o.monthlyIncome+=Number(e.monthlyIncome)||0}),o}),B=async o=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u5728\u4EA7\u60C5\u51B5\u6570\u636E\uFF0C\u671F\u95F4: ${o}`);const e=await fetch(`http://47.111.95.19:3000/inventory-in-progress/${o}`);if(!e.ok){if(e.status===404){console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4FDD\u6301\u5E74\u5EA6\u9884\u7B97\u4F46\u6E05\u7A7A\u5F53\u6708\u6536\u5165"),c.value=c.value.map(u=>({...u,monthlyIncome:0})),d.value=d.value.map(u=>({...u,monthlyIncome:0})),p.value=p.value.map(u=>({...u,monthlyIncome:0}));return}throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25")}const r=await e.json();if(console.log("API\u8FD4\u56DE\u6570\u636E:",r),r.success&&r.data){console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76...");const u=T(),n=k(u,r.data);c.value=n.equipment,d.value=n.component,p.value=n.project,console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{equipmentData:c.value,componentData:d.value,projectData:p.value})}}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e),A()}},x=async o=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${N.INVENTORY_IN_PROGRESS}/${o}`);if(e.ok){const r=await e.json();r.data&&(i.value=r.data.remarks||"",h.value=r.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};w(()=>g.query.period,o=>{o&&(a.value=o.toString(),B(o.toString()),x(o.toString()))}),w(a,(o,e)=>{o&&o!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${o}`),B(o),x(o))});const S=async()=>{try{const o={equipment:c.value,component:d.value,project:p.value};if(!(await fetch("http://47.111.95.19:3000/inventory-in-progress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:o})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await L(N.INVENTORY_IN_PROGRESS,a.value,o,i.value,h.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(o){console.error("\u4FDD\u5B58\u5931\u8D25:",o),alert("\u4FDD\u5B58\u5931\u8D25")}},b=o=>isNaN(o)||o===null||o===void 0?"0.00":o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),j=()=>{A(),i.value="",h.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return O(()=>{console.log("\u5728\u4EA7\u60C5\u51B5\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",a.value),g.query.period?(B(g.query.period.toString()),x(g.query.period.toString())):(B(a.value),x(a.value))}),(o,e)=>(y(),l("div",Y,[t("div",P,[e[3]||(e[3]=t("h1",{class:"text-2xl font-bold"},"\u5728\u4EA7\u60C5\u51B5",-1)),t("div",z,[F(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.value=r),type:"month",class:"px-3 py-2 border rounded"},null,512),[[I,a.value]])])]),t("div",J,[t("table",H,[e[5]||(e[5]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u9884\u7B97"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u6267\u884C\u91D1\u989D"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5B8C\u6210\u7387")])],-1)),t("tbody",null,[(y(!0),l(f,null,E(c.value,(r,u)=>(y(),l("tr",{key:`equipment-${u}`},[u===0?(y(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:c.value.length}," \u8BBE\u5907 ",8,K)):D("",!0),t("td",Q,s(r.customerType),1),t("td",W,s(b(r.yearlyBudget||0)),1),t("td",X,[F(t("input",{"onUpdate:modelValue":n=>r.monthlyIncome=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Z),[[I,r.monthlyIncome]])]),t("td",ee,s(_(r.monthlyIncome||0,r.yearlyBudget||0))+"% ",1)]))),128)),(y(!0),l(f,null,E(d.value,(r,u)=>(y(),l("tr",{key:`component-${u}`},[u===0?(y(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:d.value.length}," \u5143\u4EF6 ",8,oe)):D("",!0),t("td",re,s(r.customerType),1),t("td",te,s(b(r.yearlyBudget||0)),1),t("td",ue,[F(t("input",{"onUpdate:modelValue":n=>r.monthlyIncome=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ne),[[I,r.monthlyIncome]])]),t("td",se,s(_(r.monthlyIncome||0,r.yearlyBudget||0))+"% ",1)]))),128)),(y(!0),l(f,null,E(p.value,(r,u)=>(y(),l("tr",{key:`project-${u}`},[u===0?(y(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:p.value.length}," \u5DE5\u7A0B ",8,ae)):D("",!0),t("td",le,s(r.customerType),1),t("td",ye,s(b(r.yearlyBudget||0)),1),t("td",ce,[F(t("input",{"onUpdate:modelValue":n=>r.monthlyIncome=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,de),[[I,r.monthlyIncome]])]),t("td",pe,s(_(r.monthlyIncome||0,r.yearlyBudget||0))+"% ",1)]))),128)),t("tr",me,[e[4]||(e[4]=t("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),t("td",ge,s(b(v.value.yearlyBudget)),1),t("td",ie,s(b(v.value.monthlyIncome)),1),t("td",he,s(_(v.value.monthlyIncome,v.value.yearlyBudget))+"% ",1)])])])]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:S,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:j,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")]),U(M,{"module-id":$(N).INVENTORY_IN_PROGRESS,period:a.value,remarks:i.value,"onUpdate:remarks":e[1]||(e[1]=r=>i.value=r),suggestions:h.value,"onUpdate:suggestions":e[2]||(e[2]=r=>h.value=r)},null,8,["module-id","period","remarks","suggestions"])]))}});var xe=q(be,[["__scopeId","data-v-2b6e1c11"]]);export{xe as default};
