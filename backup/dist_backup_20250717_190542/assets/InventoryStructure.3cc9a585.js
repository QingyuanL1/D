import{_ as k,d as B,r as g,c as U,B as F,o as T,b,e,y as N,A,F as O,g as I,t as n,l as R,k as V,h as $,G as j,v as f,f as q}from"./index.df3e85ff.js";import{_ as J,M as x,r as M}from"./FormAttachmentAndRemarks.3283be35.js";const H={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},Y={class:"flex justify-between items-center mb-6"},L={class:"flex items-center space-x-4"},z={class:"overflow-x-auto my-6"},G={class:"w-full border-collapse border border-gray-300"},K=["rowspan"],Q={class:"border border-gray-300 px-4 py-2"},W={class:"border border-gray-300 px-4 py-2 text-right"},X={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],P={class:"border border-gray-300 px-4 py-2 text-right"},tt={class:"text-sm font-medium"},ut={class:"bg-gray-50 font-bold"},et={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"border border-gray-300 px-4 py-2 text-right"},at={class:"border border-gray-300 px-4 py-2 text-right"},ot={class:"text-sm font-bold"},st=B({__name:"InventoryStructure",setup(nt){var D;const c=j(),a=g(((D=c.query.period)==null?void 0:D.toString())||new Date().toISOString().slice(0,7)),_={customers:[{customerName:"\u4E00\u5305\u9879\u76EE",initialAmount:1e4,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u4E8C\u5305\u9879\u76EE",initialAmount:4400,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u57DF\u5185\u5408\u4F5C\u9879\u76EE",initialAmount:8600,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u57DF\u5916\u5408\u4F5C\u9879\u76EE",initialAmount:4900,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u65B0\u80FD\u6E90\u9879\u76EE",initialAmount:1900,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u82CF\u5DDE\u9879\u76EE",initialAmount:4200,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u62A2\u4FEE\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u8FD0\u68C0\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0},{customerName:"\u81EA\u5EFA\u9879\u76EE",initialAmount:0,current:0,accumulated:0,fluctuationRate:0}]},o=g(JSON.parse(JSON.stringify(_))),l=g(""),i=g(""),d=t=>t===0?"0.00":t.toFixed(2),h=t=>t===0?"0.00%":t.toFixed(2)+"%",v=t=>t>0?"text-green-600":t<0?"text-red-600":"",E=(t,u)=>!t||t===0?0:(u-t)/t*100,m=U(()=>{const t={initialAmount:0,current:0,accumulated:0,fluctuationRate:0};return o.value.customers.forEach(u=>{t.initialAmount+=u.initialAmount||0,t.current+=u.current||0,t.accumulated+=u.accumulated||0}),t.fluctuationRate=E(t.initialAmount,t.accumulated),t}),p=async t=>{try{const u=await fetch(`http://47.111.95.19:3000/nanhua-inventory-structure/${t}`);if(!u.ok){if(u.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const r=await u.json();r.data&&r.data.customers&&(o.value.customers=r.data.customers.map(s=>({customerName:s.customerName,initialAmount:Number(s.initialAmount)||0,current:Number(s.current)||0,accumulated:Number(s.accumulated)||0,fluctuationRate:Number(s.fluctuationRate)||0})))}catch(u){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",u)}},y=async t=>{try{const u=await fetch(`http://47.111.95.19:3000/forms/submission/${x.NANHUA_INVENTORY_STRUCTURE}/${t}`);if(u.ok){const r=await u.json();r.success&&r.data&&(l.value=r.data.remarks||"",i.value=r.data.suggestions||"")}}catch(u){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",u)}};F(()=>c.query.period,t=>{t&&(a.value=t.toString(),p(t.toString()),y(t.toString()))}),F(a,(t,u)=>{t&&t!==u&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${u} -> ${t}`),p(t),y(t))});const S=async()=>{try{if(o.value.customers.forEach(u=>{u.fluctuationRate=E(u.initialAmount,u.accumulated)}),!(await fetch("http://47.111.95.19:3000/nanhua-inventory-structure",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:o.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await M(x.NANHUA_INVENTORY_STRUCTURE,a.value,o.value,l.value,i.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(t){console.error("\u4FDD\u5B58\u5931\u8D25:",t),alert("\u4FDD\u5B58\u5931\u8D25")}},C=()=>{o.value=JSON.parse(JSON.stringify(_)),l.value="",i.value=""};return T(()=>{c.query.period?(p(c.query.period.toString()),y(c.query.period.toString())):(p(a.value),y(a.value))}),(t,u)=>(f(),b("div",H,[e("div",Y,[u[4]||(u[4]=e("h1",{class:"text-2xl font-bold"},"\u5B58\u91CF\u7ED3\u6784\u4E0E\u8D28\u91CF",-1)),e("div",L,[u[3]||(u[3]=e("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),N(e("input",{"onUpdate:modelValue":u[0]||(u[0]=r=>a.value=r),type:"month",class:"px-3 py-2 border rounded"},null,512),[[A,a.value]])])]),e("div",z,[e("table",G,[u[6]||(u[6]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u521D\u91D1\u989D"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u6CE2\u52A8\u7387")])],-1)),e("tbody",null,[(f(!0),b(O,null,I(o.value.customers,(r,s)=>(f(),b("tr",{key:`customer-${s}`},[s===0?(f(),b("td",{key:0,rowspan:o.value.customers.length,class:"border border-gray-300 px-4 py-2 font-medium text-center"}," \u5DE5\u7A0B ",8,K)):q("",!0),e("td",Q,n(r.customerName),1),e("td",W,n(d(r.initialAmount)),1),e("td",X,[N(e("input",{"onUpdate:modelValue":w=>r.current=w,type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01"},null,8,Z),[[A,r.current]])]),e("td",P,n(d(r.accumulated)),1),e("td",{class:R(["border border-gray-300 px-4 py-2 text-right",v(r.fluctuationRate)])},[e("span",tt,n(h(r.fluctuationRate)),1)],2)]))),128)),e("tr",ut,[u[5]||(u[5]=e("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),e("td",et,n(d(m.value.initialAmount)),1),e("td",rt,n(d(m.value.current)),1),e("td",at,n(d(m.value.accumulated)),1),e("td",{class:R(["border border-gray-300 px-4 py-2 text-right",v(m.value.fluctuationRate)])},[e("span",ot,n(h(m.value.fluctuationRate)),1)],2)])])])]),V(J,{"module-id":$(x).NANHUA_INVENTORY_STRUCTURE,period:a.value,remarks:l.value,"onUpdate:remarks":u[1]||(u[1]=r=>l.value=r),suggestions:i.value,"onUpdate:suggestions":u[2]||(u[2]=r=>i.value=r)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:S,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:C,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var it=k(st,[["__scopeId","data-v-049e3da4"]]);export{it as default};
