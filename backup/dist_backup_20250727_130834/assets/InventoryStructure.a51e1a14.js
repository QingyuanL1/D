import{_ as I,d as j,r as y,h as J,C as x,o as q,c as l,a as e,y as R,B as U,F as E,l as S,t as s,b as M,m as V,G as L,f as i,k as T}from"./index.fd6ad3c7.js";import{_ as Y,M as N,r as G}from"./FormAttachmentAndRemarks.00ecffab.js";const z={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},H={class:"flex justify-between items-center mb-6"},K={class:"flex items-center space-x-4"},Q={class:"overflow-x-auto my-6"},W={class:"w-full border-collapse border border-gray-300"},X=["rowspan"],Z={class:"border border-gray-300 px-4 py-2"},P={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},tt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},ut={class:"font-medium"},et={class:"border border-gray-300 px-4 py-2 text-right"},rt=["rowspan"],ot={class:"border border-gray-300 px-4 py-2"},st={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},nt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},at={class:"font-medium"},ct={class:"border border-gray-300 px-4 py-2 text-right"},lt=["rowspan"],it={class:"border border-gray-300 px-4 py-2"},pt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},dt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},yt={class:"font-medium"},mt={class:"border border-gray-300 px-4 py-2 text-right"},gt={class:"bg-gray-50 font-bold"},bt={class:"border border-gray-300 px-4 py-2 text-right"},At={class:"border border-gray-300 px-4 py-2 text-right"},vt={class:"border border-gray-300 px-4 py-2 text-right"},Ft=j({__name:"InventoryStructure",setup(_t){var O;const m=L(),p=y(((O=m.query.period)==null?void 0:O.toString())||new Date().toISOString().slice(0,7)),A=y(""),v=y(""),F=[{customerType:"\u4E0A\u6D77",initialAmount:39151.53,currentAmount:0},{customerType:"\u56FD\u7F51",initialAmount:7841.48,currentAmount:0},{customerType:"\u6C5F\u82CF",initialAmount:6793.01,currentAmount:0},{customerType:"\u8F93\u914D\u7535\u5185\u914D",initialAmount:0,currentAmount:0},{customerType:"\u897F\u95E8\u5B50",initialAmount:28.46,currentAmount:0},{customerType:"\u540C\u4E1A",initialAmount:821.55,currentAmount:0},{customerType:"\u7528\u6237",initialAmount:577.37,currentAmount:0},{customerType:"\u5176\u5B83",initialAmount:220.08,currentAmount:0}],_=[{customerType:"\u7528\u6237",initialAmount:26.6,currentAmount:0}],h=[{customerType:"\u4E00\u5305",initialAmount:12720.17,currentAmount:0},{customerType:"\u4E8C\u5305",initialAmount:960.55,currentAmount:0},{customerType:"\u57DF\u5185\u5408\u4F5C",initialAmount:1818.79,currentAmount:0},{customerType:"\u57DF\u5916\u5408\u4F5C",initialAmount:8063.91,currentAmount:0},{customerType:"\u5176\u5B83",initialAmount:1973.08,currentAmount:0}],n=y(JSON.parse(JSON.stringify(F))),a=y(JSON.parse(JSON.stringify(_))),c=y(JSON.parse(JSON.stringify(h))),d=r=>(Number(r)||0).toLocaleString(),D=(r,t)=>r===0?"0.00":((t-r)/r*100).toFixed(2),B=J(()=>[...n.value,...a.value,...c.value].reduce((r,t)=>r+(Number(t.initialAmount)||0),0)),C=J(()=>[...n.value,...a.value,...c.value].reduce((r,t)=>r+(Number(t.currentAmount)||0),0)),g=async r=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${N.INVENTORY_STRUCTURE}/${r}`);if(t.ok){const u=await t.json();u.success&&u.data&&(A.value=u.data.remarks||"",v.value=u.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u548C\u5EFA\u8BAE\u5931\u8D25:",t)}},k=async r=>{try{const t=await fetch(`http://47.111.95.19:3000/inventory-structure/${r}`);if(t.ok){const u=await t.json();if(u.success&&u.data)return u.data}}catch(t){console.error("\u52A0\u8F7D\u5B58\u91CF\u7ED3\u6784\u6570\u636E\u5931\u8D25:",t)}return null},f=async r=>{try{console.log(`=== \u5F00\u59CB\u52A0\u8F7D\u5B58\u91CF\u7ED3\u6784\u6570\u636E\uFF0C\u671F\u95F4: ${r} ===`);const t=await k(r);console.log("\u4ECEAPI\u52A0\u8F7D\u7684\u5B58\u91CF\u7ED3\u6784\u6570\u636E:",t),n.value=JSON.parse(JSON.stringify(F)),a.value=JSON.parse(JSON.stringify(_)),c.value=JSON.parse(JSON.stringify(h)),t&&(console.log("=== \u5F00\u59CB\u66F4\u65B0\u8BBE\u5907\u677F\u5757 ==="),t.equipment&&n.value.forEach(u=>{const o=t.equipment.find(b=>b.customerType===u.customerType);o&&(u.currentAmount=Number(o.currentAmount)||0,console.log(`  ${u.customerType}: \u5F53\u671F\u91D1\u989D=${u.currentAmount}`))}),console.log("=== \u5F00\u59CB\u66F4\u65B0\u5143\u4EF6\u677F\u5757 ==="),t.component&&a.value.forEach(u=>{const o=t.component.find(b=>b.customerType===u.customerType);o&&(u.currentAmount=Number(o.currentAmount)||0,console.log(`  ${u.customerType}: \u5F53\u671F\u91D1\u989D=${u.currentAmount}`))}),console.log("=== \u5F00\u59CB\u66F4\u65B0\u5DE5\u7A0B\u677F\u5757 ==="),t.project&&c.value.forEach(u=>{const o=t.project.find(b=>b.customerType===u.customerType);o&&(u.currentAmount=Number(o.currentAmount)||0,console.log(`  ${u.customerType}: \u5F53\u671F\u91D1\u989D=${u.currentAmount}`))})),console.log("=== \u6570\u636E\u52A0\u8F7D\u5B8C\u6210 ==="),console.log("\u6700\u7EC8\u6570\u636E:",{equipmentData:n.value,componentData:a.value,projectData:c.value})}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t),n.value=JSON.parse(JSON.stringify(F)),a.value=JSON.parse(JSON.stringify(_)),c.value=JSON.parse(JSON.stringify(h))}};x(p,r=>{f(r),g(r)}),x(()=>m.query.period,r=>{r&&(p.value=r.toString(),f(r.toString()),g(r.toString()))}),x(p,(r,t)=>{r&&r!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${r}`),f(r),g(r))});const w=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/inventory-structure",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:p.value,data:{equipment:n.value.map(t=>({customerType:t.customerType,initialAmount:t.initialAmount})),component:a.value.map(t=>({customerType:t.customerType,initialAmount:t.initialAmount})),project:c.value.map(t=>({customerType:t.customerType,initialAmount:t.initialAmount}))}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await G(N.INVENTORY_STRUCTURE,p.value,{equipment:n.value,component:a.value,project:c.value},A.value,v.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(r){console.error("\u4FDD\u5B58\u5931\u8D25:",r),alert("\u4FDD\u5B58\u5931\u8D25")}},$=()=>{n.value=JSON.parse(JSON.stringify(F)),a.value=JSON.parse(JSON.stringify(_)),c.value=JSON.parse(JSON.stringify(h))};return q(()=>{m.query.period?(f(m.query.period.toString()),g(m.query.period.toString())):g(p.value)}),(r,t)=>(i(),l("div",z,[e("div",H,[t[3]||(t[3]=e("h1",{class:"text-2xl font-bold"},"\u5B58\u91CF\u7ED3\u6784\u4E0E\u8D28\u91CF\uFF08\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3\uFF09\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),e("div",K,[R(e("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>p.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[U,p.value]])])]),e("div",Q,[e("table",W,[t[5]||(t[5]=e("thead",{class:"sticky top-0 bg-white"},[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u521D\u91D1\u989D"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u91D1\u989D"),e("th",{class:"border border-gray-300 px-4 py-2"},"\u6CE2\u52A8\u7387")])],-1)),e("tbody",null,[(i(!0),l(E,null,S(n.value,(u,o)=>(i(),l("tr",{key:`equipment-${o}`},[o===0?(i(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:n.value.length}," \u8BBE\u5907 ",8,X)):T("",!0),e("td",Z,s(u.customerType),1),e("td",P,[e("span",null,s(d(u.initialAmount)),1)]),e("td",tt,[e("span",ut,s(d(u.currentAmount)),1)]),e("td",et,s(D(u.initialAmount,u.currentAmount))+"% ",1)]))),128)),(i(!0),l(E,null,S(a.value,(u,o)=>(i(),l("tr",{key:`component-${o}`},[o===0?(i(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:a.value.length}," \u5143\u4EF6 ",8,rt)):T("",!0),e("td",ot,s(u.customerType),1),e("td",st,[e("span",null,s(d(u.initialAmount)),1)]),e("td",nt,[e("span",at,s(d(u.currentAmount)),1)]),e("td",ct,s(D(u.initialAmount,u.currentAmount))+"% ",1)]))),128)),(i(!0),l(E,null,S(c.value,(u,o)=>(i(),l("tr",{key:`project-${o}`},[o===0?(i(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:c.value.length}," \u5DE5\u7A0B ",8,lt)):T("",!0),e("td",it,s(u.customerType),1),e("td",pt,[e("span",null,s(d(u.initialAmount)),1)]),e("td",dt,[e("span",yt,s(d(u.currentAmount)),1)]),e("td",mt,s(D(u.initialAmount,u.currentAmount))+"% ",1)]))),128)),e("tr",gt,[t[4]||(t[4]=e("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),e("td",bt,s(d(B.value)),1),e("td",At,s(d(C.value)),1),e("td",vt,s(D(B.value,C.value))+"% ",1)])])])]),M(Y,{"module-id":V(N).INVENTORY_STRUCTURE,period:p.value,remarks:A.value,"onUpdate:remarks":t[1]||(t[1]=u=>A.value=u),suggestions:v.value,"onUpdate:suggestions":t[2]||(t[2]=u=>v.value=u)},null,8,["module-id","period","remarks","suggestions"]),e("div",{class:"mt-4 flex justify-end space-x-4"},[e("button",{onClick:w,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),e("button",{onClick:$,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var ft=I(Ft,[["__scopeId","data-v-84eee116"]]);export{ft as default};
