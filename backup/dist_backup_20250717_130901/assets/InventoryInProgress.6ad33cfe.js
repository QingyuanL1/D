import{_ as R,d as V,r as i,c as O,B as S,o as U,b as p,e as o,y as I,A as f,F as E,g as D,t as n,k as $,h as G,G as M,v as d,f as T}from"./index.6c7f5ea0.js";import{_ as L,M as N,r as Y}from"./FormAttachmentAndRemarks.5e1970ec.js";const P={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},z={class:"flex justify-between items-center mb-6"},J={class:"flex items-center space-x-4"},H={class:"overflow-x-auto my-6"},K={class:"w-full border-collapse border border-gray-300"},Q=["rowspan"],W={class:"border border-gray-300 px-4 py-2"},X={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},Z={class:"border border-gray-300 px-4 py-2"},ee=["onUpdate:modelValue"],re={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},te={class:"border border-gray-300 px-4 py-2 text-right"},oe=["rowspan"],ue={class:"border border-gray-300 px-4 py-2"},ne={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},se={class:"border border-gray-300 px-4 py-2"},ae=["onUpdate:modelValue"],le={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},ce={class:"border border-gray-300 px-4 py-2 text-right"},ye=["rowspan"],pe={class:"border border-gray-300 px-4 py-2"},de={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},me={class:"border border-gray-300 px-4 py-2"},ge=["onUpdate:modelValue"],ie={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},be={class:"border border-gray-300 px-4 py-2 text-right"},he={class:"bg-gray-50 font-bold"},ve={class:"border border-gray-300 px-4 py-2 text-right"},_e={class:"border border-gray-300 px-4 py-2 text-right"},xe={class:"border border-gray-300 px-4 py-2 text-right"},Be={class:"border border-gray-300 px-4 py-2 text-right"},Fe=V({__name:"InventoryInProgress",setup(Ie){var w;const b=M(),a=i(((w=b.query.period)==null?void 0:w.toString())||new Date().toISOString().slice(0,7)),h=i(""),v=i(""),A=()=>({equipment:[{customerType:"\u4E0A\u6D77",yearlyBudget:0,monthlyIncome:0},{customerType:"\u56FD\u7F51",yearlyBudget:0,monthlyIncome:0},{customerType:"\u6C5F\u82CF",yearlyBudget:0,monthlyIncome:0},{customerType:"\u8F93\u914D\u7535\u5185\u914D",yearlyBudget:0,monthlyIncome:0},{customerType:"\u897F\u95E8\u5B50",yearlyBudget:0,monthlyIncome:0},{customerType:"\u540C\u4E1A",yearlyBudget:0,monthlyIncome:0},{customerType:"\u7528\u6237",yearlyBudget:0,monthlyIncome:0},{customerType:"\u5176\u5B83",yearlyBudget:0,monthlyIncome:0}],component:[{customerType:"\u7528\u6237",yearlyBudget:0,monthlyIncome:0}],project:[{customerType:"\u4E00\u5305",yearlyBudget:0,monthlyIncome:0},{customerType:"\u4E8C\u5305",yearlyBudget:0,monthlyIncome:0},{customerType:"\u57DF\u5185\u5408\u4F5C",yearlyBudget:0,monthlyIncome:0},{customerType:"\u57DF\u5916\u5408\u4F5C",yearlyBudget:0,monthlyIncome:0},{customerType:"\u5176\u5B83",yearlyBudget:0,monthlyIncome:0}]}),j=(r,e)=>(!e||typeof e!="object"||(e.equipment&&Array.isArray(e.equipment)&&(r.equipment=r.equipment.map(t=>{const u=e.equipment.find(s=>s.customerType===t.customerType);return u?{...t,yearlyBudget:Number(u.yearlyPlan)||Number(u.yearlyBudget)||0,monthlyIncome:Number(u.monthlyIncome)||Number(u.currentAmount)||0}:t})),e.component&&Array.isArray(e.component)&&(r.component=r.component.map(t=>{const u=e.component.find(s=>s.customerType===t.customerType);return u?{...t,yearlyBudget:Number(u.yearlyPlan)||Number(u.yearlyBudget)||0,monthlyIncome:Number(u.monthlyIncome)||Number(u.currentAmount)||0}:t})),e.project&&Array.isArray(e.project)&&(r.project=r.project.map(t=>{const u=e.project.find(s=>s.customerType===t.customerType);return u?{...t,yearlyBudget:Number(u.yearlyPlan)||Number(u.yearlyBudget)||0,monthlyIncome:Number(u.monthlyIncome)||Number(u.currentAmount)||0}:t}))),r),C=()=>{const r=A();l.value=r.equipment,c.value=r.component,y.value=r.project},l=i([]),c=i([]),y=i([]),m=(r,e)=>{const t=e==="equipment"?l.value.find(u=>u.customerType===r):e==="component"?c.value.find(u=>u.customerType===r):y.value.find(u=>u.customerType===r);return Number(t==null?void 0:t.monthlyIncome)||0},x=(r,e)=>e===0?"0.00":(r/e*100).toFixed(2),_=O(()=>{const r={yearlyBudget:0,monthlyIncome:0,cumulativeIncome:0};return l.value.forEach(e=>{r.yearlyBudget+=Number(e.yearlyBudget)||0,r.monthlyIncome+=Number(e.monthlyIncome)||0,r.cumulativeIncome+=m(e.customerType,"equipment")}),c.value.forEach(e=>{r.yearlyBudget+=Number(e.yearlyBudget)||0,r.monthlyIncome+=Number(e.monthlyIncome)||0,r.cumulativeIncome+=m(e.customerType,"component")}),y.value.forEach(e=>{r.yearlyBudget+=Number(e.yearlyBudget)||0,r.monthlyIncome+=Number(e.monthlyIncome)||0,r.cumulativeIncome+=m(e.customerType,"project")}),r}),B=async r=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u5728\u4EA7\u60C5\u51B5\u6570\u636E\uFF0C\u671F\u95F4: ${r}`);const e=await fetch(`http://47.111.95.19:3000/inventory-in-progress/${r}`);if(!e.ok){if(e.status===404){console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4FDD\u6301\u5E74\u5EA6\u9884\u7B97\u4F46\u6E05\u7A7A\u5F53\u6708\u6536\u5165"),l.value=l.value.map(u=>({...u,monthlyIncome:0})),c.value=c.value.map(u=>({...u,monthlyIncome:0})),y.value=y.value.map(u=>({...u,monthlyIncome:0}));return}throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25")}const t=await e.json();if(console.log("API\u8FD4\u56DE\u6570\u636E:",t),t.success&&t.data){console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76...");const u=A(),s=j(u,t.data);l.value=s.equipment,c.value=s.component,y.value=s.project,console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{equipmentData:l.value,componentData:c.value,projectData:y.value})}}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e),C()}},F=async r=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${N.INVENTORY_IN_PROGRESS}/${r}`);if(e.ok){const t=await e.json();t.data&&(h.value=t.data.remarks||"",v.value=t.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};S(()=>b.query.period,r=>{r&&(a.value=r.toString(),B(r.toString()),F(r.toString()))}),S(a,(r,e)=>{r&&r!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${r}`),B(r),F(r))});const k=async()=>{try{const r={equipment:l.value,component:c.value,project:y.value};if(!(await fetch("http://47.111.95.19:3000/inventory-in-progress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:r})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await Y(N.INVENTORY_IN_PROGRESS,a.value,r,h.value,v.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(r){console.error("\u4FDD\u5B58\u5931\u8D25:",r),alert("\u4FDD\u5B58\u5931\u8D25")}},g=r=>isNaN(r)||r===null||r===void 0?"0.00":r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),q=()=>{C(),h.value="",v.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return U(()=>{console.log("\u5728\u4EA7\u60C5\u51B5\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",a.value),b.query.period?(B(b.query.period.toString()),F(b.query.period.toString())):(B(a.value),F(a.value))}),(r,e)=>(d(),p("div",P,[o("div",z,[e[3]||(e[3]=o("h1",{class:"text-2xl font-bold"},"\u5728\u4EA7\u60C5\u51B5",-1)),o("div",J,[I(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.value=t),type:"month",class:"px-3 py-2 border rounded"},null,512),[[f,a.value]])])]),o("div",H,[o("table",K,[e[5]||(e[5]=o("thead",{class:"sticky top-0 bg-white"},[o("tr",{class:"bg-gray-50"},[o("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u9884\u7B97"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u6708\u6536\u5165"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u6536\u5165"),o("th",{class:"border border-gray-300 px-4 py-2"},"\u5B8C\u6210\u7387")])],-1)),o("tbody",null,[(d(!0),p(E,null,D(l.value,(t,u)=>(d(),p("tr",{key:`equipment-${u}`},[u===0?(d(),p("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:l.value.length}," \u8BBE\u5907 ",8,Q)):T("",!0),o("td",W,n(t.customerType),1),o("td",X,n(g(t.yearlyBudget||0)),1),o("td",Z,[I(o("input",{"onUpdate:modelValue":s=>t.monthlyIncome=s,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ee),[[f,t.monthlyIncome]])]),o("td",re,n(g(m(t.customerType,"equipment"))),1),o("td",te,n(x(m(t.customerType,"equipment"),t.yearlyBudget||0))+"% ",1)]))),128)),(d(!0),p(E,null,D(c.value,(t,u)=>(d(),p("tr",{key:`component-${u}`},[u===0?(d(),p("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:c.value.length}," \u5143\u4EF6 ",8,oe)):T("",!0),o("td",ue,n(t.customerType),1),o("td",ne,n(g(t.yearlyBudget||0)),1),o("td",se,[I(o("input",{"onUpdate:modelValue":s=>t.monthlyIncome=s,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ae),[[f,t.monthlyIncome]])]),o("td",le,n(g(m(t.customerType,"component"))),1),o("td",ce,n(x(m(t.customerType,"component"),t.yearlyBudget||0))+"% ",1)]))),128)),(d(!0),p(E,null,D(y.value,(t,u)=>(d(),p("tr",{key:`project-${u}`},[u===0?(d(),p("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:y.value.length}," \u5DE5\u7A0B ",8,ye)):T("",!0),o("td",pe,n(t.customerType),1),o("td",de,n(g(t.yearlyBudget||0)),1),o("td",me,[I(o("input",{"onUpdate:modelValue":s=>t.monthlyIncome=s,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ge),[[f,t.monthlyIncome]])]),o("td",ie,n(g(m(t.customerType,"project"))),1),o("td",be,n(x(m(t.customerType,"project"),t.yearlyBudget||0))+"% ",1)]))),128)),o("tr",he,[e[4]||(e[4]=o("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),o("td",ve,n(g(_.value.yearlyBudget)),1),o("td",_e,n(g(_.value.monthlyIncome)),1),o("td",xe,n(g(_.value.cumulativeIncome)),1),o("td",Be,n(x(_.value.cumulativeIncome,_.value.yearlyBudget))+"% ",1)])])])]),o("div",{class:"mt-4 flex justify-end space-x-4"},[o("button",{onClick:k,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),o("button",{onClick:q,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")]),$(L,{"module-id":G(N).INVENTORY_IN_PROGRESS,period:a.value,remarks:h.value,"onUpdate:remarks":e[1]||(e[1]=t=>h.value=t),suggestions:v.value,"onUpdate:suggestions":e[2]||(e[2]=t=>v.value=t)},null,8,["module-id","period","remarks","suggestions"])]))}});var De=R(Fe,[["__scopeId","data-v-429c81a0"]]);export{De as default};
