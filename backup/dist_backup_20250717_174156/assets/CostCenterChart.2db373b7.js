import{_ as K,d as Q,r as l,c as Y,o as X,a as Z,b as f,e,y as ee,z as te,F as A,g as S,t as u,l as k,j as z,f as se,v as g}from"./index.d4de8a86.js";import{i as M,L as oe}from"./index.0a005eaa.js";const ae={class:"p-6 bg-gray-50 min-h-screen"},ue={class:"max-w-7xl mx-auto"},le={class:"bg-white p-6 rounded-lg shadow-sm mb-8"},ne={class:"flex items-center justify-between"},re={class:"flex items-center space-x-3"},ie=["value"],ce={key:0,class:"bg-white rounded-lg shadow-sm p-6 mb-8"},de={class:"text-lg font-semibold text-gray-900 mb-4"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ve={class:"text-center"},fe={class:"text-2xl font-bold text-blue-600"},ge={class:"text-center"},he={class:"text-2xl font-bold text-green-600"},xe={class:"text-center"},pe={class:"mt-4"},ye={class:"w-full bg-gray-200 rounded-full h-3"},be={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},_e={class:"text-lg font-semibold text-gray-900 mb-4"},Ee={class:"space-y-3"},Ce={class:"flex justify-between"},we={class:"font-medium text-gray-600"},Be={class:"flex justify-between"},De={class:"font-medium text-blue-600"},Fe={class:"flex justify-between"},Ae={class:"w-full bg-gray-200 rounded-full h-2"},Se={class:"bg-white rounded-lg shadow-sm p-6 mb-8"},ze={class:"flex justify-between items-center mb-6"},Re={class:"text-lg font-semibold text-gray-900"},Ie={class:"bg-white rounded-lg shadow-sm p-6"},je={class:"text-lg font-semibold text-gray-900 mb-6"},$e={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Le={class:"space-y-4"},Pe={class:"space-y-2"},Ne={class:"flex items-center"},Oe={class:"text-sm font-medium text-gray-900"},We={class:"text-right"},Ye={class:"text-sm font-medium text-gray-900"},ke={class:"text-xs text-gray-500"},Me=Q({__name:"CostCenterChart",setup(Te){const d=l(new Date().getFullYear().toString()),R=l([]),I=l(!0),w=l(null),B=l(null),p=l(null),y=l(null),m={equipment:{name:"\u8BBE\u5907",color:"#3B82F6"},component:{name:"\u5143\u4EF6",color:"#10B981"},engineering:{name:"\u5DE5\u7A0B",color:"#F59E0B"},nonMainBusiness:{name:"\u975E\u4E3B\u8425\u4E1A\u52A1",color:"#EF4444"}},b=l([]),_=l({}),h=l({}),x=l([]),v=l(0),D=l({}),j=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],E=Y(()=>{const s={};return Object.keys(m).forEach(t=>{const o=h.value[t]||{cumulativeIncome:0,currentPeriodTotal:0},a=D.value[t]||0;s[t]={...o,categoryPlan:a,completionRate:a>0?Number((o.cumulativeIncome/a*100).toFixed(2)):0}}),s}),C=Y(()=>{const s=Object.keys(m).reduce((o,a)=>{var n;return o+(((n=h.value[a])==null?void 0:n.cumulativeIncome)||0)},0),t=v.value>0?Number((s/v.value*100).toFixed(2)):0;return{totalCumulativeIncome:s,yearlyPlan:v.value,completionRate:t}}),r=s=>s.toLocaleString("zh-CN",{maximumFractionDigits:2}),$=s=>j[s%j.length],L=s=>s>=90?"text-green-600":s>=70?"text-blue-600":s>=50?"text-yellow-600":"text-red-600",T=()=>{const s=new Date().getFullYear(),t=[];for(let o=0;o<5;o++)t.push((s-o).toString());R.value=t},P=async()=>{try{I.value=!0,await V(),await U(),G()}catch(s){console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",s)}finally{I.value=!1}},V=async()=>{try{const s=await fetch(`http://47.111.95.19:3000/analytics/cost-center/${d.value}`);if(s.ok){const t=await s.json();t.success&&t.data?(b.value=t.data.months||[],_.value=t.data.monthlyData||{},h.value=t.data.summary||{},v.value=t.data.yearlyPlan||0,D.value=t.data.categoryPlans||{}):F()}else F()}catch(s){console.error("\u83B7\u53D6\u6210\u672C\u4E2D\u5FC3\u6570\u636E\u5931\u8D25:",s),F()}},F=()=>{b.value=[],_.value={},h.value={},v.value=0,D.value={},x.value=[]},U=async()=>{try{const s=[];let t=0;Object.keys(m).forEach(o=>{const a=h.value[o],n=m[o];a&&a.cumulativeIncome>0&&(s.push({name:n.name,value:a.cumulativeIncome}),t+=a.cumulativeIncome)}),x.value=s.map(o=>({...o,percentage:t>0?Number((o.value/t*100).toFixed(2)):0}))}catch(s){console.error("\u751F\u6210\u997C\u56FE\u6570\u636E\u5931\u8D25:",s),x.value=[]}},q=()=>{w.value&&(p.value=M(w.value)),B.value&&(y.value=M(B.value))},G=()=>{H(),J()},H=()=>{if(!p.value)return;const s=[],t=b.value.length>0&&Object.keys(_.value).length>0;t&&Object.keys(m).forEach((a,n)=>{const i=_.value[a],c=m[a];i&&s.push({name:`${c.name}`,type:"line",data:i.cumulativeIncome,smooth:!0,lineStyle:{color:c.color,width:3},itemStyle:{color:c.color},areaStyle:{color:new oe(0,0,0,1,[{offset:0,color:c.color+"40"},{offset:1,color:c.color+"10"}])}})});const o={title:{text:`${d.value}\u5E74\u6210\u672C\u4E2D\u5FC3\u6708\u5EA6\u8D8B\u52BF\u5206\u6790`,textStyle:{fontSize:18,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"axis",formatter:function(a){if(!t)return"\u6682\u65E0\u6570\u636E";let n=`${a[0].name}<br/>`;return a.forEach(i=>{n+=`${i.seriesName}: ${r(i.value)} \u4E07\u5143<br/>`}),n}},legend:{top:50,type:"scroll"},grid:{left:"8%",right:"5%",bottom:"15%",top:"25%",containLabel:!0},xAxis:{type:"category",data:t?b.value:[],axisLabel:{fontSize:12}},yAxis:{type:"value",name:"\u4E07\u5143",nameTextStyle:{fontSize:12},axisLabel:{formatter:function(a){return r(a)},fontSize:12}},series:t?s:[],graphic:t?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};p.value.setOption(o,!0)},J=()=>{if(!y.value)return;const s=x.value.length>0,t={title:{text:"\u677F\u5757\u5360\u6BD4",textStyle:{fontSize:16,fontWeight:"bold",color:"#374151"},left:"center",top:10},tooltip:{trigger:"item",formatter:function(o){return s?`${o.name}<br/>\u6570\u503C: ${r(o.value)} \u4E07\u5143<br/>\u5360\u6BD4: ${o.percent}%`:"\u6682\u65E0\u6570\u636E"}},legend:{orient:"vertical",left:"left",top:"middle",textStyle:{fontSize:12},show:s},series:[{name:"\u677F\u5757\u5360\u6BD4",type:"pie",radius:["30%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},labelLine:{show:!1},data:s?x.value.map((o,a)=>({value:o.value,name:o.name,itemStyle:{color:$(a)}})):[]}],graphic:s?[]:[{type:"text",left:"center",top:"middle",style:{text:"\u6682\u65E0\u6570\u636E",fontSize:16,fontWeight:"bold",fill:"#999"}}]};y.value.setOption(t,!0)},N=()=>{var s,t;(s=p.value)==null||s.resize(),(t=y.value)==null||t.resize()};return X(async()=>{T(),q(),await P(),window.addEventListener("resize",N)}),Z(()=>{var s,t;(s=p.value)==null||s.dispose(),(t=y.value)==null||t.dispose(),window.removeEventListener("resize",N)}),(s,t)=>(g(),f("div",ae,[e("div",ue,[t[11]||(t[11]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"\u6210\u672C\u4E2D\u5FC3\u7ED3\u6784\u5206\u6790"),e("p",{class:"text-gray-600 mt-2"},"\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3 - \u8BA1\u5165\u635F\u76CA\u7ED3\u6784\u5206\u6790")],-1)),e("div",le,[e("div",ne,[t[2]||(t[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"\u6570\u636E\u5E74\u4EFD\u9009\u62E9",-1)),e("div",re,[t[1]||(t[1]=e("span",{class:"text-sm text-gray-600"},"\u9009\u62E9\u5E74\u4EFD:",-1)),ee(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),onChange:P,class:"px-3 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"},[(g(!0),f(A,null,S(R.value,o=>(g(),f("option",{key:o,value:o},u(o)+"\u5E74",9,ie))),128))],544),[[te,d.value]])])])]),v.value>0?(g(),f("div",ce,[e("h3",de,u(d.value)+"\u5E74\u5EA6\u8BA1\u5212\u5B8C\u6210\u60C5\u51B5",1),e("div",me,[e("div",ve,[e("div",fe,u(r(v.value))+" \u4E07\u5143",1),t[3]||(t[3]=e("div",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212",-1))]),e("div",ge,[e("div",he,u(r(C.value.totalCumulativeIncome))+" \u4E07\u5143",1),t[4]||(t[4]=e("div",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA",-1))]),e("div",xe,[e("div",{class:k(["text-2xl font-bold",L(C.value.completionRate)])},u(C.value.completionRate)+"%",3),t[5]||(t[5]=e("div",{class:"text-sm text-gray-600"},"\u6267\u884C\u7387",-1))])]),e("div",pe,[e("div",ye,[e("div",{class:"bg-blue-600 h-3 rounded-full transition-all duration-500",style:z(`width: ${Math.min(C.value.completionRate,100)}%`)},null,4)])])])):se("",!0),e("div",be,[(g(),f(A,null,S(m,(o,a)=>{var n,i,c,O,W;return e("div",{key:a,class:"bg-white rounded-lg shadow-sm p-6"},[e("h3",_e,u(o.name),1),e("div",Ee,[e("div",Ce,[t[6]||(t[6]=e("span",{class:"text-sm text-gray-600"},"\u5E74\u5EA6\u8BA1\u5212:",-1)),e("span",we,u(r(((n=E.value[a])==null?void 0:n.categoryPlan)||0))+" \u4E07\u5143",1)]),e("div",Be,[t[7]||(t[7]=e("span",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA:",-1)),e("span",De,u(r(((i=h.value[a])==null?void 0:i.cumulativeIncome)||0))+" \u4E07\u5143",1)]),e("div",Fe,[t[8]||(t[8]=e("span",{class:"text-sm text-gray-600"},"\u5B8C\u6210\u7387:",-1)),e("span",{class:k(["font-medium",L(((c=E.value[a])==null?void 0:c.completionRate)||0)])},u(((O=E.value[a])==null?void 0:O.completionRate)||0)+"% ",3)]),e("div",Ae,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:z(`width: ${Math.min(((W=E.value[a])==null?void 0:W.completionRate)||0,100)}%`)},null,4)])])])}),64))]),e("div",Se,[e("div",ze,[e("h3",Re,u(d.value)+"\u5E74\u6708\u5EA6\u8D8B\u52BF\u5BF9\u6BD4",1),t[9]||(t[9]=e("div",{class:"flex items-center space-x-4"},[e("div",{class:"flex items-center"},[e("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),e("span",{class:"text-sm text-gray-600"},"\u8BA1\u5165\u635F\u76CA\u6708\u5EA6\u53D8\u5316")])],-1))]),e("div",{class:"h-[500px]",ref_key:"chartRef",ref:w},null,512)]),e("div",Ie,[e("h3",je,u(d.value)+"\u5E74\u5404\u677F\u5757\u8BA1\u5165\u635F\u76CA\u5360\u6BD4\u5206\u6790",1),e("div",$e,[e("div",{class:"h-[350px]",ref_key:"pieChartRef",ref:B},null,512),e("div",Le,[t[10]||(t[10]=e("h4",{class:"text-md font-medium text-gray-800"},"\u5360\u6BD4\u8BE6\u60C5",-1)),e("div",Pe,[(g(!0),f(A,null,S(x.value,(o,a)=>(g(),f("div",{key:a,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",Ne,[e("div",{class:"w-3 h-3 rounded-full mr-3",style:z(`background-color: ${$(a)}`)},null,4),e("span",Oe,u(o.name),1)]),e("div",We,[e("div",Ye,u(r(o.value))+" \u4E07\u5143",1),e("div",ke,u(o.percentage)+"%",1)])]))),128))])])])])])]))}});var qe=K(Me,[["__scopeId","data-v-2ff1d1f8"]]);export{qe as default};
