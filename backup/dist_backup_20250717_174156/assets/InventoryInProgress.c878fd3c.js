import{_ as q,d as R,r as m,c as V,B as w,o as O,b as l,e as r,y as x,A as E,F as f,g as I,t as s,k as U,h as $,G,v as y,f as D}from"./index.d4de8a86.js";import{_ as M,M as N,r as L}from"./FormAttachmentAndRemarks.0cc3dee9.js";const Y={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},P={class:"flex justify-between items-center mb-6"},z={class:"flex items-center space-x-4"},J={class:"overflow-x-auto my-6"},H={class:"w-full border-collapse border border-gray-300"},K=["rowspan"],Q={class:"border border-gray-300 px-4 py-2"},W={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},X={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],ee={class:"border border-gray-300 px-4 py-2 text-right"},oe=["rowspan"],ue={class:"border border-gray-300 px-4 py-2"},re={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},te={class:"border border-gray-300 px-4 py-2"},ne=["onUpdate:modelValue"],se={class:"border border-gray-300 px-4 py-2 text-right"},ae=["rowspan"],le={class:"border border-gray-300 px-4 py-2"},ye={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},ce={class:"border border-gray-300 px-4 py-2"},de=["onUpdate:modelValue"],pe={class:"border border-gray-300 px-4 py-2 text-right"},me={class:"bg-gray-50 font-bold"},ge={class:"border border-gray-300 px-4 py-2 text-right"},ie={class:"border border-gray-300 px-4 py-2 text-right"},he={class:"border border-gray-300 px-4 py-2 text-right"},be=R({__name:"InventoryInProgress",setup(Fe){var C;const g=G(),a=m(((C=g.query.period)==null?void 0:C.toString())||new Date().toISOString().slice(0,7)),i=m(""),h=m(""),A=()=>({equipment:[{customerType:"\u4E0A\u6D77",yearlyBudget:0,monthlyIncome:0},{customerType:"\u56FD\u7F51",yearlyBudget:0,monthlyIncome:0},{customerType:"\u6C5F\u82CF",yearlyBudget:0,monthlyIncome:0},{customerType:"\u8F93\u914D\u7535\u5185\u914D",yearlyBudget:0,monthlyIncome:0},{customerType:"\u897F\u95E8\u5B50",yearlyBudget:0,monthlyIncome:0},{customerType:"\u540C\u4E1A",yearlyBudget:0,monthlyIncome:0},{customerType:"\u7528\u6237",yearlyBudget:0,monthlyIncome:0},{customerType:"\u5176\u5B83",yearlyBudget:0,monthlyIncome:0}],component:[{customerType:"\u7528\u6237",yearlyBudget:0,monthlyIncome:0}],project:[{customerType:"\u4E00\u5305",yearlyBudget:0,monthlyIncome:0},{customerType:"\u4E8C\u5305",yearlyBudget:0,monthlyIncome:0},{customerType:"\u57DF\u5185\u5408\u4F5C",yearlyBudget:0,monthlyIncome:0},{customerType:"\u57DF\u5916\u5408\u4F5C",yearlyBudget:0,monthlyIncome:0},{customerType:"\u5176\u5B83",yearlyBudget:0,monthlyIncome:0}]}),k=(o,e)=>(!e||typeof e!="object"||(e.equipment&&Array.isArray(e.equipment)&&(o.equipment=o.equipment.map(u=>{const t=e.equipment.find(n=>n.customerType===u.customerType);return t?{...u,yearlyBudget:Number(t.yearlyPlan)||Number(t.yearlyBudget)||0,monthlyIncome:Number(t.monthlyIncome)||Number(t.currentAmount)||0}:u})),e.component&&Array.isArray(e.component)&&(o.component=o.component.map(u=>{const t=e.component.find(n=>n.customerType===u.customerType);return t?{...u,yearlyBudget:Number(t.yearlyPlan)||Number(t.yearlyBudget)||0,monthlyIncome:Number(t.monthlyIncome)||Number(t.currentAmount)||0}:u})),e.project&&Array.isArray(e.project)&&(o.project=o.project.map(u=>{const t=e.project.find(n=>n.customerType===u.customerType);return t?{...u,yearlyBudget:Number(t.yearlyPlan)||Number(t.yearlyBudget)||0,monthlyIncome:Number(t.monthlyIncome)||Number(t.currentAmount)||0}:u}))),o),T=()=>{const o=A();c.value=o.equipment,d.value=o.component,p.value=o.project},c=m([]),d=m([]),p=m([]),F=(o,e)=>e===0?"0.00":(o/e*100).toFixed(2),_=V(()=>{const o={yearlyBudget:0,monthlyIncome:0};return c.value.forEach(e=>{o.yearlyBudget+=Number(e.yearlyBudget)||0,o.monthlyIncome+=Number(e.monthlyIncome)||0}),d.value.forEach(e=>{o.yearlyBudget+=Number(e.yearlyBudget)||0,o.monthlyIncome+=Number(e.monthlyIncome)||0}),p.value.forEach(e=>{o.yearlyBudget+=Number(e.yearlyBudget)||0,o.monthlyIncome+=Number(e.monthlyIncome)||0}),o}),v=async o=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u5728\u4EA7\u60C5\u51B5\u6570\u636E\uFF0C\u671F\u95F4: ${o}`);const e=await fetch(`http://47.111.95.19:3000/inventory-in-progress/${o}`);if(!e.ok){if(e.status===404){console.log("\u8BE5\u671F\u95F4\u6682\u65E0\u6570\u636E\uFF0C\u4FDD\u6301\u5E74\u5EA6\u9884\u7B97\u4F46\u6E05\u7A7A\u5F53\u6708\u6536\u5165"),c.value=c.value.map(t=>({...t,monthlyIncome:0})),d.value=d.value.map(t=>({...t,monthlyIncome:0})),p.value=p.value.map(t=>({...t,monthlyIncome:0}));return}throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25")}const u=await e.json();if(console.log("API\u8FD4\u56DE\u6570\u636E:",u),u.success&&u.data){console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76...");const t=A(),n=k(t,u.data);c.value=n.equipment,d.value=n.component,p.value=n.project,console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{equipmentData:c.value,componentData:d.value,projectData:p.value})}}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e),T()}},B=async o=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${N.INVENTORY_IN_PROGRESS}/${o}`);if(e.ok){const u=await e.json();u.data&&(i.value=u.data.remarks||"",h.value=u.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};w(()=>g.query.period,o=>{o&&(a.value=o.toString(),v(o.toString()),B(o.toString()))}),w(a,(o,e)=>{o&&o!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${o}`),v(o),B(o))});const S=async()=>{try{const o={equipment:c.value,component:d.value,project:p.value};if(!(await fetch("http://47.111.95.19:3000/inventory-in-progress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:a.value,data:o})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await L(N.INVENTORY_IN_PROGRESS,a.value,o,i.value,h.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(o){console.error("\u4FDD\u5B58\u5931\u8D25:",o),alert("\u4FDD\u5B58\u5931\u8D25")}},b=o=>isNaN(o)||o===null||o===void 0?"0.00":o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),j=()=>{T(),i.value="",h.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return O(()=>{console.log("\u5728\u4EA7\u60C5\u51B5\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",a.value),g.query.period?(v(g.query.period.toString()),B(g.query.period.toString())):(v(a.value),B(a.value))}),(o,e)=>(y(),l("div",Y,[r("div",P,[e[3]||(e[3]=r("h1",{class:"text-2xl font-bold"},"\u65B0\u7B7E\u8BA2\u5355\u5DF2\u6392\u4EA7\u672A\u5165\u5E93\u9879\u76EE\uFF08\u5728\u4EA7\uFF09\uFF08\u4E0D\u5305\u542B\u9884\u6295\uFF09\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),r("div",z,[x(r("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>a.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[E,a.value]])])]),r("div",J,[r("table",H,[e[5]||(e[5]=r("thead",{class:"sticky top-0 bg-white"},[r("tr",{class:"bg-gray-50"},[r("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u9884\u7B97"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u6267\u884C\u91D1\u989D"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5B8C\u6210\u7387")])],-1)),r("tbody",null,[(y(!0),l(f,null,I(c.value,(u,t)=>(y(),l("tr",{key:`equipment-${t}`},[t===0?(y(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:c.value.length}," \u8BBE\u5907 ",8,K)):D("",!0),r("td",Q,s(u.customerType),1),r("td",W,s(b(u.yearlyBudget||0)),1),r("td",X,[x(r("input",{"onUpdate:modelValue":n=>u.monthlyIncome=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Z),[[E,u.monthlyIncome]])]),r("td",ee,s(F(u.monthlyIncome||0,u.yearlyBudget||0))+"% ",1)]))),128)),(y(!0),l(f,null,I(d.value,(u,t)=>(y(),l("tr",{key:`component-${t}`},[t===0?(y(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:d.value.length}," \u5143\u4EF6 ",8,oe)):D("",!0),r("td",ue,s(u.customerType),1),r("td",re,s(b(u.yearlyBudget||0)),1),r("td",te,[x(r("input",{"onUpdate:modelValue":n=>u.monthlyIncome=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ne),[[E,u.monthlyIncome]])]),r("td",se,s(F(u.monthlyIncome||0,u.yearlyBudget||0))+"% ",1)]))),128)),(y(!0),l(f,null,I(p.value,(u,t)=>(y(),l("tr",{key:`project-${t}`},[t===0?(y(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:p.value.length}," \u5DE5\u7A0B ",8,ae)):D("",!0),r("td",le,s(u.customerType),1),r("td",ye,s(b(u.yearlyBudget||0)),1),r("td",ce,[x(r("input",{"onUpdate:modelValue":n=>u.monthlyIncome=n,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,de),[[E,u.monthlyIncome]])]),r("td",pe,s(F(u.monthlyIncome||0,u.yearlyBudget||0))+"% ",1)]))),128)),r("tr",me,[e[4]||(e[4]=r("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),r("td",ge,s(b(_.value.yearlyBudget)),1),r("td",ie,s(b(_.value.monthlyIncome)),1),r("td",he,s(F(_.value.monthlyIncome,_.value.yearlyBudget))+"% ",1)])])])]),r("div",{class:"mt-4 flex justify-end space-x-4"},[r("button",{onClick:S,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),r("button",{onClick:j,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")]),U(M,{"module-id":$(N).INVENTORY_IN_PROGRESS,period:a.value,remarks:i.value,"onUpdate:remarks":e[1]||(e[1]=u=>i.value=u),suggestions:h.value,"onUpdate:suggestions":e[2]||(e[2]=u=>h.value=u)},null,8,["module-id","period","remarks","suggestions"])]))}});var Be=q(be,[["__scopeId","data-v-70e14df1"]]);export{Be as default};
