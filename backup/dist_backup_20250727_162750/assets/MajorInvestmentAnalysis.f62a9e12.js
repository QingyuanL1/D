import{d as C,r as d,h as v,C as S,o as I,c as E,a as u,y as p,B as m,F as P,l as k,t as l,b as j,m as V,G as M,f as b}from"./index.a6ecef53.js";import{_ as U,l as T,M as y,r as O}from"./FormAttachmentAndRemarks.aec7ae75.js";const R={class:"container mx-auto p-6"},L={class:"bg-white rounded-lg shadow-md p-6 mb-6"},$={class:"flex items-center justify-between mb-4"},J={class:"flex items-center"},q={class:"overflow-x-auto"},Y={class:"min-w-full border-collapse"},G={class:"border px-4 py-2 text-center"},z={class:"border px-4 py-2"},H=["onUpdate:modelValue"],K={class:"border px-4 py-2"},Q=["onUpdate:modelValue","onInput"],W={class:"border px-4 py-2"},X=["onUpdate:modelValue","onInput"],Z={class:"border px-4 py-2 text-center"},tt={class:"bg-gray-100 font-bold"},et={class:"border px-4 py-2 text-center"},ut={class:"border px-4 py-2 text-center"},ot={class:"border px-4 py-2 text-center"},at=C({__name:"MajorInvestmentAnalysis",setup(st){var N;const F=M(),n=d(((N=F.query.period)==null?void 0:N.toString())||new Date().toISOString().substr(0,7)),c=d(""),i=d(""),D=()=>Array.from({length:12},(e,t)=>({id:t+1,projectName:"",initialPlan:0,currentExecution:0,executionProgress:"0.0%"})),w=(e,t)=>{if(!t||!t.projects)return e;const o=[...e];return t.projects.forEach((s,r)=>{r<o.length&&(o[r]={...o[r],...s})}),o},a=d(D()),_=e=>{const t=a.value[e],o=Number(t.initialPlan||0),s=Number(t.currentExecution||0);o>0?t.executionProgress=(s/o*100).toFixed(1)+"%":t.executionProgress="0.0%"},x=v(()=>a.value.reduce((e,t)=>e+Number(t.initialPlan||0),0).toFixed(2)),g=v(()=>a.value.reduce((e,t)=>e+Number(t.currentExecution||0),0).toFixed(2)),f=v(()=>{const e=parseFloat(x.value),t=parseFloat(g.value);return e>0?(t/e*100).toFixed(1)+"%":"0.0%"}),h=async e=>{console.log(`\u6B63\u5728\u52A0\u8F7D\u5E74\u5EA6\u91CD\u5927\u6295\u8D44\u60C5\u51B5\u6570\u636E\uFF0C\u671F\u95F4: ${e}`);try{const t=await fetch(`http://47.111.95.19:3000/major-investment-analysis/${e}`);if(!t.ok){if(t.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log("\u672A\u627E\u5230\u6570\u636E\uFF0C\u4F7F\u7528\u7A7A\u767D\u6A21\u677F");return}const o=await t.json();if(console.log("\u52A0\u8F7D\u5230\u7684\u6570\u636E:",o),o.data){const s=w(D(),o.data);a.value=s,console.log("\u6570\u636E\u5408\u5E76\u5B8C\u6210:",a.value)}}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t)}},A=async e=>{try{const t=await T(y.MAJOR_INVESTMENT_ANALYSIS,e);c.value=t.remarks,i.value=t.suggestions}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u4FE1\u606F\u5931\u8D25:",t)}},B=async()=>{try{const t={projects:a.value.filter(s=>s.projectName.trim()!==""),summary:{totalInitialPlan:parseFloat(x.value),totalCurrentExecution:parseFloat(g.value),totalExecutionProgress:f.value}};if(!(await fetch("http://47.111.95.19:3000/major-investment-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:n.value,data:t})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await O(y.MAJOR_INVESTMENT_ANALYSIS,n.value,t,c.value,i.value),alert("\u6570\u636E\u4FDD\u5B58\u6210\u529F\uFF01")}catch(e){console.error("\u4FDD\u5B58\u5931\u8D25:",e),alert("\u4FDD\u5B58\u5931\u8D25: "+(e instanceof Error?e.message:"\u672A\u77E5\u9519\u8BEF"))}};return S(n,e=>{e&&(h(e),A(e))}),S(()=>F.query.period,e=>{e&&(n.value=e.toString())}),I(()=>{var t;const e=((t=F.query.period)==null?void 0:t.toString())||n.value;h(e),A(e)}),(e,t)=>(b(),E("div",R,[t[6]||(t[6]=u("h1",{class:"text-2xl font-bold mb-6"},"\u5E74\u5EA6\u91CD\u5927\u6295\u8D44\u60C5\u51B5\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),u("div",L,[u("div",$,[u("div",J,[t[3]||(t[3]=u("span",{class:"mr-2"},"\u9009\u62E9\u6708\u4EFD\uFF1A",-1)),p(u("input",{type:"month","onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),class:"border rounded px-2 py-1"},null,512),[[m,n.value]])]),u("button",{onClick:B,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors"}," \u4FDD\u5B58\u6570\u636E ")]),u("div",q,[u("table",Y,[t[5]||(t[5]=u("thead",null,[u("tr",{class:"bg-gray-100"},[u("th",{class:"border px-4 py-2 text-center"},"\u5E8F\u53F7"),u("th",{class:"border px-4 py-2 text-center"},"\u9879\u76EE\u540D\u79F0"),u("th",{class:"border px-4 py-2 text-center"},"\u5E74\u521D\u8BA1\u5212"),u("th",{class:"border px-4 py-2 text-center"},"\u5F53\u671F\u6267\u884C"),u("th",{class:"border px-4 py-2 text-center"},"\u6267\u884C\u8FDB\u5EA6")])],-1)),u("tbody",null,[(b(!0),E(P,null,k(a.value,(o,s)=>(b(),E("tr",{key:s},[u("td",G,l(s+1),1),u("td",z,[p(u("input",{type:"text","onUpdate:modelValue":r=>o.projectName=r,class:"w-full border-0 focus:ring-0"},null,8,H),[[m,o.projectName]])]),u("td",K,[p(u("input",{type:"number","onUpdate:modelValue":r=>o.initialPlan=r,class:"w-full border-0 focus:ring-0",onInput:r=>_(s)},null,40,Q),[[m,o.initialPlan]])]),u("td",W,[p(u("input",{type:"number","onUpdate:modelValue":r=>o.currentExecution=r,class:"w-full border-0 focus:ring-0",onInput:r=>_(s)},null,40,X),[[m,o.currentExecution]])]),u("td",Z,l(o.executionProgress||"0.0%"),1)]))),128)),u("tr",tt,[t[4]||(t[4]=u("td",{class:"border px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),u("td",et,l(x.value),1),u("td",ut,l(g.value),1),u("td",ot,l(f.value),1)])])])]),j(U,{"module-id":V(y).MAJOR_INVESTMENT_ANALYSIS,period:n.value,remarks:c.value,"onUpdate:remarks":t[1]||(t[1]=o=>c.value=o),suggestions:i.value,"onUpdate:suggestions":t[2]||(t[2]=o=>i.value=o)},null,8,["module-id","period","remarks","suggestions"])])]))}});export{at as default};
