import{_ as T,d as S,r as C,c as N,B as w,o as k,b as c,e as t,y as l,A as s,F as h,g as D,t as p,k as j,h as q,G as I,v as d,f}from"./index.d08f7120.js";import{_ as O,l as $,M,r as z}from"./FormAttachmentAndRemarks.f46940a7.js";const G={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},J={class:"flex justify-between items-center mb-6"},H={class:"flex items-center space-x-4"},K={class:"overflow-x-auto my-6"},Q={class:"w-full border-collapse border border-gray-300"},W=["rowspan"],X={class:"border border-gray-300 px-4 py-2"},Y={class:"border border-gray-300 px-4 py-2"},Z=["onUpdate:modelValue"],ee={class:"border border-gray-300 px-4 py-2"},ue=["onUpdate:modelValue"],te={class:"border border-gray-300 px-4 py-2"},re=["onUpdate:modelValue"],oe={class:"border border-gray-300 px-4 py-2"},ae=["onUpdate:modelValue"],le={class:"border border-gray-300 px-4 py-2"},se=["onUpdate:modelValue"],ne={class:"border border-gray-300 px-4 py-2"},ce=["onUpdate:modelValue"],de=["rowspan"],pe={class:"border border-gray-300 px-4 py-2"},ie={class:"border border-gray-300 px-4 py-2"},ye=["onUpdate:modelValue"],be={class:"border border-gray-300 px-4 py-2"},Ce=["onUpdate:modelValue"],me={class:"border border-gray-300 px-4 py-2"},ve=["onUpdate:modelValue"],_e={class:"border border-gray-300 px-4 py-2"},xe=["onUpdate:modelValue"],Ee={class:"border border-gray-300 px-4 py-2"},Fe=["onUpdate:modelValue"],ge={class:"border border-gray-300 px-4 py-2"},Me=["onUpdate:modelValue"],Le=["rowspan"],he={class:"border border-gray-300 px-4 py-2"},De={class:"border border-gray-300 px-4 py-2"},fe=["onUpdate:modelValue"],Be={class:"border border-gray-300 px-4 py-2"},Ae=["onUpdate:modelValue"],we={class:"border border-gray-300 px-4 py-2"},Ue=["onUpdate:modelValue"],Pe={class:"border border-gray-300 px-4 py-2"},Re=["onUpdate:modelValue"],Ve={class:"border border-gray-300 px-4 py-2"},Te=["onUpdate:modelValue"],Se={class:"border border-gray-300 px-4 py-2"},Ne=["onUpdate:modelValue"],ke={class:"bg-gray-50 font-bold"},je={class:"border border-gray-300 px-4 py-2"},qe={class:"border border-gray-300 px-4 py-2"},Ie={class:"border border-gray-300 px-4 py-2"},Oe={class:"border border-gray-300 px-4 py-2"},$e={class:"border border-gray-300 px-4 py-2"},ze={class:"border border-gray-300 px-4 py-2"},Ge=S({__name:"MainBusinessCost",setup(Je){var A;const E=I(),n=C(((A=E.query.period)==null?void 0:A.toString())||new Date().toISOString().slice(0,7)),B=()=>({equipment:[{customerType:"\u4E0A\u6D77",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u56FD\u7F51",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u6C5F\u82CF",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u8F93\u914D\u7535\u5185\u914D",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u897F\u95E8\u5B50",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u540C\u4E1A",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u7528\u6237",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u5176\u5B83",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0}],component:[{customerType:"\u7528\u6237",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0}],project:[{customerType:"\u4E00\u5305",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u4E8C\u5305",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u57DF\u5185\u5408\u4F5C",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u57DF\u5916\u5408\u4F5C",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0},{customerType:"\u5176\u5B83",yearlyPlan:"0",planExecutionRate:"0.00%",currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0}]}),U=(o,r)=>(!r||typeof r!="object"||(r.equipment&&Array.isArray(r.equipment)&&(o.equipment=o.equipment.map(u=>{const a=r.equipment.find(e=>e.customerType===u.customerType);return a?{...u,yearlyPlan:a.yearlyPlan||"0",planExecutionRate:a.planExecutionRate||"0.00%",currentMaterialCost:Number(a.currentMaterialCost)||0,cumulativeMaterialCost:Number(a.cumulativeMaterialCost)||0,currentLaborCost:Number(a.currentLaborCost)||0,cumulativeLaborCost:Number(a.cumulativeLaborCost)||0}:u})),r.component&&Array.isArray(r.component)&&(o.component=o.component.map(u=>{const a=r.component.find(e=>e.customerType===u.customerType);return a?{...u,yearlyPlan:a.yearlyPlan||"0",planExecutionRate:a.planExecutionRate||"0.00%",currentMaterialCost:Number(a.currentMaterialCost)||0,cumulativeMaterialCost:Number(a.cumulativeMaterialCost)||0,currentLaborCost:Number(a.currentLaborCost)||0,cumulativeLaborCost:Number(a.cumulativeLaborCost)||0}:u})),r.project&&Array.isArray(r.project)&&(o.project=o.project.map(u=>{const a=r.project.find(e=>e.customerType===u.customerType);return a?{...u,yearlyPlan:a.yearlyPlan||"0",planExecutionRate:a.planExecutionRate||"0.00%",currentMaterialCost:Number(a.currentMaterialCost)||0,cumulativeMaterialCost:Number(a.cumulativeMaterialCost)||0,currentLaborCost:Number(a.currentLaborCost)||0,cumulativeLaborCost:Number(a.cumulativeLaborCost)||0}:u}))),o),F=()=>{const o=B();i.value=o.equipment,y.value=o.component,b.value=o.project},i=C([]),y=C([]),b=C([]),m=C(""),v=C(""),P=()=>{const o=[...i.value,...y.value,...b.value];let r=0,u=0;return o.forEach(a=>{a.planExecutionRate&&a.planExecutionRate!=="/"&&(r+=parseFloat(a.planExecutionRate.replace(/%/g,""))||0,u++)}),u===0?"/":(r/u).toFixed(2)+"%"},_=o=>o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),x=N(()=>{const o={yearlyPlan:0,currentMaterialCost:0,cumulativeMaterialCost:0,currentLaborCost:0,cumulativeLaborCost:0};return i.value.forEach(r=>{r.yearlyPlan!=="/"&&(o.yearlyPlan+=parseFloat(r.yearlyPlan.replace(/,/g,""))||0),o.currentMaterialCost+=r.currentMaterialCost||0,o.cumulativeMaterialCost+=r.cumulativeMaterialCost||0,o.currentLaborCost+=r.currentLaborCost||0,o.cumulativeLaborCost+=r.cumulativeLaborCost||0}),y.value.forEach(r=>{r.yearlyPlan!=="/"&&(o.yearlyPlan+=parseFloat(r.yearlyPlan.replace(/,/g,""))||0),o.currentMaterialCost+=r.currentMaterialCost||0,o.cumulativeMaterialCost+=r.cumulativeMaterialCost||0,o.currentLaborCost+=r.currentLaborCost||0,o.cumulativeLaborCost+=r.cumulativeLaborCost||0}),b.value.forEach(r=>{r.yearlyPlan!=="/"&&(o.yearlyPlan+=parseFloat(r.yearlyPlan.replace(/,/g,""))||0),o.currentMaterialCost+=r.currentMaterialCost||0,o.cumulativeMaterialCost+=r.cumulativeMaterialCost||0,o.currentLaborCost+=r.currentLaborCost||0,o.cumulativeLaborCost+=r.cumulativeLaborCost||0}),o}),g=async o=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u4E3B\u8425\u4E1A\u52A1\u6210\u672C\u6570\u636E\uFF0C\u671F\u95F4: ${o}`);const r=await fetch(`http://47.111.95.19:3000/main-business-cost/${o}`);if(!r.ok){if(r.status===404){console.log("\u672A\u627E\u5230\u6570\u636E\uFF0C\u4F7F\u7528\u521D\u59CB\u6A21\u677F"),F();return}throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25")}const u=await r.json();if(console.log("API\u8FD4\u56DE\u6570\u636E:",u),u.success&&u.data){console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76...");const a=B(),e=U(a,u.data);i.value=e.equipment,y.value=e.component,b.value=e.project,console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{equipmentData:i.value,componentData:y.value,projectData:b.value})}else console.log("\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u4F7F\u7528\u521D\u59CB\u6A21\u677F"),F()}catch(r){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",r),F()}},L=async()=>{const{remarks:o,suggestions:r}=await $(M.MAIN_BUSINESS_COST,n.value);m.value=o,v.value=r};w(()=>E.query.period,o=>{o&&(n.value=o.toString(),g(o.toString()),L())}),w(n,o=>{g(o),L()});const R=async()=>{try{console.log("=== \u5F00\u59CB\u4FDD\u5B58\u4E3B\u8425\u4E1A\u52A1\u6210\u672C\u6570\u636E ==="),console.log("\u671F\u95F4:",n.value),console.log("\u6A21\u5757ID:",M.MAIN_BUSINESS_COST);const o={equipment:i.value.map(e=>({customerType:e.customerType,yearlyPlan:e.yearlyPlan,planExecutionRate:e.planExecutionRate,currentMaterialCost:e.currentMaterialCost,cumulativeMaterialCost:e.cumulativeMaterialCost,currentLaborCost:e.currentLaborCost,cumulativeLaborCost:e.cumulativeLaborCost})),component:y.value.map(e=>({customerType:e.customerType,yearlyPlan:e.yearlyPlan,planExecutionRate:e.planExecutionRate,currentMaterialCost:e.currentMaterialCost,cumulativeMaterialCost:e.cumulativeMaterialCost,currentLaborCost:e.currentLaborCost,cumulativeLaborCost:e.cumulativeLaborCost})),project:b.value.map(e=>({customerType:e.customerType,yearlyPlan:e.yearlyPlan,planExecutionRate:e.planExecutionRate,currentMaterialCost:e.currentMaterialCost,cumulativeMaterialCost:e.cumulativeMaterialCost,currentLaborCost:e.currentLaborCost,cumulativeLaborCost:e.cumulativeLaborCost}))};console.log("\u8868\u5355\u6570\u636E:",o),console.log("\u6B65\u9AA41\uFF1A\u4FDD\u5B58\u5230\u4E13\u7528\u8868...");const r=await fetch("http://47.111.95.19:3000/main-business-cost",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:n.value,data:o})});if(!r.ok){const e=await r.text();throw console.error("\u4E13\u7528\u8868\u4FDD\u5B58\u5931\u8D25\uFF0C\u54CD\u5E94:",e),new Error("\u4FDD\u5B58\u5931\u8D25")}const u=await r.json();console.log("\u4E13\u7528\u8868\u4FDD\u5B58\u6210\u529F:",u),console.log("\u6B65\u9AA42\uFF1A\u8BB0\u5F55\u63D0\u4EA4\u72B6\u6001...");const a=await z(M.MAIN_BUSINESS_COST,n.value,o,m.value,v.value);console.log("\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u7ED3\u679C:",a),a?(console.log("=== \u4FDD\u5B58\u5B8C\u6210\uFF0C\u6240\u6709\u6B65\u9AA4\u6210\u529F ==="),alert("\u4FDD\u5B58\u6210\u529F")):(console.warn("=== \u4E13\u7528\u8868\u4FDD\u5B58\u6210\u529F\uFF0C\u4F46\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u5931\u8D25 ==="),alert("\u4FDD\u5B58\u6210\u529F\uFF0C\u4F46\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u5931\u8D25"))}catch(o){console.error("=== \u4FDD\u5B58\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF ===",o),alert("\u4FDD\u5B58\u5931\u8D25: "+(o instanceof Error?o.message:"\u672A\u77E5\u9519\u8BEF"))}},V=()=>{F(),m.value="",v.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return k(()=>{console.log("\u4E3B\u8425\u4E1A\u52A1\u6210\u672C\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",n.value),E.query.period?g(E.query.period.toString()):g(n.value),L()}),(o,r)=>(d(),c("div",G,[t("div",J,[r[3]||(r[3]=t("h1",{class:"text-2xl font-bold"},"\u4E3B\u8425\u4E1A\u52A1\u6210\u672C\u7ED3\u6784\u4E0E\u8D28\u91CF\uFF08\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3\uFF09",-1)),t("div",H,[l(t("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>n.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[s,n.value]])])]),t("div",K,[r[6]||(r[6]=t("h2",{class:"text-xl font-semibold mb-3"},"\u5BF9\u5E94\u5E74\u5EA6\u8BA1\u5212:",-1)),t("table",Q,[r[5]||(r[5]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u5EA6\u8BA1\u5212"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u8BA1\u5212\u6267\u884C\u7387"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u6750\u6599\u8D39\u7528"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u6750\u6599\u8D39\u7528"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u4EBA\u5DE5\u8D39\u7528"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1\u4EBA\u5DE5\u8D39\u7528")])],-1)),t("tbody",null,[(d(!0),c(h,null,D(i.value,(u,a)=>(d(),c("tr",{key:`equipment-${a}`},[a===0?(d(),c("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:i.value.length}," \u8BBE\u5907 ",8,W)):f("",!0),t("td",X,p(u.customerType),1),t("td",Y,[l(t("input",{"onUpdate:modelValue":e=>u.yearlyPlan=e,type:"text",class:"w-full px-2 py-1 border rounded"},null,8,Z),[[s,u.yearlyPlan]])]),t("td",ee,[l(t("input",{"onUpdate:modelValue":e=>u.planExecutionRate=e,type:"text",class:"w-full px-2 py-1 border rounded"},null,8,ue),[[s,u.planExecutionRate]])]),t("td",te,[l(t("input",{"onUpdate:modelValue":e=>u.currentMaterialCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,re),[[s,u.currentMaterialCost,void 0,{number:!0}]])]),t("td",oe,[l(t("input",{"onUpdate:modelValue":e=>u.cumulativeMaterialCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ae),[[s,u.cumulativeMaterialCost,void 0,{number:!0}]])]),t("td",le,[l(t("input",{"onUpdate:modelValue":e=>u.currentLaborCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,se),[[s,u.currentLaborCost,void 0,{number:!0}]])]),t("td",ne,[l(t("input",{"onUpdate:modelValue":e=>u.cumulativeLaborCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ce),[[s,u.cumulativeLaborCost,void 0,{number:!0}]])])]))),128)),(d(!0),c(h,null,D(y.value,(u,a)=>(d(),c("tr",{key:`component-${a}`},[a===0?(d(),c("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:y.value.length}," \u5143\u4EF6 ",8,de)):f("",!0),t("td",pe,p(u.customerType),1),t("td",ie,[l(t("input",{"onUpdate:modelValue":e=>u.yearlyPlan=e,type:"text",class:"w-full px-2 py-1 border rounded"},null,8,ye),[[s,u.yearlyPlan]])]),t("td",be,[l(t("input",{"onUpdate:modelValue":e=>u.planExecutionRate=e,type:"text",class:"w-full px-2 py-1 border rounded"},null,8,Ce),[[s,u.planExecutionRate]])]),t("td",me,[l(t("input",{"onUpdate:modelValue":e=>u.currentMaterialCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,ve),[[s,u.currentMaterialCost,void 0,{number:!0}]])]),t("td",_e,[l(t("input",{"onUpdate:modelValue":e=>u.cumulativeMaterialCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,xe),[[s,u.cumulativeMaterialCost,void 0,{number:!0}]])]),t("td",Ee,[l(t("input",{"onUpdate:modelValue":e=>u.currentLaborCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Fe),[[s,u.currentLaborCost,void 0,{number:!0}]])]),t("td",ge,[l(t("input",{"onUpdate:modelValue":e=>u.cumulativeLaborCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Me),[[s,u.cumulativeLaborCost,void 0,{number:!0}]])])]))),128)),(d(!0),c(h,null,D(b.value,(u,a)=>(d(),c("tr",{key:`project-${a}`},[a===0?(d(),c("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:b.value.length}," \u5DE5\u7A0B ",8,Le)):f("",!0),t("td",he,p(u.customerType),1),t("td",De,[l(t("input",{"onUpdate:modelValue":e=>u.yearlyPlan=e,type:"text",class:"w-full px-2 py-1 border rounded"},null,8,fe),[[s,u.yearlyPlan]])]),t("td",Be,[l(t("input",{"onUpdate:modelValue":e=>u.planExecutionRate=e,type:"text",class:"w-full px-2 py-1 border rounded"},null,8,Ae),[[s,u.planExecutionRate]])]),t("td",we,[l(t("input",{"onUpdate:modelValue":e=>u.currentMaterialCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Ue),[[s,u.currentMaterialCost,void 0,{number:!0}]])]),t("td",Pe,[l(t("input",{"onUpdate:modelValue":e=>u.cumulativeMaterialCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Re),[[s,u.cumulativeMaterialCost,void 0,{number:!0}]])]),t("td",Ve,[l(t("input",{"onUpdate:modelValue":e=>u.currentLaborCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Te),[[s,u.currentLaborCost,void 0,{number:!0}]])]),t("td",Se,[l(t("input",{"onUpdate:modelValue":e=>u.cumulativeLaborCost=e,type:"number",class:"w-full px-2 py-1 border rounded",step:"0.01"},null,8,Ne),[[s,u.cumulativeLaborCost,void 0,{number:!0}]])])]))),128)),t("tr",ke,[r[4]||(r[4]=t("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),t("td",je,p(_(x.value.yearlyPlan)),1),t("td",qe,p(P()),1),t("td",Ie,p(_(x.value.currentMaterialCost)),1),t("td",Oe,p(_(x.value.cumulativeMaterialCost)),1),t("td",$e,p(_(x.value.currentLaborCost)),1),t("td",ze,p(_(x.value.cumulativeLaborCost)),1)])])])]),j(O,{"module-id":q(M).MAIN_BUSINESS_COST,period:n.value,remarks:m.value,"onUpdate:remarks":r[1]||(r[1]=u=>m.value=u),suggestions:v.value,"onUpdate:suggestions":r[2]||(r[2]=u=>v.value=u)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:R,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:V,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var Qe=T(Ge,[["__scopeId","data-v-3732036f"]]);export{Qe as default};
