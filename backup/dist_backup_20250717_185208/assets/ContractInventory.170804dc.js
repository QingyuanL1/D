import{_,d as F,r as f,c as J,B as R,o as N,b as w,e as t,y as l,A as i,t as o,l as p,k as C,h as B,G as S,v as I}from"./index.5d6963f7.js";import{_ as U,M as D,r as k}from"./FormAttachmentAndRemarks.a356591a.js";const V={class:"max-w-[1600px] mx-auto bg-white rounded-lg shadow-lg p-6"},$={class:"flex justify-between items-center mb-6"},H={class:"flex items-center space-x-4"},O={class:"overflow-x-auto my-6"},L={class:"w-full border-collapse border border-gray-300"},T={class:"border border-gray-300 px-4 py-2 text-right"},q={class:"border border-gray-300 px-4 py-2"},M={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"border border-gray-300 px-4 py-2 text-right"},z={class:"border border-gray-300 px-4 py-2 text-right"},G={class:"border border-gray-300 px-4 py-2"},K={class:"border border-gray-300 px-4 py-2 text-right"},Q={class:"border border-gray-300 px-4 py-2 text-right"},W={class:"border border-gray-300 px-4 py-2 text-right"},X={class:"border border-gray-300 px-4 py-2"},Z={class:"border border-gray-300 px-4 py-2 text-right"},tt={class:"border border-gray-300 px-4 py-2 text-right"},et={class:"border border-gray-300 px-4 py-2 text-right"},rt={class:"border border-gray-300 px-4 py-2"},nt={class:"border border-gray-300 px-4 py-2 text-right"},ut={class:"border border-gray-300 px-4 py-2 text-right"},ot={class:"border border-gray-300 px-4 py-2 text-right"},at={class:"border border-gray-300 px-4 py-2"},st={class:"border border-gray-300 px-4 py-2 text-right"},lt={class:"border border-gray-300 px-4 py-2 text-right"},it={class:"border border-gray-300 px-4 py-2 text-right"},dt={class:"border border-gray-300 px-4 py-2"},gt={class:"border border-gray-300 px-4 py-2 text-right"},ct={class:"border border-gray-300 px-4 py-2 text-right"},pt={class:"border border-gray-300 px-4 py-2 text-right"},yt={class:"border border-gray-300 px-4 py-2"},bt={class:"border border-gray-300 px-4 py-2 text-right"},mt={class:"border border-gray-300 px-4 py-2 text-right"},xt={class:"border border-gray-300 px-4 py-2 text-right"},vt={class:"border border-gray-300 px-4 py-2"},At={class:"border border-gray-300 px-4 py-2 text-right"},ft={class:"border border-gray-300 px-4 py-2 text-right"},Dt={class:"border border-gray-300 px-4 py-2 text-right"},jt={class:"border border-gray-300 px-4 py-2"},Et={class:"border border-gray-300 px-4 py-2 text-right"},Rt={class:"border border-gray-300 px-4 py-2 text-right"},Pt={class:"bg-gray-50 font-bold"},ht={class:"border border-gray-300 px-4 py-2 text-right"},_t={class:"border border-gray-300 px-4 py-2 text-right"},Ft={class:"border border-gray-300 px-4 py-2 text-right"},Jt={class:"border border-gray-300 px-4 py-2 text-right"},Nt={class:"text-sm font-bold"},wt=F({__name:"ContractInventory",setup(Ct){var E;const y=S(),d=f(((E=y.query.period)==null?void 0:E.toString())||new Date().toISOString().slice(0,7)),j={yunJianProjects:[{projectName:"\u4E00\u5305\u9879\u76EE",beginningRollingData:1900,currentAmount:0,accumulatedAmount:0,fluctuationRate:0},{projectName:"\u4E8C\u5305\u9879\u76EE",beginningRollingData:500,currentAmount:0,accumulatedAmount:0,fluctuationRate:0},{projectName:"\u81EA\u5EFA\u9879\u76EE",beginningRollingData:0,currentAmount:0,accumulatedAmount:0,fluctuationRate:0}],yunJianHeLiProject:{projectName:"\u8FD0\u68C0\u5408\u529B\u9879\u76EE",beginningRollingData:180,currentAmount:0,accumulatedAmount:0,fluctuationRate:0},engineeringProjects:[{projectName:"\u5EFA\u7B51\u5DE5\u7A0B\u9879\u76EE",beginningRollingData:280,currentAmount:0,accumulatedAmount:0,fluctuationRate:0},{projectName:"\u65B0\u80FD\u6E90\u9879\u76EE",beginningRollingData:0,currentAmount:0,accumulatedAmount:0,fluctuationRate:0},{projectName:"\u82CF\u5DDE\u9879\u76EE",beginningRollingData:0,currentAmount:0,accumulatedAmount:0,fluctuationRate:0},{projectName:"\u70DF\u56F1\u9879\u76EE",beginningRollingData:0,currentAmount:0,accumulatedAmount:0,fluctuationRate:0},{projectName:"\u8FD0\u68C0\u9879\u76EE",beginningRollingData:3e3,currentAmount:0,accumulatedAmount:0,fluctuationRate:0}]},r=f(JSON.parse(JSON.stringify(j))),b=f(""),m=f(""),a=n=>n===0?"0.00":n.toFixed(2),s=n=>n===0?"0.00":n.toFixed(2),g=n=>n>0?"text-red-500":n<0?"text-green-500":"text-gray-500",c=n=>{n.accumulatedAmount=n.beginningRollingData+(n.currentAmount||0),n.beginningRollingData>0?n.fluctuationRate=(n.accumulatedAmount-n.beginningRollingData)/n.beginningRollingData*100:n.fluctuationRate=n.accumulatedAmount>0?100:0},x=J(()=>{const n={beginningRollingData:0,currentAmount:0,accumulatedAmount:0,fluctuationRate:0};return r.value.yunJianProjects.forEach(e=>{n.beginningRollingData+=e.beginningRollingData||0,n.currentAmount+=e.currentAmount||0,n.accumulatedAmount+=e.accumulatedAmount||0}),n.beginningRollingData+=r.value.yunJianHeLiProject.beginningRollingData||0,n.currentAmount+=r.value.yunJianHeLiProject.currentAmount||0,n.accumulatedAmount+=r.value.yunJianHeLiProject.accumulatedAmount||0,r.value.engineeringProjects.forEach(e=>{n.beginningRollingData+=e.beginningRollingData||0,n.currentAmount+=e.currentAmount||0,n.accumulatedAmount+=e.accumulatedAmount||0}),n.beginningRollingData>0?n.fluctuationRate=(n.accumulatedAmount-n.beginningRollingData)/n.beginningRollingData*100:n.fluctuationRate=n.accumulatedAmount>0?100:0,n}),v=async n=>{try{const e=await fetch(`http://47.111.95.19:3000/nanhua-contract-inventory/${n}`);if(!e.ok){if(e.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");return}const u=await e.json();u.data&&(r.value=u.data)}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e)}},A=async n=>{try{const e=await fetch(`http://47.111.95.19:3000/forms/submission/${D.NANHUA_CONTRACT_INVENTORY}/${n}`);if(e.ok){const u=await e.json();u.success&&u.data&&(b.value=u.data.remarks||"",m.value=u.data.suggestions||"")}}catch(e){console.error("\u52A0\u8F7D\u5907\u6CE8\u5931\u8D25:",e)}};R(()=>y.query.period,async n=>{n&&(d.value=n.toString(),await v(n.toString()),A(n.toString()))}),R(d,async(n,e)=>{n&&n!==e&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${e} -> ${n}`),await v(n),A(n))});const P=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/nanhua-contract-inventory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:d.value,data:r.value})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await k(D.NANHUA_CONTRACT_INVENTORY,d.value,r.value,b.value,m.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(n){console.error("\u4FDD\u5B58\u5931\u8D25:",n),alert("\u4FDD\u5B58\u5931\u8D25")}},h=()=>{r.value=JSON.parse(JSON.stringify(j)),b.value="",m.value=""};return N(async()=>{y.query.period?(await v(y.query.period.toString()),A(y.query.period.toString())):(await v(d.value),A(d.value))}),(n,e)=>(I(),w("div",V,[t("div",$,[e[22]||(e[22]=t("h1",{class:"text-2xl font-bold"},"\u5728\u5EFA\u5DE5\u7A0B\uFF08\u5408\u540C\u5B58\u91CF\uFF09",-1)),t("div",H,[e[21]||(e[21]=t("span",{class:"text-sm text-gray-600"},"\uFF08\u5355\u4F4D\uFF1A\u4E07\u5143\uFF09",-1)),l(t("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>d.value=u),type:"month",class:"px-3 py-2 border rounded"},null,512),[[i,d.value]])])]),t("div",O,[t("table",L,[e[36]||(e[36]=t("thead",{class:"sticky top-0 bg-white"},[t("tr",{class:"bg-gray-50"},[t("th",{class:"border border-gray-300 px-4 py-2"},"\u6A21\u5757"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u9879\u76EE\u540D\u79F0"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u521D\u6EDA\u52A8\u6570\u636E"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u7D2F\u8BA1"),t("th",{class:"border border-gray-300 px-4 py-2"},"\u53D8\u52A8\u7387")])],-1)),t("tbody",null,[t("tr",null,[e[23]||(e[23]=t("td",{rowspan:"3",class:"border border-gray-300 px-4 py-2 font-medium text-center"},"\u8FD0\u68C0\u9879\u76EE",-1)),e[24]||(e[24]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u4E00\u5305\u9879\u76EE",-1)),t("td",T,o(a(r.value.yunJianProjects[0].beginningRollingData)),1),t("td",q,[l(t("input",{"onUpdate:modelValue":e[1]||(e[1]=u=>r.value.yunJianProjects[0].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[2]||(e[2]=u=>c(r.value.yunJianProjects[0]))},null,544),[[i,r.value.yunJianProjects[0].currentAmount]])]),t("td",M,o(a(r.value.yunJianProjects[0].accumulatedAmount)),1),t("td",Y,[t("span",{class:p(g(r.value.yunJianProjects[0].fluctuationRate))},o(s(r.value.yunJianProjects[0].fluctuationRate))+"%",3)])]),t("tr",null,[e[25]||(e[25]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u4E8C\u5305\u9879\u76EE",-1)),t("td",z,o(a(r.value.yunJianProjects[1].beginningRollingData)),1),t("td",G,[l(t("input",{"onUpdate:modelValue":e[3]||(e[3]=u=>r.value.yunJianProjects[1].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[4]||(e[4]=u=>c(r.value.yunJianProjects[1]))},null,544),[[i,r.value.yunJianProjects[1].currentAmount]])]),t("td",K,o(a(r.value.yunJianProjects[1].accumulatedAmount)),1),t("td",Q,[t("span",{class:p(g(r.value.yunJianProjects[1].fluctuationRate))},o(s(r.value.yunJianProjects[1].fluctuationRate))+"%",3)])]),t("tr",null,[e[26]||(e[26]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u81EA\u5EFA\u9879\u76EE",-1)),t("td",W,o(a(r.value.yunJianProjects[2].beginningRollingData)),1),t("td",X,[l(t("input",{"onUpdate:modelValue":e[5]||(e[5]=u=>r.value.yunJianProjects[2].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[6]||(e[6]=u=>c(r.value.yunJianProjects[2]))},null,544),[[i,r.value.yunJianProjects[2].currentAmount]])]),t("td",Z,o(a(r.value.yunJianProjects[2].accumulatedAmount)),1),t("td",tt,[t("span",{class:p(g(r.value.yunJianProjects[2].fluctuationRate))},o(s(r.value.yunJianProjects[2].fluctuationRate))+"%",3)])]),t("tr",null,[e[27]||(e[27]=t("td",{class:"border border-gray-300 px-4 py-2 font-medium text-center"},"\u8FD0\u68C0\u5408\u529B\u9879\u76EE",-1)),e[28]||(e[28]=t("td",{class:"border border-gray-300 px-4 py-2"},null,-1)),t("td",et,o(a(r.value.yunJianHeLiProject.beginningRollingData)),1),t("td",rt,[l(t("input",{"onUpdate:modelValue":e[7]||(e[7]=u=>r.value.yunJianHeLiProject.currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[8]||(e[8]=u=>c(r.value.yunJianHeLiProject))},null,544),[[i,r.value.yunJianHeLiProject.currentAmount]])]),t("td",nt,o(a(r.value.yunJianHeLiProject.accumulatedAmount)),1),t("td",ut,[t("span",{class:p(g(r.value.yunJianHeLiProject.fluctuationRate))},o(s(r.value.yunJianHeLiProject.fluctuationRate))+"%",3)])]),t("tr",null,[e[29]||(e[29]=t("td",{rowspan:"5",class:"border border-gray-300 px-4 py-2 font-medium text-center"},"\u5DE5\u7A0B",-1)),e[30]||(e[30]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u5EFA\u7B51\u5DE5\u7A0B\u9879\u76EE",-1)),t("td",ot,o(a(r.value.engineeringProjects[0].beginningRollingData)),1),t("td",at,[l(t("input",{"onUpdate:modelValue":e[9]||(e[9]=u=>r.value.engineeringProjects[0].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[10]||(e[10]=u=>c(r.value.engineeringProjects[0]))},null,544),[[i,r.value.engineeringProjects[0].currentAmount]])]),t("td",st,o(a(r.value.engineeringProjects[0].accumulatedAmount)),1),t("td",lt,[t("span",{class:p(g(r.value.engineeringProjects[0].fluctuationRate))},o(s(r.value.engineeringProjects[0].fluctuationRate))+"%",3)])]),t("tr",null,[e[31]||(e[31]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u65B0\u80FD\u6E90\u9879\u76EE",-1)),t("td",it,o(a(r.value.engineeringProjects[1].beginningRollingData)),1),t("td",dt,[l(t("input",{"onUpdate:modelValue":e[11]||(e[11]=u=>r.value.engineeringProjects[1].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[12]||(e[12]=u=>c(r.value.engineeringProjects[1]))},null,544),[[i,r.value.engineeringProjects[1].currentAmount]])]),t("td",gt,o(a(r.value.engineeringProjects[1].accumulatedAmount)),1),t("td",ct,[t("span",{class:p(g(r.value.engineeringProjects[1].fluctuationRate))},o(s(r.value.engineeringProjects[1].fluctuationRate))+"%",3)])]),t("tr",null,[e[32]||(e[32]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u82CF\u5DDE\u9879\u76EE",-1)),t("td",pt,o(a(r.value.engineeringProjects[2].beginningRollingData)),1),t("td",yt,[l(t("input",{"onUpdate:modelValue":e[13]||(e[13]=u=>r.value.engineeringProjects[2].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[14]||(e[14]=u=>c(r.value.engineeringProjects[2]))},null,544),[[i,r.value.engineeringProjects[2].currentAmount]])]),t("td",bt,o(a(r.value.engineeringProjects[2].accumulatedAmount)),1),t("td",mt,[t("span",{class:p(g(r.value.engineeringProjects[2].fluctuationRate))},o(s(r.value.engineeringProjects[2].fluctuationRate))+"%",3)])]),t("tr",null,[e[33]||(e[33]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u70DF\u56F1\u9879\u76EE",-1)),t("td",xt,o(a(r.value.engineeringProjects[3].beginningRollingData)),1),t("td",vt,[l(t("input",{"onUpdate:modelValue":e[15]||(e[15]=u=>r.value.engineeringProjects[3].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[16]||(e[16]=u=>c(r.value.engineeringProjects[3]))},null,544),[[i,r.value.engineeringProjects[3].currentAmount]])]),t("td",At,o(a(r.value.engineeringProjects[3].accumulatedAmount)),1),t("td",ft,[t("span",{class:p(g(r.value.engineeringProjects[3].fluctuationRate))},o(s(r.value.engineeringProjects[3].fluctuationRate))+"%",3)])]),t("tr",null,[e[34]||(e[34]=t("td",{class:"border border-gray-300 px-4 py-2"},"\u8FD0\u68C0\u9879\u76EE",-1)),t("td",Dt,o(a(r.value.engineeringProjects[4].beginningRollingData)),1),t("td",jt,[l(t("input",{"onUpdate:modelValue":e[17]||(e[17]=u=>r.value.engineeringProjects[4].currentAmount=u),type:"number",class:"w-full px-2 py-1 border rounded text-right",step:"0.01",onInput:e[18]||(e[18]=u=>c(r.value.engineeringProjects[4]))},null,544),[[i,r.value.engineeringProjects[4].currentAmount]])]),t("td",Et,o(a(r.value.engineeringProjects[4].accumulatedAmount)),1),t("td",Rt,[t("span",{class:p(g(r.value.engineeringProjects[4].fluctuationRate))},o(s(r.value.engineeringProjects[4].fluctuationRate))+"%",3)])]),t("tr",Pt,[e[35]||(e[35]=t("td",{colspan:"2",class:"border border-gray-300 px-4 py-2 text-center"},"\u5408\u8BA1",-1)),t("td",ht,o(a(x.value.beginningRollingData)),1),t("td",_t,o(a(x.value.currentAmount)),1),t("td",Ft,o(a(x.value.accumulatedAmount)),1),t("td",Jt,[t("span",Nt,o(s(x.value.fluctuationRate))+"%",1)])])])])]),C(U,{"module-id":B(D).NANHUA_CONTRACT_INVENTORY,period:d.value,remarks:b.value,"onUpdate:remarks":e[19]||(e[19]=u=>b.value=u),suggestions:m.value,"onUpdate:suggestions":e[20]||(e[20]=u=>m.value=u)},null,8,["module-id","period","remarks","suggestions"]),t("div",{class:"mt-4 flex justify-end space-x-4"},[t("button",{onClick:P,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),t("button",{onClick:h,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var It=_(wt,[["__scopeId","data-v-1eb0054c"]]);export{It as default};
