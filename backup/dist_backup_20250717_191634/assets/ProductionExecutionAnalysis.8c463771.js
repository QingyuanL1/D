import{_ as tu,d as ru,r as f,c as s,B as q,o as nu,b as g,e as o,y as c,A as d,F as O,g as R,t as a,k as su,h as lu,G as au,v,f as k}from"./index.0de2a829.js";import{_ as cu,l as du,M as D,r as iu}from"./FormAttachmentAndRemarks.6e720ff0.js";const pu={class:"container mx-auto p-6"},yu={class:"bg-white rounded-lg shadow-md p-6 mb-6"},mu={class:"flex items-center justify-between mb-4"},gu={class:"flex items-center"},vu={class:"overflow-x-auto"},bu={class:"min-w-full border-collapse"},Pu=["rowspan"],xu={class:"border px-4 py-2"},fu={class:"border px-4 py-2"},Fu=["onUpdate:modelValue","onInput"],Eu={class:"border px-4 py-2"},_u=["onUpdate:modelValue","onInput"],Bu={class:"border px-4 py-2"},Du=["onUpdate:modelValue","onInput"],hu={class:"border px-4 py-2"},Au=["onUpdate:modelValue","onInput"],Cu={class:"bg-gray-50"},wu={class:"border px-4 py-2 text-right"},Su={class:"border px-4 py-2 text-right"},Iu={class:"border px-4 py-2 text-right"},Tu={class:"border px-4 py-2"},Uu={class:"border px-4 py-2"},Nu={class:"border px-4 py-2"},Vu={class:"border px-4 py-2"},ju={class:"bg-gray-50"},qu={class:"border px-4 py-2 text-right"},Ou={class:"border px-4 py-2 text-right"},Ru={class:"border px-4 py-2 text-right"},ku=["rowspan"],$u={class:"border px-4 py-2"},Lu={class:"border px-4 py-2"},Yu=["onUpdate:modelValue","onInput"],Mu={class:"border px-4 py-2"},Xu=["onUpdate:modelValue","onInput"],zu={class:"border px-4 py-2"},Gu=["onUpdate:modelValue","onInput"],Ju={class:"border px-4 py-2"},Hu=["onUpdate:modelValue","onInput"],Ku={class:"bg-gray-50"},Qu={class:"border px-4 py-2 text-right"},Wu={class:"border px-4 py-2 text-right"},Zu={class:"border px-4 py-2 text-right"},ue={class:"bg-gray-100 font-bold"},ee={class:"border px-4 py-2 text-right"},oe={class:"border px-4 py-2 text-right"},te={class:"border px-4 py-2 text-right"},re={class:"border px-4 py-2 text-right"},ne={class:"bg-white rounded-lg shadow-md p-6"},se=ru({__name:"ProductionExecutionAnalysis",setup(le){var j;const F=au(),i=f(((j=F.query.period)==null?void 0:j.toString())||new Date().toISOString().substr(0,7)),b=f(""),P=f(""),C=()=>({equipment:[{id:1,segment:"\u8BBE\u5907",customerType:"\u4E0A\u6D77",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:2,segment:"\u8BBE\u5907",customerType:"\u56FD\u7F51",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:3,segment:"\u8BBE\u5907",customerType:"\u6C5F\u82CF",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:4,segment:"\u8BBE\u5907",customerType:"\u8F93\u914D\u7535\u5185\u914D",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:5,segment:"\u8BBE\u5907",customerType:"\u897F\u95E8\u5B50",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:6,segment:"\u8BBE\u5907",customerType:"\u540C\u4E1A",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:7,segment:"\u8BBE\u5907",customerType:"\u7528\u6237",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:8,segment:"\u8BBE\u5907",customerType:"\u5176\u5B83",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0}],component:{yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},project:[{id:10,segment:"\u5DE5\u7A0B",customerType:"\u4E00\u5305",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:11,segment:"\u5DE5\u7A0B",customerType:"\u4E8C\u5305",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:12,segment:"\u5DE5\u7A0B",customerType:"\u57DF\u5185\u5408\u4F5C",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:13,segment:"\u5DE5\u7A0B",customerType:"\u57DF\u5916\u5408\u4F5C",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0},{id:14,segment:"\u5DE5\u7A0B",customerType:"\u5176\u5B83",yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0}]}),x=f([]),n=f({yearlyPlan:0,selfProduction:0,semiProduction:0,outsourcing:0}),h=()=>{const u=C();x.value=[...u.equipment,...u.project],n.value={...u.component}},y=s(()=>x.value.filter(u=>u.segment==="\u8BBE\u5907")),m=s(()=>x.value.filter(u=>u.segment==="\u5DE5\u7A0B")),p=u=>{console.log(`\u91CD\u65B0\u8BA1\u7B97 ${u.customerType} \u7684\u6BD4\u7387`)},E=()=>{console.log("\u91CD\u65B0\u8BA1\u7B97\u5143\u4EF6\u6BD4\u7387")},_=s(()=>y.value.reduce((u,e)=>u+Number(e.yearlyPlan||0),0)),w=s(()=>y.value.reduce((u,e)=>u+Number(e.selfProduction||0),0)),S=s(()=>y.value.reduce((u,e)=>u+Number(e.semiProduction||0),0)),I=s(()=>y.value.reduce((u,e)=>u+Number(e.outsourcing||0),0)),$=s(()=>{const u=_.value;return u>0?(w.value/u*100).toFixed(1)+"%":"0.0%"}),L=s(()=>{const u=_.value;return u>0?(S.value/u*100).toFixed(1)+"%":"0.0%"}),Y=s(()=>{const u=_.value;return u>0?(I.value/u*100).toFixed(1)+"%":"0.0%"}),M=s(()=>{const u=n.value.yearlyPlan;return u>0?(n.value.selfProduction/u*100).toFixed(1)+"%":"0.0%"}),X=s(()=>{const u=n.value.yearlyPlan;return u>0?(n.value.semiProduction/u*100).toFixed(1)+"%":"0.0%"}),z=s(()=>{const u=n.value.yearlyPlan;return u>0?(n.value.outsourcing/u*100).toFixed(1)+"%":"0.0%"}),B=s(()=>m.value.reduce((u,e)=>u+Number(e.yearlyPlan||0),0)),T=s(()=>m.value.reduce((u,e)=>u+Number(e.selfProduction||0),0)),U=s(()=>m.value.reduce((u,e)=>u+Number(e.semiProduction||0),0)),N=s(()=>m.value.reduce((u,e)=>u+Number(e.outsourcing||0),0)),G=s(()=>{const u=B.value;return u>0?(T.value/u*100).toFixed(1)+"%":"0.0%"}),J=s(()=>{const u=B.value;return u>0?(U.value/u*100).toFixed(1)+"%":"0.0%"}),H=s(()=>{const u=B.value;return u>0?(N.value/u*100).toFixed(1)+"%":"0.0%"}),K=s(()=>_.value+n.value.yearlyPlan+B.value),Q=s(()=>w.value+n.value.selfProduction+T.value),W=s(()=>S.value+n.value.semiProduction+U.value),Z=s(()=>I.value+n.value.outsourcing+N.value),uu=(u,e)=>(!e||typeof e!="object"||(e.equipment&&Array.isArray(e.equipment)&&(u.equipment=u.equipment.map(t=>{const l=e.equipment.find(r=>r.customerType===t.customerType);return l?{...t,...l}:t})),e.component&&(u.component={...u.component,...e.component}),e.project&&Array.isArray(e.project)&&(u.project=u.project.map(t=>{const l=e.project.find(r=>r.customerType===t.customerType);return l?{...t,...l}:t}))),u),A=async u=>{try{console.log(`\u6B63\u5728\u52A0\u8F7D\u751F\u4EA7\u6267\u884C\u5206\u6790\u6570\u636E\uFF0C\u671F\u95F4: ${u}`);const e=await fetch(`http://47.111.95.19:3000/production-execution/${u}`);if(!e.ok){if(e.status!==404)throw new Error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25");console.log("\u672A\u627E\u5230\u6570\u636E\uFF0C\u4F7F\u7528\u521D\u59CB\u6A21\u677F"),h();return}const t=await e.json();if(console.log("API\u8FD4\u56DE\u6570\u636E:",t),t.success&&t.data){console.log("\u6210\u529F\u83B7\u53D6\u6570\u636E\uFF0C\u5F00\u59CB\u5408\u5E76...");const l=C(),r=uu(l,t.data);x.value=[...r.equipment,...r.project],n.value={...r.component},console.log("\u5408\u5E76\u540E\u7684\u6570\u636E:",{tableData:x.value,componentData:n.value})}}catch(e){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e),h()}},V=async()=>{const{remarks:u,suggestions:e}=await du(D.PRODUCTION_EXECUTION_ANALYSIS,i.value);b.value=u,P.value=e};q(i,u=>{A(u),V()}),q(()=>F.query.period,u=>{u&&(i.value=u.toString())});const eu=async()=>{try{console.log("=== \u5F00\u59CB\u4FDD\u5B58\u751F\u4EA7\u6267\u884C\u5206\u6790\u6570\u636E ==="),console.log("\u671F\u95F4:",i.value),console.log("\u6A21\u5757ID:",D.PRODUCTION_EXECUTION_ANALYSIS);const u={equipment:y.value.map(r=>({customerType:r.customerType,yearlyPlan:r.yearlyPlan,selfProduction:r.selfProduction,semiProduction:r.semiProduction,outsourcing:r.outsourcing})),component:{yearlyPlan:n.value.yearlyPlan,selfProduction:n.value.selfProduction,semiProduction:n.value.semiProduction,outsourcing:n.value.outsourcing},project:m.value.map(r=>({customerType:r.customerType,yearlyPlan:r.yearlyPlan,selfProduction:r.selfProduction,semiProduction:r.semiProduction,outsourcing:r.outsourcing}))};console.log("\u8868\u5355\u6570\u636E:",u),console.log("\u6B65\u9AA41\uFF1A\u4FDD\u5B58\u5230\u4E13\u7528\u8868...");const e=await fetch("http://47.111.95.19:3000/production-execution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:i.value,data:u})});if(!e.ok){const r=await e.text();throw console.error("\u4E13\u7528\u8868\u4FDD\u5B58\u5931\u8D25\uFF0C\u54CD\u5E94:",r),new Error("\u4FDD\u5B58\u5931\u8D25")}const t=await e.json();console.log("\u4E13\u7528\u8868\u4FDD\u5B58\u6210\u529F:",t),console.log("\u6B65\u9AA42\uFF1A\u8BB0\u5F55\u63D0\u4EA4\u72B6\u6001...");const l=await iu(D.PRODUCTION_EXECUTION_ANALYSIS,i.value,u,b.value,P.value);console.log("\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u7ED3\u679C:",l),l?(console.log("=== \u4FDD\u5B58\u5B8C\u6210\uFF0C\u6240\u6709\u6B65\u9AA4\u6210\u529F ==="),alert("\u4FDD\u5B58\u6210\u529F")):(console.warn("=== \u4E13\u7528\u8868\u4FDD\u5B58\u6210\u529F\uFF0C\u4F46\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u5931\u8D25 ==="),alert("\u4FDD\u5B58\u6210\u529F\uFF0C\u4F46\u63D0\u4EA4\u72B6\u6001\u8BB0\u5F55\u5931\u8D25"))}catch(u){console.error("=== \u4FDD\u5B58\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF ===",u),alert("\u4FDD\u5B58\u5931\u8D25: "+(u instanceof Error?u.message:"\u672A\u77E5\u9519\u8BEF"))}},ou=()=>{h(),b.value="",P.value="",console.log("\u5DF2\u91CD\u7F6E\u4E3A\u521D\u59CB\u6570\u636E")};return nu(()=>{console.log("\u751F\u4EA7\u6267\u884C\u5206\u6790\u7EC4\u4EF6\u6302\u8F7D\uFF0C\u5F53\u524D\u671F\u95F4:",i.value),F.query.period?A(F.query.period.toString()):A(i.value),V()}),(u,e)=>(v(),g("div",pu,[e[18]||(e[18]=o("h1",{class:"text-2xl font-bold mb-6"},"\u751F\u4EA7/\u65BD\u5DE5\u8BA2\u5355\u751F\u4EA7\u65BD\u5DE5\u6267\u884C\u60C5\u51B5",-1)),o("div",yu,[o("div",mu,[o("div",gu,[e[7]||(e[7]=o("span",{class:"mr-2"},"\u9009\u62E9\u65E5\u671F\uFF1A",-1)),c(o("input",{type:"month","onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),class:"border rounded px-2 py-1"},null,512),[[d,i.value]])]),o("div",{class:"flex space-x-4"},[o("button",{onClick:eu,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors"}," \u4FDD\u5B58\u6570\u636E "),o("button",{onClick:ou,class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors"}," \u91CD\u7F6E ")])]),o("div",vu,[o("table",bu,[e[17]||(e[17]=o("thead",null,[o("tr",{class:"bg-gray-100"},[o("th",{class:"border px-4 py-2 text-left"},"\u677F\u5757"),o("th",{class:"border px-4 py-2 text-left"},"\u5BA2\u6237\u5C5E\u6027"),o("th",{class:"border px-4 py-2 text-center"},"\u5E74\u5EA6\u8BA1\u5212\u4EA7\u503C"),o("th",{class:"border px-4 py-2 text-center"},"\u81EA\u5236/\u81EA\u884C\u65BD\u5DE5"),o("th",{class:"border px-4 py-2 text-center"},"\u534A\u81EA\u5236/\u5206\u5305"),o("th",{class:"border px-4 py-2 text-center"},"\u5916\u53D1/\u8F6C\u5305")])],-1)),o("tbody",null,[(v(!0),g(O,null,R(y.value,(t,l)=>(v(),g("tr",{key:`equipment-${l}`},[l===0?(v(),g("td",{key:0,class:"border px-4 py-2",rowspan:y.value.length+1},"\u8BBE\u5907",8,Pu)):k("",!0),o("td",xu,a(t.customerType),1),o("td",fu,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.yearlyPlan=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,Fu),[[d,t.yearlyPlan,void 0,{number:!0}]])]),o("td",Eu,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.selfProduction=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,_u),[[d,t.selfProduction,void 0,{number:!0}]])]),o("td",Bu,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.semiProduction=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,Du),[[d,t.semiProduction,void 0,{number:!0}]])]),o("td",hu,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.outsourcing=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,Au),[[d,t.outsourcing,void 0,{number:!0}]])])]))),128)),o("tr",Cu,[e[8]||(e[8]=o("td",{class:"border px-4 py-2"},"\u81EA\u5236\u7387%",-1)),e[9]||(e[9]=o("td",{class:"border px-4 py-2"},null,-1)),o("td",wu,a($.value),1),o("td",Su,a(L.value),1),o("td",Iu,a(Y.value),1)]),o("tr",null,[e[10]||(e[10]=o("td",{class:"border px-4 py-2",rowspan:"2"},"\u5143\u4EF6",-1)),e[11]||(e[11]=o("td",{class:"border px-4 py-2"},"\u7528\u6237",-1)),o("td",Tu,[c(o("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=t=>n.value.yearlyPlan=t),class:"w-full border-0 focus:ring-0 text-right",onInput:E},null,544),[[d,n.value.yearlyPlan,void 0,{number:!0}]])]),o("td",Uu,[c(o("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=t=>n.value.selfProduction=t),class:"w-full border-0 focus:ring-0 text-right",onInput:E},null,544),[[d,n.value.selfProduction,void 0,{number:!0}]])]),o("td",Nu,[c(o("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=t=>n.value.semiProduction=t),class:"w-full border-0 focus:ring-0 text-right",onInput:E},null,544),[[d,n.value.semiProduction,void 0,{number:!0}]])]),o("td",Vu,[c(o("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=t=>n.value.outsourcing=t),class:"w-full border-0 focus:ring-0 text-right",onInput:E},null,544),[[d,n.value.outsourcing,void 0,{number:!0}]])])]),o("tr",ju,[e[12]||(e[12]=o("td",{class:"border px-4 py-2"},"\u81EA\u5236\u7387%",-1)),e[13]||(e[13]=o("td",{class:"border px-4 py-2"},null,-1)),o("td",qu,a(M.value),1),o("td",Ou,a(X.value),1),o("td",Ru,a(z.value),1)]),(v(!0),g(O,null,R(m.value,(t,l)=>(v(),g("tr",{key:`project-${l}`},[l===0?(v(),g("td",{key:0,class:"border px-4 py-2",rowspan:m.value.length+1},"\u5DE5\u7A0B",8,ku)):k("",!0),o("td",$u,a(t.customerType),1),o("td",Lu,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.yearlyPlan=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,Yu),[[d,t.yearlyPlan,void 0,{number:!0}]])]),o("td",Mu,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.selfProduction=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,Xu),[[d,t.selfProduction,void 0,{number:!0}]])]),o("td",zu,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.semiProduction=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,Gu),[[d,t.semiProduction,void 0,{number:!0}]])]),o("td",Ju,[c(o("input",{type:"number","onUpdate:modelValue":r=>t.outsourcing=r,class:"w-full border-0 focus:ring-0 text-right",onInput:r=>p(t)},null,40,Hu),[[d,t.outsourcing,void 0,{number:!0}]])])]))),128)),o("tr",Ku,[e[14]||(e[14]=o("td",{class:"border px-4 py-2"},"\u81EA\u884C\u65BD\u5DE5\u7387%",-1)),e[15]||(e[15]=o("td",{class:"border px-4 py-2"},null,-1)),o("td",Qu,a(G.value),1),o("td",Wu,a(J.value),1),o("td",Zu,a(H.value),1)]),o("tr",ue,[e[16]||(e[16]=o("td",{class:"border px-4 py-2",colspan:"2"},"\u5408\u8BA1\u4EA7\u503C",-1)),o("td",ee,a(K.value.toLocaleString()),1),o("td",oe,a(Q.value.toLocaleString()),1),o("td",te,a(W.value.toLocaleString()),1),o("td",re,a(Z.value.toLocaleString()),1)])])])])]),o("div",ne,[su(cu,{"module-id":lu(D).PRODUCTION_EXECUTION_ANALYSIS,period:i.value,remarks:b.value,"onUpdate:remarks":e[5]||(e[5]=t=>b.value=t),suggestions:P.value,"onUpdate:suggestions":e[6]||(e[6]=t=>P.value=t)},null,8,["module-id","period","remarks","suggestions"])])]))}});var de=tu(se,[["__scopeId","data-v-d44f7026"]]);export{de as default};
