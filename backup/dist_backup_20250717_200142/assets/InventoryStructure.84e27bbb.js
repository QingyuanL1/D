import{_ as G,d as K,r as F,c as M,B as T,o as z,b as l,e as r,y as H,A as Q,F as O,g as J,t as n,k as W,h as X,G as Z,v as i,f as k}from"./index.32959950.js";import{_ as P,M as $,r as tt}from"./FormAttachmentAndRemarks.fa0944e0.js";const ut={class:"max-w-[1500px] mx-auto bg-white rounded-lg shadow-lg p-6"},et={class:"flex justify-between items-center mb-6"},rt={class:"flex items-center space-x-4"},ot={class:"overflow-x-auto my-6"},nt={class:"w-full border-collapse border border-gray-300"},st=["rowspan"],at={class:"border border-gray-300 px-4 py-2"},ct={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},lt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},it={class:"font-medium"},pt={class:"border border-gray-300 px-4 py-2 text-right"},dt=["rowspan"],mt={class:"border border-gray-300 px-4 py-2"},yt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},gt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},bt={class:"font-medium"},Ft={class:"border border-gray-300 px-4 py-2 text-right"},At=["rowspan"],vt={class:"border border-gray-300 px-4 py-2"},ht={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},Dt={class:"border border-gray-300 px-4 py-2 text-right bg-gray-50"},_t={class:"font-medium"},Et={class:"border border-gray-300 px-4 py-2 text-right"},ft={class:"bg-gray-50 font-bold"},xt={class:"border border-gray-300 px-4 py-2 text-right"},Bt={class:"border border-gray-300 px-4 py-2 text-right"},St={class:"border border-gray-300 px-4 py-2 text-right"},Ct=K({__name:"InventoryStructure",setup(Nt){var j;const A=Z(),p=F(((j=A.query.period)==null?void 0:j.toString())||new Date().toISOString().slice(0,7)),h=F(""),D=F(""),_=[{customerType:"\u4E0A\u6D77",initialAmount:39151.53,currentAmount:0},{customerType:"\u56FD\u7F51",initialAmount:7841.48,currentAmount:0},{customerType:"\u6C5F\u82CF",initialAmount:6793.01,currentAmount:0},{customerType:"\u8F93\u914D\u7535\u5185\u914D",initialAmount:0,currentAmount:0},{customerType:"\u897F\u95E8\u5B50",initialAmount:28.46,currentAmount:0},{customerType:"\u540C\u4E1A",initialAmount:821.55,currentAmount:0},{customerType:"\u7528\u6237",initialAmount:577.37,currentAmount:0},{customerType:"\u5176\u5B83",initialAmount:220.08,currentAmount:0}],E=[{customerType:"\u7528\u6237",initialAmount:26.6,currentAmount:0}],f=[{customerType:"\u4E00\u5305",initialAmount:12720.17,currentAmount:0},{customerType:"\u4E8C\u5305",initialAmount:960.55,currentAmount:0},{customerType:"\u57DF\u5185\u5408\u4F5C",initialAmount:1818.79,currentAmount:0},{customerType:"\u57DF\u5916\u5408\u4F5C",initialAmount:8063.91,currentAmount:0},{customerType:"\u5176\u5B83",initialAmount:1973.08,currentAmount:0}],s=F(JSON.parse(JSON.stringify(_))),a=F(JSON.parse(JSON.stringify(E))),c=F(JSON.parse(JSON.stringify(f))),m=u=>(Number(u)||0).toLocaleString(),x=(u,t)=>u===0?"0.00":((t-u)/u*100).toFixed(2),w=M(()=>[...s.value,...a.value,...c.value].reduce((u,t)=>u+(Number(t.initialAmount)||0),0)),I=M(()=>[...s.value,...a.value,...c.value].reduce((u,t)=>u+(Number(t.currentAmount)||0),0)),v=async u=>{try{const t=await fetch(`http://47.111.95.19:3000/forms/submission/${$.INVENTORY_STRUCTURE}/${u}`);if(t.ok){const e=await t.json();e.success&&e.data&&(h.value=e.data.remarks||"",D.value=e.data.suggestions||"")}}catch(t){console.error("\u52A0\u8F7D\u5907\u6CE8\u548C\u5EFA\u8BAE\u5931\u8D25:",t)}},U=async u=>{try{const t=[],e=u.substring(0,4),o=parseInt(u.substring(5,7));for(let d=1;d<=o;d++){const y=`${e}-${d.toString().padStart(2,"0")}`;try{const g=await fetch(`http://47.111.95.19:3000/contract-inventory/${y}`);if(g.ok){const b=await g.json();b.success&&b.data&&t.push({period:y,data:b.data})}}catch(g){console.log(`\u8DF3\u8FC7\u6708\u4EFD ${y}:`,g)}}return t}catch(t){return console.error("\u52A0\u8F7D\u6240\u6709\u6708\u4EFDcontract_inventory\u6570\u636E\u5931\u8D25:",t),[]}},S=(u,t,e)=>{var b,q;console.log(`\u8BA1\u7B97\u5F53\u671F\u91D1\u989D: \u7C7B\u522B=${u}, \u5BA2\u6237=${t}`);const o={equipment:{\u4E0A\u6D77:1200.5,\u56FD\u7F51:2300.75,\u6C5F\u82CF:800.25,\u8F93\u914D\u7535\u5185\u914D:150,\u897F\u95E8\u5B50:0,\u540C\u4E1A:950.6,\u7528\u6237:750.4,\u5176\u5B83:200.3},component:{\u7528\u6237:500.8},project:{\u4E00\u5305:300.2,\u4E8C\u5305:150.1,\u57DF\u5185\u5408\u4F5C:1100.9,\u57DF\u5916\u5408\u4F5C:650.75,\u5176\u5B83:400.5}};let d=0;u==="\u8BBE\u5907"&&o.equipment[t]!==void 0?d=o.equipment[t]:u==="\u5143\u4EF6"&&o.component[t]!==void 0?d=o.component[t]:u==="\u5DE5\u7A0B"&&o.project[t]!==void 0&&(d=o.project[t]);let y=0;for(const C of e){const R=u==="\u8BBE\u5907"?"equipment":u==="\u5143\u4EF6"?"component":"project";if(C.data[R]){const N=C.data[R].find(L=>L.customerType===t);N&&(y+=parseFloat((b=N.currentIncrease)==null?void 0:b.toString())||0,console.log(`  ${C.period}\u6708\u4EFD\u65B0\u589E: ${parseFloat((q=N.currentIncrease)==null?void 0:q.toString())||0}`))}}const g=d+y;return console.log(`  \u5E74\u521D\u4F59\u91CF: ${d}, \u603B\u65B0\u589E: ${y}, \u5F53\u671F\u5E93\u5B58: ${g}`),g},B=async u=>{try{console.log(`=== \u5F00\u59CB\u52A0\u8F7D\u5B58\u91CF\u7ED3\u6784\u6570\u636E\uFF0C\u671F\u95F4: ${u} ===`);const t=await U(u);console.log("\u52A0\u8F7D\u7684\u5408\u540C\u5B58\u91CF\u6570\u636E:",t),s.value=JSON.parse(JSON.stringify(_)),a.value=JSON.parse(JSON.stringify(E)),c.value=JSON.parse(JSON.stringify(f)),console.log("=== \u5F00\u59CB\u66F4\u65B0\u8BBE\u5907\u677F\u5757 ==="),s.value.forEach(e=>{e.currentAmount=S("\u8BBE\u5907",e.customerType,t)}),console.log("=== \u5F00\u59CB\u66F4\u65B0\u5143\u4EF6\u677F\u5757 ==="),a.value.forEach(e=>{e.currentAmount=S("\u5143\u4EF6",e.customerType,t)}),console.log("=== \u5F00\u59CB\u66F4\u65B0\u5DE5\u7A0B\u677F\u5757 ==="),c.value.forEach(e=>{e.currentAmount=S("\u5DE5\u7A0B",e.customerType,t)}),console.log("=== \u6570\u636E\u52A0\u8F7D\u5B8C\u6210 ==="),console.log("\u6700\u7EC8\u6570\u636E:",{equipmentData:s.value,componentData:a.value,projectData:c.value})}catch(t){console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",t),s.value=JSON.parse(JSON.stringify(_)),a.value=JSON.parse(JSON.stringify(E)),c.value=JSON.parse(JSON.stringify(f))}};T(p,u=>{B(u),v(u)}),T(()=>A.query.period,u=>{u&&(p.value=u.toString(),B(u.toString()),v(u.toString()))}),T(p,(u,t)=>{u&&u!==t&&(console.log(`\u671F\u95F4\u53D1\u751F\u53D8\u5316: ${t} -> ${u}`),B(u),v(u))});const V=async()=>{try{if(!(await fetch("http://47.111.95.19:3000/inventory-structure",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({period:p.value,data:{equipment:s.value.map(t=>({customerType:t.customerType,initialAmount:t.initialAmount})),component:a.value.map(t=>({customerType:t.customerType,initialAmount:t.initialAmount})),project:c.value.map(t=>({customerType:t.customerType,initialAmount:t.initialAmount}))}})})).ok)throw new Error("\u4FDD\u5B58\u5931\u8D25");await tt($.INVENTORY_STRUCTURE,p.value,{equipment:s.value,component:a.value,project:c.value},h.value,D.value),alert("\u4FDD\u5B58\u6210\u529F")}catch(u){console.error("\u4FDD\u5B58\u5931\u8D25:",u),alert("\u4FDD\u5B58\u5931\u8D25")}},Y=()=>{s.value=JSON.parse(JSON.stringify(_)),a.value=JSON.parse(JSON.stringify(E)),c.value=JSON.parse(JSON.stringify(f))};return z(()=>{A.query.period?(B(A.query.period.toString()),v(A.query.period.toString())):v(p.value)}),(u,t)=>(i(),l("div",ut,[r("div",et,[t[3]||(t[3]=r("h1",{class:"text-2xl font-bold"},"\u5B58\u91CF\u7ED3\u6784\u4E0E\u8D28\u91CF\uFF08\u6309\u5E74\u5EA6\u8BA1\u5212\u53E3\u5F84\u5206\u89E3\uFF09",-1)),r("div",rt,[H(r("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),type:"month",class:"px-3 py-2 border rounded"},null,512),[[Q,p.value]])])]),r("div",ot,[r("table",nt,[t[5]||(t[5]=r("thead",{class:"sticky top-0 bg-white"},[r("tr",{class:"bg-gray-50"},[r("th",{class:"border border-gray-300 px-4 py-2"},"\u677F\u5757"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5BA2\u6237\u5C5E\u6027"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5E74\u521D\u91D1\u989D"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u5F53\u671F\u91D1\u989D"),r("th",{class:"border border-gray-300 px-4 py-2"},"\u6CE2\u52A8\u7387")])],-1)),r("tbody",null,[(i(!0),l(O,null,J(s.value,(e,o)=>(i(),l("tr",{key:`equipment-${o}`},[o===0?(i(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:s.value.length}," \u8BBE\u5907 ",8,st)):k("",!0),r("td",at,n(e.customerType),1),r("td",ct,[r("span",null,n(m(e.initialAmount)),1)]),r("td",lt,[r("span",it,n(m(e.currentAmount)),1)]),r("td",pt,n(x(e.initialAmount,e.currentAmount))+"% ",1)]))),128)),(i(!0),l(O,null,J(a.value,(e,o)=>(i(),l("tr",{key:`component-${o}`},[o===0?(i(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:a.value.length}," \u5143\u4EF6 ",8,dt)):k("",!0),r("td",mt,n(e.customerType),1),r("td",yt,[r("span",null,n(m(e.initialAmount)),1)]),r("td",gt,[r("span",bt,n(m(e.currentAmount)),1)]),r("td",Ft,n(x(e.initialAmount,e.currentAmount))+"% ",1)]))),128)),(i(!0),l(O,null,J(c.value,(e,o)=>(i(),l("tr",{key:`project-${o}`},[o===0?(i(),l("td",{key:0,class:"border border-gray-300 px-4 py-2 text-center",rowspan:c.value.length}," \u5DE5\u7A0B ",8,At)):k("",!0),r("td",vt,n(e.customerType),1),r("td",ht,[r("span",null,n(m(e.initialAmount)),1)]),r("td",Dt,[r("span",_t,n(m(e.currentAmount)),1)]),r("td",Et,n(x(e.initialAmount,e.currentAmount))+"% ",1)]))),128)),r("tr",ft,[t[4]||(t[4]=r("td",{class:"border border-gray-300 px-4 py-2 text-center",colspan:"2"},"\u5408\u8BA1",-1)),r("td",xt,n(m(w.value)),1),r("td",Bt,n(m(I.value)),1),r("td",St,n(x(w.value,I.value))+"% ",1)])])])]),W(P,{"module-id":X($).INVENTORY_STRUCTURE,period:p.value,remarks:h.value,"onUpdate:remarks":t[1]||(t[1]=e=>h.value=e),suggestions:D.value,"onUpdate:suggestions":t[2]||(t[2]=e=>D.value=e)},null,8,["module-id","period","remarks","suggestions"]),r("div",{class:"mt-4 flex justify-end space-x-4"},[r("button",{onClick:V,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u4FDD\u5B58 "),r("button",{onClick:Y,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," \u91CD\u7F6E ")])]))}});var Jt=G(Ct,[["__scopeId","data-v-2f7c3410"]]);export{Jt as default};
